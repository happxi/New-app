<nav class="bottom-nav glass-nav flex justify-around items-center px-2">
    <button class="tab-item w-full h-full text-gray-400" onclick="navigateTo('sanctuary')" id="nav-sanctuary">
        <svg id="icon-sanctuary" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 1 0-2.652-2.652L6.832 9.07a1.875 1.875 0 1 0 2.652 2.652l9.76-9.76Z"/>
            <path stroke-linecap="round" stroke-linejoin="round" d="M18.882 17.519a4.5 4.5 0 0 0-7.373-3.955l-3.237 3.237a3 3 0 0 0 .848 5.61 3.5 3.5 0 0 0 5.483-3.665"/>
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 7.5a1.5 1.5 0 0 1 1.5 1.5v1.5a1.5 1.5 0 0 1-3 0V9a1.5 1.5 0 0 1 1.5-1.5z"/>
        </svg>
        <span class="text-[10px] font-medium mt-0.5">ì˜¤ëŠ˜ì˜ ë¬´ë“œ</span>
    </button>
    
    </nav>

<div id="diaryWriteModal" class="modal bg-black/90 backdrop-blur-xl" onclick="closeModal(event, 'diaryWriteModal')">
    <div class="modal-content w-full h-full max-w-none max-h-none p-0 rounded-none bg-white relative">
        <form id="diaryForm" class="p-6 h-[calc(100vh-60px)] flex flex-col">
            
            <div id="moodTracker" class="mb-4 pt-2 pb-4 border-b border-gray-100">
                <p class="text-sm font-medium text-text-sub mb-2 flex justify-between items-center">
                    ì˜¤ëŠ˜ì˜ ê¸°ë¶„ì€ ì–´ë–¤ê°€ìš”?
                    </p>
                <div class="flex justify-between items-center overflow-x-auto gap-2">
                    <button type="button" class="mood-icon text-3xl p-1 rounded-full border-2 border-transparent active:scale-95 transition" data-mood="í–‰ë³µ" data-color="#FFD700">ğŸ˜„</button>
                    <button type="button" class="mood-icon text-3xl p-1 rounded-full border-2 border-transparent active:scale-95 transition" data-mood="í‰ì˜¨" data-color="#A2E8E4">ğŸ˜Œ</button>
                    <button type="button" class="mood-icon text-3xl p-1 rounded-full border-2 border-transparent active:scale-95 transition" data-mood="ì„¤ë ˜" data-color="#FFB6C1">ğŸ¥°</button>
                    <button type="button" class="mood-icon text-3xl p-1 rounded-full border-2 border-transparent active:scale-95 transition" data-mood="ì§€ì¹¨" data-color="#FFA07A">ğŸ˜©</button>
                    <button type="button" class="mood-icon text-3xl p-1 rounded-full border-2 border-transparent active:scale-95 transition" data-mood="ë¶„ë…¸" data-color="#FF6347">ğŸ˜ </button>
                    <button type="button" class="mood-icon text-3xl p-1 rounded-full border-2 border-transparent active:scale-95 transition" data-mood="ìŠ¬í””" data-color="#ADD8E6">ğŸ˜¢</button>
                    <button type="button" class="mood-icon text-3xl p-1 rounded-full border-2 border-transparent active:scale-95 transition" data-mood="ë¶ˆì•ˆ" data-color="#DDA0DD">ğŸ˜Ÿ</button>
                    <button type="button" class="mood-icon text-3xl p-1 rounded-full border-2 border-transparent active:scale-95 transition" data-mood="ë¬´ê´€ì‹¬" data-color="#D3D3D3">ğŸ˜</button>
                </div>
            </div>
            
            <input type="text" id="diaryTitle" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒ)" class="w-full text-2xl font-bold p-3 border-b-2 border-gray-100 focus:outline-none focus:border-primary-blue/70 transition mb-4">
            
            <textarea id="diaryContent" placeholder="ì˜¤ëŠ˜ì€ ì–´ë–¤ í•˜ë£¨ì˜€ë‚˜ìš”? (ê¸°ë¡ ì‹œì‘ ì‹œ ì‚¬ë¼ì§‘ë‹ˆë‹¤)" rows="15" 
                      class="w-full flex-grow text-base leading-relaxed p-3 bg-white focus:outline-none resize-none placeholder-gentle-gray"
                      style="font-family: 'Noto Sans KR', sans-serif;">
            </textarea>
            
            </form>
    </div>
</div>

<script>
    // ... (ê¸°ì¡´ V12.0ì˜ data, currentUser, checkDiaryFormStatus í•¨ìˆ˜ ìœ ì§€) ...
    
    // V13.0: Sanctuary í˜ì´ì§€ ë Œë”ë§ í•¨ìˆ˜ ì—…ë°ì´íŠ¸ (ì†Œì œëª© ì¶”ê°€ ë° ë³´ì•ˆ ì‹œë®¬ë ˆì´ì…˜)
    function renderSanctuary() {
        if (!currentUser) {
            // ë¹„ë¡œê·¸ì¸ ì‹œ ë¡œì§ (ë¡œê·¸ì¸ ìœ ë„)
            const sanctuaryPage = document.getElementById('sanctuaryPage');
            sanctuaryPage.innerHTML = `<p class="text-center text-gray-400 mt-20">ë¡œê·¸ì¸í•´ì•¼ ë‚˜ë§Œì˜ ë¹„ë°€ ê³µê°„, 'ì˜¤ëŠ˜ì˜ ë¬´ë“œ'ë¥¼ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>`;
            return;
        }

        const header = document.getElementById('sanctuaryHeader');
        const container = document.getElementById('diaryListContainer');
        
        // V13.0: Headerì— ì†Œì œëª© ì¶”ê°€ ë° ë³´ì•ˆ ì‹œë®¬ë ˆì´ì…˜
        const diaryName = "My Sanctuary"; // ë‚´ë¶€ ëª…ì¹­ì€ ìœ ì§€
        header.innerHTML = `
            <div class="flex-grow">
                <h2 class="text-2xl font-bold text-text-main flex items-center">
                    ${diaryName} 
                    <svg class="w-5 h-5 ml-2 text-primary-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6-6h.008v.008H6v-.008zm0 3h.008v.008H6v-.008zm0 3h.008v.008H6v-.008zm3-3h.008v.008H9v-.008zm0 3h.008v.008H9v-.008zm9-9h.008v.008H18v-.008zm0 3h.008v.008H18v-.008zm0 3h.008v.008H18v-.008z"/></svg>
                </h2>
                <p class="text-sm text-text-sub mt-1">í–…ì‚ë‹˜ì´ ì˜¤ëŠ˜ ëŠë‚€ ê°ì •ê³¼ ìƒê°ë“¤ì„ ì†”ì§í•˜ê²Œ ê¸°ë¡í•´ ë³´ì„¸ìš”!</p>
            </div>
            <button id="writeDiaryBtn" onclick="showDiaryWriteModal()" class="p-2 bg-primary-blue rounded-full text-white shadow-md hover:bg-blue-600 transition active:scale-90">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
            </button>
        `;
        
        container.innerHTML = '';
        
        // V13.0: ë³´ì•ˆ/ì ‘ê·¼ì„± ë°˜ì˜ ì‹œë®¬ë ˆì´ì…˜: ì‹¤ì œë¡œëŠ” ì„œë²„ì—ì„œ currentUserì˜ ê¸°ë¡ë§Œ ê°€ì ¸ì™€ì•¼ í•¨.
        const userDiaries = data.diaries.filter(d => d.userId === currentUser.id);

        userDiaries.forEach(diary => {
            // V13.0: Mood Colorë¥¼ í™œìš©í•˜ì—¬ ë‹¤ì´ì–´ë¦¬ ì¹´ë“œ ë””ìì¸ ì—…ë°ì´íŠ¸
            const html = `
                <div class="bg-white p-5 rounded-2xl shadow-soft border-l-4 border-[${diary.moodColor || '#D3D3D3'}] cursor-pointer active:scale-[0.99] transition-transform group" onclick="toggleDiaryContent(this, ${diary.id})">
                    </div>
            `;
            container.innerHTML += html;
        });
        
        if (userDiaries.length === 0) {
            container.innerHTML = `<p class="text-center text-gray-400 mt-10">ì•„ì§ ê¸°ë¡ëœ ë¬´ë“œê°€ ì—†ì–´ìš”. ì²« ê¸°ë¡ì„ ë‚¨ê²¨ë³´ì„¸ìš”! :)</p>`;
        }
    }
    
    // V13.0: Mood Icon í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì—…ë°ì´íŠ¸ (ê°ì •ëª… í‘œì‹œ ì œê±° ë°˜ì˜)
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.mood-icon').forEach(button => {
            button.addEventListener('click', (e) => {
                e.preventDefault(); 
                
                // ëª¨ë“  ì•„ì´ì½˜ ì´ˆê¸°í™” (í…Œë‘ë¦¬ ì œê±°)
                document.querySelectorAll('.mood-icon').forEach(btn => {
                    btn.style.borderColor = 'transparent';
                    btn.style.boxShadow = 'none';
                });
                
                // ì„ íƒëœ ì•„ì´ì½˜ í•˜ì´ë¼ì´íŠ¸
                const mood = e.currentTarget.getAttribute('data-mood');
                const color = e.currentTarget.getAttribute('data-color');
                
                e.currentTarget.style.borderColor = color;
                e.currentTarget.style.boxShadow = `0 0 10px ${color}80`;
                
                // ìƒíƒœ ì—…ë°ì´íŠ¸
                selectedMood = {
                    mood: mood,
                    icon: e.currentTarget.innerText.trim(),
                    color: color
                };
                
                // V13.0: ê°ì •ëª… í‘œì‹œ ë¡œì§ ì œê±° (ìš”ì²­ ë°˜ì˜)
                
                checkDiaryFormStatus();
            });
        });
        
        // ... (ë‚´ìš© ì…ë ¥ ë¦¬ìŠ¤ë„ˆ ìœ ì§€) ...
    });
</script>
