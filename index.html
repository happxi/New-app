<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ìíœ´ë ˆí„°</title>
    
    <!-- í°íŠ¸ & ì•„ì´ì½˜ -->
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Round+Gothic:wght@400;700;800&family=Gaegu:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <style>
        :root {
            /* ğŸ¨ ê°ì„± íŒŒìŠ¤í…” íŒ”ë ˆíŠ¸ */
            --primary: #9D76C1;       /* ë” ë¶€ë“œëŸ¬ìš´ ë¼ë²¤ë” */
            --primary-soft: #F8F5FF;  /* ì•„ì£¼ ì—°í•œ ë³´ë¼ */
            --primary-gradient: linear-gradient(135deg, #E0C3FC 0%, #8EC5FC 100%);
            --accent: #FFB7B2;        /* ì‚´êµ¬ í•‘í¬ */
            --bg-body: #FFFCF9;       /* ë”°ëœ»í•œ ë¯¸ìƒ‰ ë°°ê²½ */
            --text-main: #4A4A4A;     /* ì§„í•œ íšŒìƒ‰ (ê²€ì •ë³´ë‹¤ ë¶€ë“œëŸ¬ì›€) */
            --text-sub: #9B9B9B;
            --glass: rgba(255, 255, 255, 0.8);
            --glass-border: 1px solid rgba(255, 255, 255, 0.6);
            --shadow: 0 10px 30px rgba(157, 118, 193, 0.15);
            --radius: 25px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Nanum Round Gothic', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: var(--bg-body); 
            color: var(--text-main); 
            min-height: 100vh; 
            display: flex; flex-direction: column; align-items: center; 
        }

        .app-container { 
            width: 100%; max-width: 480px; min-height: 100vh; 
            background: var(--bg-body); 
            position: relative; padding-bottom: 100px; 
            box-shadow: 0 0 50px rgba(0,0,0,0.05);
        }

        /* âœ¨ í—¤ë” (ì‹¬í”Œ & ì¤‘ì•™) */
        .header {
            padding: 20px;
            text-align: center;
            background: transparent;
            margin-top: 10px;
        }
        .logo { 
            font-family: 'Gaegu', cursive; 
            font-size: 28px; 
            font-weight: 700; 
            color: var(--primary); 
            letter-spacing: 1px;
        }

        /* ğŸ  í™ˆ: ì¸ì‚¬ë§ (ì¤‘ì•™ ì •ë ¬) */
        .home-greeting {
            text-align: center;
            margin: 20px 0 30px;
        }
        .home-greeting h2 { font-size: 22px; margin-bottom: 8px; color: var(--text-main); }
        .home-greeting p { font-size: 14px; color: var(--text-sub); }

        /* íˆì–´ë¡œ ì¹´ë“œ */
        .hero-card {
            margin: 0 20px 30px; padding: 30px 25px;
            background: var(--primary-gradient);
            border-radius: var(--radius); color: white; text-align: center;
            box-shadow: var(--shadow);
            position: relative; overflow: hidden; cursor: pointer;
            transition: transform 0.2s;
        }
        .hero-card:active { transform: scale(0.98); }
        .hero-title { font-size: 18px; font-weight: 800; margin-bottom: 8px; }
        .hero-sub { font-size: 13px; opacity: 0.95; }

        /* ğŸ”˜ í€µë©”ë‰´ (í•¸ë“œ ë“œë¡œì‰ ëŠë‚Œ) */
        .quick-menu { display: flex; justify-content: space-between; padding: 0 25px; margin-bottom: 40px; }
        .quick-item { display: flex; flex-direction: column; align-items: center; cursor: pointer; gap: 8px; }
        .quick-icon {
            width: 60px; height: 60px; border-radius: 22px;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; color: white;
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            border: 2px solid white;
        }
        .icon-letter { background: #FFD1DC; color: #D66D75; }
        .icon-challenge { background: #C1E1C1; color: #588157; }
        .icon-sentence { background: #B5EAD7; color: #3B7A57; }
        .icon-chat { background: #FFDAC1; color: #E07A5F; }
        .quick-text { font-size: 12px; font-weight: 700; color: var(--text-sub); }

        /* ğŸ’Œ ë ˆí„° ì•„ì¹´ì´ë¸Œ íƒ­ ìŠ¤íƒ€ì¼ */
        .archive-header { padding: 20px 20px 10px; }
        .archive-title { font-size: 24px; font-weight: 800; margin-bottom: 20px; color: var(--primary); text-align: center;}
        
        /* íƒ­ ë²„íŠ¼ (ê³µì§€/ë ˆí„°/ë©) */
        .archive-tabs { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
        .tab-btn {
            padding: 10px 20px; border-radius: 30px;
            background: white; border: 1px solid #eee;
            color: var(--text-sub); font-weight: 700; font-size: 14px;
            cursor: pointer; transition: all 0.2s;
        }
        .tab-btn.active {
            background: var(--primary); color: white; border-color: var(--primary);
            box-shadow: 0 5px 15px rgba(157, 118, 193, 0.3);
        }

        /* í•€í„°ë ˆìŠ¤íŠ¸ ê·¸ë¦¬ë“œ */
        .masonry-grid { column-count: 2; column-gap: 15px; padding: 0 20px; }
        .pin-card {
            break-inside: avoid; margin-bottom: 15px;
            background: white; border-radius: 20px;
            overflow: hidden; box-shadow: var(--shadow);
            cursor: pointer; transition: transform 0.2s;
            border: 1px solid rgba(0,0,0,0.02);
        }
        .pin-img { width: 100%; display: block; }
        .pin-content { padding: 15px; }
        .pin-badge { 
            display: inline-block; padding: 4px 8px; border-radius: 8px; 
            font-size: 10px; font-weight: 700; margin-bottom: 5px;
        }
        .badge-new { background: #FF6B6B; color: white; }
        .badge-notice { background: #FFD43B; color: #862E9C; }
        .pin-title { font-size: 14px; font-weight: 700; line-height: 1.4; color: #333; margin-bottom: 8px; }
        .pin-meta { font-size: 11px; color: #aaa; display: flex; justify-content: space-between; }

        /* ğŸ—“ï¸ ë¬´ë“œ ìº˜ë¦°ë” (íŒŒìŠ¤í…”í†¤ ê°•í™”) */
        .calendar-wrap { 
            background: white; border-radius: 30px; 
            padding: 25px; margin: 0 20px 20px;
            box-shadow: var(--shadow);
        }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; font-weight: 800; font-size: 18px; color: var(--text-main); }
        .week-days { display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; font-size: 12px; color: #bbb; margin-bottom: 10px; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; }
        .day-cell {
            aspect-ratio: 1/1; border-radius: 12px;
            background: #FAFAFA; 
            display: flex; align-items: center; justify-content: center;
            font-size: 12px; color: #ddd; position: relative;
        }
        .day-cell.today { border: 2px solid var(--accent); color: var(--accent); font-weight: 700; }
        .day-emoji { font-size: 22px; }
        
        /* ë¬´ë“œ ë²„íŠ¼ ê·¸ë£¹ */
        .mood-actions { display: flex; gap: 10px; padding: 0 20px; margin-bottom: 30px; }
        .mood-btn {
            flex: 1; padding: 15px; border-radius: 20px; border: none;
            font-weight: 700; font-size: 14px; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 8px;
            transition: transform 0.2s; box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        .btn-save { background: #E0E7FF; color: #5C7CFA; }
        .btn-share { background: #FFE3E3; color: #FA5252; }

        /* ğŸƒâ€â™€ï¸ ì±Œë¦°ì§€ íƒ­ */
        .challenge-header { text-align: center; padding: 30px 20px; background: #F3F0FF; margin-bottom: 20px; border-radius: 0 0 30px 30px; }
        .make-challenge-btn {
            background: white; color: var(--primary);
            padding: 12px 25px; border-radius: 30px; border: none;
            font-weight: 700; font-size: 14px; margin-top: 15px;
            box-shadow: 0 5px 15px rgba(157, 118, 193, 0.2); cursor: pointer;
        }

        /* ğŸ“ ê¸€ì“°ê¸° ëª¨ë‹¬ (ì˜ˆì˜ê²Œ!) */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.9); z-index: 2000;
            backdrop-filter: blur(5px);
            display: none; justify-content: center; align-items: center;
        }
        .write-card {
            background: white; width: 90%; max-width: 400px;
            border-radius: 30px; padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            border: 1px solid #f0f0f0; position: relative;
        }
        .write-card h3 { text-align: center; margin-bottom: 20px; color: var(--primary); }
        .modal-btn-group { display: flex; gap: 10px; margin-top: 20px; }
        .modal-btn {
            flex: 1; padding: 15px; border-radius: 15px; border: none;
            font-weight: 700; cursor: pointer; font-size: 14px;
        }
        .btn-submit { background: var(--primary-gradient); color: white; box-shadow: 0 5px 15px rgba(157, 118, 193, 0.4); }
        .btn-cancel { background: #f1f3f5; color: #868e96; }
        
        /* â†˜ï¸ ë’¤ë¡œê°€ê¸° ì•„ì´ì½˜ (ìš°ì¸¡ í•˜ë‹¨) */
        .modal-back-icon {
            position: absolute; bottom: 30px; right: -20px; 
            width: 40px; height: 40px; background: white; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); cursor: pointer; color: var(--text-sub);
            transform: translateX(100%);
        }

        /* ğŸ§­ í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
        .bottom-nav {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px; height: 70px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 35px;
            display: flex; justify-content: space-around; align-items: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1); z-index: 900;
            border: 1px solid rgba(255,255,255,0.5);
        }
        .nav-item { color: #C1C1C1; font-size: 24px; cursor: pointer; transition: 0.2s; position: relative; }
        .nav-item.active { color: var(--primary); transform: translateY(-5px); }
        .nav-item.active::after {
            content: ''; position: absolute; bottom: -5px; left: 50%; transform: translateX(-50%);
            width: 5px; height: 5px; background: var(--primary); border-radius: 50%;
        }

        /* FAB (ê¸€ì“°ê¸° ë²„íŠ¼) */
        .fab {
            position: fixed; bottom: 110px; right: 25px;
            width: 55px; height: 55px; border-radius: 50%;
            background: var(--text-main); color: white;
            display: flex; align-items: center; justify-content: center;
            font-size: 22px; box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            cursor: pointer; z-index: 950; transition: transform 0.2s;
        }
        .fab:hover { transform: scale(1.1) rotate(90deg); }

        /* ë§ˆì´í˜ì´ì§€ ë©”ë‰´ */
        .mypage-header { text-align: center; padding: 40px 20px; }
        .admin-badge { background: #FFD43B; color: #862E9C; padding: 4px 8px; border-radius: 8px; font-size: 11px; font-weight: 700; vertical-align: middle; margin-left: 5px; }
        .menu-list { background: white; border-radius: 25px; padding: 10px; margin: 0 20px; box-shadow: var(--shadow); }
        .menu-item { padding: 18px 20px; display: flex; justify-content: space-between; font-size: 14px; font-weight: 600; cursor: pointer; border-bottom: 1px solid #f8f9fa; }
        .menu-item:last-child { border-bottom: none; }
        .menu-item:hover { background: #f8f9fa; border-radius: 15px; }

        /* ìœ í‹¸ë¦¬í‹° */
        .hidden { display: none !important; }
        #captureArea { position: fixed; top: -9999px; left: -9999px; background: white; padding: 40px; width: 360px; text-align: center; }
    </style>
</head>
<body>

    <!-- ìº¡ì²˜ìš© ì˜ì—­ -->
    <div id="captureArea">
        <div style="font-family:'Gaegu'; font-size:30px; color:#9D76C1; margin-bottom:20px;">Jahyu Letter</div>
        <div id="captureContent" style="font-size:16px; line-height:1.6; color:#444;"></div>
        <div style="margin-top:30px; font-size:12px; color:#aaa;">@jahyu_letter</div>
    </div>

    <!-- ì•± í—¤ë” -->
    <header class="header">
        <div class="logo" onclick="renderTab('home')">Jahyu</div>
    </header>

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div id="appContainer" class="app-container"></div>

    <!-- í•˜ë‹¨ ë„¤ë¹„ -->
    <nav class="bottom-nav">
        <div class="nav-item active" id="nav-home" onclick="renderTab('home')"><i class="fas fa-home"></i></div>
        <div class="nav-item" id="nav-letter" onclick="renderTab('letter')"><i class="fas fa-envelope-open-text"></i></div>
        <div class="nav-item" id="nav-mood" onclick="renderTab('mood')"><i class="fas fa-calendar-alt"></i></div>
        <div class="nav-item" id="nav-challenge" onclick="renderTab('challenge')"><i class="fas fa-running"></i></div>
        <div class="nav-item" id="nav-mypage" onclick="renderTab('mypage')"><i class="fas fa-user-circle"></i></div>
    </nav>

    <!-- ê¸€ì“°ê¸° FAB -->
    <div id="fab" class="fab hidden" onclick="openWriteModal()">
        <i class="fas fa-plus"></i>
    </div>

    <!-- ê¸€ì“°ê¸° ëª¨ë‹¬ -->
    <div id="writeModal" class="modal-overlay">
        <div class="write-card">
            <h3 id="modalTitle">ê¸€ì“°ê¸°</h3>
            
            <!-- ë ˆí„° íƒ­ ì „ìš©: ì¹´í…Œê³ ë¦¬ & ê³µì§€ -->
            <div id="letterOptions" class="hidden">
                <select id="postCategory" class="input-box">
                    <option value="ìíœ´ë ˆí„°">ìíœ´ë ˆí„°</option>
                    <option value="ìíœ´ë©">ìíœ´ë©</option>
                    <option value="ì—ë””í„°í†¡">ì—ë””í„°í†¡</option>
                </select>
                <label style="font-size:13px; display:block; margin-bottom:10px;">
                    <input type="checkbox" id="isNotice"> ğŸ“¢ ê³µì§€ì‚¬í•­ìœ¼ë¡œ ë“±ë¡ (ìƒë‹¨ ê³ ì •)
                </label>
                <div style="margin-bottom:10px;">
                    <input type="text" id="linkUrl" class="input-box" placeholder="ğŸ”— ì—°ê²°í•  ë§í¬ (http://...)" style="margin-bottom:5px;">
                    <input type="text" id="linkText" class="input-box" placeholder="ë²„íŠ¼ ì´ë¦„ (ì˜ˆ: ë³´ëŸ¬ê°€ê¸°)">
                </div>
            </div>

            <!-- ë¬´ë“œ ì „ìš© -->
            <div id="moodOptions" class="hidden">
                <div class="emoji-selector" id="emojiList" style="display:flex; gap:10px; overflow-x:auto; padding-bottom:10px;">
                    <!-- JSë¡œ ì±„ì›€ -->
                </div>
            </div>

            <!-- ê³µí†µ ì…ë ¥ -->
            <input type="text" id="postTitle" class="input-box" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
            <textarea id="postContent" class="input-box" style="height:120px; resize:none;" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
            
            <!-- ì‚¬ì§„ ì²¨ë¶€ -->
            <div onclick="document.getElementById('fileInput').click()" style="padding:15px; border:2px dashed #eee; border-radius:15px; text-align:center; color:#aaa; cursor:pointer; margin-bottom:10px;">
                <i class="fas fa-image"></i> ì‚¬ì§„ ì¶”ê°€í•˜ê¸°
            </div>
            <input type="file" id="fileInput" hidden accept="image/*">

            <div class="modal-btn-group">
                <button onclick="closeModal()" class="modal-btn btn-cancel">ì·¨ì†Œ</button>
                <button onclick="submitPost()" class="modal-btn btn-submit">ë“±ë¡í•˜ê¸°</button>
            </div>

            <!-- ìš°ì¸¡ í•˜ë‹¨ ë’¤ë¡œê°€ê¸° ì•„ì´ì½˜ -->
            <div class="modal-back-icon" onclick="closeModal()">
                <i class="fas fa-arrow-right"></i>
            </div>
        </div>
    </div>

    <!-- ë¡œê·¸ì¸ ëª¨ë‹¬ -->
    <div id="authModal" class="modal-overlay" style="display:flex;">
        <div class="write-card" style="text-align:center;">
            <div class="logo" style="font-size:36px; margin-bottom:10px;">Jahyu</div>
            <p style="color:#aaa; margin-bottom:30px;">ë‹¹ì‹ ì„ ìœ„í•œ ì‰¼í‘œ ğŸŒ¿</p>
            <input type="email" id="email" class="input-box" placeholder="ì´ë©”ì¼">
            <input type="password" id="pw" class="input-box" placeholder="ë¹„ë°€ë²ˆí˜¸">
            <button onclick="doLogin()" class="btn-primary" style="width:100%; border-radius:15px; padding:15px; margin-bottom:10px; background:var(--primary-gradient); border:none; color:white; font-weight:700;">ë¡œê·¸ì¸</button>
            <button onclick="doSignup()" class="btn-secondary" style="width:100%; border-radius:15px; padding:15px;">íšŒì›ê°€ì…</button>
            <p onclick="resetPw()" style="font-size:12px; color:#aaa; margin-top:20px; cursor:pointer; text-decoration:underline;">ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠìœ¼ì…¨ë‚˜ìš”?</p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, updateProfile, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, doc, onSnapshot, query, orderBy, updateDoc, deleteDoc, arrayUnion, arrayRemove, setDoc, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ğŸ”´ í–…ì‚ë‹˜ í‚¤ê°’ (ë³µë¶™ í•„ìˆ˜) ğŸ”´
        const firebaseConfig = {
            apiKey: "AIzaSyDq2eT8H6tNcsrT8dhZWsEyyMZbpCZIZZQ",
            authDomain: "jahyu-e24cd.firebaseapp.com",
            databaseURL: "https://jahyu-e24cd-default-rtdb.firebaseio.com",
            projectId: "jahyu-e24cd",
            storageBucket: "jahyu-e24cd.firebasestorage.app",
            messagingSenderId: "955637836464",
            appId: "1:955637836464:web:096ed0c28e0070f4fca975",
            measurementId: "G-CTDZFNYJV7"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // ë³€ìˆ˜
        let currentUser = null;
        let isAdmin = false;
        let currentTab = 'home';
        let currentFilter = 'all'; // ë ˆí„° íƒ­ í•„í„° (notice, jahyu, lab)
        const ADMIN_EMAILS = ['happxi@jahyu.com', 'elly@jahyu.com', 'gokal@jahyu.com', 'sunny@jahyu.com', 'yudan@jahyu.com'];
        const MOODS = ['ğŸ˜Š','ğŸ¥°','ğŸ˜Œ','ğŸ˜­','ğŸ˜¡','ğŸ˜´','ğŸ¤©','ğŸ¤”','ğŸ¥º','ğŸ”¥','â˜”','ğŸ€'];

        // ì¸ì¦
        window.doLogin = async () => {
            try { await signInWithEmailAndPassword(auth, document.getElementById('email').value, document.getElementById('pw').value); }
            catch(e) { alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: " + e.message); }
        };
        window.doSignup = async () => {
            const nick = prompt("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”:");
            if(!nick) return;
            try {
                const cred = await createUserWithEmailAndPassword(auth, document.getElementById('email').value, document.getElementById('pw').value);
                await updateProfile(cred.user, { displayName: nick });
                await setDoc(doc(db, "users", cred.user.uid), { email: cred.user.email, name: nick, createdAt: new Date().toISOString() });
                alert("ê°€ì… í™˜ì˜í•©ë‹ˆë‹¤!");
            } catch(e) { alert("ê°€ì… ì‹¤íŒ¨: " + e.message); }
        };
        window.resetPw = async () => {
            const email = prompt("ê°€ì…í•œ ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”:");
            if(email) {
                await sendPasswordResetEmail(auth, email);
                alert("ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë©”ì¼ì„ ë³´ëƒˆìŠµë‹ˆë‹¤.");
            }
        };

        // íƒ­ ë Œë”ë§
        window.renderTab = (tab) => {
            currentTab = tab;
            const container = document.getElementById('appContainer');
            container.innerHTML = '';
            
            // ë„¤ë¹„
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById(`nav-${tab}`)?.classList.add('active');

            // FAB ì œì–´
            const fab = document.getElementById('fab');
            if(tab === 'challenge' || tab === 'mood') fab.classList.remove('hidden');
            else if(isAdmin && tab === 'letter') fab.classList.remove('hidden'); // ì—ë””í„°í†¡ì€ ë ˆí„°íƒ­ ì•ˆì—ì„œ ì”€
            else fab.classList.add('hidden');

            if (tab === 'home') {
                container.innerHTML = `
                    <div class="home-greeting">
                        <h2>${currentUser.displayName}ë‹˜, ì˜¤ëŠ˜ ë§ˆìŒì€ ì–´ë•Œìš”?</h2>
                        <p>ìíœ´ë ˆí„°ì™€ í•¨ê»˜ ì ì‹œ ì‰¬ì–´ê°€ì„¸ìš” ğŸŒ¿</p>
                    </div>
                    
                    <div class="hero-card" onclick="window.open('https://index-html-zak5.vercel.app/')">
                        <div class="hero-title">ë‚˜ì—ê²Œ ë”± ë§ëŠ” ì‰¼ ìœ í˜•ì€?</div>
                        <div class="hero-sub">íë§ í…ŒìŠ¤íŠ¸ í•˜ëŸ¬ê°€ê¸° ğŸ‘‰</div>
                    </div>

                    <div class="quick-menu">
                        <div class="quick-item" onclick="renderTab('letter')">
                            <div class="quick-icon icon-letter"><i class="fas fa-envelope-open-text"></i></div>
                            <span class="quick-text">ë ˆí„°</span>
                        </div>
                        <div class="quick-item" onclick="renderTab('challenge')">
                            <div class="quick-icon icon-challenge"><i class="fas fa-running"></i></div>
                            <span class="quick-text">ì±Œë¦°ì§€</span>
                        </div>
                        <div class="quick-item" onclick="window.open('https://pf.kakao.com/_Jfjxgn/111753149')">
                            <div class="quick-icon icon-sentence"><i class="fas fa-pen-nib"></i></div>
                            <span class="quick-text">ë¬¸ì¥ìˆ˜ì§‘</span>
                        </div>
                        <div class="quick-item" onclick="window.open('https://pf.kakao.com/_Jfjxgn')">
                            <div class="quick-icon icon-chat"><i class="fas fa-comments"></i></div>
                            <span class="quick-text">1:1ì±„íŒ…</span>
                        </div>
                    </div>
                `;
            }

            else if (tab === 'letter') {
                container.innerHTML = `
                    <div class="archive-header">
                        <div class="archive-title">Letter Archive</div>
                        <div class="archive-tabs">
                            <div class="tab-btn active" onclick="filterArchive(this, 'all')">ì „ì²´</div>
                            <div class="tab-btn" onclick="filterArchive(this, 'ìíœ´ë ˆí„°')">ìíœ´ë ˆí„°</div>
                            <div class="tab-btn" onclick="filterArchive(this, 'ìíœ´ë©')">ìíœ´ë©</div>
                        </div>
                    </div>
                    <!-- ê³µì§€ì‚¬í•­ ì˜ì—­ -->
                    <div id="noticeArea" style="padding:0 20px;"></div>
                    <!-- ê²Œì‹œê¸€ ì˜ì—­ -->
                    <div id="archiveGrid" class="masonry-grid" style="padding-top:15px;"></div>
                `;
                fetchArchive('all');
            }

            else if (tab === 'mood') {
                container.innerHTML = `
                    <div style="padding:20px; text-align:center;">
                        <h2 style="font-weight:800; color:var(--text-main);">My Mood Log</h2>
                    </div>
                    <div id="moodCalendar" class="calendar-wrap">
                        <div class="calendar-header">
                            <span>${new Date().getMonth()+1}ì›”</span>
                        </div>
                        <div class="week-days"><div>ì¼</div><div>ì›”</div><div>í™”</div><div>ìˆ˜</div><div>ëª©</div><div>ê¸ˆ</div><div>í† </div></div>
                        <div class="calendar-grid" id="calGrid"></div>
                    </div>
                    <div class="mood-actions">
                        <button class="mood-btn btn-save" onclick="saveImage('moodCalendar')"><i class="fas fa-download"></i> ì˜ˆìœ ì´ë¯¸ì§€ë¡œ ì €ì¥</button>
                        <button class="mood-btn btn-share" onclick="shareImage('moodCalendar')"><i class="fas fa-share-alt"></i> ê³µìœ í•˜ê¸°</button>
                    </div>
                    <div style="padding:0 20px;">
                        <h4 style="margin-bottom:10px;">ìµœê·¼ ê¸°ë¡</h4>
                        <div id="moodList"></div>
                    </div>
                `;
                loadCalendar();
                fetchList('mood', 'moodList');
            }

            else if (tab === 'challenge') {
                container.innerHTML = `
                    <div class="challenge-header">
                        <h3>í•¨ê»˜í•˜ëŠ” ë¦¬ì¶”ì–¼ ğŸƒâ€â™€ï¸</h3>
                        <p style="font-size:13px; color:#888; margin-top:5px;">ë‚˜ë§Œì˜ ì‚¬ì†Œí•œ ìŠµê´€ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”!</p>
                        <button class="make-challenge-btn" onclick="openWriteModal('challenge')">+ ë‚˜ë„ ì±Œë¦°ì§€ ë§Œë“¤ê¸°</button>
                    </div>
                    <div id="challengeList" class="masonry-grid"></div>
                `;
                fetchList('challenge', 'challengeList');
            }

            else if (tab === 'mypage') {
                container.innerHTML = `
                    <div class="mypage-header">
                        <div style="width:80px; height:80px; background:var(--primary-soft); border-radius:50%; margin:0 auto 15px; display:flex; align-items:center; justify-content:center; font-size:30px;">
                            ${currentUser.displayName[0]}
                        </div>
                        <h3>
                            ${currentUser.displayName}ë‹˜ 
                            ${isAdmin ? '<span class="admin-badge">ğŸ‘‘ ê´€ë¦¬ì</span>' : ''}
                        </h3>
                        <p style="font-size:12px; color:#aaa;">${currentUser.email}</p>
                    </div>
                    <div class="menu-list">
                        <div class="menu-item" onclick="showMyData('posts')">ğŸ“ ë‚´ê°€ ì“´ ê¸€</div>
                        <div class="menu-item" onclick="showMyData('likes')">â¤ï¸ ì¢‹ì•„ìš”í•œ ê¸€</div>
                        <div class="menu-item" onclick="showMyData('bookmarks')">ğŸ”– ë¶ë§ˆí¬í•œ ê¸€</div>
                        <div class="menu-item" onclick="resetPw()">ğŸ”’ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</div>
                        <div class="menu-item" onclick="auth.signOut(); location.reload();" style="color:#ff6b6b;">ğŸ‘‹ ë¡œê·¸ì•„ì›ƒ</div>
                    </div>
                `;
            }
        };

        // --- ê¸°ëŠ¥ ë¡œì§ ---

        // ì•„ì¹´ì´ë¸Œ í•„í„°ë§ (ê³µì§€ + ë ˆí„°/ë©/ì—ë””í„°í†¡)
        window.filterArchive = (el, type) => {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
            fetchArchive(type);
        };

        async function fetchArchive(filterType) {
            const noticeArea = document.getElementById('noticeArea');
            const grid = document.getElementById('archiveGrid');
            noticeArea.innerHTML = ''; grid.innerHTML = '';

            // ì¿¼ë¦¬: post íƒ€ì… ì „ì²´ ê°€ì ¸ì™€ì„œ JSë¡œ í•„í„°ë§ (Firestore ì¸ë±ìŠ¤ íšŒí”¼)
            const q = query(collection(db, "posts"), where("type", "==", "post"), orderBy("date", "desc"));
            const snap = await getDocs(q);

            snap.forEach(d => {
                const p = d.data();
                const card = createCard(d.id, p);

                if(p.isNotice) {
                    noticeArea.innerHTML += card; // ê³µì§€ëŠ” í•­ìƒ ìƒë‹¨
                } else {
                    if (filterType === 'all') {
                        // ì „ì²´ë³´ê¸°: ìíœ´ë ˆí„°, ìíœ´ë©, ì—ë””í„°í†¡ ëª¨ë‘ í‘œì‹œ
                        grid.innerHTML += card;
                    } else if (p.category === filterType) {
                        grid.innerHTML += card;
                    }
                }
            });
        }

        async function fetchList(type, targetId) {
            const target = document.getElementById(targetId);
            const q = query(collection(db, "posts"), where("type", "==", type), orderBy("date", "desc"));
            const snap = await getDocs(q);
            target.innerHTML = '';
            snap.forEach(d => {
                target.innerHTML += createCard(d.id, d.data());
            });
        }

        function createCard(id, p) {
            // New ë±ƒì§€ (7ì¼ ì´ë‚´)
            const isNew = (new Date() - new Date(p.date)) < (7 * 24 * 60 * 60 * 1000);
            return `
                <div class="pin-card" onclick="alert('ìƒì„¸ë³´ê¸° êµ¬í˜„ë¨ (ìƒëµ)')">
                    ${p.image ? `<img src="${p.image}" class="pin-img">` : ''}
                    <div class="pin-content">
                        ${p.isNotice ? '<span class="pin-badge badge-notice">ğŸ“¢ ê³µì§€</span>' : ''}
                        ${isNew ? '<span class="pin-badge badge-new">N</span>' : ''}
                        ${p.category ? `<span class="pin-badge" style="background:#eee; color:#666;">${p.category}</span>` : ''}
                        <div class="pin-title">${p.title}</div>
                        <div class="pin-meta">
                            <span>${p.author}</span>
                            <span>${new Date(p.date).toLocaleDateString()}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // ğŸ“… ìº˜ë¦°ë” (íŒŒìŠ¤í…” ë””ìì¸)
        async function loadCalendar() {
            const grid = document.getElementById('calGrid');
            const today = new Date();
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1).getDay();
            const lastDate = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();
            
            grid.innerHTML = '';
            for(let i=0; i<firstDay; i++) grid.innerHTML += `<div></div>`;

            // ë‚´ ê¸°ë¡ ê°€ì ¸ì˜¤ê¸°
            const q = query(collection(db, "posts"), where("type", "==", "mood"), where("authorId", "==", currentUser.uid));
            const snap = await getDocs(q);
            const records = {};
            snap.forEach(d => {
                const date = new Date(d.data().date);
                if(date.getMonth() === today.getMonth()) records[date.getDate()] = d.data().emoji;
            });

            for(let i=1; i<=lastDate; i++) {
                grid.innerHTML += `
                    <div class="day-cell ${i===today.getDate()?'today':''}">
                        <span style="position:absolute; top:3px; left:5px;">${i}</span>
                        <span class="day-emoji">${records[i] || ''}</span>
                    </div>
                `;
            }
        }

        // ğŸ“ ê¸€ì“°ê¸° UI ë¡œì§
        window.openWriteModal = (forceType) => {
            const modal = document.getElementById('writeModal');
            const title = document.getElementById('postTitle');
            const content = document.getElementById('postContent');
            
            // ì´ˆê¸°í™”
            title.value = ''; content.value = '';
            document.getElementById('letterOptions').classList.add('hidden');
            document.getElementById('moodOptions').classList.add('hidden');
            document.getElementById('postTitle').classList.remove('hidden');

            // íƒ­ë³„ UI ë¶„ê¸°
            if (currentTab === 'letter') {
                document.getElementById('letterOptions').classList.remove('hidden');
                document.getElementById('postCategory').innerHTML = `
                    <option value="ìíœ´ë ˆí„°">ìíœ´ë ˆí„°</option>
                    <option value="ìíœ´ë©">ìíœ´ë©</option>
                    <option value="ì—ë””í„°í†¡">ì—ë””í„°í†¡</option>
                `;
            } else if (currentTab === 'challenge') {
                // ì±Œë¦°ì§€ëŠ” ì œëª©/ë‚´ìš©/ì‚¬ì§„ë§Œ (ì˜µì…˜ X)
                title.placeholder = "ì±Œë¦°ì§€ ì´ë¦„ (ì˜ˆ: í•˜ë£¨ ë¬¼ 3ì”)";
            } else if (currentTab === 'mood') {
                document.getElementById('moodOptions').classList.remove('hidden');
                document.getElementById('postTitle').classList.add('hidden'); // ë¬´ë“œëŠ” ì œëª© ë¶ˆí•„ìš”
                document.getElementById('emojiList').innerHTML = MOODS.map(m => 
                    `<div class="emoji-option" onclick="selectEmoji(this, '${m}')">${m}</div>`
                ).join('');
            }

            modal.style.display = 'flex';
        };

        let selectedEmoji = null;
        window.selectEmoji = (el, e) => {
            document.querySelectorAll('.emoji-option').forEach(x => x.classList.remove('selected'));
            el.classList.add('selected');
            selectedEmoji = e;
        };

        window.submitPost = async () => {
            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;
            const file = document.getElementById('fileInput').files[0];
            const category = document.getElementById('postCategory').value;
            const isNotice = document.getElementById('isNotice')?.checked;
            
            // ì‚¬ì§„ ì²˜ë¦¬ (ê°„ë‹¨ Base64)
            let imgStr = null;
            if(file) {
                imgStr = await new Promise(r => {
                    const reader = new FileReader();
                    reader.onload = e => r(e.target.result);
                    reader.readAsDataURL(file);
                });
            }

            const data = {
                title: title || selectedEmoji || 'ë¬´ì œ',
                content: content,
                image: imgStr,
                date: new Date().toISOString(),
                author: currentUser.displayName,
                authorId: currentUser.uid,
                type: currentTab === 'mood' ? 'mood' : (currentTab === 'challenge' ? 'challenge' : 'post'),
                category: currentTab === 'letter' ? category : 'challenge',
                isNotice: isNotice || false,
                emoji: selectedEmoji
            };

            await addDoc(collection(db, "posts"), data);
            alert("ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!");
            window.closeModal();
            renderTab(currentTab);
        };

        window.closeModal = () => document.getElementById('writeModal').style.display = 'none';

        // ğŸ“¸ ì´ë¯¸ì§€ ì €ì¥ & ê³µìœ 
        window.saveImage = (id) => {
            const target = document.getElementById(id);
            document.getElementById('captureContent').innerHTML = target.innerHTML; // ë³µì‚¬
            html2canvas(document.getElementById('captureArea')).then(canvas => {
                const link = document.createElement('a');
                link.download = 'jahyu_mood.png';
                link.href = canvas.toDataURL();
                link.click();
            });
        };

        // ì•± ì‹œì‘
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                isAdmin = ADMIN_EMAILS.includes(user.email);
                document.getElementById('authModal').style.display = 'none';
                renderTab('home');
            } else {
                document.getElementById('authModal').style.display = 'flex';
            }
        });
    </script>
</body>
</html>
