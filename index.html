<head>
    <title>ìíœ´ë ˆí„° - ììœ ë¡œìš´ ë‹¹ì‹ ì˜ íœ´ì‹ ê°€ì´ë“œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* V15.0: ë””ìì¸ íŒ”ë ˆíŠ¸ ë° ê·¸ë¼ë°ì´ì…˜ ì •ì˜ */
        .bg-gentle-pink { background-color: #FEEEEE; } /* ë°°ê²½ ì—°í•œ í•‘í¬ */
        .text-primary-violet { color: #8A48D9; }      /* í¬ì¸íŠ¸ ë°”ì´ì˜¬ë › */
        .bg-primary-violet { background-color: #8A48D9; }
        .bg-gradient-soft { 
            background: linear-gradient(135deg, #FFDDE1 0%, #E1FFFD 100%); /* ëª½í™˜ì ì¸ í•‘í¬ -> ë¯¼íŠ¸ ê·¸ë¼ë°ì´ì…˜ */
        }
        .bg-gradient-card { 
            background: linear-gradient(135deg, #FEE4F5 0%, #DDEFFC 100%); /* ì¹´ë“œ ë°°ê²½ ê°ì„± ê·¸ë¼ë°ì´ì…˜ */
        }
        .shadow-glow { box-shadow: 0 10px 30px rgba(138, 72, 217, 0.15); } /* ì€ì€í•œ ê·¸ë¦¼ì */

        /* ê¸°ë³¸ ë ˆì´ì•„ì›ƒ ìœ ì§€ */
        .glass-nav { backdrop-filter: blur(10px); background-color: rgba(255, 255, 255, 0.9); }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; height: 60px; z-index: 1000; border-top: 1px solid #f0f0f0; }
        .hide { display: none !important; }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* V13.0 ìŠ¤íƒ€ì¼ ìœ ì§€ */
        .placeholder-gentle-gray::placeholder { color: #C0C0C0; font-style: italic; }
        #submitDiaryBtn:not(:disabled) { background-color: #8A48D9; cursor: pointer; } /* ë²„íŠ¼ ìƒ‰ìƒ ë³€ê²½ */
        #submitDiaryBtn:not(:disabled):hover { background-color: #6A39A9; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2000; display: none; }
    </style>
</head>
<body class="bg-gentle-pink">

<div id="appContainer" class="min-h-screen pb-[60px]">

    <section id="homePage" class="p-5 pt-12 fade-in">
        <h1 class="text-3xl font-extrabold text-primary-violet">ììœ ë¡œìš´ ë‹¹ì‹ ì˜ íœ´ì‹ ê°€ì´ë“œ</h1>
        <p class="text-gray-600 mt-2">ì¼ê³¼ ì‚¶ì˜ ê· í˜•, ìíœ´ë ˆí„°ê°€ ë„ì™€ë“œë¦´ê²Œìš”. âœ¨</p>
        
        <div id="greetingArea" class="mt-8 bg-gradient-card p-6 rounded-2xl shadow-glow">
            <h3 id="greetingTitle" class="text-xl font-bold text-gray-800">í–…ì‚ë‹˜ ì˜¤ëŠ˜ë„ í–‰ë³µí•˜ì„¸ìš”! ğŸŒ¿</h3>
            <p id="greetingSub" class="text-sm text-gray-500 mt-1">ë‹¹ì‹ ì˜ íë§ì„ ìœ„í•œ, ìíœ´ë ˆí„°</p>
        </div>
        
        <div class="mt-10">
            <h3 class="text-xl font-bold text-primary-violet mb-4">HOT TREND</h3>
            <div class="bg-gradient-soft p-6 rounded-2xl shadow-glow cursor-pointer transition hover:scale-[1.01]" 
                 onclick="alert('íŠ¸ë Œë“œ ë ˆí„° ë³´ê¸° ê¸°ëŠ¥ ì‘ë™!')">
                <p class="font-bold text-lg text-gray-800">ë‚˜ì˜ íë§ ìœ í˜•ì€?</p>
                <p class="text-sm mt-1 text-gray-600">ì§€ê¸ˆ ë°”ë¡œ í…ŒìŠ¤íŠ¸í•˜ê³  ë§ì¶¤ ë ˆí„° ë°›ê¸° ğŸ”®</p>
            </div>
        </div>
        
        <div class="flex justify-around mt-8">
            <button class="flex flex-col items-center p-2 rounded-xl transition active:scale-95" onclick="alert('ì¹´í†¡ ì¶”ê°€ ê¸°ëŠ¥ ì‘ë™!')">
                <div class="w-14 h-14 bg-white rounded-full shadow-md flex items-center justify-center text-3xl border border-gray-100">ğŸ’¬</div>
                <span class="text-xs mt-2 text-gray-600">ì¹´í†¡ ì¶”ê°€</span>
            </button>
            <button class="flex flex-col items-center p-2 rounded-xl transition active:scale-95" onclick="alert('ë¬¸ì¥ ìˆ˜ì§‘ ê¸°ëŠ¥ ì‘ë™!')">
                <div class="w-14 h-14 bg-white rounded-full shadow-md flex items-center justify-center text-3xl border border-gray-100">ğŸ“–</div>
                <span class="text-xs mt-2 text-gray-600">ë¬¸ì¥ ìˆ˜ì§‘</span>
            </button>
            <button class="flex flex-col items-center p-2 rounded-xl transition active:scale-95" onclick="alert('ë ˆí„° ë³´ê¸° ê¸°ëŠ¥ ì‘ë™!')">
                <div class="w-14 h-14 bg-white rounded-full shadow-md flex items-center justify-center text-3xl border border-gray-100">ğŸ’Œ</div>
                <span class="text-xs mt-2 text-gray-600">ë ˆí„° ë³´ê¸°</span>
            </button>
        </div>
    </section>

    <section id="newsletterPage" class="p-5 pt-12 hide fade-in">
        <h2 class="text-3xl font-bold text-primary-violet">ë ˆí„° ì•„ì¹´ì´ë¸Œ</h2>
        <p class="text-gray-600 mt-2">ì§€ê¸ˆ ê¼­ í•„ìš”í•œ ìœ„ë¡œë¥¼ ë°›ì•„ë³´ì„¸ìš”!</p>
        <div class="mt-6 bg-white p-5 rounded-xl shadow-soft border-l-4 border-primary-violet/50">
            <h4 class="text-lg font-bold">32í˜¸. í‡´ì‚¬ í›„ ë²ˆì•„ì›ƒ, ì €ë§Œ ì´ëŸ°ê°€ìš”?</h4>
            <p class="text-sm text-gray-500 mt-1">í‡´ì‚¬ í›„ì—ë„ ì‰¬ì§€ ëª»í•˜ëŠ” ë‹¹ì‹ ì—ê²Œ......</p>
        </div>
    </section>
    <section id="editorTalkPage" class="p-5 pt-12 hide fade-in">
        <h2 class="text-3xl font-bold text-primary-violet">ì—ë””í„° í†¡</h2>
        <div class="mt-6 bg-white p-5 rounded-xl shadow-soft border-l-4 border-primary-violet/50">
            <p class="font-bold">ì¼ì£¼ì¼ ì˜ ë²„í‹°ì…¨ë‚˜ìš”?</p>
            <p class="text-sm text-gray-500 mt-1">ì£¼ë§ì—ëŠ” ì•„ë¬´ ìƒê° ì—†ì´ ì‰¬ì–´ì•¼ í•´ìš”!...</p>
        </div>
    </section>
    <section id="momentPage" class="p-5 pt-12 hide fade-in">
        <h2 class="text-3xl font-bold text-primary-violet">ëª¨ë¨¼íŠ¸ (ì§§ì€ ë‹¨ìƒ)</h2>
        <p class="text-gray-600 mt-2">ì—ë””í„°ë“¤ì˜ ì§§ì€ ë‹¨ìƒì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
    </section>
    <section id="sanctuaryPage" class="p-5 pt-12 hide fade-in">
        <div id="sanctuaryHeader" class="mb-6 flex justify-between items-start">
            </div>
        <div id="diaryListContainer" class="space-y-4 pb-20">
            <p class="text-center text-gray-400 mt-10">ë¡œê·¸ì¸ í›„ ë‚˜ë§Œì˜ ë¬´ë“œë¥¼ ê¸°ë¡í•´ë³´ì„¸ìš”.</p>
        </div>
    </section>
    <section id="myPage" class="p-5 pt-12 hide fade-in">
        <h2 class="text-3xl font-bold text-primary-violet">ë§ˆì´í˜ì´ì§€</h2>
        <div id="myProfileArea" class="mt-6 bg-white p-5 rounded-xl shadow-soft">ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</div>
    </section>


</div>

<nav id="bottomNav" class="bottom-nav glass-nav flex justify-around items-center px-2">
    <button class="tab-item w-full h-full text-primary-violet" onclick="navigateTo('home')" id="nav-home">
        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
        <span class="text-[10px] font-medium mt-0.5">í™ˆ</span>
    </button>
    <button class="tab-item w-full h-full text-gray-400" onclick="navigateTo('newsletter')" id="nav-newsletter">
        <span class="text-2xl transition-transform active:scale-[0.9]">ğŸ’Œ</span> 
        <span class="text-[10px] font-medium mt-0.5">ë ˆí„°</span>
    </button>
    <button class="tab-item w-full h-full text-gray-400" onclick="navigateTo('editorTalk')" id="nav-editorTalk">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 0 1-4.255-.949L3 20l1.395-3.69A9.86 9.86 0 0 1 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8Z"/></svg>
        <span class="text-[10px] font-medium mt-0.5">ì—ë””í„°í†¡</span>
    </button>
    <button class="tab-item w-full h-full text-gray-400" onclick="navigateTo('moment')" id="nav-moment">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 18.75a6 6 0 0 0 6-6M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5a7.5 7.5 0 1 0 7.5 7.5A7.5 7.5 0 0 0 12 4.5ZM12 4.5V3m0 18v-1.5m7.5-7.5h1.5M3 12h1.5m10.875 3.375-.929-.929m-11.782.929 1.06-1.06m0-7.531 1.06 1.06m9.281 0-.929-.929"/></svg>
        <span class="text-[10px] font-medium mt-0.5">ëª¨ë¨¼íŠ¸</span>
    </button>
    <button class="tab-item w-full h-full text-gray-400" onclick="navigateTo('sanctuary')" id="nav-sanctuary">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 1 0-2.652-2.652L6.832 9.07a1.875 1.875 0 1 0 2.652 2.652l9.76-9.76Z"/>
            <path stroke-linecap="round" stroke-linejoin="round" d="M18.882 17.519a4.5 4.5 0 0 0-7.373-3.955l-3.237 3.237a3 3 0 0 0 .848 5.61 3.5 3.5 0 0 0 5.483-3.665"/>
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 7.5a1.5 1.5 0 0 1 1.5 1.5v1.5a1.5 1.5 0 0 1-3 0V9a1.5 1.5 0 0 1 1.5-1.5z"/>
        </svg>
        <span class="text-[10px] font-medium mt-0.5">ì˜¤ëŠ˜ì˜ ë¬´ë“œ</span>
    </button>
    <button class="tab-item w-full h-full text-gray-400" onclick="navigateTo('myPage')" id="nav-myPage">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"/></svg>
        <span class="text-[10px] font-medium mt-0.5">ë§ˆì´</span>
    </button>
</nav>

<div id="diaryWriteModal" class="modal bg-black/90 backdrop-blur-xl" onclick="closeModal(event, 'diaryWriteModal')">
    <div class="modal-content w-full h-full max-w-none max-h-none p-0 rounded-none bg-white relative">
        <header class="p-4 flex justify-between items-center border-b border-gray-100 sticky top-0 bg-white z-10">
            <h3 class="text-lg font-bold text-primary-violet">ì˜¤ëŠ˜ì˜ ê¸°ë¡ âœ’ï¸</h3>
            <button onclick="closeModal(null, 'diaryWriteModal')" class="text-gray-500 hover:text-gray-800">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
            </button>
        </header>
        
        <form id="diaryForm" class="p-6 h-[calc(100vh-60px)] flex flex-col">
            
            <div id="moodTracker" class="mb-4 pt-2 pb-4 border-b border-gray-100">
                <p class="text-sm font-medium text-gray-600 mb-2 flex justify-between items-center">
                    ì˜¤ëŠ˜ì˜ ê¸°ë¶„ì€ ì–´ë–¤ê°€ìš”?
                </p>
                <div class="flex justify-between items-center overflow-x-auto gap-2">
                    <button type="button" class="mood-icon text-3xl p-1 rounded-full border-2 border-transparent active:scale-95 transition" data-mood="í–‰ë³µ" data-color="#FFD700">ğŸ˜„</button>
                    <button type="button" class="mood-icon text-3xl p-1 rounded-full border-2 border-transparent active:scale-95 transition" data-mood="í‰ì˜¨" data-color="#A2E8E4">ğŸ˜Œ</button>
                    <button type="button" class="mood-icon text-3xl p-1 rounded-full border-2 border-transparent active:scale-95 transition" data-mood="ì„¤ë ˜" data-color="#FFB6C1">ğŸ¥°</button>
                    <button type="button" class="mood-icon text-3xl p-1 rounded-full border-2 border-transparent active:scale-95 transition" data-mood="ì§€ì¹¨" data-color="#FFA07A">ğŸ˜©</button>
                    <button type="button" class="mood-icon text-3xl p-1 rounded-full border-2 border-transparent active:scale-95 transition" data-mood="ë¶„ë…¸" data-color="#FF6347">ğŸ˜ </button>
                    <button type="button" class="mood-icon text-3xl p-1 rounded-full border-2 border-transparent active:scale-95 transition" data-mood="ìŠ¬í””" data-color="#ADD8E6">ğŸ˜¢</button>
                    <button type="button" class="mood-icon text-3xl p-1 rounded-full border-2 border-transparent active:scale-95 transition" data-mood="ë¶ˆì•ˆ" data-color="#DDA0DD">ğŸ˜Ÿ</button>
                    <button type="button" class="mood-icon text-3xl p-1 rounded-full border-2 border-transparent active:scale-95 transition" data-mood="ë¬´ê´€ì‹¬" data-color="#D3D3D3">ğŸ˜</button>
                </div>
            </div>
            
            <input type="text" id="diaryTitle" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒ)" class="w-full text-2xl font-bold p-3 border-b-2 border-gray-200 focus:outline-none focus:border-primary-violet/70 transition mb-4">
            
            <textarea id="diaryContent" placeholder="ì˜¤ëŠ˜ì€ ì–´ë–¤ í•˜ë£¨ì˜€ë‚˜ìš”? (ê¸°ë¡ ì‹œì‘ ì‹œ ì‚¬ë¼ì§‘ë‹ˆë‹¤)" rows="15" 
                      class="w-full flex-grow text-base leading-relaxed p-3 bg-white focus:outline-none resize-none placeholder-gentle-gray"
                      style="font-family: 'Noto Sans KR', sans-serif;">
            </textarea>
            
            <div class="mt-4 flex justify-end pt-4 border-t border-gray-100">
                <button type="button" id="submitDiaryBtn" onclick="submitDiaryPost()" 
                        class="bg-gray-300 text-white py-3 px-6 rounded-full font-bold shadow-md cursor-not-allowed transition transform"
                        disabled>
                    ê¸°ë¡ ì™„ë£Œ
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    // ------------------------------------------------------------------
    // V15.0: í•µì‹¬ ë°ì´í„° ë° ìƒíƒœ ì •ì˜ (V14.0 ìœ ì§€)
    // ------------------------------------------------------------------
    const data = {
        diaries: [
            { id: 1, userId: 'hyeran', date: '2025.12.09', title: 'ìƒˆë¡œìš´ ì‹œì‘ì— ëŒ€í•œ ê¸°ëŒ€ì™€ ë¶ˆì•ˆ', content: 'ì„±ì¥í†µì´ê¸°ë¥¼ ë°”ë¼ë©°.', emotion: 'ğŸ˜Œ', moodName: 'í‰ì˜¨', moodColor: '#A2E8E4' },
            { id: 2, userId: 'hyeran', date: '2025.12.07', title: 'ì†Œí™•í–‰, ë”°ëœ»í•œ ë¼ë–¼ í•œ ì”', content: 'ëª¨ë“  í”¼ë¡œê°€ ë…¹ëŠ” ê¸°ë¶„.', emotion: 'ğŸ˜„', moodName: 'í–‰ë³µ', moodColor: '#FFD700' },
            { id: 3, userId: 'another', date: '2025.12.06', title: 'ë‹¤ë¥¸ ìœ ì €ì˜ ê¸°ë¡', content: 'ì´ê±´ ë³´ì—¬ì£¼ë©´ ì•ˆë¨.', emotion: 'ğŸ˜', moodName: 'ë¬´ê´€ì‹¬', moodColor: '#D3D3D3' }
        ],
        currentUser: { id: 'hyeran', name: 'í˜œë€ë‹˜' } 
    };

    let selectedMood = { mood: '', icon: '', color: '' };
    let currentTab = 'home'; 

    const PAGES = ['homePage', 'newsletterPage', 'editorTalkPage', 'momentPage', 'sanctuaryPage', 'myPage'];
    const TABS = ['nav-home', 'nav-newsletter', 'nav-editorTalk', 'nav-moment', 'nav-sanctuary', 'nav-myPage'];

    // ------------------------------------------------------------------
    // V15.0: í•µì‹¬ í•¨ìˆ˜ - í˜ì´ì§€ ì´ë™ ë° UI ì—…ë°ì´íŠ¸ (ë²„íŠ¼ ì‘ë™ ì˜¤ë¥˜ í•´ê²°)
    // ------------------------------------------------------------------
    function hideAllPages() {
        PAGES.forEach(id => {
            const page = document.getElementById(id);
            if (page) page.classList.add('hide');
        });
    }

    function deactivateAllTabs() {
        TABS.forEach(id => {
            const tab = document.getElementById(id);
            if (tab) tab.classList.remove('text-primary-violet'); // V15.0 ìƒ‰ìƒ ë°˜ì˜
            if (tab) tab.classList.add('text-gray-400');
        });
    }

    function navigateTo(pageId) {
        // 'Page' ì ‘ë¯¸ì‚¬ê°€ ìƒëµëœ ê²½ìš°ë¥¼ ëŒ€ë¹„í•œ ë³´ì •
        const fullPageId = pageId.endsWith('Page') ? pageId : pageId + 'Page'; 
        
        if (!PAGES.includes(fullPageId)) {
            console.error('Invalid page ID:', fullPageId);
            return;
        }

        // 1. ëª¨ë“  í˜ì´ì§€ ìˆ¨ê¹€
        hideAllPages();
        
        // 2. ìš”ì²­ëœ í˜ì´ì§€ í‘œì‹œ (fade-in íš¨ê³¼ ì ìš©)
        const pageElement = document.getElementById(fullPageId);
        if (pageElement) {
            pageElement.classList.remove('hide');
            // í´ë˜ìŠ¤ ì¬ì¶”ê°€ë¡œ ì• ë‹ˆë©”ì´ì…˜ íŠ¸ë¦¬ê±° (UX í–¥ìƒ)
            pageElement.classList.remove('fade-in'); 
            void pageElement.offsetWidth; 
            pageElement.classList.add('fade-in'); 
        }

        // 3. ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
        deactivateAllTabs();
        
        // 4. ìš”ì²­ëœ íƒ­ í™œì„±í™”
        const navId = 'nav-' + pageId;
        const tabElement = document.getElementById(navId);
        if (tabElement) {
            tabElement.classList.remove('text-gray-400');
            tabElement.classList.add('text-primary-violet'); // V15.0 ìƒ‰ìƒ ë°˜ì˜
        }

        // 5. í˜„ì¬ íƒ­ ìƒíƒœ ì—…ë°ì´íŠ¸
        currentTab = pageId;

        // 6. í˜ì´ì§€ë³„ íŠ¹í™” ë Œë”ë§ í˜¸ì¶œ
        if (pageId === 'sanctuary') renderSanctuary();
    }

    // ------------------------------------------------------------------
    // V15.0: ì´ˆê¸° ë¡œë“œ í•¨ìˆ˜ (í™ˆ í™”ë©´ ì§„ì… ë° ê¸°ëŠ¥ ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™” ë³´ì¥)
    // ------------------------------------------------------------------
    function initApp() {
        // ëª¨ë“  í˜ì´ì§€/ëª¨ë‹¬ì´ í™•ì‹¤í•˜ê²Œ ìˆ¨ê²¨ì§„ ìƒíƒœì—ì„œ ì‹œì‘
        hideAllPages();
        
        // **í•µì‹¬ ìˆ˜ì •: DOM ë¡œë“œ í›„ navigateTo('home')ì„ ëª…í™•íˆ í˜¸ì¶œí•˜ì—¬ í™ˆ í™”ë©´ ì§„ì… ë³´ì¥**
        navigateTo('home'); 
        
        // V10.0: Dynamic Greeting ì´ˆê¸°í™”
        const greetingTitle = document.getElementById('greetingTitle');
        if(data.currentUser) {
            greetingTitle.innerText = `${data.currentUser.name} ì˜¤ëŠ˜ë„ í–‰ë³µí•˜ì„¸ìš”! ğŸŒ¿`;
        }
        
        // ëª¨ë“  ë¦¬ìŠ¤ë„ˆ ì¬ë¶€ì°© í™•ì¸
        setupMoodTrackerListeners(); 
    }
    
    // V15.0: ë‹¤ì´ì–´ë¦¬ ê¸°ëŠ¥ í•¨ìˆ˜ë“¤ (V14.0 ë¡œì§ ìœ ì§€)
    function closeModal(event, modalId) {
        if (event && event.target.id !== modalId && !event.target.classList.contains('modal')) return;
        document.getElementById(modalId).style.display = 'none';
    }
    
    function showDiaryWriteModal() {
        if (!data.currentUser) {
            alert('ë¡œê·¸ì¸ í›„ ë¹„ë°€ ê¸°ë¡ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            return;
        }
        document.getElementById('diaryWriteModal').style.display = 'flex';
        document.getElementById('diaryTitle').value = '';
        document.getElementById('diaryContent').value = '';
        selectedMood = { mood: '', icon: '', color: '' };
        document.querySelectorAll('.mood-icon').forEach(btn => {
            btn.style.borderColor = 'transparent';
            btn.style.boxShadow = 'none';
        });
        checkDiaryFormStatus();
    }
    
    function checkDiaryFormStatus() {
        // ... (V14.0 ë¡œì§ ìœ ì§€) ...
        const content = document.getElementById('diaryContent').value.trim();
        const submitBtn = document.getElementById('submitDiaryBtn');
        
        if (selectedMood.mood && content) {
            submitBtn.disabled = false;
            submitBtn.classList.remove('bg-gray-300', 'cursor-not-allowed');
            // V15.0: ë²„íŠ¼ í™œì„±í™” ì‹œ ìƒ‰ìƒ ë³€ê²½
            submitBtn.classList.add('bg-primary-violet', 'hover:bg-violet-600'); 
        } else {
            submitBtn.disabled = true;
            submitBtn.classList.add('bg-gray-300', 'cursor-not-allowed');
            submitBtn.classList.remove('bg-primary-violet', 'hover:bg-violet-600');
        }
    }
    
    function setupMoodTrackerListeners() {
        document.querySelectorAll('.mood-icon').forEach(button => {
            button.addEventListener('click', (e) => {
                e.preventDefault(); 
                document.querySelectorAll('.mood-icon').forEach(btn => {
                    btn.style.borderColor = 'transparent';
                    btn.style.boxShadow = 'none';
                });
                
                const color = e.currentTarget.getAttribute('data-color');
                e.currentTarget.style.borderColor = color;
                e.currentTarget.style.boxShadow = `0 0 10px ${color}80`;
                
                selectedMood = {
                    mood: e.currentTarget.getAttribute('data-mood'),
                    icon: e.currentTarget.innerText.trim(),
                    color: color
                };
                checkDiaryFormStatus();
            });
        });
        document.getElementById('diaryContent').addEventListener('input', checkDiaryFormStatus);
    }
    
    function submitDiaryPost() {
        // ... (V14.0 ë¡œì§ ìœ ì§€) ...
        const title = document.getElementById('diaryTitle').value;
        const content = document.getElementById('diaryContent').value.trim();
        
        if (!selectedMood.mood || !content) {
            alert('ê°ì •ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        const newDiary = {
            id: Date.now(),
            userId: data.currentUser.id,
            date: new Date().toISOString().split('T')[0].replace(/-/g, '.'),
            title: title,
            content: content,
            emotion: selectedMood.icon, 
            moodName: selectedMood.mood, 
            moodColor: selectedMood.color 
        };
        
        data.diaries.unshift(newDiary);
        closeModal(null, 'diaryWriteModal');
        
        alert(`'${newDiary.moodName}' ë¬´ë“œë¡œ ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        navigateTo('sanctuary'); 
    }

    function renderSanctuary() {
        // ... (V14.0 ë¡œì§ ìœ ì§€, V15.0 ë””ìì¸ ë°˜ì˜) ...
        if (!data.currentUser) {
             document.getElementById('sanctuaryPage').innerHTML = `<p class="text-center text-gray-400 mt-20">ë¡œê·¸ì¸ í›„ ë‚˜ë§Œì˜ ë¹„ë°€ ê³µê°„, 'ì˜¤ëŠ˜ì˜ ë¬´ë“œ'ë¥¼ ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>`;
             return;
        }
        
        const header = document.getElementById('sanctuaryHeader');
        const container = document.getElementById('diaryListContainer');
        
        header.innerHTML = `
            <div class="flex-grow">
                <h2 class="text-2xl font-bold text-primary-violet flex items-center">
                    ì˜¤ëŠ˜ì˜ ë¬´ë“œ 
                    <svg class="w-5 h-5 ml-2 text-primary-violet" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6-6h.008v.008H6v-.008zm0 3h.008v.008H6v-.008zm0 3h.008v.008H6v-.008zm3-3h.008v.008H9v-.008zm0 3h.008v.008H9v-.008zm9-9h.008v.008H18v-.008zm0 3h.008v.008H18v-.008zm0 3h.008v.008H18v-.008z"/></svg>
                </h2>
                <p class="text-sm text-gray-600 mt-1">í–…ì‚ë‹˜ì´ ì˜¤ëŠ˜ ëŠë‚€ ê°ì •ê³¼ ìƒê°ë“¤ì„ ì†”ì§í•˜ê²Œ ê¸°ë¡í•´ ë³´ì„¸ìš”!</p>
            </div>
            <button id="writeDiaryBtn" onclick="showDiaryWriteModal()" class="p-2 bg-primary-violet rounded-full text-white shadow-md hover:bg-violet-600 transition active:scale-90">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
            </button>
        `;
        
        container.innerHTML = '';
        
        const allowedUsers = [data.currentUser.id, 'happxi'];
        const userDiaries = data.diaries.filter(d => allowedUsers.includes(d.userId));

        userDiaries.forEach(diary => {
            const html = `
                <div class="bg-white p-5 rounded-2xl shadow-soft border-l-4" style="border-color: ${diary.moodColor || '#D3D3D3'}; cursor: pointer; transition: transform 0.2s;" onclick="toggleDiaryContent(this, ${diary.id})">
                    <div class="flex items-start justify-between">
                        <div class="flex flex-col items-center mr-4 text-gray-500">
                            <span class="font-bold text-xl">${diary.date.split('.')[2]}</span>
                            <span class="text-xs">${diary.date.substring(0, 7)}</span>
                        </div>
                        
                        <div class="flex-grow">
                            <h3 class="text-lg font-bold text-gray-800 leading-tight flex justify-between items-center">
                                ${diary.title || 'ì œëª© ì—†ìŒ'} 
                                <span class="text-2xl">${diary.emotion}</span>
                            </h3>
                            <p class="diary-preview text-sm text-gray-500 mt-1 line-clamp-2">${diary.content}</p>
                            <div class="diary-full-content mt-4 border-t pt-3 text-base leading-relaxed text-gray-700 hide">
                                ${diary.content}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            container.innerHTML += html;
        });
        
        if (userDiaries.length === 0) {
            container.innerHTML = `<p class="text-center text-gray-400 mt-10">ì•„ì§ ê¸°ë¡ëœ ë¬´ë“œê°€ ì—†ì–´ìš”. ì²« ê¸°ë¡ì„ ë‚¨ê²¨ë³´ì„¸ìš”! :)</p>`;
        }
    }
    
    function toggleDiaryContent(cardElement, diaryId) {
        // ... (V14.0 ë¡œì§ ìœ ì§€) ...
        const preview = cardElement.querySelector('.diary-preview');
        const fullContent = cardElement.querySelector('.diary-full-content');
        
        if (fullContent.classList.contains('hide')) {
            preview.classList.add('hide');
            fullContent.classList.remove('hide');
        } else {
            preview.classList.remove('hide');
            fullContent.classList.add('hide');
        }
    }


    // ------------------------------------------------------------------
    // V15.0: ì•± ì´ˆê¸°í™” (DOM ë¡œë“œ ì‹œ ì‹¤í–‰)
    // ------------------------------------------------------------------
    window.addEventListener('load', initApp);
    
</script>
</body>
</html>
