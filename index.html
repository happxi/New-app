<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ììœ ì˜ì§€: íœ´ì‹ ê¸°ë¡</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* --- 1. ë³€ìˆ˜ ë° ê¸°ë³¸ ìŠ¤íƒ€ì¼ --- */
        :root {
            --primary: #8B5CF6; /* ë³´ë¼ìƒ‰ */
            --primary-dark: #6D28D9;
            --accent: #F59E0B; /* ì£¼í™© */
            --background: #F3F4F6;
            --text-dark: #1F2937;
            --text-light: #6B7280;
            --border-color: #E5E7EB;
            
            /* ìš”ì²­í•˜ì‹  ìíœ´ë ˆí„°/ìíœ´ë© ì»¬ëŸ¬ ë³€ìˆ˜ */
            --info-light: #BFDBFE; /* ì—°í•œ í•˜ëŠ˜ìƒ‰ */
            --success-light: #D1FAE5; /* ì—°í•œ ì—°ë‘ìƒ‰ */
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background);
            color: var(--text-dark);
            overflow-x: hidden;
            touch-action: pan-y; /* ìŠ¤í¬ë¡¤ ì„±ëŠ¥ í–¥ìƒ */
        }
        #appContainer {
            max-width: 500px;
            margin: 0 auto;
            min-height: 100vh;
            background-color: white;
            padding-bottom: 80px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
            display: none; /* ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ */
        }

        /* --- 2. ë¡œë”© ìŠ¤í¬ë¦° --- */
        #loadingScreen {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #F9FAFB, #EDE9FE);
            transition: opacity 0.5s ease-in-out;
            opacity: 1;
        }
        #loadingScreen i {
            font-size: 3rem;
            color: var(--primary);
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.7; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 0.7; }
        }

        /* --- 3. í—¤ë” ë° ë„¤ë¹„ê²Œì´ì…˜ --- */
        .header-section {
            padding: 20px;
            background-color: white;
            border-bottom: 1px solid var(--border-color);
        }
        .header-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-dark);
        }
        .header-sub {
            font-size: 14px;
            color: var(--text-light);
            margin-top: 4px;
        }

        .navbar {
            position: fixed;
            bottom: 0;
            width: 100%;
            max-width: 500px;
            height: 60px;
            background-color: white;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-around;
            align-items: center;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
            z-index: 100;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-light);
            transition: color 0.3s;
            flex-grow: 1;
            height: 100%;
        }
        .nav-item i {
            font-size: 18px;
        }
        .nav-item span {
            font-size: 10px;
            margin-top: 4px;
        }
        .nav-item.active {
            color: var(--primary);
        }
        
        #writeIcon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background-color: var(--accent);
            color: white;
            border-radius: 50%;
            display: none; /* ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ */
            justify-content: center;
            align-items: center;
            font-size: 18px;
            box-shadow: 0 4px 8px rgba(245, 158, 11, 0.4);
            z-index: 110;
            cursor: pointer;
        }

        /* --- 4. ì½˜í…ì¸  ìŠ¤íƒ€ì¼ --- */
        .content-card {
            background-color: var(--background);
            padding: 15px;
            margin: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .content-card:hover {
            background-color: #E5E7EB;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        .btn-primary:hover {
            background-color: var(--primary-dark);
        }
        .input-box {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 14px;
        }
        
        /* ë§ˆì´í˜ì´ì§€ íƒ­ */
        .mypage-tabs {
            display: flex;
            justify-content: space-around;
            padding: 0 20px;
            border-bottom: 1px solid var(--border-color);
            margin-top: 10px;
        }
        .mypage-tab {
            padding: 10px 0;
            cursor: pointer;
            color: var(--text-light);
            font-weight: 500;
            border-bottom: 3px solid transparent;
            transition: color 0.2s, border-bottom-color 0.2s;
        }
        .mypage-tab.active {
            color: var(--primary-dark);
            border-bottom-color: var(--primary);
        }

        /* ì—ë””í„° í•„í„° íƒ­ */
        .editor-filter-tabs {
            display: flex;
            padding: 0 20px 10px;
            overflow-x: auto;
            gap: 8px;
            white-space: nowrap;
        }
        .editor-tab {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        .editor-tab.active {
            background-color: var(--accent);
            color: white !important;
            border-color: var(--accent);
        }

        /* ìŠ¤íƒ¬í”„ ë³´ë“œ */
        .stamp-board {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            padding: 10px 0;
        }
        .stamp-cell {
            aspect-ratio: 1 / 1;
            background-color: #FEE2E2;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #FCA5A5;
            font-size: 1.2rem;
            border: 1px solid #FECACA;
        }
        .stamp-cell.stamped {
            background-color: #6D28D9;
            color: white;
            border: 1px solid var(--primary-dark);
        }
        
        /* ë¬´ë“œ íƒœê·¸ */
        #moodTagSelector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 10px 0;
            justify-content: center;
        }
        .mood-tag {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: opacity 0.2s;
        }
        .mood-tag.selected {
            border: 2px solid var(--accent);
            box-shadow: 0 0 5px rgba(245, 158, 11, 0.5);
        }


        /* --- 5. ëª¨ë‹¬ ìŠ¤íƒ€ì¼ --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 200;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            transform: translateY(-20px);
            transition: transform 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        .modal-overlay.show .modal-content {
            transform: translateY(0);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
        }
        
        /* ìƒì„¸ í˜ì´ì§€ */
        #postDetailModal .modal-content {
            height: 90vh;
            max-height: 700px;
            display: flex;
            flex-direction: column;
        }
        #postDetailBody {
            overflow-y: auto;
            padding-right: 5px; /* ìŠ¤í¬ë¡¤ë°” ê³µê°„ */
        }
        .detail-meta {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 10px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }
        #detailImage {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-top: 15px;
            background: #eee;
        }
        #detailContent {
            margin: 15px 0;
            line-height: 1.6;
            font-size: 14px;
        }
        .interaction-bar {
            display: flex;
            justify-content: space-between;
            border-top: 1px solid var(--border-color);
            padding-top: 10px;
            margin-top: 10px;
        }
        .interaction-btn {
            background: none;
            border: 1px solid var(--border-color);
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            color: var(--text-light);
            transition: all 0.2s;
        }
        .interaction-btn i { margin-right: 5px; }

        /* ëŒ“ê¸€ */
        .comment-item {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
            font-size: 13px;
        }
        .comment-meta {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: var(--text-light);
            margin-bottom: 5px;
        }
        .reply-btn {
            color: var(--primary);
            cursor: pointer;
            font-weight: bold;
        }
        .reply-section {
            padding-left: 15px;
            border-left: 2px solid var(--border-color);
            margin-top: 10px;
        }
        .reply-item {
            padding: 5px 0;
            border-top: 1px dotted #eee;
            margin-top: 5px;
        }
        .reply-input-group {
            display: flex;
            gap: 5px;
            margin-top: 10px;
            align-items: center;
        }
        .comment-input-area {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

    </style>
</head>
<body>

    <div id="loadingScreen">
        <i class="fas fa-heart"></i>
    </div>

    <div id="appContainer">
        </div>

    <div class="navbar">
        <div id="nav-home" class="nav-item active" onclick="renderTab('home')">
            <i class="fas fa-home"></i>
            <span>í™ˆ</span>
        </div>
        <div id="nav-letter" class="nav-item" onclick="renderTab('letter', 'all')">
            <i class="fas fa-book-open"></i>
            <span>ìíœ´ë ˆí„°</span>
        </div>
        <div id="writeIcon" onclick="openModal(document.getElementById('nav-mood').classList.contains('active') ? 'mood' : 'adminWrite')">
            <i class="fas fa-pen"></i>
        </div>
        <div id="nav-mood" class="nav-item" onclick="renderTab('mood')">
            <i class="fas fa-calendar-check"></i>
            <span>ë¬´ë“œ</span>
        </div>
        <div id="nav-editorTalk" class="nav-item" onclick="renderTab('editorTalk', 'all')">
            <i class="fas fa-comments"></i>
            <span>ì—ë””í„°í†¡</span>
        </div>
        <div id="nav-mypage" class="nav-item" onclick="renderTab('mypage')">
            <i class="fas fa-user"></i>
            <span>ë§ˆì´</span>
        </div>
    </div>

    <div id="loginModal" class="modal-overlay" onclick="if(event.target.id === 'loginModal') closeModal()">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ë¡œê·¸ì¸</h2>
                <button class="modal-close" onclick="showSignupModal()"><i class="fas fa-user-plus"></i></button>
            </div>
            <input type="email" id="loginEmail" class="input-box" placeholder="ì´ë©”ì¼ ì£¼ì†Œ">
            <input type="password" id="loginPassword" class="input-box" placeholder="ë¹„ë°€ë²ˆí˜¸">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <label style="font-size:12px;"><input type="checkbox" id="saveLoginInfo" style="margin-right:5px;">ë¡œê·¸ì¸ ì •ë³´ ì €ì¥</label>
                <a href="#" onclick="showFindPasswordModal()" style="font-size:12px; color:var(--text-light);">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
            </div>
            <button class="btn-primary" style="width:100%;" onclick="handleLogin()">ë¡œê·¸ì¸</button>
        </div>
    </div>

    <div id="signupModal" class="modal-overlay" onclick="if(event.target.id === 'signupModal') closeModal()">
        <div class="modal-content">
            <div class="modal-header">
                <h2>íšŒì›ê°€ì…</h2>
                <button class="modal-close" onclick="showLoginModal()"><i class="fas fa-times"></i></button>
            </div>
            <input type="text" id="signupNickname" class="input-box" placeholder="ë‹‰ë„¤ì„">
            <input type="email" id="signupEmail" class="input-box" placeholder="ì´ë©”ì¼ ì£¼ì†Œ">
            <input type="password" id="signupPassword" class="input-box" placeholder="ë¹„ë°€ë²ˆí˜¸ (4ì ì´ìƒ)">
            <button class="btn-primary" style="width:100%;" onclick="handleSignup()">ê°€ì…í•˜ê¸°</button>
        </div>
    </div>

    <div id="findPasswordModal" class="modal-overlay" onclick="if(event.target.id === 'findPasswordModal') closeModal()">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</h2>
                <button class="modal-close" onclick="showLoginModal()"><i class="fas fa-times"></i></button>
            </div>
            <p style="font-size:13px; color:var(--text-light); margin-bottom:15px;">ë“±ë¡ëœ ì´ë©”ì¼ë¡œ ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.</p>
            <input type="email" id="findPasswordEmail" class="input-box" placeholder="ê°€ì… ì‹œ ì‚¬ìš©í•œ ì´ë©”ì¼ ì£¼ì†Œ">
            <button class="btn-primary" style="width:100%;" onclick="handleFindPassword()">ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ ë°›ê¸°</button>
        </div>
    </div>

    <div id="changePasswordModal" class="modal-overlay" onclick="if(event.target.id === 'changePasswordModal') closeModal()">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h2>
                <button class="modal-close" onclick="closeModal()"><i class="fas fa-times"></i></button>
            </div>
            <input type="password" id="currentPassword" class="input-box" placeholder="í˜„ì¬ ë¹„ë°€ë²ˆí˜¸">
            <input type="password" id="newPassword" class="input-box" placeholder="ìƒˆë¡œìš´ ë¹„ë°€ë²ˆí˜¸ (4ì ì´ìƒ)">
            <input type="password" id="confirmNewPassword" class="input-box" placeholder="ìƒˆë¡œìš´ ë¹„ë°€ë²ˆí˜¸ í™•ì¸">
            <button class="btn-primary" style="width:100%;" onclick="handleChangePassword()">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì™„ë£Œ</button>
        </div>
    </div>

    <div id="writeModal" class="modal-overlay" onclick="if(event.target.id === 'writeModal') closeModal()">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="writeTitle">ê¸€ì“°ê¸°</h2>
                <button class="modal-close" onclick="closeModal()"><i class="fas fa-times"></i></button>
            </div>
            <input type="hidden" id="editPostId">

            <select id="postCategory" class="input-box" style="display:none;">
                <option value="ìíœ´ë ˆí„°">ìíœ´ë ˆí„°</option>
                <option value="ìíœ´ë©">ìíœ´ë©</option>
                <option value="ì—ë””í„°í†¡">ì—ë””í„°í†¡</option>
            </select>

            <input type="text" id="postTitle" class="input-box" placeholder="ì œëª©">

            <div id="moodSection" style="display:none;">
                <p style="font-size:12px; margin-top:5px; font-weight:bold;">ì˜¤ëŠ˜ì˜ ê¸°ë¶„ì€?</p>
                <div id="moodTagSelector">
                    </div>
            </div>

            <textarea id="postContent" class="input-box" placeholder="ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" rows="5" style="resize:none;"></textarea>
            
            <div id="photoAttachment" style="display:none; margin-bottom:15px;">
                 <label for="postImage" style="display:block; font-size:13px; font-weight:bold; margin-bottom:5px;">ğŸ–¼ï¸ ì‚¬ì§„ ì²¨ë¶€ (ì„ íƒ)</label>
                 <input type="file" id="postImage" accept="image/*" style="width:100%; border:1px solid #ddd; padding:8px; border-radius:8px;">
            </div>

            <button class="btn-primary" style="width:100%;" onclick="submitPost()">ë“±ë¡í•˜ê¸°</button>
        </div>
    </div>

    <div id="postDetailModal" class="modal-overlay" onclick="if(event.target.id === 'postDetailModal') closeModal()">
        <div class="modal-content">
            <div class="modal-header" style="flex-shrink:0;">
                <h2 id="detailCategory" style="color:var(--primary); font-size:16px;">Category</h2>
                <button class="modal-close" onclick="closeModal()"><i class="fas fa-times"></i></button>
            </div>
            <div id="postDetailBody">
                <h1 id="detailTitle" style="font-size:22px; margin-bottom:0;">ê²Œì‹œë¬¼ ì œëª©</h1>
                <div class="detail-meta">
                    <div>
                        <span>ì‘ì„±ì: <b id="detailAuthor"></b></span>
                        <span style="margin-left:15px;">ë‚ ì§œ: <b id="detailDate"></b></span>
                    </div>
                    <div id="manageButtons" style="display:none; gap:10px;">
                        <button class="btn-primary" style="padding:4px 8px; font-size:12px; background:#F59E0B;" onclick="editPost()">ìˆ˜ì •</button>
                        <button class="btn-primary" style="padding:4px 8px; font-size:12px; background:#EF4444;" onclick="deletePost()">ì‚­ì œ</button>
                    </div>
                </div>
                
                <img id="detailImage" alt="ì²¨ë¶€ ì´ë¯¸ì§€" style="display:none;">
                
                <div id="detailContent">
                    ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                </div>
                
                <div class="interaction-bar">
                    <div style="display:flex; gap:10px;">
                        <button id="btnLike" class="interaction-btn" onclick="toggleLike()">
                            <i class="fas fa-heart"></i> ì¢‹ì•„ìš” (<span id="likeCount">0</span>)
                        </button>
                        <button id="btnBookmark" class="interaction-btn" onclick="toggleBookmark()">
                            <i class="fas fa-bookmark"></i> ë¶ë§ˆí¬
                        </button>
                    </div>
                </div>

                <h3 style="font-size:16px; margin-top:20px;">ëŒ“ê¸€</h3>
                <div id="commentList">
                    </div>
                
                <div class="comment-input-area">
                    <input type="text" id="commentInput" class="input-box" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..." style="flex-grow:1; margin-bottom:0;">
                    <button class="btn-primary" style="width:60px; height:40px; margin-bottom:0;" onclick="submitComment(null)">ë“±ë¡</button>
                </div>
                
            </div>
        </div>
    </div>

    <script>
        // --- ë°ì´í„° ë° ìƒíƒœ ê´€ë¦¬ ---
        const SUPER_ADMIN = 'happxi@jahyu.com';
        const EDITORS = {
            'happxi@jahyu.com': 'í–…ì”¨', 'elly@jahyu.com': 'ì—˜ë¦¬', 'gokal@jahyu.com': 'ê³ ì¹¼', 
            'sunny@jahyu.com': 'ì¨ë‹ˆ', 'yudan@jahyu.com': 'ìœ ë‹¨'
        };
        const ADMINS = Object.keys(EDITORS);
        
        // 20ê°€ì§€ íŒŒìŠ¤í…”í†¤ ê·€ì—¬ìš´ íƒ€ì´í¬ê·¸ë˜í”¼ (ë¬´ë“œ íƒœê·¸)
        const MOOD_TAGS = [
            { text: '#í–‰ë³µí•´', color: '#BEE3F8' }, { text: '#ì‚¬ë‘ìŠ¤ëŸ¬ì›Œ', color: '#FEEBCF' }, { text: '#ë”°ëœ»í•´', color: '#D6BCFA' },
            { text: '#í‰í™”ë¡œì›Œ', color: '#A7F3D0' }, { text: '#ê¸°ëŒ€ë¼', color: '#FDD6D9' }, { text: '#ììœ ë¡œì›Œ', color: '#BEE3F8' },
            { text: '#ì§€ë£¨í•´', color: '#D1D5DB' }, { text: '#ë‹µë‹µí•´', color: '#FECACA' }, { text: '#í”¼ê³¤í•´', color: '#A7F3D0' },
            { text: '#ìš°ìš¸í•´', color: '#BFDBFE' }, { text: '#í™”ë‚˜', color: '#FCD7D7' }, { text: '#ì‹ ë‚˜', color: '#FEF08A' },
            { text: '#íë§', color: '#E9D5FF' }, { text: '#ë°˜ê°€ì›Œ', color: '#BFDBFE' }, { text: '#ì„¤ë ˜', color: '#FDD6D9' },
            { text: '#í¸ì•ˆí•´', color: '#D1FAE5' }, { text: '#ë³µì¡í•´', color: '#BFDBFE' }, { text: '#ì§œì¦ë‚˜', color: '#FEE2E2' },
            { text: '#ì¢‹ì•„', color: '#FDD6D9' }, { text: '#í‰ë²”í•´', color: '#D1D5DB' }
        ];

        let currentUser = null;
        let users = {};
        let posts = [];
        let comments = [];
        let myLikes = [];
        let myBookmarks = [];
        let currentViewingPostId = null;
        let lastMoodDate = localStorage.getItem('lastMoodDate') || null;
        let currentMoodTag = null; // í˜„ì¬ ì„ íƒëœ ë¬´ë“œ íƒœê·¸

        function saveData(key, data) {
            localStorage.setItem(`jahyu_${key}`, JSON.stringify(data));
        }
        
        function getTodayDate() {
            return new Date().toISOString().split('T')[0];
        }
        
        // --- ì´ˆê¸° ë°ì´í„° ë¡œë”© ---
        function initData() {
            const initialUsers = {
                'happxi@jahyu.com': { nickname: 'í–…ì”¨', password: 'admin123', stamps: 5, lastActive: Date.now(), totalDuration: 1200 },
                'elly@jahyu.com': { nickname: 'ì—˜ë¦¬', password: 'admin123', stamps: 3, lastActive: Date.now(), totalDuration: 900 },
                'gokal@jahyu.com': { nickname: 'ê³ ì¹¼', password: 'admin123', stamps: 1, lastActive: Date.now(), totalDuration: 600 },
                'sunny@jahyu.com': { nickname: 'ì¨ë‹ˆ', password: 'admin123', stamps: 0, lastActive: Date.now(), totalDuration: 300 },
                'yudan@jahyu.com': { nickname: 'ìœ ë‹¨', password: 'admin123', stamps: 2, lastActive: Date.now(), totalDuration: 450 },
                'user@example.com': { nickname: 'í–…ì‚', password: 'test', stamps: 12, lastActive: Date.now(), totalDuration: 2000 }
            };
            
            const initialPosts = [
                { id: 101, type: 'letter', category: 'ìíœ´ë ˆí„°', title: '[32í˜¸] í‡´ì‚¬ í›„ ë²ˆì•„ì›ƒ', content: 'ì‰¬ì–´ë„ ì‰¬ëŠ” ê²ƒ ê°™ì§€ ì•Šì€ ë‹¹ì‹ ì—ê²Œ...', author: 'í–…ì”¨', authorId: 'happxi@jahyu.com', date: '2025-12-08', views: 50 },
                { id: 102, type: 'letter', category: 'ìíœ´ë©', title: 'ê¸€ì“°ê¸°ë¡œ ë§ˆìŒ ì±™ê¸°ê¸°', content: 'ë‚˜ë¥¼ ëŒì•„ë³´ëŠ” ì‹œê°„', author: 'ì—˜ë¦¬', authorId: 'elly@jahyu.com', date: '2025-12-09', views: 30 },
                { id: 201, type: 'talk', category: 'ì—ë””í„°í†¡', title: 'ì˜¤ëŠ˜ ë‚ ì”¨ ë§‘ìŒ â˜€ï¸', content: 'ì‚°ì±…í•˜ê¸° ë”± ì¢‹ì€ ë‚ ì”¨ë„¤ìš”!', author: 'ê³ ì¹¼', authorId: 'gokal@jahyu.com', date: '2025-12-10', views: 20 },
                { id: 301, type: 'mood', title: 'ì˜¤ëŠ˜ì˜ ë¬´ë“œ', content: 'ê¸°ë¶„ì´ ë„ˆë¬´ ì¢‹ì•„ìš”!', author: 'í–…ì‚', authorId: 'user@example.com', date: '2025-12-11', moodTag: '#í–‰ë³µí•´', tagColor: '#BEE3F8', views: 5 }
            ];
            
            const initialComments = [
                { id: 1, postId: 201, content: 'ë§ì•„ìš” ë‚ ì”¨ ë„ˆë¬´ ì¢‹ì•„ìš”!', author: 'í–…ì‚', authorId: 'user@example.com', date: '2025-12-10', parentId: null },
                { id: 2, postId: 201, content: 'ì €ë„ ì‚°ì±…ê°ˆë˜ìš”!', author: 'í–…ì”¨', authorId: 'happxi@jahyu.com', date: '2025-12-10', parentId: null },
                { id: 3, postId: 201, content: 'ëŒ“ê¸€ì— ëŒ€í•œ ë‹µê¸€ í…ŒìŠ¤íŠ¸!', author: 'ì—˜ë¦¬', authorId: 'elly@jahyu.com', date: '2025-12-11', parentId: 1 }
            ];
            
            users = JSON.parse(localStorage.getItem('jahyu_users')) || initialUsers;
            posts = JSON.parse(localStorage.getItem('jahyu_posts')) || initialPosts;
            comments = JSON.parse(localStorage.getItem('jahyu_comments')) || initialComments;
            myLikes = JSON.parse(localStorage.getItem('jahyu_myLikes')) || [];
            myBookmarks = JSON.parse(localStorage.getItem('jahyu_myBookmarks')) || [];
            
            Object.keys(users).forEach(email => {
                if (!users[email].nickname) { users[email].nickname = email.split('@')[0]; }
                if (users[email].stamps === undefined) { users[email].stamps = 0; }
                if (ADMINS.includes(email)) { users[email].password = 'admin123'; }
                
                // ëŒ€ì‹œë³´ë“œ ë°ì´í„° ì´ˆê¸°í™”
                if (users[email].lastActive === undefined) { users[email].lastActive = Date.now(); }
                if (users[email].totalDuration === undefined) { users[email].totalDuration = 0; }
            });
            
            saveData('users', users);
            saveData('posts', posts);
            saveData('comments', comments);
        }

        // --- í™œë™ ì‹œê°„ ì—…ë°ì´íŠ¸ (ëŒ€ì‹œë³´ë“œ ì‹¤ì‹œê°„ ë°˜ì˜ ë¡œì§) ---
        let lastActivityTime = Date.now();
        function updateDuration() {
            if (currentUser && users[currentUser.id]) {
                const now = Date.now();
                const elapsedSeconds = Math.floor((now - lastActivityTime) / 1000);
                
                // 10ì´ˆ ì´ìƒ í™œë™ ì‹œì—ë§Œ ë°˜ì˜
                if (elapsedSeconds > 10) { 
                    users[currentUser.id].totalDuration = (users[currentUser.id].totalDuration || 0) + elapsedSeconds;
                    users[currentUser.id].lastActive = now;
                    saveData('users', users);
                }
                lastActivityTime = now;
            }
        }
        
        // 5ì´ˆë§ˆë‹¤ í™œë™ ì‹œê°„ ì²´í¬
        setInterval(updateDuration, 5000); 

        // --- ì´ˆê¸°í™” ë° ë¡œê·¸ì¸ ---
        window.addEventListener('load', () => {
            initData();
            
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('dev') === 'true') {
                 currentUser = { id: SUPER_ADMIN, name: 'í–…ì”¨', isSuperAdmin: true, isAdmin: true };
                 localStorage.setItem('jahyu_currentUser', JSON.stringify(currentUser));
                 checkLogin(true);
                 // ë¡œë”© í™”ë©´ ìˆ¨ê¸°ê¸°
                 document.getElementById('loadingScreen').style.opacity = '0';
                 setTimeout(() => {
                     document.getElementById('loadingScreen').style.display = 'none';
                 }, 500);
                 return;
            }
            
            const savedUser = localStorage.getItem('jahyu_savedUser');
            if (savedUser) {
                 currentUser = JSON.parse(savedUser);
                 checkLogin(true);
                 // ë¡œë”© í™”ë©´ ìˆ¨ê¸°ê¸°
                 document.getElementById('loadingScreen').style.opacity = '0';
                 setTimeout(() => {
                     document.getElementById('loadingScreen').style.display = 'none';
                 }, 500);
                 return;
            }

            // ë¡œë”© í™”ë©´ì„ ìˆ¨ê¸´ í›„ ë¡œê·¸ì¸ ì²´í¬ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
            setTimeout(() => {
                const loadingScreen = document.getElementById('loadingScreen');
                if (loadingScreen) {
                    loadingScreen.style.opacity = '0';
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                        // ë¡œë”© ìŠ¤í¬ë¦°ì´ ì‚¬ë¼ì§„ í›„ ë¡œê·¸ì¸ ì²´í¬/ëª¨ë‹¬ í‘œì‹œ
                        checkLogin(); 
                    }, 500);
                } else {
                    // ì˜ˆì™¸ ì²˜ë¦¬: ë¡œë”© ìŠ¤í¬ë¦°ì´ ì—†ëŠ” ê²½ìš° ë°”ë¡œ ë¡œê·¸ì¸ ì²´í¬
                    checkLogin(); 
                }
            }, 800);
        });

        function checkLogin(isLoggedIn = false) {
            const saved = localStorage.getItem('jahyu_currentUser');
            if (isLoggedIn || saved) { // savedê°€ ìˆê±°ë‚˜ ì´ë¯¸ ë¡œê·¸ì¸ ìƒíƒœë¼ë©´
                if(!currentUser) currentUser = JSON.parse(saved);
                
                // ë¡œê·¸ì¸ ì‹œ í™œë™ ì‹œê°„ ì—…ë°ì´íŠ¸
                updateDuration();

                document.getElementById('appContainer').style.display = 'block';
                renderTab('home');
            } else { // ë¡œê·¸ì¸ ìƒíƒœê°€ ì•„ë‹ˆë¼ë©´ ë¡œê·¸ì¸ ëª¨ë‹¬ í‘œì‹œ
                showLoginModal();
            }
        }
        
        function addStamp(count = 1) {
            if (users[currentUser.id]) {
                users[currentUser.id].stamps += count;
                saveData('users', users);
                return true;
            }
            return false;
        }

        // --- ëª¨ë‹¬ ì œì–´ ---
        function closeModal() { document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('show')); }
        function showLoginModal() { closeModal(); document.getElementById('loginModal').classList.add('show'); document.getElementById('appContainer').style.display = 'none'; }
        function showSignupModal() { closeModal(); document.getElementById('signupModal').classList.add('show'); }
        function showFindPasswordModal() { closeModal(); document.getElementById('findPasswordModal').classList.add('show'); }
        function showChangePasswordModal() { closeModal(); document.getElementById('changePasswordModal').classList.add('show'); }
        
        function openModal(type) {
            // ê´€ë¦¬ì ì™¸ì˜ ì‚¬ìš©ìëŠ” ê´€ë¦¬ì ê¸€ì“°ê¸° ëª¨ë‹¬ì„ ì—´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ì•„ì´ì½˜ ìˆ¨ê¹€ìœ¼ë¡œ 1ì°¨ ë°©ì–´)
            if (type === 'adminWrite' && !currentUser.isAdmin) {
                 return; 
            }
            
            currentMoodTag = null;
            document.getElementById('editPostId').value = '';
            document.getElementById('postTitle').value = '';
            document.getElementById('postContent').value = '';
            document.getElementById('postImage').value = null; // ì‹¤ì œ íŒŒì¼ í•„ë“œ ì´ˆê¸°í™”
            
            document.getElementById('postCategory').style.display = 'none';
            document.getElementById('moodSection').style.display = 'none';
            document.getElementById('postTitle').style.display = 'block';
            document.getElementById('photoAttachment').style.display = 'none';

            if (type === 'mood') {
                if (lastMoodDate === getTodayDate()) {
                    // ë¬´ë“œ ê¸°ë¡ì€ í•˜ë£¨ í•œ ë²ˆë§Œ ê°€ëŠ¥ (ìˆ˜ì •ì€ í—ˆìš©)
                }
                document.getElementById('writeTitle').innerText = 'ì˜¤ëŠ˜ì˜ ë¬´ë“œ ê¸°ë¡';
                document.getElementById('moodSection').style.display = 'block';
                document.getElementById('postTitle').placeholder = 'ì œëª© (ì„ íƒ)';
                document.getElementById('photoAttachment').style.display = 'block';
                renderMoodTags();
            } else if (type === 'adminWrite') {
                document.getElementById('writeTitle').innerText = 'ê´€ë¦¬ì ê¸€ì“°ê¸°';
                document.getElementById('postCategory').style.display = 'block';
                document.getElementById('postTitle').placeholder = 'ì œëª© (í•„ìˆ˜)';
            }
            
            closeModal();
            document.getElementById('writeModal').classList.add('show');
        }

        // --- ë¬´ë“œ íƒœê·¸ ë Œë”ë§ ë° ì„ íƒ ë¡œì§ ---
        function renderMoodTags() {
            const container = document.getElementById('moodTagSelector');
            container.innerHTML = MOOD_TAGS.map(tag => `
                <div class="mood-tag" style="background-color: ${tag.color};" 
                     data-tag="${tag.text}" onclick="selectMoodTag(this)">
                    ${tag.text}
                </div>
            `).join('');
        }

        function selectMoodTag(element) {
            document.querySelectorAll('.mood-tag').forEach(tag => {
                tag.classList.remove('selected');
                tag.style.backgroundColor = MOOD_TAGS.find(t => t.text === tag.dataset.tag).color;
                tag.style.color = 'var(--text-dark)';
            });

            element.classList.add('selected');
            element.style.backgroundColor = 'var(--accent)';
            element.style.color = 'white';
            currentMoodTag = { text: element.dataset.tag, color: element.style.backgroundColor };
        }

        // --- ë¡œê·¸ì¸/íšŒì›ê°€ì…/ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° ---
        function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const saveLogin = document.getElementById('saveLoginInfo').checked;

            if (!users[email] || users[email].password !== password) {
                return alert('ì´ë©”ì¼ ì£¼ì†Œ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
            
            const u = users[email];
            currentUser = { 
                id: email, 
                name: u.nickname, 
                isSuperAdmin: email === SUPER_ADMIN,
                isAdmin: ADMINS.includes(email)
            };

            localStorage.setItem('jahyu_currentUser', JSON.stringify(currentUser));
            
            if (saveLogin) {
                localStorage.setItem('jahyu_savedUser', JSON.stringify(currentUser));
            } else {
                 localStorage.removeItem('jahyu_savedUser');
            }
            
            updateDuration(); // ë¡œê·¸ì¸ ì‹œ í™œë™ ì‹œê°„ ì—…ë°ì´íŠ¸
            closeModal();
            document.getElementById('appContainer').style.display = 'block';
            renderTab('home');
        }

        function handleSignup() {
            const nickname = document.getElementById('signupNickname').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            
            if (!nickname || !email || !password) return alert('ëª¨ë“  í•„ë“œë¥¼ ì±„ì›Œì£¼ì„¸ìš”.');
            if (users[email]) return alert('ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼ ì£¼ì†Œì…ë‹ˆë‹¤.');

            users[email] = { nickname: nickname, password: password, stamps: 0, lastActive: Date.now(), totalDuration: 0 };
            saveData('users', users);
            alert('íšŒì›ê°€ì… ì™„ë£Œ! ì´ì œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
            showLoginModal();
        }
        
        function handleFindPassword() {
            const email = document.getElementById('findPasswordEmail').value;
            if (!users[email]) {
                return alert('âš ï¸ ì…ë ¥í•˜ì‹  ì´ë©”ì¼ ì£¼ì†Œì™€ ì¼ì¹˜í•˜ëŠ” ê³„ì •ì´ ì—†ìŠµë‹ˆë‹¤.');
            }
            
            const tempPassword = Math.random().toString(36).substring(2, 8);
            users[email].password = tempPassword;
            saveData('users', users);

            alert(`âœ… ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ê°€ ${email}ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. (${tempPassword})\n\në°˜ë“œì‹œ ë¡œê·¸ì¸ í›„ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•˜ì„¸ìš”.`);
            showLoginModal();
        }

        function handleChangePassword() {
            const currentPw = document.getElementById('currentPassword').value;
            const newPw = document.getElementById('newPassword').value;
            const confirmPw = document.getElementById('confirmNewPassword').value;

            if (users[currentUser.id].password !== currentPw) {
                return alert('í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
            if (newPw !== confirmPw) {
                return alert('ìƒˆë¡œìš´ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
            if (newPw.length < 4) {
                return alert('ë¹„ë°€ë²ˆí˜¸ëŠ” 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
            }

            users[currentUser.id].password = newPw;
            saveData('users', users);
            
            if (localStorage.getItem('jahyu_savedUser')) {
                 localStorage.setItem('jahyu_savedUser', JSON.stringify(currentUser));
            }
            
            alert('âœ… ë¹„ë°€ë²ˆí˜¸ê°€ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
            closeModal();
        }


        // --- ê¸€ì“°ê¸°/ë¬´ë“œ ë“±ë¡ ---
        function submitPost() {
            const editId = document.getElementById('editPostId').value;
            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;
            const isMood = document.getElementById('moodSection').style.display !== 'none';
            
            if (!content && !isMood) return alert('ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); // ì¼ë°˜ ê²Œì‹œë¬¼ í•„ìˆ˜ ì²´í¬
            if (isMood && !currentMoodTag) return alert('ê¸°ë¶„ íƒœê·¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');

            if (editId) {
                const post = posts.find(p => p.id == editId);
                if (post) { post.title = title; post.content = content; saveData('posts', posts); alert('ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.'); viewPost(post.id); }
            } else {
                if (isMood && lastMoodDate === getTodayDate()) {
                    return alert('âš ï¸ ë¬´ë“œ ê¸°ë¡ì€ í•˜ë£¨ì— í•œ ë²ˆë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.\në‚´ì¼ ë‹¤ì‹œ ì°¾ì•„ì£¼ì„¸ìš”!');
                }

                const newId = Date.now();
                let newPost = {
                    id: newId, content: content, author: currentUser.name, authorId: currentUser.id,
                    date: getTodayDate(), views: 0
                };

                if (isMood) {
                    newPost.type = 'mood';
                    newPost.moodTag = currentMoodTag.text;
                    newPost.tagColor = currentMoodTag.color;
                    newPost.title = title || `${currentMoodTag.text} ë¬´ë“œ`;
                    // ì‹¤ì œ íŒŒì¼ ì„ íƒ ì—¬ë¶€ë§Œ ê¸°ë¡ (íŒŒì¼ ìì²´ëŠ” ì €ì¥ ë¶ˆê°€)
                    newPost.image = document.getElementById('postImage').files.length > 0 ? 'file_selected' : null;
                    
                    addStamp(1);
                    lastMoodDate = getTodayDate();
                    localStorage.setItem('lastMoodDate', lastMoodDate);
                    alert('âœ… ë¬´ë“œ ë“±ë¡ ì™„ë£Œ! ìŠ¤íƒ¬í”„ +1');

                } else {
                    const category = document.getElementById('postCategory').value;
                    
                    // ê´€ë¦¬ìë§Œ ì—ë””í„°í†¡/ë ˆí„° ì‘ì„± ê°€ëŠ¥ (ì•„ì´ì½˜ ìˆ¨ê¹€ìœ¼ë¡œ 1ì°¨ ë°©ì–´, ì—¬ê¸°ì„œ 2ì°¨ ë°©ì–´)
                    if (!currentUser.isAdmin && (category === 'ì—ë””í„°í†¡' || category === 'ìíœ´ë ˆí„°' || category === 'ìíœ´ë©')) {
                         return alert('âš ï¸ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.'); 
                    }
                    
                    if (!title) return alert('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    
                    newPost.type = (category === 'ì—ë””í„°í†¡' || category === 'ìíœ´ë ˆí„°' || category === 'ìíœ´ë©') ? 'talk' : 'letter';
                    newPost.category = category;
                    newPost.title = title;
                    
                    addStamp(1);
                    alert('âœ… ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤! ìŠ¤íƒ¬í”„ +1');
                }
                
                posts.unshift(newPost);
                saveData('posts', posts);
            }
            
            document.getElementById('postTitle').value = '';
            document.getElementById('postContent').value = '';
            document.getElementById('postImage').value = null; // ì´ˆê¸°í™”
            closeModal();
            renderTab(isMood ? 'mood' : 'home');
        }


        // --- ëŒ“ê¸€ ë° ë‹µê¸€ ë“±ë¡ ---
        function submitComment(parentId) {
            const inputId = parentId ? `replyInput_${parentId}` : 'commentInput';
            const input = document.getElementById(inputId);
            const text = input.value;
            if(!text) return;
            
            comments.push({
                id: Date.now(), postId: currentViewingPostId, content: text,
                author: currentUser.name, authorId: currentUser.id, date: getTodayDate(), parentId: parentId
            });
            saveData('comments', comments);
            
            // ëŒ“ê¸€/ë‹µê¸€ ë“±ë¡ ì‹œ ìŠ¤íƒ¬í”„ ì ë¦½ì€ ë¶€ëª¨ ëŒ“ê¸€ ë‹¨ìœ„ë¡œ 1íšŒë§Œ ì¹´ìš´íŠ¸
            if (!parentId) {
                addStamp(1); 
                alert('âœ… ëŒ“ê¸€ ë“±ë¡ ì™„ë£Œ! ìŠ¤íƒ¬í”„ +1');
            }
            
            input.value = '';
            renderComments();
        }

        // --- ëŒ“ê¸€ ë Œë”ë§ (ë‹µê¸€ í¬í•¨) ---
        function renderComments() {
            const list = document.getElementById('commentList');
            // ë¶€ëª¨ ëŒ“ê¸€ë§Œ í•„í„°ë§ (parentIdê°€ nullì¸ ëŒ“ê¸€)
            const parentComments = comments.filter(c => c.postId == currentViewingPostId && c.parentId === null).reverse();
            
            list.innerHTML = parentComments.map(c => {
                const authorNickname = users[c.authorId] ? users[c.authorId].nickname : c.author;
                
                // ë‹µê¸€ í•„í„°ë§
                const replies = comments.filter(r => r.parentId === c.id);
                const replyHtml = replies.map(r => {
                    const replyAuthorNickname = users[r.authorId] ? users[r.authorId].nickname : r.author;
                    return `
                        <div class="reply-item">
                            <div class="comment-meta">
                                <span>${replyAuthorNickname} (${r.date})</span>
                                ${(currentUser.isAdmin || currentUser.id === r.authorId) ? `<span class="comment-del" style="color:#EF4444; cursor:pointer;" onclick="deleteComment(${r.id})">ì‚­ì œ</span>` : ''}
                            </div>
                            <div>${r.content}</div>
                        </div>
                    `;
                }).join('');

                return `
                <div class="comment-item">
                    <div class="comment-meta">
                        <span>${authorNickname} (${c.date})</span>
                        <div style="display:flex; align-items:center;">
                            <span class="reply-btn" onclick="showReplyInput(${c.id})">ë‹µê¸€ ë‹¬ê¸°</span>
                            ${(currentUser.isAdmin || currentUser.id === c.authorId) ? `<span class="comment-del" style="color:#EF4444; cursor:pointer; margin-left: 10px;" onclick="deleteComment(${c.id})">ì‚­ì œ</span>` : ''}
                        </div>
                    </div>
                    <div>${c.content}</div>
                    
                    <div id="replyInputContainer_${c.id}" class="reply-input-group" style="display:none;">
                        <input type="text" id="replyInput_${c.id}" class="input-box" style="margin:0; font-size:11px;" placeholder="${authorNickname}ë‹˜ê»˜ ë‹µê¸€...">
                        <button onclick="submitComment(${c.id})" style="background:var(--accent); color:white; border:none; border-radius:8px; width:40px; font-size:11px;">ë“±ë¡</button>
                    </div>

                    ${replies.length > 0 ? `<div class="reply-section">${replyHtml}</div>` : ''}
                </div>
            `;}).join('');
        }
        
        function showReplyInput(commentId) {
            const container = document.getElementById(`replyInputContainer_${commentId}`);
            if (container) {
                container.style.display = 'flex';
                document.getElementById(`replyInput_${commentId}`).focus();
            }
        }
        
        function deleteComment(commentId) {
            if(confirm('ëŒ“ê¸€ì„ ì‚­ì œí• ê¹Œìš”? ë‹µê¸€ë„ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤.')) {
                // ë¶€ëª¨ ëŒ“ê¸€ ì‚­ì œ ì‹œ í•´ë‹¹ ë‹µê¸€ë„ ëª¨ë‘ ì‚­ì œ
                comments = comments.filter(c => c.id != commentId && c.parentId != commentId);
                saveData('comments', comments);
                renderComments();
            }
        }
        
        // --- ê²Œì‹œë¬¼ ìƒì„¸ ë³´ê¸° (ë¬´ë“œ ì—´ëŒ ê¶Œí•œ ë°˜ì˜) ---
        function viewPost(id) {
            const post = posts.find(p => p.id == id);
            if (!post) return;

            // ë¬´ë“œ ê²Œì‹œë¬¼ ì—´ëŒ ê¶Œí•œ ì²´í¬ (ìš”ì²­ ë°˜ì˜)
            const isMoodPost = post.type === 'mood';
            if (isMoodPost) {
                const canView = currentUser.id === post.authorId || currentUser.isSuperAdmin;
                if (!canView) {
                    return alert('âš ï¸ ì´ ë¬´ë“œ ê¸°ë¡ì€ ë³¸ì¸(ì‘ì„±ì) ë˜ëŠ” ìŠˆí¼ ê´€ë¦¬ì(í–…ì”¨)ë§Œ ì—´ëŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                }
            }

            currentViewingPostId = id;
            document.getElementById('detailCategory').innerText = post.category || 'Mood';
            document.getElementById('detailTitle').innerText = post.title;
            
            const authorNickname = users[post.authorId] ? users[post.authorId].nickname : post.author;
            document.getElementById('detailAuthor').innerText = authorNickname;
            document.getElementById('detailDate').innerText = post.date;
            
            let contentHtml = post.content;
            document.getElementById('detailImage').style.display = 'none';

            if (isMoodPost) {
                // ë¬´ë“œ ê²Œì‹œë¬¼ ìŠ¤íƒ€ì¼ ë° íƒœê·¸ í‘œì‹œ
                contentHtml = `<div style="font-size:14px; text-align:center; padding:15px; border-radius:15px; background: ${post.tagColor || '#eee'}; color: var(--text-dark); margin-bottom: 15px; font-weight: bold;">${post.moodTag}</div>` + contentHtml;
                if (post.image) {
                     // ì‹¤ì œ ì´ë¯¸ì§€ ëŒ€ì‹  placeholder ì‚¬ìš© (í”„ë¡ íŠ¸ì—”ë“œ í•œê³„)
                     document.getElementById('detailImage').src = 'https://via.placeholder.com/400x200?text=Selected+Mood+Image'; 
                     document.getElementById('detailImage').style.display = 'block';
                }
            }
            document.getElementById('detailContent').innerHTML = contentHtml;
            
            const btnGroup = document.getElementById('manageButtons');
            if (currentUser.isAdmin || currentUser.id === post.authorId) {
                btnGroup.style.display = 'flex';
            } else {
                btnGroup.style.display = 'none';
            }
            
            // ì¡°íšŒìˆ˜ ì¦ê°€
            post.views = (post.views || 0) + 1;
            saveData('posts', posts);

            updateInteractionButtons();
            renderComments();
            closeModal(); 
            setTimeout(() => document.getElementById('postDetailModal').classList.add('show'), 50);
        }
        
        function editPost() {
            const post = posts.find(p => p.id == currentViewingPostId);
            if (!post) return;

            // ì¼ë°˜ ê¸€ì“°ê¸° ëª¨ë‹¬ì„ ì‚¬ìš©í•˜ì—¬ ìˆ˜ì •
            openModal('adminWrite'); 
            
            document.getElementById('writeTitle').innerText = 'ê²Œì‹œë¬¼ ìˆ˜ì •';
            document.getElementById('editPostId').value = post.id;
            document.getElementById('postTitle').value = post.title;
            document.getElementById('postContent').value = post.content;
            
            const categorySelect = document.getElementById('postCategory');
            categorySelect.style.display = 'block';
            categorySelect.value = post.category || (post.type === 'mood' ? 'Mood' : 'ìíœ´ë ˆí„°'); 
        }

        function deletePost() {
            if (confirm('ì •ë§ ì´ ê²Œì‹œë¬¼ì„ ì‚­ì œí• ê¹Œìš”?')) {
                posts = posts.filter(p => p.id != currentViewingPostId);
                comments = comments.filter(c => c.postId != currentViewingPostId); // ê´€ë ¨ ëŒ“ê¸€ë„ ì‚­ì œ
                saveData('posts', posts);
                saveData('comments', comments);
                alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                closeModal();
                renderTab('home'); // ì‚­ì œ í›„ í™ˆìœ¼ë¡œ ì´ë™
            }
        }


        function toggleLike() {
            if (myLikes.includes(currentViewingPostId)) {
                myLikes = myLikes.filter(id => id != currentViewingPostId);
            } else {
                myLikes.push(currentViewingPostId);
            }
            saveData('myLikes', myLikes);
            updateInteractionButtons();
        }

        function toggleBookmark() {
            if (myBookmarks.includes(currentViewingPostId)) {
                myBookmarks = myBookmarks.filter(id => id != currentViewingPostId);
            } else {
                myBookmarks.push(currentViewingPostId);
            }
            saveData('myBookmarks', myBookmarks);
            updateInteractionButtons();
        }

        function updateInteractionButtons() {
            const btnLike = document.getElementById('btnLike');
            const btnBookmark = document.getElementById('btnBookmark');
            const likeCount = document.getElementById('likeCount');

            if (myLikes.includes(currentViewingPostId)) {
                btnLike.classList.add('active-like');
                btnLike.style.color = '#EF4444';
                likeCount.innerText = '1';
            } else {
                btnLike.classList.remove('active-like');
                btnLike.style.color = '#6B7280';
                likeCount.innerText = '0';
            }

            if (myBookmarks.includes(currentViewingPostId)) {
                btnBookmark.classList.add('active-bookmark');
                btnBookmark.style.color = '#F59E0B';
                btnBookmark.innerHTML = '<i class="fas fa-bookmark"></i> ì €ì¥ë¨';
            } else {
                btnBookmark.classList.remove('active-bookmark');
                btnBookmark.style.color = '#6B7280';
                btnBookmark.innerHTML = '<i class="fas fa-bookmark"></i> ë¶ë§ˆí¬';
            }
        }


        // --- íƒ­ ë Œë”ë§ ---
        function renderTab(tab) {
            if (!currentUser) return showLoginModal();

            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById(`nav-${tab}`).classList.add('active');

            const writeIcon = document.getElementById('writeIcon');
            // 'mood' íƒ­ì—ì„œëŠ” í•­ìƒ ê¸€ì“°ê¸° ì•„ì´ì½˜ ë…¸ì¶œ
            if (tab === 'mood') {
                 writeIcon.style.display = 'flex';
            // 'home', 'letter', 'editorTalk' íƒ­ì—ì„œëŠ” ê´€ë¦¬ìì—ê²Œë§Œ ì•„ì´ì½˜ ë…¸ì¶œ (ìˆ˜ì • ë°˜ì˜)
            } else if (tab === 'home' || tab === 'letter' || tab === 'editorTalk') {
                 writeIcon.style.display = currentUser.isAdmin ? 'flex' : 'none';
            } else {
                 writeIcon.style.display = 'none';
            }

            const container = document.getElementById('appContainer');
            container.innerHTML = '';
            window.scrollTo(0,0);
            
            updateDuration(); // íƒ­ ì „í™˜ ì‹œ í™œë™ ì‹œê°„ ì—…ë°ì´íŠ¸

            if (tab === 'home') {
                // í™ˆ í™”ë©´ ë¬¸êµ¬ ìˆ˜ì • (ìš”ì²­ ë°˜ì˜)
                const greeting = `${currentUser.name}ë‹˜ ë°˜ê°€ì›Œìš”!`;
                
                container.innerHTML = `
                    <div class="header-section">
                        <div class="header-title">${greeting}</div>
                        <div class="header-sub">ì˜¤ëŠ˜ì€ ë” í–‰ë³µí•˜ì„¸ìš”!</div>
                    </div>
                    <div class="content-card" style="text-align:center;">
                        <h3 style="margin-bottom: 15px;">ì˜¤ëŠ˜ì€ ì–´ë–¤ íœ´ì‹ì´ í•„ìš”í•˜ì„¸ìš”?</h3>
                        <div style="display:flex; justify-content:center; gap:10px;">
                            <button class="btn-primary" style="flex:1; margin:0; background:var(--info-light); color:var(--text-dark);" onclick="renderTab('letter', 'ìíœ´ë ˆí„°')">ìíœ´ë ˆí„°</button>
                            <button class="btn-primary" style="flex:1; margin:0; background:var(--success-light); color:var(--text-dark);" onclick="renderTab('letter', 'ìíœ´ë©')">ìíœ´ë©</button>
                        </div>
                        <p style="font-size:11px; color:#999; margin-top:10px;">ìíœ´ë ˆí„°ì™€ ìíœ´ë©ì„ ì£¼ì œë³„ë¡œ í•œ ëˆˆì—!</p>
                    </div>
                    <div style="padding:0 20px;">
                        <h4 style="margin:15px 0;">ìµœê·¼ ê²Œì‹œê¸€</h4>
                        ${getPostListHTML(posts.filter(p => p.type !== 'mood').slice(0, 3))}
                    </div>
                `;
            } else if (tab === 'letter') {
                const categoryFilter = arguments[1] || 'all'; 
                const filteredPosts = posts.filter(p => p.category === 'ìíœ´ë ˆí„°' || p.category === 'ìíœ´ë©').filter(p => categoryFilter === 'all' || p.category === categoryFilter);

                container.innerHTML = `
                    <div class="header-section">
                        <div class="header-title">ì˜¤ëŠ˜ì˜ ë‚˜ë¥¼ ìœ„í•œ ìœ„ë¡œ!</div>
                        <div class="header-sub">ìíœ´ë ˆí„°ì™€ ìíœ´ë©ì„ ì£¼ì œë³„ë¡œ ë³¼ ìˆ˜ ìˆì–´ìš”</div>
                    </div>
                    
                    <div class="mypage-tabs">
                        <div class="mypage-tab ${categoryFilter === 'all' ? 'active' : ''}" onclick="renderTab('letter', 'all')">ì „ì²´</div>
                        <div class="mypage-tab ${categoryFilter === 'ìíœ´ë ˆí„°' ? 'active' : ''}" onclick="renderTab('letter', 'ìíœ´ë ˆí„°')">ìíœ´ë ˆí„°</div>
                        <div class="mypage-tab ${categoryFilter === 'ìíœ´ë©' ? 'active' : ''}" onclick="renderTab('letter', 'ìíœ´ë©')">ìíœ´ë©</div>
                    </div>

                    <div style="padding:0 20px;">${getPostListHTML(filteredPosts)}</div>
                `;
            } else if (tab === 'mood') {
                const moods = posts.filter(p => p.type === 'mood' && p.authorId === currentUser.id);
                const isTodayMood = lastMoodDate === getTodayDate();
                
                container.innerHTML = `
                    <div class="header-section">
                        <div class="header-title">ë¬´ë“œ íŠ¸ë˜ì»¤</div>
                        <div class="header-sub">ë¬´ë“œë¥¼ ê¸°ë¡í•˜ë©´ ìŠ¤íƒ¬í”„ê°€ ì ë¦½ë©ë‹ˆë‹¤! (1ì¼ 1íšŒ)</div>
                        <div class="header-sub" style="font-weight: bold;">í–…ì‚ë‹˜ë§Œì˜ ê³µê°„ì— ì†”ì§í•œ ê°ì •ì„ ê¸°ë¡í•´ ë³´ì„¸ìš” :)</div>
                    </div>
                    <div class="content-card" style="text-align:center;">
                        <button class="btn-primary" onclick="openModal('mood')" 
                                style="margin:0; background:${isTodayMood ? '#9CA3AF' : 'var(--primary)'}">
                            ${isTodayMood ? 'ì˜¤ëŠ˜ì˜ ê¸°ë¡ ì™„ë£Œ (ìˆ˜ì • ê°€ëŠ¥)' : 'ì˜¤ëŠ˜ì˜ ê¸°ë¶„ ê¸°ë¡í•˜ê¸°'}
                        </button>
                    </div>
                    <div style="padding:0 20px;">
                        <h4 style="margin:15px 0;">ë‚˜ì˜ ê¸°ë¡</h4>
                        ${getPostListHTML(moods)}
                    </div>
                `;
            } else if (tab === 'editorTalk') {
                const authorFilter = arguments[1] || 'all'; 
                const talks = posts.filter(p => p.category === 'ì—ë””í„°í†¡');
                const filteredTalks = authorFilter === 'all' 
                    ? talks
                    : talks.filter(p => p.author === authorFilter);

                container.innerHTML = `
                    <div class="header-section">
                        <div class="header-title">ì—ë””í„°í†¡</div>
                        <div class="header-sub">ì—ë””í„°ë“¤ê³¼ ë” ê°€ê¹Œì´ì—ì„œ ì†Œí†µí•´ìš”!</div>
                    </div>
                    
                    <div class="editor-filter-tabs">
                        <div class="editor-tab ${authorFilter === 'all' ? 'active' : ''}" onclick="renderTab('editorTalk', 'all')">ì „ì²´</div>
                        ${Object.values(EDITORS).map(name => `
                            <div class="editor-tab ${authorFilter === name ? 'active' : ''}" style="background:${authorFilter === name ? 'var(--accent)' : 'white'}; color:${authorFilter === name ? 'white' : '#6B7280'};" onclick="renderTab('editorTalk', '${name}')">${name}</div>
                        `).join('')}
                    </div>

                    <div style="padding:0 20px;">${getPostListHTML(filteredTalks)}</div>
                `;
            } else if (tab === 'mypage') {
                renderMyPage(container);
            }
        }
        
        // --- ë§ˆì´í˜ì´ì§€ ---
        function renderMyPage(container) {
            const user = users[currentUser.id];
            const currentStamps = user ? user.stamps : 0;
            
            container.innerHTML = `
                <div class="header-section">
                    <div class="header-title">ë§ˆì´í˜ì´ì§€</div>
                    <div class="header-sub">${currentUser.name}ë‹˜ (${currentUser.id})</div>
                    ${currentUser.isSuperAdmin ? '<span style="background:#4338CA; color:white; padding:2px 8px; border-radius:10px; font-size:10px; margin-top:5px;">ìŠˆí¼ ê´€ë¦¬ì</span>' : (currentUser.isAdmin ? '<span style="background:#E0E7FF; color:#4338CA; padding:2px 8px; border-radius:10px; font-size:10px; margin-top:5px;">ê´€ë¦¬ì</span>' : '')}
                </div>
                
                ${currentUser.isSuperAdmin ? `
                    <div class="content-card" onclick="renderAdminDashboard()">
                        <h3 style="color:var(--primary-dark);">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h3>
                        <p style="font-size:12px; color:#666; margin-top:5px;">ëª¨ë“  ì‚¬ìš©ì ê¸°ë¡ ë° í†µê³„ ë¶„ì„</p>
                    </div>
                ` : ''}

                <div class="content-card" style="cursor:default;">
                    <h3 style="font-size:16px; margin-bottom:10px;">ìíœ´ ìŠ¤íƒ¬í”„: ${currentStamps} / 30ê°œ</h3>
                    <div class="stamp-board">
                        ${Array(30).fill(0).map((_, i) => `
                            <div class="stamp-cell ${i < currentStamps ? 'stamped' : ''}">
                                <i class="fas fa-hand-peace"></i>
                            </div>
                        `).join('')}
                    </div>
                    <p style="font-size:12px; color:var(--text-dark); margin-top:15px; font-weight:bold;">
                        ìŠ¤íƒ¬í”„ë¥¼ 30ê°œ ëª¨ìœ¼ë©´ ì–´ëŠ ë‚  ìŠ¤í˜ì…œ ë ˆí„°ê°€ ë„ì°©!
                    </p>
                    <p style="font-size:11px; color:#666; margin-top:5px;">
                        ìíœ´ë ˆí„° ì¹´í†¡ ì±„ë„ë¡œ ì¸ì¦ì‚¬ì§„ì„ ë³´ë‚´ì£¼ì„¸ìš”!
                    </p>
                </div>
                
                <div class="mypage-tabs">
                    <div class="mypage-tab active" onclick="switchMyTab(this, 'posts')">ë‚´ê°€ ì“´ ê¸€</div>
                    <div class="mypage-tab" onclick="switchMyTab(this, 'comments')">ë‚´ê°€ ì“´ ëŒ“ê¸€</div>
                    <div class="mypage-tab" onclick="switchMyTab(this, 'likes')">ì¢‹ì•„ìš”</div>
                    <div class="mypage-tab" onclick="switchMyTab(this, 'bookmarks')">ë¶ë§ˆí¬</div>
                </div>

                <div id="mypageContent" style="padding: 0 20px;"></div>
                <div style="padding: 20px;">
                    <button onclick="showChangePasswordModal()" style="width:100%; padding:10px; border:1px solid #ddd; background:white; border-radius:10px; margin-bottom:10px;">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
                    <button onclick="localStorage.clear(); location.reload();" style="width:100%; padding:10px; border:1px solid #ddd; background:white; border-radius:10px; color:#EF4444;">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            `;
            loadMyContent('posts');
        }
        
        function switchMyTab(element, type) {
            document.querySelectorAll('.mypage-tab').forEach(el => el.classList.remove('active'));
            element.classList.add('active');
            loadMyContent(type);
        }
        
        function loadMyContent(type) {
             const area = document.getElementById('mypageContent');
            let content = '';

            if (type === 'posts') {
                const myPosts = posts.filter(p => p.authorId === currentUser.id);
                content = myPosts.length ? getPostListHTML(myPosts) : '<p style="text-align:center; color:#999; margin-top:20px;">ì‘ì„±í•œ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            } else if (type === 'comments') {
                // ë¶€ëª¨ ëŒ“ê¸€ë§Œ í•„í„°ë§ (ì¤‘ë³µ ëŒ“ê¸€ ë°©ì§€)
                const myParentComments = comments.filter(c => c.authorId === currentUser.id && c.parentId === null).reverse();
                if (myParentComments.length) {
                    content = myParentComments.map(c => {
                        const originalPost = posts.find(p => p.id == c.postId);
                        const postTitle = originalPost ? originalPost.title : 'ì‚­ì œëœ ê²Œì‹œê¸€';
                        return `
                        <div class="content-card" onclick="${originalPost ? `viewPost(${originalPost.id})` : ''}">
                            <div style="font-size:11px; color:var(--primary); margin-bottom:5px;">${postTitle}</div>
                            <div style="font-size:13px;">${c.content}</div>
                            <div style="font-size:10px; color:#999; margin-top:5px;">${c.date} (ë‹µê¸€ í¬í•¨ ${comments.filter(r => r.parentId === c.id).length}ê°œ)</div>
                        </div>`;
                    }).join('');
                } else {
                    content = '<p style="text-align:center; color:#999; margin-top:20px;">ì‘ì„±í•œ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
            } else if (type === 'likes') {
                const likedPosts = posts.filter(p => myLikes.includes(p.id));
                content = likedPosts.length ? getPostListHTML(likedPosts) : '<p style="text-align:center; color:#999; margin-top:20px;">ì¢‹ì•„ìš”í•œ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            } else if (type === 'bookmarks') {
                const bookmarkedPosts = posts.filter(p => myBookmarks.includes(p.id));
                content = bookmarkedPosts.length ? getPostListHTML(bookmarkedPosts) : '<p style="text-align:center; color:#999; margin-top:20px;">ë¶ë§ˆí¬í•œ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
            area.innerHTML = content;
        }

        // --- ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ---
        function renderAdminDashboard() {
            if (!currentUser.isSuperAdmin) return;
            
            const container = document.getElementById('appContainer');
            container.innerHTML = `
                <div class="header-section">
                    <div class="header-title" style="color:#4338CA;">ìŠˆí¼ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</div>
                    <div class="header-sub">ì „ì²´ ì„œë¹„ìŠ¤ í†µê³„ ë° ì‚¬ìš©ì ê¸°ë¡ ì¡°íšŒ</div>
                </div>
                
                <div class="mypage-tabs" style="justify-content:center;">
                    <div id="dashTabUsers" class="mypage-tab active" onclick="switchDashTab('users')">ì‚¬ìš©ìë³„ ê¸°ë¡</div>
                    <div id="dashTabStats" class="mypage-tab" onclick="switchDashTab('stats')">í†µê³„ ë¶„ì„</div>
                </div>

                <div id="dashboardContent" style="padding: 0 20px;"></div>
                <div style="padding: 20px;">
                    <button onclick="renderTab('mypage')" style="width:100%; padding:10px; border:1px solid #ddd; background:white; border-radius:10px;">ë§ˆì´í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</button>
                </div>
            `;
            loadDashboardContent('users');
        }
        
        function switchDashTab(tab) {
            document.getElementById('dashTabUsers').classList.remove('active');
            document.getElementById('dashTabStats').classList.remove('active');
            document.getElementById(`dashTab${tab.charAt(0).toUpperCase() + tab.slice(1)}`).classList.add('active');
            loadDashboardContent(tab);
        }

        function loadDashboardContent(tab) {
            const contentArea = document.getElementById('dashboardContent');

            if (tab === 'users') {
                let userListHtml = '';
                
                Object.keys(users).forEach(email => {
                    const user = users[email];
                    const userPosts = posts.filter(p => p.authorId === email);
                    const userComments = comments.filter(c => c.authorId === email);
                    const lastActiveTime = new Date(user.lastActive).toLocaleTimeString('ko-KR');
                    const totalDurationMinutes = Math.floor((user.totalDuration || 0) / 60);

                    userListHtml += `
                        <div class="content-card" style="cursor:default; margin-bottom:10px;">
                            <h4 style="font-size:14px; color:var(--primary);">${user.nickname} (${email})</h4>
                            <p style="font-size:12px; margin-top:5px;">
                                ğŸ“ ê¸€ ì‘ì„±: ${userPosts.length}ê°œ | ğŸ’¬ ëŒ“ê¸€ ì‘ì„±: ${userComments.length}ê°œ | ğŸ’œ ìŠ¤íƒ¬í”„: ${user.stamps}ê°œ
                            </p>
                            <p style="font-size:10px; color:#999;">
                                ìµœì¢… í™œë™: ${lastActiveTime} | ëˆ„ì  ì²´ë¥˜ì‹œê°„: ${totalDurationMinutes}ë¶„ (ì‹¤ì œ ì—…ë°ì´íŠ¸)
                            </p>
                        </div>
                    `;
                });
                contentArea.innerHTML = userListHtml;

            } else if (tab === 'stats') {
                const totalPosts = posts.length;
                const totalComments = comments.length;
                
                // --- ìˆœìœ„ ê³„ì‚° ë¡œì§ (ìš”ì²­ ë°˜ì˜) ---
                
                // 1. ê²Œì‹œë¬¼ ìˆœìœ„ (ê´€ë¦¬ìë§Œ)
                const adminPostCounts = ADMINS.map(id => ({ 
                    nickname: users[id]?.nickname || id, 
                    count: posts.filter(p => p.authorId === id).length 
                })).sort((a, b) => b.count - a.count).slice(0, 3);
                
                // 2. ëŒ“ê¸€ ìˆœìœ„ (ì „ì²´ ì‚¬ìš©ì)
                const userCommentCounts = Object.keys(users).map(id => ({
                    nickname: users[id].nickname,
                    count: comments.filter(c => c.authorId === id).length
                })).sort((a, b) => b.count - a.count).slice(0, 3);
                
                // 3. ìŠ¤íƒ¬í”„ ìˆœìœ„ (ì „ì²´ ì‚¬ìš©ì)
                const userStampCounts = Object.keys(users).map(id => ({
                    nickname: users[id].nickname,
                    count: users[id].stamps
                })).sort((a, b) => b.count - a.count).slice(0, 3);
                
                const formatRank = (rankArray) => {
                    return rankArray.map(item => `${item.nickname}(${item.count}íšŒ)`).join(', ');
                };

                contentArea.innerHTML = `
                    <div class="content-card" style="cursor:default;">
                        <h4 style="font-size:16px; margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:5px;">ì „ì²´ í†µê³„</h4>
                        <p>ì´ ê²Œì‹œë¬¼ ìˆ˜: ${totalPosts}ê°œ</p>
                        <p>ì´ ëŒ“ê¸€ ìˆ˜: ${totalComments}ê°œ</p>
                        <p style="margin-bottom:15px;">í‰ê·  ìŠ¤íƒ¬í”„: ${Math.round(Object.values(users).reduce((sum, u) => sum + u.stamps, 0) / Object.keys(users).length)}ê°œ</p>

                        <h5 style="margin-top:10px; font-weight:bold;">ê²Œì‹œë¬¼ ìˆœìœ„ (ê´€ë¦¬ì)</h5>
                        <p style="font-size:13px;">${formatRank(adminPostCounts)}</p>

                        <h5 style="margin-top:10px; font-weight:bold;">ëŒ“ê¸€ ìˆœìœ„ (ì „ì²´)</h5>
                        <p style="font-size:13px;">${formatRank(userCommentCounts)}</p>

                        <h5 style="margin-top:10px; font-weight:bold;">ìŠ¤íƒ¬í”„ ìˆœìœ„ (ì „ì²´)</h5>
                        <p style="font-size:13px;">${formatRank(userStampCounts)}</p>
                    </div>
                    
                    <div class="content-card" style="cursor:default;">
                        <h4 style="font-size:16px; margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:5px;">ì¸ê¸° ê¸€ ìˆœìœ„ (ì¡°íšŒìˆ˜ ê¸°ì¤€)</h4>
                        <ol style="font-size:13px; padding-left:20px; color:#444;">
                            ${posts.sort((a, b) => b.views - a.views).slice(0, 3).map(p => `
                                <li>${p.title} (ì¡°íšŒìˆ˜: ${p.views}íšŒ)</li>
                            `).join('')}
                        </ol>
                    </div>
                 `;
            }
        }
        
        // ê³µí†µ ë¦¬ìŠ¤íŠ¸ HTML ìƒì„±ê¸°
        function getPostListHTML(list) {
            return list.map(p => {
                const isMood = p.type === 'mood';
                return `
                <div class="content-card" onclick="viewPost(${p.id})">
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                        <span style="font-size:10px; color:var(--primary); font-weight:bold;">${p.category || 'Mood'}</span>
                        <span style="font-size:10px; color:#999;">${p.date}</span>
                    </div>
                    <div style="display:flex; align-items:center;">
                        ${isMood ? `<div style="font-size:12px; margin-right:10px; padding: 4px 8px; border-radius: 12px; background: ${p.tagColor || '#eee'}; color: var(--text-dark);">${p.moodTag}</div>` : ''}
                        <div>
                            <h4 style="font-size:15px; margin:0 0 5px 0;">${p.title}</h4>
                            <p style="font-size:12px; color:#666; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; max-width:250px;">
                                ${p.content.substring(0, 30)}${p.content.length > 30 ? '...' : ''}
                            </p>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }
    </script>
</body>
</html>
