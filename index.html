<!DOCTYPE html>  
<html lang="ko">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">  
    <title>ìíœ´ë ˆí„° - í–…ì‚ë‹˜ì„ ìœ„í•œ íŠ¹ë³„í•œ ê³µê°„!</title>  
      
    <meta property="og:title" content="ìíœ´ë ˆí„°ë¥¼ ì•±ìœ¼ë¡œ ë§Œë‚˜ë³´ì„¸ìš”!">  
    <meta property="og:description" content=" ë¬´ë“œíŠ¸ë˜ì»¤ë„ ê¸°ë¡í•´ë³´ì„¸ìš”!">  
    <meta property="og:image" content="https://i.imgur.com/exampleImage.png">   
    <meta property="og:url" content="https://assets.carat-api.im/files/2907633/97cb17f3-d538-4c40-9705-3f9e517a4d5a/jahyu_letter_app_fixed.html">  
    <meta property="og:type" content="website">  
      
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Round+Gothic:wght@400;700;800&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">  
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">  
      
    <!-- Firebase SDK -->  
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>  
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>  
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>  
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-analytics-compat.js"></script>  
      
    <style>  
        :root {  
            --primary: #6B46C1;  
            --primary-soft: #F3E8FF;  
            --accent: #FF6B9D;  
            --accent-soft: #FFE4EC;  
            --secondary: #4ECDC4;  
            --secondary-soft: #E6FFF9;  
            --text-main: #2D3748;  
            --text-sub: #718096;  
            --bg-body: #F8F9FA;  
            --white: #FFFFFF;  
            --glass-bg: rgba(255, 255, 255, 0.85);  
            --glass-border: rgba(255, 255, 255, 0.2);  
            --shadow-card: 0 8px 32px rgba(107, 70, 193, 0.12);  
            --shadow-glass: 0 8px 32px rgba(31, 38, 135, 0.15);  
        }  
  
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Nanum Round Gothic', 'Noto Sans KR', sans-serif; -webkit-tap-highlight-color: transparent; }  
          
        body {  
            background: linear-gradient(135deg, #F8F9FA 0%, #E6FFF9 100%);  
            color: var(--text-main);  
            min-height: 100vh;  
            overflow-x: hidden;  
            display: flex; flex-direction: column; align-items: center;  
            position: relative;  
        }  
  
        body::before {  
            content: '';  
            position: fixed;  
            top: 0;  
            left: 0;  
            width: 100%;  
            height: 100%;  
            background-image:   
                radial-gradient(circle at 20% 80%, var(--primary-soft) 0%, transparent 50%),  
                radial-gradient(circle at 80% 20%, var(--accent-soft) 0%, transparent 50%),  
                radial-gradient(circle at 40% 40%, var(--secondary-soft) 0%, transparent 50%);  
            z-index: -1;  
            opacity: 0.6;  
        }  
  
        .app-container {  
            width: 100%; max-width: 480px; min-height: 100vh;  
            background: var(--glass-bg);  
            backdrop-filter: blur(10px);  
            border-radius: 30px 30px 0 0;  
            margin-top: 20px;  
            box-shadow: var(--shadow-glass);  
            border: 1px solid var(--glass-border);  
            padding-bottom: 90px;  
            position: relative;  
        }  
  
        .header-section {  
            padding: 40px 25px 20px;  
            text-align: center;  
            background: linear-gradient(180deg, rgba(255,255,255,0.9) 0%, rgba(248,249,250,0.8) 100%);  
            border-radius: 30px 30px 0 0;  
        }  
        .header-title {  
            font-size: 24px; font-weight: 800; color: var(--primary);  
            margin-bottom: 8px; letter-spacing: -0.5px;  
            text-shadow: 0 2px 4px rgba(107, 70, 193, 0.1);  
        }  
        .header-sub {  
            font-size: 14px; color: var(--text-sub); font-weight: 500;  
        }  
  
        .tab-nav {  
            display: flex; justify-content: space-around;  
            background: var(--white); padding: 15px 10px;  
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);  
            position: sticky; top: 0; z-index: 100;  
        }  
        .tab-btn {  
            flex: 1; text-align: center; padding: 8px; font-size: 14px;  
            font-weight: 700; border: none; background: none; cursor: pointer;  
            color: var(--text-sub); transition: all 0.3s ease; border-radius: 8px;  
        }  
        .tab-btn.active { color: var(--primary); background: var(--primary-soft); }  
        .tab-btn i { font-size: 16px; margin-right: 4px; }  
        .content-area { padding: 20px; min-height: 400px; }  
  
        /* ëª¨ë‹¬ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */  
        .modal-overlay {  
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;  
            background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(4px);  
            display: flex; justify-content: center; align-items: center;  
            z-index: 1000; opacity: 0; visibility: hidden;  
            transition: all 0.3s ease;  
        }  
        .modal-overlay.show { opacity: 1; visibility: visible; }  
        .modal-card {  
            background: var(--white); padding: 24px;  
            border-radius: 16px; width: 90%; max-width: 400px;  
            max-height: 90vh; overflow-y: auto;  
            box-shadow: var(--shadow-card); transform: scale(0.9);   
            transition: all 0.3s ease;  
        }  
        .modal-overlay.show .modal-card { transform: scale(1); }  
        .modal-header {  
            display: flex; justify-content: space-between;  
            align-items: center; margin-bottom: 20px;  
        }  
        .modal-title {  
            font-size: 18px; font-weight: 800; color: var(--primary);  
        }  
        .close-btn {  
            border: none; background: none; font-size: 20px;  
            color: var(--text-sub); cursor: pointer; padding: 4px;  
            transition: color 0.2s;  
        }  
        .close-btn:hover { color: var(--accent); }  
        .form-group {  
            margin-bottom: 16px;  
        }  
        .form-label {  
            display: block; font-size: 13px; font-weight: 700;  
            color: var(--text-main); margin-bottom: 6px;  
        }  
        .form-input {  
            width: 100%; padding: 12px; border: 2px solid #e2e8f0;  
            border-radius: 8px; font-size: 14px; transition: border-color 0.2s;  
        }  
        .form-input:focus {  
            outline: none; border-color: var(--primary);  
        }  
        .form-textarea {  
            width: 100%; padding: 12px; border: 2px solid #e2e8f0;  
            border-radius: 8px; font-size: 14px; resize: vertical;  
            min-height: 100px; font-family: inherit;  
        }  
        .form-textarea:focus {  
            outline: none; border-color: var(--primary);  
        }  
        .btn-primary {  
            width: 100%; padding: 12px; background: var(--primary);  
            color: white; border: none; border-radius: 8px;  
            font-size: 16px; font-weight: 700; cursor: pointer;  
            transition: all 0.2s; margin-top: 8px;  
        }  
        .btn-primary:hover {  
            background: var(--accent); transform: translateY(-2px);  
        }  
        .btn-secondary {  
            width: 100%; padding: 10px; background: transparent;  
            color: var(--primary); border: 2px solid var(--primary);  
            border-radius: 8px; font-size: 14px; font-weight: 700;  
            cursor: pointer; transition: all 0.2s; margin-top: 8px;  
        }  
        .btn-secondary:hover {  
            background: var(--primary); color: white;  
        }  
        .checkbox-group {  
            display: flex; align-items: center; margin-bottom: 16px;  
        }  
        .checkbox-group input {  
            margin-right: 8px; transform: scale(1.2);  
        }  
        .checkbox-group label {  
            font-size: 13px; color: var(--text-sub);  
        }  
        /* ì¹´ë“œ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */  
        .post-card {  
            background: var(--white); padding: 20px;  
            margin-bottom: 16px; border-radius: 12px;  
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);  
            transition: all 0.3s ease; border: 1px solid var(--glass-border);  
        }  
        .post-card:hover {  
            transform: translateY(-2px); box-shadow: var(--shadow-card);  
        }  
        .post-header {  
            display: flex; justify-content: space-between;  
            align-items: center; margin-bottom: 12px;  
        }  
        .post-meta {  
            display: flex; align-items: center; gap: 8px;  
        }  
        .author-badge {  
            padding: 4px 8px; background: var(--primary); color: white;  
            border-radius: 12px; font-size: 11px; font-weight: 700;  
        }  
        .post-date {  
            font-size: 12px; color: var(--text-sub);  
        }  
        .post-title {  
            font-size: 16px; font-weight: 700; color: var(--text-main);  
            margin-bottom: 8px; line-height: 1.4;  
        }  
        .post-content {  
            font-size: 14px; color: var(--text-sub); line-height: 1.6;  
            margin-bottom: 12px;  
        }  
        .post-actions {  
            display: flex; gap: 16px; align-items: center;  
        }  
        .action-btn {  
            background: none; border: none; display: flex; align-items: center;  
            gap: 4px; font-size: 13px; color: var(--text-sub);  
            cursor: pointer; transition: color 0.2s;  
        }  
        .action-btn.active { color: var(--accent); }  
        .action-btn:hover { color: var(--primary); }  
        /* ë¬´ë“œ ê¸°ë¡ ê´€ë ¨ ìŠ¤íƒ€ì¼ */  
        .mood-grid {  
            display: grid; grid-template-columns: repeat(5, 1fr);  
            gap: 8px; margin-bottom: 20px;  
        }  
        .mood-emoji {  
            font-size: 28px; padding: 8px; text-align: center;  
            border-radius: 8px; background: var(--bg-body);  
            cursor: pointer; transition: all 0.2s; border: 2px solid transparent;  
        }  
        .mood-emoji:hover {  
            transform: scale(1.1); background: var(--primary-soft);  
        }  
        .mood-emoji.selected {  
            border-color: var(--primary); background: var(--primary-soft);  
        }  
        /* ëŒ“ê¸€ ìŠ¤íƒ€ì¼ */  
        .comment-section {  
            margin-top: 20px; padding-top: 20px;  
            border-top: 1px solid var(--glass-border);  
        }  
        .comment-form {  
            display: flex; gap: 8px; margin-bottom: 16px;  
        }  
        .comment-input {  
            flex: 1; padding: 8px 12px; border: 2px solid #e2e8f0;  
            border-radius: 20px; font-size: 13px; outline: none;  
        }  
        .comment-input:focus {  
            border-color: var(--primary);  
        }  
        .comment-submit {  
            padding: 8px 16px; background: var(--primary);  
            color: white; border: none; border-radius: 20px;  
            font-size: 13px; cursor: pointer;  
        }  
        .comment-list {  
            list-style: none;  
        }  
        .comment-item {  
            background: var(--bg-body); padding: 12px;  
            border-radius: 8px; margin-bottom: 8px;  
            font-size: 13px; line-height: 1.4;  
        }  
        .comment-header {  
            display: flex; justify-content: space-between;  
            align-items: center; margin-bottom: 4px;  
        }  
        .comment-author {  
            font-weight: 700; color: var(--primary);  
        }  
        .comment-date {  
            font-size: 11px; color: var(--text-sub);  
        }  
        /* í†µê³„ ëŒ€ì‹œë³´ë“œ ìŠ¤íƒ€ì¼ */  
        .stats-grid {  
            display: grid; grid-template-columns: repeat(2, 1fr);  
            gap: 16px; margin-bottom: 20px;  
        }  
        .stat-card {  
            background: var(--white); padding: 16px; border-radius: 12px;  
            text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.08);  
        }  
        .stat-number {  
            font-size: 24px; font-weight: 800; color: var(--primary);  
        }  
        .stat-label {  
            font-size: 12px; color: var(--text-sub); margin-top: 4px;  
        }  
        .activity-list {  
            list-style: none; margin-top: 16px;  
        }  
        .activity-item {  
            background: var(--white); padding: 12px;  
            border-radius: 8px; margin-bottom: 8px;  
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);  
        }  
        .activity-time {  
            font-size: 11px; color: var(--text-sub);  
            margin-bottom: 4px;  
        }  
        .activity-content {  
            font-size: 13px; color: var(--text-main);  
        }  
        /* í† ìŠ¤íŠ¸ ì•Œë¦¼ */  
        .toast {  
            position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%);  
            background: rgba(0, 0, 0, 0.8); color: white;  
            padding: 12px 20px; border-radius: 24px; font-size: 14px;  
            z-index: 2000; animation: slideUp 0.3s ease;  
        }  
        @keyframes slideUp {  
            from { opacity: 0; transform: translateX(-50%) translateY(20px); }  
            to { opacity: 1; transform: translateX(-50%) translateY(0); }  
        }  
        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */  
        .loading {  
            display: flex; justify-content: center; align-items: center;  
            padding: 40px;  
        }  
        .spinner {  
            width: 40px; height: 40px; border: 4px solid var(--primary-soft);  
            border-top: 4px solid var(--primary); border-radius: 50%;  
            animation: spin 1s linear infinite;  
        }  
        @keyframes spin {  
            0% { transform: rotate(0deg); }  
            100% { transform: rotate(360deg); }  
        }  
        /* ì—ëŸ¬ ë©”ì‹œì§€ */  
        .error-message {  
            text-align: center; padding: 40px; color: var(--text-sub);  
        }  
        .error-message i {  
            font-size: 48px; margin-bottom: 16px; color: var(--accent);  
        }  
    </style>  
</head>  
<body>  
  
    <!-- ë¡œê·¸ì¸ ëª¨ë‹¬ -->  
    <div id="loginModal" class="modal-overlay">  
        <div class="modal-card">  
            <div class="modal-header">  
                <h2 class="modal-title">ë¡œê·¸ì¸</h2>  
                <button class="close-btn" onclick="closeModal('loginModal')">&times;</button>  
            </div>  
            <div class="form-group">  
                <label class="form-label">ì´ë©”ì¼</label>  
                <input type="email" id="loginEmail" class="form-input" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">  
            </div>  
            <div class="form-group">  
                <label class="form-label">ë¹„ë°€ë²ˆí˜¸</label>  
                <input type="password" id="loginPassword" class="form-input" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”">  
            </div>  
            <div class="checkbox-group">  
                <input type="checkbox" id="keepLogin">  
                <label for="keepLogin">ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€</label>  
            </div>  
            <button class="btn-primary" onclick="handleLogin()">ë¡œê·¸ì¸</button>  
            <button class="btn-secondary" onclick="showSignupModal()">íšŒì›ê°€ì…</button>  
        </div>  
    </div>  
  
    <!-- íšŒì›ê°€ì… ëª¨ë‹¬ -->  
    <div id="signupModal" class="modal-overlay">  
        <div class="modal-card">  
            <div class="modal-header">  
                <h2 class="modal-title">íšŒì›ê°€ì…</h2>  
                <button class="close-btn" onclick="closeModal('signupModal')">&times;</button>  
            </div>  
            <div class="form-group">  
                <label class="form-label">ë‹‰ë„¤ì„</label>  
                <input type="text" id="signupNickname" class="form-input" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">  
            </div>  
            <div class="form-group">  
                <label class="form-label">ì´ë©”ì¼</label>  
                <input type="email" id="signupEmail" class="form-input" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">  
            </div>  
            <div class="form-group">  
                <label class="form-label">ë¹„ë°€ë²ˆí˜¸</label>  
                <input type="password" id="signupPassword" class="form-input" placeholder="ë¹„ë°€ë²ˆí˜¸ (6ì ì´ìƒ)">  
            </div>  
            <div class="form-group">  
                <label class="form-label">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>  
                <input type="password" id="signupPasswordConfirm" class="form-input" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”">  
            </div>  
            <div class="checkbox-group">  
                <input type="checkbox" id="agreeTerms">  
                <label for="agreeTerms">ì´ìš©ì•½ê´€ì— ë™ì˜í•©ë‹ˆë‹¤</label>  
            </div>  
            <button class="btn-primary" onclick="handleSignup()">íšŒì›ê°€ì…</button>  
            <button class="btn-secondary" onclick="showLoginModal()">ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>  
        </div>  
    </div>  
  
    <!-- ê²Œì‹œê¸€ ì‘ì„± ëª¨ë‹¬ -->  
    <div id="postModal" class="modal-overlay">  
        <div class="modal-card">  
            <div class="modal-header">  
                <h2 class="modal-title" id="postModalTitle">ê¸€ì“°ê¸°</h2>  
                <button class="close-btn" onclick="closeModal('postModal')">&times;</button>  
            </div>  
            <div id="postCategoryGroup" class="form-group">  
                <label class="form-label">ì¹´í…Œê³ ë¦¬</label>  
                <select id="postCategory" class="form-input">  
                    <option value="ìíœ´ë ˆí„°">ìíœ´ë ˆí„°</option>  
                    <option value="ìíœ´ë©">ìíœ´ë©</option>  
                    <option value="ì—ë””í„°í†¡">ì—ë””í„°í†¡</option>  
                </select>  
            </div>  
            <div id="moodSelector" class="form-group" style="display: none;">  
                <label class="form-label">ì˜¤ëŠ˜ì˜ ê°ì •ì€ ì–´ë– ì‹ ê°€ìš”?</label>  
                <div class="mood-grid">  
                    <div class="mood-emoji" onclick="selectMood('ğŸ˜Š')">ğŸ˜Š</div>  
                    <div class="mood-emoji" onclick="selectMood('ğŸ˜¢')">ğŸ˜¢</div>  
                    <div class="mood-emoji" onclick="selectMood('ğŸ˜¡')">ğŸ˜¡</div>  
                    <div class="mood-emoji" onclick="selectMood('ğŸ˜´')">ğŸ˜´</div>  
                    <div class="mood-emoji" onclick="selectMood('ğŸ˜')">ğŸ˜</div>  
                    <div class="mood-emoji" onclick="selectMood('ğŸ˜°')">ğŸ˜°</div>  
                    <div class="mood-emoji" onclick="selectMood('ğŸ¥°')">ğŸ¥°</div>  
                    <div class="mood-emoji" onclick="selectMood('ğŸ˜')">ğŸ˜</div>  
                    <div class="mood-emoji" onclick="selectMood('ğŸ˜­')">ğŸ˜­</div>  
                    <div class="mood-emoji" onclick="selectMood('ğŸ¤—')">ğŸ¤—</div>  
                    <div class="mood-emoji" onclick="selectMood('ğŸ˜Œ')">ğŸ˜Œ</div>  
                    <div class="mood-emoji" onclick="selectMood('ğŸ¥³')">ğŸ¥³</div>  
                    <div class="mood-emoji" onclick="selectMood('ğŸ˜¨')">ğŸ˜¨</div>  
                    <div class="mood-emoji" onclick="selectMood('ğŸ¤”')">ğŸ¤”</div>  
                    <div class="mood-emoji" onclick="selectMood('ğŸ˜‡')">ğŸ˜‡</div>  
                    <div class="mood-emoji" onclick="selectMood('ğŸŒ')">ğŸŒ</div>  
                    <div class="mood-emoji" onclick="selectMood('ğŸŒš')">ğŸŒš</div>  
                    <div class="mood-emoji" onclick="selectMood('âœ¨')">âœ¨</div>  
                    <div class="mood-emoji" onclick="selectMood('ğŸ’•')">ğŸ’•</div>  
                    <div class="mood-emoji" onclick="selectMood('ğŸ”¥')">ğŸ”¥</div>  
                </div>  
            </div>  
            <div class="form-group">  
                <label class="form-label">ì œëª©</label>  
                <input type="text" id="postTitle" class="form-input" placeholder="ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">  
            </div>  
            <div class="form-group">  
                <label class="form-label">ë‚´ìš©</label>  
                <textarea id="postContent" class="form-textarea" placeholder="ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"></textarea>  
            </div>  
            <button class="btn-primary" onclick="submitPost()">ë“±ë¡í•˜ê¸°</button>  
        </div>  
    </div>  
  
    <!-- ë©”ì¸ ì•± ì»¨í…Œì´ë„ˆ -->  
    <main class="app-container" id="appContainer">  
          
        <!-- í—¤ë” -->  
        <header class="header-section">  
            <h1 class="header-title">ìíœ´ë ˆí„°</h1>  
            <p class="header-sub">í–…ì‚ë‹˜ì„ ìœ„í•œ íŠ¹ë³„í•œ ê³µê°„!</p>  
        </header>  
  
        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->  
        <nav class="tab-nav" id="tabNav">  
            <button class="tab-btn active" onclick="renderTab('home')" data-tab="home">  
                <i class="fas fa-home"></i>í™ˆ  
            </button>  
            <button class="tab-btn" onclick="renderTab('letter')" data-tab="letter">  
                <i class="fas fa-envelope"></i>ìíœ´ë ˆí„°  
            </button>  
            <button class="tab-btn" onclick="renderTab('mood')" data-tab="mood">  
                <i class="fas fa-smile"></i>ë¬´ë“œíŠ¸ë˜ì»¤  
            </button>  
            <button class="tab-btn" onclick="renderTab('editorTalk')" data-tab="editorTalk">  
                <i class="fas fa-comments"></i>ì—ë””í„°í†¡  
            </button>  
            <button class="tab-btn" onclick="renderTab('profile')" data-tab="profile">  
                <i class="fas fa-user"></i>ë‚´ ì •ë³´  
            </button>  
        </nav>  
  
        <!-- ì½˜í…ì¸  ì˜ì—­ -->  
        <section class="content-area" id="contentArea">  
            <div class="loading">  
                <div class="spinner"></div>  
            </div>  
        </section>  
  
    </main>  
  
    <script>  
    // --- Firebase ì´ˆê¸°í™” ---  
    const firebaseConfig = {  
        apiKey: "AIzaSyDq2eT8H6tNcsrT8dhZWsEyyMZbpCZIZZQ",  
        authDomain: "jahyu-e24cd.firebaseapp.com",  
        databaseURL: "https://jahyu-e24cd-default-rtdb.firebaseio.com",  
        projectId: "jahyu-e24cd",  
        storageBucket: "jahyu-e24cd.firebasestorage.app",  
        messagingSenderId: "955637836464",  
        appId: "1:955637836464:web:096ed0c28e0070f4fca975",  
        measurementId: "G-CTDZFNYJV7"  
    };  
  
    // Firebase ì´ˆê¸°í™”  
    firebase.initializeApp(firebaseConfig);  
    const db = firebase.firestore();  
    const auth = firebase.auth();  
    const analytics = firebase.analytics();  
  
    // Firebase ì—°ê²° ìƒíƒœ í™•ì¸  
    console.log('Firebase ì—°ê²° ìƒíƒœ:', firebase.app().name);  
  
    // --- Firebase ì—°ë™ í•¨ìˆ˜ ---  
  
    // ë°ì´í„° ì´ˆê¸° ë¶ˆëŸ¬ì˜¤ê¸°  
    async function loadInitialData() {  
        try {  
            console.log('Firebase ë°ì´í„° ë¡œë“œ ì‹œì‘...');  
              
            // ì‚¬ìš©ì ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°  
            const usersSnapshot = await db.collection('users').get();  
            users = usersSnapshot.docs.map(doc => doc.data());  
            console.log('ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ:', users.length, 'ê°œ');  
              
            // ê²Œì‹œê¸€ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°  
            const postsSnapshot = await db.collection('posts').get();  
            posts = postsSnapshot.docs.map(doc => ({ ...doc.data(), id: doc.id }));  
            console.log('ê²Œì‹œê¸€ ë°ì´í„° ë¡œë“œ:', posts.length, 'ê°œ');  
              
            // ì—ë””í„°í†¡ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°  
            const talksSnapshot = await db.collection('editorTalks').get();  
            editorTalks = talksSnapshot.docs.map(doc => ({ ...doc.data(), id: doc.id }));  
            console.log('ì—ë””í„°í†¡ ë°ì´í„° ë¡œë“œ:', editorTalks.length, 'ê°œ');  
              
            // ë¬´ë“œ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°  
            const moodsSnapshot = await db.collection('moodRecords').get();  
            myMoodRecords = moodsSnapshot.docs.map(doc => ({ ...doc.data(), id: doc.id }));  
            console.log('ë¬´ë“œ ê¸°ë¡ ë¡œë“œ:', myMoodRecords.length, 'ê°œ');  
              
            // ëŒ“ê¸€ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°  
            const commentsSnapshot = await db.collectionGroup('replies').get();  
            comments = {};  
            commentsSnapshot.forEach(doc => {  
                const comment = { ...doc.data(), id: doc.id };  
                const postId = comment.postId;  
                if (!comments[postId]) comments[postId] = [];  
                comments[postId].push(comment);  
            });  
            console.log('ëŒ“ê¸€ ë°ì´í„° ë¡œë“œ ì™„ë£Œ');  
              
            // ì‚¬ìš©ì ì„ í˜¸ë„ ë¶ˆëŸ¬ì˜¤ê¸°  
            const preferencesSnapshot = await db.collection('userPreferences').get();  
            preferencesSnapshot.forEach(doc => {  
                const data = doc.data();  
                console.log('ì‚¬ìš©ì ì„ í˜¸ë„ ë°ì´í„°:', data);  
                if (currentUser && data.userId === currentUser.id) {  
                    myLikes = data.likes || [];  
                    bookmarks = data.bookmarks || [];  
                    userStamps = data.stamps || 0;  
                }  
            });  
              
            // í†µí•© ê²Œì‹œê¸€ ëª©ë¡ ì—…ë°ì´íŠ¸  
            allPosts = [...posts, ...editorTalks];  
            console.log('Firebase ë°ì´í„° ë¡œë“œ ì™„ë£Œ');  
        } catch (error) {  
            console.error('Firebase ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);  
            showToast('ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);  
        }  
    }  
  
    // ì‚¬ìš©ì ë°ì´í„° ì €ì¥  
    async function saveUser(userData) {  
        try {  
            console.log('ì‚¬ìš©ì ì €ì¥ ì‹œë„:', userData);  
            const result = await db.collection('users').doc(userData.id).set(userData);  
            console.log('ì‚¬ìš©ì Firebase ì €ì¥ ì™„ë£Œ:', userData.id);  
            return result;  
        } catch (error) {  
            console.error('ì‚¬ìš©ì Firebase ì €ì¥ ì˜¤ë¥˜:', error);  
            throw error;  
        }  
    }  
  
    // ê²Œì‹œê¸€ ì €ì¥  
    async function savePost(postData) {  
        try {  
            console.log('ê²Œì‹œê¸€ ì €ì¥ ì‹œë„:', postData);  
            const docRef = await db.collection('posts').add(postData);  
            console.log('ê²Œì‹œê¸€ Firebase ì €ì¥ ì™„ë£Œ, ID:', docRef.id);  
              
            // ì €ì¥ í™•ì¸  
            const savedDoc = await docRef.get();  
            console.log('ì €ì¥ëœ ê²Œì‹œê¸€ ë°ì´í„°:', savedDoc.data());  
              
            return docRef.id;  
        } catch (error) {  
            console.error('ê²Œì‹œê¸€ Firebase ì €ì¥ ì˜¤ë¥˜:', error);  
            showToast('ê²Œì‹œê¸€ ì €ì¥ ì‹¤íŒ¨: ' + error.message);  
            throw error;  
        }  
    }  
  
    // ì—ë””í„°í†¡ ì €ì¥  
    async function saveEditorTalk(talkData) {  
        try {  
            console.log('ì—ë””í„°í†¡ ì €ì¥ ì‹œë„:', talkData);  
            const docRef = await db.collection('editorTalks').add(talkData);  
            console.log('ì—ë””í„°í†¡ Firebase ì €ì¥ ì™„ë£Œ, ID:', docRef.id);  
              
            // ì €ì¥ í™•ì¸  
            const savedDoc = await docRef.get();  
            console.log('ì €ì¥ëœ ì—ë””í„°í†¡ ë°ì´í„°:', savedDoc.data());  
              
            return docRef.id;  
        } catch (error) {  
            console.error('ì—ë””í„°í†¡ Firebase ì €ì¥ ì˜¤ë¥˜:', error);  
            showToast('ì—ë””í„°í†¡ ì €ì¥ ì‹¤íŒ¨: ' + error.message);  
            throw error;  
        }  
    }  
  
    // ë¬´ë“œ ê¸°ë¡ ì €ì¥  
    async function saveMoodRecord(moodData) {  
        try {  
            console.log('ë¬´ë“œ ê¸°ë¡ ì €ì¥ ì‹œë„:', moodData);  
            const docRef = await db.collection('moodRecords').add(moodData);  
            console.log('ë¬´ë“œ ê¸°ë¡ Firebase ì €ì¥ ì™„ë£Œ, ID:', docRef.id);  
            return docRef.id;  
        } catch (error) {  
            console.error('ë¬´ë“œ ê¸°ë¡ Firebase ì €ì¥ ì˜¤ë¥˜:', error);  
            showToast('ë¬´ë“œ ê¸°ë¡ ì €ì¥ ì‹¤íŒ¨: ' + error.message);  
            throw error;  
        }  
    }  
  
    // í™œë™ ë¡œê·¸ ì €ì¥  
    async function saveActivityLog(logData) {  
        try {  
            console.log('í™œë™ ë¡œê·¸ ì €ì¥ ì‹œë„:', logData);  
            await db.collection('activityLogs').add(logData);  
            console.log('í™œë™ ë¡œê·¸ Firebase ì €ì¥ ì™„ë£Œ');  
        } catch (error) {  
            console.error('í™œë™ ë¡œê·¸ Firebase ì €ì¥ ì˜¤ë¥˜:', error);  
        }  
    }  
  
    // ëŒ“ê¸€ ì €ì¥  
    async function saveComment(postId, commentData) {  
        try {  
            console.log('ëŒ“ê¸€ ì €ì¥ ì‹œë„:', { postId, commentData });  
            await db.collection('comments').doc(postId).collection('replies').add(commentData);  
            console.log('ëŒ“ê¸€ Firebase ì €ì¥ ì™„ë£Œ');  
        } catch (error) {  
            console.error('ëŒ“ê¸€ Firebase ì €ì¥ ì˜¤ë¥˜:', error);  
            showToast('ëŒ“ê¸€ ì €ì¥ ì‹¤íŒ¨: ' + error.message);  
            throw error;  
        }  
    }  
  
    // ì‚¬ìš©ì ì„ í˜¸ë„ ì €ì¥  
    async function saveUserPreferences(userId, preferences) {  
        try {  
            console.log('ì‚¬ìš©ì ì„ í˜¸ë„ ì €ì¥ ì‹œë„:', { userId, preferences });  
            await db.collection('userPreferences').doc(userId).set(preferences);  
            console.log('ì‚¬ìš©ì ì„ í˜¸ë„ Firebase ì €ì¥ ì™„ë£Œ');  
        } catch (error) {  
            console.error('ì‚¬ìš©ì ì„ í˜¸ë„ Firebase ì €ì¥ ì˜¤ë¥˜:', error);  
            showToast('ì„ í˜¸ë„ ì €ì¥ ì‹¤íŒ¨: ' + error.message);  
            throw error;  
        }  
    }  
  
    // --- ìƒìˆ˜ì™€ ë³€ìˆ˜ë“¤ ---  
    const ADMINS = ['happxi@jahyu.com', 'elly@jahyu.com', 'gokal@jahyu.com', 'sunny@jahyu.com', 'yudan@jahyu.com'];  
    const SUPER_ADMIN = 'happxi@jahyu.com';  
      
    let currentUser = null;  
    let currentTab = 'home';  
    let userStamps = 0;  
    let selectedMoodEmoji = null;  
    let todayMoodSubmitted = false;  
    let attachedFile = null;  
  
    let users = [];  
    let posts = [];  
    let editorTalks = [];  
    let allPosts = [];  
    let myMoodRecords = [];  
    let comments = {};  
    let bookmarks = [];  
    let myLikes = [];  
    let activityLogs = [];  
  
    // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---  
    function findUserById(id) { return users.find(u => u.id === id); }  
    function findUserByName(name) { return users.find(u => u.name === name); }  
    function findPostById(postId) { return allPosts.find(p => p.id === postId); }  
      
    function showToast(msg) {  
        const div = document.createElement('div'); div.className = 'toast'; div.innerText = msg;  
        document.body.appendChild(div);  
        setTimeout(() => div.remove(), 3000);  
    }  
  
    function getTimeAgo(dateString) {  
        const now = new Date(); const past = new Date(dateString);  
        const diffMs = now.getTime() - past.getTime();  
        const diffMin = Math.floor(diffMs / (1000 * 60));  
        if (diffMin < 60) return `${diffMin}ë¶„ ì „`;  
        const diffHour = Math.floor(diffMin / 60);  
        if (diffHour < 24) return `${diffHour}ì‹œê°„ ì „`;  
        const diffDay = Math.floor(diffHour / 24);  
        if (diffDay < 7) return `${diffDay}ì¼ ì „`;  
        return new Date(dateString).toLocaleDateString('ko-KR').replace(/\. /g, '.').replace(/\.$/, '');  
    }  
  
    // --- ëª¨ë‹¬ ê´€ë¦¬ í•¨ìˆ˜ ---  
    function showLoginModal() {  
        document.getElementById('loginModal').style.display = 'flex';  
        setTimeout(() => document.getElementById('loginModal').classList.add('show'), 10);  
    }  
    function showSignupModal() {  
        document.getElementById('signupModal').style.display = 'flex';  
        setTimeout(() => document.getElementById('signupModal').classList.add('show'), 10);  
    }  
    function showPostModal() {  
        document.getElementById('postModal').style.display = 'flex';  
        setTimeout(() => document.getElementById('postModal').classList.add('show'), 10);  
    }  
    function showModal(modalId) {  
        document.getElementById(modalId).style.display = 'flex';  
        setTimeout(() => document.getElementById(modalId).classList.add('show'), 10);  
    }  
    function closeModal(modalId) {  
        const modal = document.getElementById(modalId);  
        modal.classList.remove('show');  
        setTimeout(() => modal.style.display = 'none', 300);  
    }  
  
    // --- ì¸ì¦ ê´€ë ¨ í•¨ìˆ˜ ---  
    function checkAutoLogin() {  
        const savedUser = localStorage.getItem('jahyu_user');  
        if (savedUser) {  
            currentUser = JSON.parse(savedUser);  
            console.log('ìë™ ë¡œê·¸ì¸ ì„±ê³µ:', currentUser.name);  
            renderTab('home');  
        } else {  
            console.log('ì €ì¥ëœ ì‚¬ìš©ì ì •ë³´ ì—†ìŒ');  
            renderTab('home');  
        }  
    }  
  
    function logout() {  
        localStorage.removeItem('jahyu_user');  
        currentUser = null;  
        showToast('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');  
        renderTab('home');  
    }  
  
    // --- ë©”ì¸ ë¡œì§ ---  
    async function handleLogin() {  
        const email = document.getElementById('loginEmail').value.trim();  
        const password = document.getElementById('loginPassword').value;  
          
        if (!email || !password) return showToast('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');  
        if (!email.includes('@')) return showToast('ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');  
          
        const user = users.find(u => u.id === email);  
        if (!user) return showToast('ë“±ë¡ë˜ì§€ ì•Šì€ ì´ë©”ì¼ì…ë‹ˆë‹¤. íšŒì›ê°€ì…ì„ í•´ì£¼ì„¸ìš”.');  
        if (user.password !== password) return showToast('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');  
  
        currentUser = {  
            id: user.id, name: user.name, isAdmin: ADMINS.includes(user.id),  
            isSuperAdmin: user.id === SUPER_ADMIN, password: user.password  
        };  
  
        if (document.getElementById('keepLogin').checked) {  
            localStorage.setItem('jahyu_user', JSON.stringify(currentUser));  
        }  
  
        await saveActivityLog({   
            type: 'login',   
            user: currentUser.name,   
            date: new Date().toISOString(),   
            userId: currentUser.id   
        });  
  
        closeModal('loginModal');  
        renderTab('home');  
        showToast(`${currentUser.name}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`);  
    }  
  
    async function handleSignup() {  
        const nickname = document.getElementById('signupNickname').value.trim();  
        const email = document.getElementById('signupEmail').value.trim();  
        const password = document.getElementById('signupPassword').value;  
        const passwordConfirm = document.getElementById('signupPasswordConfirm').value;  
        const agreeTerms = document.getElementById('agreeTerms').checked;  
  
        if (!email || !nickname || !password || !passwordConfirm) return showToast('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');  
        if (!email.includes('@')) return showToast('ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');  
        if (password !== passwordConfirm) return showToast('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');  
        if (password.length < 6) return showToast('ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');  
        if (!agreeTerms) return showToast('ì´ìš©ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”.');  
        if (users.some(u => u.id === email)) return showToast('ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤. ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');  
          
        const newUser = { id: email, name: nickname, password: password };  
        users.push(newUser);  
        await saveUser(newUser);  
  
        currentUser = {  
            id: email, name: nickname, isAdmin: ADMINS.includes(email),  
            isSuperAdmin: email === SUPER_ADMIN, password: password  
        };  
  
        localStorage.setItem('jahyu_user', JSON.stringify(currentUser));  
  
        await saveActivityLog({   
            type: 'signup',   
            user: currentUser.name,   
            date: new Date().toISOString(),   
            userId: currentUser.id   
        });  
  
        closeModal('signupModal');  
        renderTab('home');  
        showToast(`${nickname}ë‹˜, íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!`);  
    }  
  
    // --- ê²Œì‹œê¸€/ë¬´ë“œ ê¸°ë¡ ì²˜ë¦¬ ---  
    function selectMood(emoji) {  
        document.querySelectorAll('.mood-emoji').forEach(el => el.classList.remove('selected'));  
        event.target.classList.add('selected');  
        selectedMoodEmoji = emoji;  
    }  
  
    async function submitPost() {  
        try {  
            const title = document.getElementById('postTitle').value.trim();  
            const content = document.getElementById('postContent').value.trim();  
            const postCategorySelect = document.getElementById('postCategory');  
            const isMoodRecord = document.getElementById('moodSelector').style.display === 'grid';  
              
            if (!currentUser) {  
                showToast('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');  
                return;  
            }  
              
            if (!title || !content) return showToast('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');  
              
            console.log('ê²Œì‹œê¸€ ë“±ë¡ ì‹œì‘:', { title, content, isMoodRecord, category: postCategorySelect?.value });  
              
            if (isMoodRecord) {  
                const today = new Date().toDateString();  
                if (myMoodRecords.some(record => new Date(record.date).toDateString() === today && record.authorId === currentUser.id)) {  
                    showToast('ì˜¤ëŠ˜ì€ ì´ë¯¸ ë¬´ë“œë¥¼ ê¸°ë¡í•˜ì…¨ì–´ìš”!');  
                    closeModal('postModal');  
                    return;  
                }  
                  
                if (!selectedMoodEmoji) return showToast('ê°ì • ì´ëª¨ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');  
  
                const moodRecord = {  
                    emoji: selectedMoodEmoji,  
                    title: title,  
                    content: content,  
                    date: new Date().toISOString(),  
                    author: currentUser.name,  
                    authorId: currentUser.id  
                };  
  
                console.log('ë¬´ë“œ ê¸°ë¡ ì €ì¥ ì‹œë„:', moodRecord);  
                const moodId = await saveMoodRecord(moodRecord);  
                moodRecord.id = moodId;  
                myMoodRecords.push(moodRecord);  
                todayMoodSubmitted = true;  
                if (userStamps < 30) userStamps++;  
  
                await saveUserPreferences(currentUser.id, {  
                    likes: myLikes,  
                    bookmarks: bookmarks,  
                    stamps: userStamps  
                });  
  
                showToast("ë¬´ë“œ ê¸°ë¡ ì™„ë£Œ! ìíœ´ìŠ¤íƒ¬í”„ê°€ ì ë¦½ë˜ì—ˆìŠµë‹ˆë‹¤ âœ¨");  
                renderTab('mood');  
            } else if (currentUser.isAdmin) {  
                const selectedCategory = postCategorySelect.value;  
                const imageUrl = attachedFile ? document.getElementById('imagePreview').src : null;  
                  
                const newPost = {  
                    title: title,  
                    category: selectedCategory,  
                    content: content,  
                    author: currentUser.name,  
                    authorId: currentUser.id,  
                    date: new Date().toISOString(),  
                    likes: 0,  
                    comments: 0,  
                    image: imageUrl  
                };  
  
                console.log('ê²Œì‹œê¸€ ì €ì¥ ì‹œë„:', newPost);  
                  
                if (selectedCategory === 'ìíœ´ë ˆí„°' || selectedCategory === 'ìíœ´ë©') {  
                    const postId = await savePost(newPost);  
                    newPost.id = postId;  
                    posts.unshift(newPost);  
                    showToast(`${selectedCategory}ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!`);  
                    renderTab('letter');  
                } else if (selectedCategory === 'ì—ë””í„°í†¡') {  
                    const talkId = await saveEditorTalk(newPost);  
                    newPost.id = talkId;  
                    editorTalks.unshift(newPost);  
                    showToast("ì—ë””í„°í†¡ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!");  
                    renderTab('editorTalk');  
                }  
                  
                allPosts = [...posts, ...editorTalks];  
  
                await saveActivityLog({   
                    type: 'post',   
                    user: currentUser.name,   
                    date: new Date().toISOString(),   
                    targetId: newPost.id,   
                    userId: currentUser.id   
                });  
            } else {  
                showToast("ê²Œì‹œê¸€ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (ìœ íš¨í•˜ì§€ ì•Šì€ ì ‘ê·¼)");  
            }  
              
            closeModal('postModal');  
        } catch (error) {  
            console.error('submitPost ì „ì²´ ì˜¤ë¥˜:', error);  
            showToast('ê²Œì‹œê¸€ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);  
        }  
    }  
  
    // --- ëŒ“ê¸€ ê´€ë ¨ ---  
    async function submitComment(postId) {  
        const commentInput = document.getElementById('commentInput');  
        const content = commentInput.value.trim();  
  
        if (!content) return showToast('ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');  
          
        const nowIso = new Date().toISOString();  
  
        const newComment = {  
            id: Date.now(),  
            author: currentUser.name,  
            content: content,  
            date: nowIso,  
            authorId: currentUser.id,  
            postId: postId  
        };  
  
        if (!comments[postId]) comments[postId] = [];  
        comments[postId].push(newComment);  
          
        await saveComment(postId, newComment);  
          
        const post = findPostById(postId);  
        post.comments = comments[postId].length;  
          
        await saveActivityLog({   
            type: 'comment',   
            user: currentUser.name,   
            date: nowIso,   
            targetId: postId,   
            userId: currentUser.id,  
            commentId: newComment.id  
        });  
          
        const commentSectionContainer = document.getElementById('commentSection');  
        commentSectionContainer.innerHTML = generateCommentSection(postId);  
        commentInput.value = '';   
        showToast('ëŒ“ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');  
    }  
  
    function generateCommentSection(postId) {  
        const postComments = comments[postId] || [];  
        return `  
            <div class="comment-section">  
                <div class="comment-form">  
                    <input type="text" id="commentInput" class="comment-input" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”..." onkeypress="if(event.key==='Enter') submitComment('${postId}')">  
                    <button class="comment-submit" onclick="submitComment('${postId}')">ë“±ë¡</button>  
                </div>  
                <ul class="comment-list">  
                    ${postComments.map(comment => `  
                        <li class="comment-item">  
                            <div class="comment-header">  
                                <span class="comment-author">${comment.author}</span>  
                                <span class="comment-date">${getTimeAgo(comment.date)}</span>  
                            </div>  
                            <div class="comment-content">${comment.content}</div>  
                        </li>  
                    `).join('')}  
                </ul>  
            </div>  
        `;  
    }  
  
    // --- ìƒí˜¸ì‘ìš© ê´€ë ¨ ---  
    async function toggleLike(postId) {  
        if (!currentUser) return showToast('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');  
          
        const index = myLikes.indexOf(postId);  
        const post = findPostById(postId);  
  
        if (index > -1) {  
            myLikes.splice(index, 1);  
            showToast('ì¢‹ì•„ìš”ë¥¼ ì·¨ì†Œí–ˆì–´ìš”.');  
            post.likes--;  
        } else {  
            myLikes.push(postId);  
            showToast('ì¢‹ì•„ìš”! ğŸ’œ');  
            post.likes++;  
              
            await saveActivityLog({   
                type: 'like',   
                user: currentUser.name,   
                date: new Date().toISOString(),   
                targetId: postId,   
                userId: currentUser.id   
            });  
        }  
  
        await saveUserPreferences(currentUser.id, {  
            likes: myLikes,  
            bookmarks: bookmarks,  
            stamps: userStamps  
        });  
  
        if (currentTab === 'postDetail' || currentTab === 'editorTalkDetail') {  
             document.querySelector(`.action-btn i.fa-heart`).parentElement.classList.toggle('active', myLikes.includes(postId));  
             document.getElementById(`likes-count-${postId}`).textContent = post.likes;  
        } else {  
            renderTab(currentTab);  
        }  
    }  
  
    async function toggleBookmark(postId) {  
        if (!currentUser) return showToast('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');  
  
        const index = bookmarks.indexOf(postId);  
          
        if (index > -1) {  
            bookmarks.splice(index, 1);  
            showToast('ë¶ë§ˆí¬ë¥¼ í•´ì œí–ˆì–´ìš”.');  
        } else {  
            bookmarks.push(postId);  
            showToast('ë¶ë§ˆí¬ ì €ì¥! ğŸ”–');  
        }  
          
        await saveUserPreferences(currentUser.id, {  
            likes: myLikes,  
            bookmarks: bookmarks,  
            stamps: userStamps  
        });  
          
        if (currentTab === 'postDetail' || currentTab === 'editorTalkDetail') {  
            document.querySelector(`.action-btn i.fa-bookmark`).parentElement.classList.toggle('active', bookmarks.includes(postId));  
        }  
    }  
  
    // --- ë Œë”ë§ ê´€ë ¨ ---  
    function generateHomeContent() {  
        if (!currentUser) {  
            return `  
                <div class="post-card">  
                    <h3 style="color: var(--primary); margin-bottom: 16px; text-align: center;">ğŸ‘‹ ìíœ´ë ˆí„°ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</h3>  
                    <p style="text-align: center; color: var(--text-sub); margin-bottom: 20px;">ë¡œê·¸ì¸í•˜ê³  ë‹¤ì–‘í•œ ì½˜í…ì¸ ë¥¼ ì¦ê²¨ë³´ì„¸ìš”.</p>  
                    <button class="btn-primary" onclick="showLoginModal()" style="width: 100%;">ë¡œê·¸ì¸í•˜ê¸°</button>  
                    <button class="btn-secondary" onclick="showSignupModal()" style="width: 100%;">íšŒì›ê°€ì…í•˜ê¸°</button>  
                </div>  
            `;  
        }  
  
        const recentActivities = activityLogs  
            .filter(log => myMoodRecords.some(m => m.authorId === currentUser.id) || log.userId === currentUser.id)  
            .slice(-5);  
  
        const todayMood = myMoodRecords.find(m =>   
            m.authorId === currentUser.id && new Date(m.date).toDateString() === new Date().toDateString()  
        );  
  
        return `  
            <div class="post-card">  
                <h3 style="color: var(--primary); margin-bottom: 16px;">ğŸ‘‹ ${currentUser.name}ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!</h3>  
                <div style="display: flex; justify-content: space-around; margin: 20px 0;">  
                    <div style="text-align: center;">  
                        <div style="font-size: 24px; font-weight: 800; color: var(--primary);">${userStamps}</div>  
                        <div style="font-size: 12px; color: var(--text-sub);">ìíœ´ìŠ¤íƒ¬í”„</div>  
                    </div>  
                    <div style="text-align: center;">  
                        <div style="font-size: 24px; font-weight: 800; color: var(--primary);">${myMoodRecords.length}</div>  
                        <div style="font-size: 12px; color: var(--text-sub);">ë¬´ë“œ ê¸°ë¡</div>  
                    </div>  
                    <div style="text-align: center;">  
                        <div style="font-size: 24px; font-weight: 800; color: var(--primary);">${bookmarks.length}</div>  
                        <div style="font-size: 12px; color: var(--text-sub);">ë¶ë§ˆí¬</div>  
                    </div>  
                </div>  
                  
                ${todayMood ? `  
                    <div style="padding: 12px; background: var(--primary-soft); border-radius: 8px; margin-bottom: 16px;">  
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">  
                            <span style="font-size: 24px;">${todayMood.emoji}</span>  
                            <span style="font-weight: 700;">ì˜¤ëŠ˜ì˜ ë¬´ë“œ</span>  
                        </div>  
                        <div style="font-size: 14px; color: var(--text-sub);">${todayMood.title}</div>  
                    </div>  
                ` : `  
                    <button class="btn-primary" onclick="showMoodRecorder()" style="width: 100%; margin-bottom: 16px;">ì˜¤ëŠ˜ì˜ ë¬´ë“œ ê¸°ë¡í•˜ê¸°</button>  
                `}  
                  
                <button class="btn-secondary" onclick="logout()" style="width: 100%;">ë¡œê·¸ì•„ì›ƒ</button>  
            </div>  
              
            ${recentActivities.length > 0 ? `  
                <div class="post-card">  
                    <h4 style="margin-bottom: 12px;">ìµœê·¼ í™œë™</h4>  
                    <div class="activity-list">  
                        ${recentActivities.map(activity => `  
                            <div class="activity-item">  
                                <div class="activity-time">${getTimeAgo(activity.date)}</div>  
                                <div class="activity-content">  
                                    ${activity.type === 'login' ? 'ë¡œê·¸ì¸í–ˆì–´ìš”' :  
                                      activity.type === 'mood' ? 'ë¬´ë“œë¥¼ ê¸°ë¡í–ˆì–´ìš”' :  
                                      activity.type === 'post' ? 'ê¸€ì„ ì‘ì„±í–ˆì–´ìš”' :  
                                      activity.type === 'comment' ? 'ëŒ“ê¸€ì„ ë‚¨ê²¼ì–´ìš”' :  
                                      activity.type === 'like' ? 'ì¢‹ì•„ìš”ë¥¼ ëˆŒë €ì–´ìš”' :  
                                      activity.type === 'signup' ? 'íšŒì›ê°€ì…í–ˆì–´ìš”' : 'í™œë™í–ˆì–´ìš”'}  
                                </div>  
                            </div>  
                        `).join('')}  
                    </div>  
                </div>  
            ` : ''}  
        `;  
    }  
  
    function generateLetterPosts() {  
        if (!currentUser) {  
            return `<div class="error-message"><i class="fas fa-lock"></i><br>ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</div>`;  
        }  
  
        const letterPosts = posts.filter(p => p.category === 'ìíœ´ë ˆí„°' || p.category === 'ìíœ´ë©');  
          
        if (letterPosts.length === 0) {  
            return `<div class="error-message"><i class="fas fa-envelope-open"></i><br>ì•„ì§ ìíœ´ë ˆí„°ê°€ ì—†ì–´ìš”</div>`;  
        }  
  
        return letterPosts.map(post => `  
            <div class="post-card">  
                <div class="post-header">  
                    <div class="post-meta">  
                        <span class="author-badge">${post.category}</span>  
                        <span class="post-date">${getTimeAgo(post.date)}</span>  
                    </div>  
                </div>  
                <h3 class="post-title">${post.title}</h3>  
                <p class="post-content">${post.content}</p>  
                ${post.image ? `<img src="${post.image}" style="width: 100%; border-radius: 8px; margin: 12px 0;">` : ''}  
                <div class="post-actions">  
                    <button class="action-btn ${myLikes.includes(post.id) ? 'active' : ''}" onclick="viewPost('${post.id}')">  
                        <i class="fas fa-comment"></i> <span>${post.comments || 0}</span>  
                    </button>  
                    <button class="action-btn ${myLikes.includes(post.id) ? 'active' : ''}" onclick="toggleLike('${post.id}')">  
                        <i class="fas fa-heart"></i> <span id="likes-count-${post.id}">${post.likes || 0}</span>  
                    </button>  
                    <button class="action-btn ${bookmarks.includes(post.id) ? 'active' : ''}" onclick="toggleBookmark('${post.id}')">  
                        <i class="fas fa-bookmark"></i> ë¶ë§ˆí¬  
                    </button>  
                </div>  
            </div>  
        `).join('');  
    }  
  
    function generateMoodContent() {  
        if (!currentUser) {  
            return `<div class="error-message"><i class="fas fa-lock"></i><br>ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</div>`;  
        }  
  
        const userMoods = myMoodRecords.filter(m => m.authorId === currentUser.id).reverse();  
          
        const today = new Date().toDateString();  
        const todayMood = userMoods.find(m => new Date(m.date).toDateString() === today);  
          
        return `  
            ${!todayMood ? `  
                <div class="post-card">  
                    <h3 style="color: var(--primary); margin-bottom: 16px;">ì˜¤ëŠ˜ì˜ ê¸°ë¶„ì€ ì–´ë– ì„¸ìš”?</h3>  
                    <button class="btn-primary" onclick="showMoodRecorder()" style="width: 100%;">ë¬´ë“œ ê¸°ë¡í•˜ê¸°</button>  
                </div>  
            ` : ''}  
              
            ${userMoods.map(mood => `  
                <div class="post-card">  
                    <div class="post-header">  
                        <div class="post-meta">  
                            <span style="font-size: 24px;">${mood.emoji}</span>  
                            <span class="post-date">${getTimeAgo(mood.date)}</span>  
                        </div>  
                    </div>  
                    <h3 class="post-title">${mood.title}</h3>  
                    <p class="post-content">${mood.content}</p>  
                </div>  
            `).join('')}  
        `;  
    }  
  
    function generateEditorTalkPosts() {  
        if (!currentUser) {  
            return `<div class="error-message"><i class="fas fa-lock"></i><br>ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</div>`;  
        }  
  
        if (editorTalks.length === 0) {  
            return `<div class="error-message"><i class="fas fa-comments"></i><br>ì•„ì§ ì—ë””í„°í†¡ì´ ì—†ì–´ìš”</div>`;  
        }  
  
        return editorTalks.map(talk => `  
            <div class="post-card">  
                <div class="post-header">  
                    <div class="post-meta">  
                        <span class="author-badge">ì—ë””í„°í†¡</span>  
                        <span class="post-date">${getTimeAgo(talk.date)}</span>  
                    </div>  
                </div>  
                <h3 class="post-title">${talk.title}</h3>  
                <p class="post-content">${talk.content}</p>  
                ${talk.image ? `<img src="${talk.image}" style="width: 100%; border-radius: 8px; margin: 12px 0;">` : ''}  
                <div class="post-actions">  
                    <button class="action-btn ${myLikes.includes(talk.id) ? 'active' : ''}" onclick="viewEditorTalk('${talk.id}')">  
                        <i class="fas fa-comment"></i> <span>${talk.comments || 0}</span>  
                    </button>  
                    <button class="action-btn ${myLikes.includes(talk.id) ? 'active' : ''}" onclick="toggleLike('${talk.id}')">  
                        <i class="fas fa-heart"></i> <span id="likes-count-${talk.id}">${talk.likes || 0}</span>  
                    </button>  
                    <button class="action-btn ${bookmarks.includes(talk.id) ? 'active' : ''}" onclick="toggleBookmark('${talk.id}')">  
                        <i class="fas fa-bookmark"></i> ë¶ë§ˆí¬  
                    </button>  
                </div>  
            </div>  
        `).join('');  
    }  
  
    function generateProfileContent() {  
        if (!currentUser) {  
            return `<div class="error-message"><i class="fas fa-lock"></i><br>ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</div>`;  
        }  
  
        return `  
            <div class="post-card">  
                <h3 style="color: var(--primary); margin-bottom: 16px;">ë‚´ ì •ë³´</h3>  
                <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">  
                    <div style="width: 60px; height: 60px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px;">  
                        ${currentUser.name.charAt(0)}  
                    </div>  
                    <div>  
                        <div style="font-size: 18px; font-weight: 700;">${currentUser.name}</div>  
                        <div style="font-size: 14px; color: var(--text-sub);">${currentUser.id}</div>  
                        ${currentUser.isAdmin ? '<span class="author-badge">ê´€ë¦¬ì</span>' : ''}  
                    </div>  
                </div>  
                  
                <div class="stats-grid">  
                    <div class="stat-card">  
                        <div class="stat-number">${userStamps}</div>  
                        <div class="stat-label">ìíœ´ìŠ¤íƒ¬í”„</div>  
                    </div>  
                    <div class="stat-card">  
                        <div class="stat-number">${myMoodRecords.length}</div>  
                        <div class="stat-label">ë¬´ë“œ ê¸°ë¡</div>  
                    </div>  
                    <div class="stat-card">  
                        <div class="stat-number">${myLikes.length}</div>  
                        <div class="stat-label">ì¢‹ì•„ìš”</div>  
                    </div>  
                    <div class="stat-card">  
                        <div class="stat-number">${bookmarks.length}</div>  
                        <div class="stat-label">ë¶ë§ˆí¬</div>  
                    </div>  
                </div>  
                  
                ${currentUser.isAdmin ? `  
                    <button class="btn-primary" onclick="showPostModal()" style="width: 100%; margin-top: 16px;">ê¸€ì“°ê¸°</button>  
                ` : ''}  
            </div>  
        `;  
    }  
  
    // --- íƒ­ ê´€ë ¨ ---  
    function renderTab(tabName) {  
        currentTab = tabName;  
        document.querySelectorAll('.tab-btn').forEach(btn => {  
            btn.classList.toggle('active', btn.dataset.tab === tabName);  
        });  
  
        let content = '';  
          
        switch(tabName) {  
            case 'home':  
                content = generateHomeContent();  
                break;  
            case 'letter':  
                content = generateLetterPosts();  
                break;  
            case 'mood':  
                content = generateMoodContent();  
                break;  
            case 'editorTalk':  
                content = generateEditorTalkPosts();  
                break;  
            case 'profile':  
                content = generateProfileContent();  
                break;  
        }  
  
        document.getElementById('contentArea').innerHTML = content;  
    }  
  
    // --- íŠ¹ì • ê¸°ëŠ¥ ëª¨ë‹¬ ê´€ë¦¬ ---  
    function showMoodRecorder() {  
        const modal = document.getElementById('postModal');  
        document.getElementById('postModalTitle').textContent = 'ë¬´ë“œ ê¸°ë¡';  
        document.getElementById('postCategoryGroup').style.display = 'none';  
        document.getElementById('moodSelector').style.display = 'block';  
        document.getElementById('postTitle').value = '';  
        document.getElementById('postContent').value = '';  
        selectedMoodEmoji = null;  
        document.querySelectorAll('.mood-emoji').forEach(el => el.classList.remove('selected'));  
        showModal('postModal');  
    }  
  
    // --- í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™” ---  
    document.addEventListener('DOMContentLoaded', async () => {  
        console.log('ì•± ì´ˆê¸°í™” ì‹œì‘...');  
          
        try {  
            // Firebase ì—°ê²° í…ŒìŠ¤íŠ¸  
            const testDoc = await db.collection('test').add({  
                test: 'connection',  
                timestamp: new Date().toISOString()  
            });  
            console.log('Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì„±ê³µ:', testDoc.id);  
            await testDoc.delete();  
            console.log('Firebase ì—°ê²° í…ŒìŠ¤íŠ¸ ì™„ë£Œ');  
              
            // ë°ì´í„° ë¡œë“œ  
            await loadInitialData();  
            console.log('ë°ì´í„° ë¡œë“œ ì™„ë£Œ');  
              
            // ë¡œê·¸ì¸ ì²´í¬  
            checkAutoLogin();  
            console.log('ë¡œê·¸ì¸ ì²´í¬ ì™„ë£Œ');  
              
        } catch (error) {  
            console.error('ì´ˆê¸°í™” ì˜¤ë¥˜:', error);  
            showToast('ì•± ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);  
        }  
    });  
  
    // --- ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸° ---  
    document.addEventListener('click', function(event) {  
        if (event.target.classList.contains('modal-overlay') && event.target.classList.contains('show')) {  
            const modalId = event.target.id;  
            closeModal(modalId);  
        }  
    });  
  
    // --- í¼ ì œì¶œ ë°©ì§€ ---  
    document.addEventListener('keypress', function(event) {  
        if (event.key === 'Enter' && event.target.tagName === 'INPUT') {  
            const form = event.target.closest('.modal-card');  
            if (form && !event.target.classList.contains('comment-input')) {  
                event.preventDefault();  
            }  
        }  
    });  
  
    </script>  
</body>  
</html>  
