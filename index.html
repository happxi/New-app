<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ìíœ´ë ˆí„° - í–…ì‚ë‹˜ì„ ìœ„í•œ íŠ¹ë³„í•œ ê³µê°„!</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Round+Gothic:wght@400;700;800&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* CSS ë³€ìˆ˜ ë° ê¸°ë³¸ ìŠ¤íƒ€ì¼ (ì´ì „ê³¼ ë™ì¼) */
        :root {
            --primary: #8B5CF6; --primary-light: #A78BFA; --primary-dark: #7C3AED; --accent: #EC4899;
            --bg-gradient-start: #F0F4FF; --bg-gradient-end: #F5E6FF; --text-dark: #1F2937;
            --text-light: #6B7280; --white: #FFFFFF; --glass-bg: rgba(255, 255, 255, 0.9);
            --like-color: #EF4444; --bookmark-color: #F59E0B;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Noto Sans KR', 'Nanum Round Gothic', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%); color: var(--text-dark); min-height: 100vh; overflow-x: hidden; display: flex; flex-direction: column; align-items: center; position: relative; }

        /* ì£¼ìš” ì»´í¬ë„ŒíŠ¸ ìŠ¤íƒ€ì¼ (í•„ìš”í•œ ë¶€ë¶„ë§Œ ìœ ì§€) */
        .loading-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%); display: flex; justify-content: center; align-items: center; z-index: 10000; transition: opacity 0.5s ease; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
        .app-container { width: 100%; max-width: 480px; min-height: 100vh; background: var(--glass-bg); backdrop-filter: blur(10px); margin-top: 20px; padding-bottom: 90px; }
        .header-section { padding: 40px 25px 20px; text-align: center; background: linear-gradient(180deg, var(--white) 0%, var(--glass-bg) 100%); border-radius: 30px 30px 0 0; }
        .header-title { font-size: 24px; font-weight: 800; color: var(--primary-dark); margin-bottom: 8px; }
        .header-sub { font-size: 14px; color: var(--text-light); }
        .content-card { background: var(--glass-bg); border: 1px solid rgba(139, 92, 246, 0.1); border-radius: 25px; padding: 20px; margin: 0 20px 15px; position: relative; transition: all 0.2s ease; box-shadow: 0 4px 15px rgba(139, 92, 246, 0.05); cursor: pointer; }
        .mypage-tabs, .editor-filter-tabs { display: flex; overflow-x: auto; padding: 0 20px; gap: 8px; margin-bottom: 20px; -webkit-overflow-scrolling: touch; }
        .mypage-tab, .editor-tab { padding: 8px 16px; border-radius: 20px; background: white; border: 1px solid #eee; font-size: 12px; color: var(--text-light); white-space: nowrap; cursor: pointer; }
        .mypage-tab.active, .editor-tab.active { background: var(--primary); color: white; border-color: var(--primary); }
        .editor-tab.active { background: var(--accent); color: white; border-color: var(--accent); }
        
        /* ëª¨ë‹¬ ê°•ì œ ì •ì˜ */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 2000; }
        .modal-overlay.show { display: flex; }
        .modal-card { background: white; width: 90%; max-width: 400px; border-radius: 20px; padding: 25px; max-height: 90vh; overflow-y: auto; position: relative; }
        .input-box { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 10px; font-size: 14px; }
        .btn-primary { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 12px; width: 100%; font-weight: bold; margin-top: 10px; }

        /* ìŠ¤íƒ¬í”„ íŒ (8-B) */
        .stamp-board { display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px; margin: 15px 0; padding: 10px; border: 1px dashed #A78BFA; border-radius: 15px; }
        .stamp-cell { 
            width: 100%; height: 0; padding-bottom: 100%; position: relative; border-radius: 50%; 
            background: #F0F4FF; border: 2px solid #D1D5DB; 
            display: flex; align-items: center; justify-content: center;
        }
        .stamp-cell i { font-size: 18px; color: #D1D5DB; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .stamp-cell.stamped { background: #A78BFA; border-color: var(--primary-dark); }
        .stamp-cell.stamped i { color: white; }

        /* ê¸°íƒ€ UI */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; max-width: 480px; height: 70px; background: white; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #eee; z-index: 1000; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #999; font-size: 10px; cursor: pointer; }
        .nav-item i { font-size: 20px; margin-bottom: 4px; }
        .nav-item.active { color: var(--primary); }
        .write-icon { position: fixed; bottom: 90px; right: 20px; width: 55px; height: 55px; background: var(--primary); border-radius: 50%; color: white; display: none; align-items: center; justify-content: center; font-size: 24px; box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4); cursor: pointer; z-index: 900; }
        .comment-item { font-size: 13px; margin-bottom: 12px; padding: 10px; background: #f9fafb; border-radius: 10px; position: relative; }
        .comment-meta { font-size: 11px; color: #888; margin-bottom: 4px; display: flex; justify-content: space-between; }
        
    </style>
</head>
<body>

    <div class="loading-screen" id="loadingScreen">
        <div class="loading-icon">ğŸ’œ</div>
    </div>

    <div id="loginModal" class="modal-overlay">
        <div class="modal-card" style="text-align: center;">
            <h2 style="color: var(--primary); margin-bottom: 20px;">ìíœ´ë ˆí„°</h2>
            <input type="email" id="loginEmail" class="input-box" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" required>
            <input type="password" id="loginPassword" class="input-box" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
            <button onclick="handleLogin()" class="btn-primary">ë¡œê·¸ì¸</button>
            <p style="margin-top: 15px; font-size: 12px; color: #666; display:flex; justify-content:space-between; align-items:center;">
                <span onclick="showFindPasswordModal()" style="color: var(--text-light); cursor: pointer;">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</span>
                <span>ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? <span onclick="showSignupModal()" style="color: var(--primary); font-weight: bold; cursor: pointer;">íšŒì›ê°€ì…</span></span>
            </p>
        </div>
    </div>
    
    <div id="findPasswordModal" class="modal-overlay">
        <div class="modal-card">
            <h3 style="text-align: center; margin-bottom: 15px;">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</h3>
            <p style="font-size: 12px; color: #666; margin-bottom: 15px;">ê°€ì… ì‹œ ì‚¬ìš©í•œ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
            <input type="email" id="findPasswordEmail" class="input-box" placeholder="ì´ë©”ì¼ ì£¼ì†Œ" required>
            <button onclick="handleFindPassword()" class="btn-primary">ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ ë°›ê¸°</button>
            <button onclick="showLoginModal()" style="width:100%; padding:10px; background:none; border:none; color:#888; margin-top:5px;">ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
    </div>
    
    <div id="changePasswordModal" class="modal-overlay">
        <div class="modal-card">
            <h3 style="text-align: center; margin-bottom: 15px;">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h3>
            <input type="password" id="currentPassword" class="input-box" placeholder="í˜„ì¬ ë¹„ë°€ë²ˆí˜¸" required>
            <input type="password" id="newPassword" class="input-box" placeholder="ìƒˆë¡œìš´ ë¹„ë°€ë²ˆí˜¸" required>
            <input type="password" id="confirmNewPassword" class="input-box" placeholder="ìƒˆë¡œìš´ ë¹„ë°€ë²ˆí˜¸ í™•ì¸" required>
            <button onclick="handleChangePassword()" class="btn-primary">ë³€ê²½í•˜ê¸°</button>
            <button onclick="closeModal()" style="width:100%; padding:10px; background:none; border:none; color:#888; margin-top:5px;">ì·¨ì†Œ</button>
        </div>
    </div>

    <div id="signupModal" class="modal-overlay">
        <div class="modal-card">
            <h3 style="text-align: center; margin-bottom: 15px;">íšŒì›ê°€ì…</h3>
            <input type="text" id="signupNickname" class="input-box" placeholder="ë‹‰ë„¤ì„ (í•„ìˆ˜)" required>
            <input type="email" id="signupEmail" class="input-box" placeholder="ì´ë©”ì¼" required>
            <input type="password" id="signupPassword" class="input-box" placeholder="ë¹„ë°€ë²ˆí˜¸" required>
            <button onclick="handleSignup()" class="btn-primary">ê°€ì…í•˜ê¸°</button>
            <button onclick="showLoginModal()" style="width:100%; padding:10px; background:none; border:none; color:#888; margin-top:10px;">ì·¨ì†Œ</button>
        </div>
    </div>

    <div id="writeModal" class="modal-overlay">
        <div class="modal-card">
            <h3 id="writeTitle" style="margin-bottom: 15px; color: var(--primary);">ê¸€ì“°ê¸°</h3>
            
            <input type="hidden" id="editPostId" value="">
            
            <select id="postCategory" class="input-box" style="display: none;">
                <option value="ìíœ´ë ˆí„°">ìíœ´ë ˆí„°</option>
                <option value="ìíœ´ë©">ìíœ´ë©</option>
                <option value="ì—ë””í„°í†¡">ì—ë””í„°í†¡</option>
            </select>
            
            <div id="moodSection" style="display: none;">
                <p style="font-size: 12px; color: #666;">ì˜¤ëŠ˜ì˜ ê¸°ë¶„ì€ ì–´ë–¤ê°€ìš”?</p>
                <div id="moodSelector" class="emoji-selector"></div>
            </div>
            
            <input type="text" id="postTitle" class="input-box" placeholder="ì œëª©">
            <textarea id="postContent" class="input-box" style="height: 100px; resize: none;" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            
            <button onclick="submitPost()" class="btn-primary">ë“±ë¡í•˜ê¸°</button>
            <button onclick="closeModal()" style="width:100%; padding:10px; background:none; border:none; color:#888; margin-top:5px;">ì·¨ì†Œ</button>
        </div>
    </div>

    <div id="postDetailModal" class="modal-overlay">
        <div class="modal-card" style="max-height: 85vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: start; position: relative;">
                <span id="detailCategory" style="background: var(--primary-light); color: white; padding: 4px 8px; border-radius: 8px; font-size: 10px; font-weight: 700;">ì¹´í…Œê³ ë¦¬</span>
                
                <div id="manageButtons" class="manage-btn-group" style="display:none; position: absolute; top: 0; right: 40px; display: flex; gap: 8px;">
                    <button class="manage-btn btn-edit" style="font-size: 11px; padding: 4px 8px; border-radius: 6px; border: none; cursor: pointer; background: #E0E7FF; color: #4338CA;" onclick="openEditModal()">ìˆ˜ì •</button>
                    <button class="manage-btn btn-delete" style="font-size: 11px; padding: 4px 8px; border-radius: 6px; border: none; cursor: pointer; background: #FEE2E2; color: #B91C1C;" onclick="deleteCurrentPost()">ì‚­ì œ</button>
                </div>
                
                <button onclick="closeModal()" style="background:none; border:none; font-size: 20px; color: #999;"><i class="fas fa-times"></i></button>
            </div>
            
            <h3 id="detailTitle" style="margin: 15px 0; font-size: 18px;">ì œëª©</h3>
            <div style="font-size: 12px; color: #888; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
                <span id="detailAuthor" style="font-weight: bold; color: var(--text-dark);">ì‘ì„±ì</span> Â· <span id="detailDate">ë‚ ì§œ</span>
            </div>

            <img id="detailImage" src="" style="width: 100%; border-radius: 10px; margin-bottom: 15px; display: none;">
            <div id="detailContent" style="font-size: 14px; line-height: 1.6; white-space: pre-line; margin-bottom: 20px;">ë‚´ìš©</div>

            <div class="action-btn-group" style="display: flex; gap: 10px; margin-top: 15px; border-top: 1px solid rgba(0,0,0,0.05); padding-top: 15px;">
                <button id="btnLike" class="action-btn" style="flex: 1; padding: 10px; border-radius: 12px; border: 1px solid #eee; background: white; color: #6B7280; font-size: 13px; display: flex; align-items: center; justify-content: center; gap: 5px; transition: all 0.2s;" onclick="toggleLike()">
                    <i class="fas fa-heart"></i> <span id="likeCount">0</span>
                </button>
                <button id="btnBookmark" class="action-btn" style="flex: 1; padding: 10px; border-radius: 12px; border: 1px solid #eee; background: white; color: #6B7280; font-size: 13px; display: flex; align-items: center; justify-content: center; gap: 5px; transition: all 0.2s;" onclick="toggleBookmark()">
                    <i class="fas fa-bookmark"></i> ë¶ë§ˆí¬
                </button>
            </div>

            <div class="comment-section" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                <div style="display:flex; gap:5px; margin-bottom:15px;">
                    <input type="text" id="commentInput" class="input-box" style="margin:0; font-size:12px;" placeholder="ëŒ“ê¸€ ë‹¬ê¸°...">
                    <button onclick="submitComment()" style="background:var(--primary); color:white; border:none; border-radius:10px; width:50px; font-size:12px;">ë“±ë¡</button>
                </div>
                <div id="commentList"></div>
            </div>
        </div>
    </div>
    
    <div id="appContainer" class="app-container" style="display:none;"></div>

    <div id="writeIcon" class="write-icon" onclick="openModal('adminWrite')">
        <i class="fas fa-plus"></i>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="renderTab('home')" id="nav-home"><i class="fas fa-home"></i><span>í™ˆ</span></div>
        <div class="nav-item" onclick="renderTab('letter')" id="nav-letter"><i class="fas fa-envelope"></i><span>ë ˆí„°</span></div>
        <div class="nav-item" onclick="renderTab('mood')" id="nav-mood"><i class="fas fa-smile"></i><span>ë¬´ë“œ</span></div>
        <div class="nav-item" onclick="renderTab('editorTalk')" id="nav-editorTalk"><i class="fas fa-comments"></i><span>ì—ë””í„°í†¡</span></div>
        <div class="nav-item" onclick="renderTab('mypage')" id="nav-mypage"><i class="fas fa-user"></i><span>ë§ˆì´</span></div>
    </nav>

    <script>
        // --- ë°ì´í„° ë° ìƒíƒœ ê´€ë¦¬ ---
        const SUPER_ADMIN = 'happxi@jahyu.com';
        const EDITORS = {
            'happxi@jahyu.com': 'í–…ì”¨', 'elly@jahyu.com': 'ì—˜ë¦¬', 'gokal@jahyu.com': 'ê³ ì¹¼', 
            'sunny@jahyu.com': 'ì¨ë‹ˆ', 'yudan@jahyu.com': 'ìœ ë‹¨'
        };
        const ADMINS = Object.keys(EDITORS);
        
        const MOOD_EMOJIS = [
            { emoji: 'ğŸ˜Š', bg: '#E0F2FE' }, { emoji: 'ğŸ¥°', bg: '#FCE7F3' }, { emoji: 'ğŸ˜Œ', bg: '#E9D5FF' },
            { emoji: 'ğŸ˜¢', bg: '#DBEAFE' }, { emoji: 'ğŸ˜ ', bg: '#FEE2E2' }, { emoji: 'ğŸ˜´', bg: '#D1FAE5' },
            { emoji: 'ğŸ’¡', bg: '#FEF3C7' }, { emoji: 'â˜€ï¸', bg: '#FDE68A' }, { emoji: 'ğŸ˜°', bg: '#FED7AA' }, { emoji: 'ğŸ˜', bg: '#F3F4F6' }
        ];

        let currentUser = null;
        let users = {};
        let posts = [];
        let comments = [];
        let myLikes = [];
        let myBookmarks = [];
        let currentViewingPostId = null;
        let lastMoodDate = localStorage.getItem('lastMoodDate') || null;

        function saveData(key, data) {
            localStorage.setItem(`jahyu_${key}`, JSON.stringify(data));
        }
        
        function getTodayDate() {
            return new Date().toISOString().split('T')[0];
        }
        
        // --- ì´ˆê¸° ë°ì´í„° ë¡œë”© ---
        function initData() {
            // ë”ë¯¸ ë°ì´í„° ì´ˆê¸°í™”
            const initialUsers = {
                'happxi@jahyu.com': { nickname: 'í–…ì”¨', password: 'test', stamps: 5 },
                'elly@jahyu.com': { nickname: 'ì—˜ë¦¬', password: 'test', stamps: 3 },
                'gokal@jahyu.com': { nickname: 'ê³ ì¹¼', password: 'test', stamps: 1 },
                'sunny@jahyu.com': { nickname: 'ì¨ë‹ˆ', password: 'test', stamps: 0 },
                'yudan@jahyu.com': { nickname: 'ìœ ë‹¨', password: 'test', stamps: 2 },
                'user@example.com': { nickname: 'í–…ì‚', password: 'test', stamps: 12 }
            };
            
            const initialPosts = [
                { id: 101, type: 'letter', category: 'ìíœ´ë ˆí„°', title: '[32í˜¸] í‡´ì‚¬ í›„ ë²ˆì•„ì›ƒ', content: 'ì‰¬ì–´ë„ ì‰¬ëŠ” ê²ƒ ê°™ì§€ ì•Šì€ ë‹¹ì‹ ì—ê²Œ...', author: 'í–…ì”¨', authorId: 'happxi@jahyu.com', date: '2025-12-08' },
                { id: 102, type: 'letter', category: 'ìíœ´ë©', title: 'ê¸€ì“°ê¸°ë¡œ ë§ˆìŒ ì±™ê¸°ê¸°', content: 'ë‚˜ë¥¼ ëŒì•„ë³´ëŠ” ì‹œê°„', author: 'ì—˜ë¦¬', authorId: 'elly@jahyu.com', date: '2025-12-09' },
                { id: 201, type: 'talk', category: 'ì—ë””í„°í†¡', title: 'ì˜¤ëŠ˜ ë‚ ì”¨ ë§‘ìŒ â˜€ï¸', content: 'ì‚°ì±…í•˜ê¸° ë”± ì¢‹ì€ ë‚ ì”¨ë„¤ìš”!', author: 'ê³ ì¹¼', authorId: 'gokal@jahyu.com', date: '2025-12-10' },
                { id: 301, type: 'mood', title: 'ì˜¤ëŠ˜ì˜ ë¬´ë“œ', content: 'ê¸°ë¶„ì´ ë„ˆë¬´ ì¢‹ì•„ìš”!', author: 'í–…ì‚', authorId: 'user@example.com', date: '2025-12-11', emoji: 'ğŸ˜Š', bg: '#E0F2FE' }
            ];
            
            const initialComments = [
                { id: 1, postId: 201, content: 'ë§ì•„ìš” ë‚ ì”¨ ë„ˆë¬´ ì¢‹ì•„ìš”!', author: 'í–…ì‚', authorId: 'user@example.com', date: '2025-12-10' },
                { id: 2, postId: 201, content: 'ì €ë„ ì‚°ì±…ê°ˆë˜ìš”!', author: 'í–…ì”¨', authorId: 'happxi@jahyu.com', date: '2025-12-10' }
            ];
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë¡œë“œ (ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì´ˆê¸° ë°ì´í„° ì‚¬ìš©)
            users = JSON.parse(localStorage.getItem('jahyu_users')) || initialUsers;
            posts = JSON.parse(localStorage.getItem('jahyu_posts')) || initialPosts;
            comments = JSON.parse(localStorage.getItem('jahyu_comments')) || initialComments;
            myLikes = JSON.parse(localStorage.getItem('jahyu_myLikes')) || [];
            myBookmarks = JSON.parse(localStorage.getItem('jahyu_myBookmarks')) || [];
            
            // ë‹‰ë„¤ì„ì´ ì—†ëŠ” ì‚¬ìš©ìì—ê²Œ ë‹‰ë„¤ì„ ë¶€ì—¬ (êµ¬ë²„ì „ ë°ì´í„° í˜¸í™˜)
            Object.keys(users).forEach(email => {
                if (!users[email].nickname) {
                    users[email].nickname = email.split('@')[0];
                }
                if (users[email].stamps === undefined) {
                    users[email].stamps = 0;
                }
            });
            saveData('users', users);
        }

        // --- ì´ˆê¸°í™” ë° ë¡œê·¸ì¸ ---
        window.addEventListener('load', () => {
            initData();
            
            // URL íŒŒë¼ë¯¸í„°ë¥¼ í™•ì¸í•˜ì—¬ ê°œë°œì ëª¨ë“œ ìë™ ë¡œê·¸ì¸ (ë””ë²„ê¹…ìš©)
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('dev') === 'true') {
                 currentUser = { 
                    id: SUPER_ADMIN, 
                    name: 'í–…ì”¨', 
                    isSuperAdmin: true,
                    isAdmin: true
                };
                localStorage.setItem('jahyu_currentUser', JSON.stringify(currentUser));
                checkLogin(true); // ë°”ë¡œ ì•± ì»¨í…Œì´ë„ˆ í‘œì‹œ
                return;
            }

            // ì¼ë°˜ ë¡œë”©
            setTimeout(() => {
                document.getElementById('loadingScreen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                    checkLogin();
                }, 500);
            }, 800);
        });

        function checkLogin(skipLoading = false) {
            const saved = localStorage.getItem('jahyu_currentUser');
            if (saved) {
                currentUser = JSON.parse(saved);
                document.getElementById('appContainer').style.display = 'block';
                renderTab('home');
            } else if (!skipLoading) {
                showLoginModal();
            }
        }
        
        function addStamp(count = 1) {
            if (users[currentUser.id]) {
                users[currentUser.id].stamps += count;
                saveData('users', users);
                return true;
            }
            return false;
        }

        // --- ëª¨ë‹¬ ì œì–´ ---
        function closeModal() { document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('show')); }
        function showLoginModal() { closeModal(); document.getElementById('loginModal').classList.add('show'); document.getElementById('appContainer').style.display = 'none'; }
        function showSignupModal() { closeModal(); document.getElementById('signupModal').classList.add('show'); }
        function showFindPasswordModal() { closeModal(); document.getElementById('findPasswordModal').classList.add('show'); }
        function showChangePasswordModal() { closeModal(); document.getElementById('changePasswordModal').classList.add('show'); }


        // --- ë¡œê·¸ì¸/íšŒì›ê°€ì…/ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° (ìš”ì²­ì‚¬í•­ 1) ---
        function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!users[email] || users[email].password !== password) {
                return alert('ì´ë©”ì¼ ì£¼ì†Œ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
            
            const u = users[email];
            currentUser = { 
                id: email, 
                name: u.nickname, 
                isSuperAdmin: email === SUPER_ADMIN,
                isAdmin: ADMINS.includes(email)
            };

            localStorage.setItem('jahyu_currentUser', JSON.stringify(currentUser));
            closeModal();
            document.getElementById('appContainer').style.display = 'block';
            renderTab('home');
        }

        function handleSignup() {
            const nickname = document.getElementById('signupNickname').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            
            if (!nickname || !email || !password) return alert('ëª¨ë“  í•„ë“œë¥¼ ì±„ì›Œì£¼ì„¸ìš”.');
            if (users[email]) return alert('ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼ ì£¼ì†Œì…ë‹ˆë‹¤.');

            users[email] = { nickname: nickname, password: password, stamps: 0 };
            saveData('users', users);
            alert('íšŒì›ê°€ì… ì™„ë£Œ! ì´ì œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
            showLoginModal();
        }
        
        function handleFindPassword() {
            const email = document.getElementById('findPasswordEmail').value;
            if (!users[email]) {
                return alert('âš ï¸ ì…ë ¥í•˜ì‹  ì´ë©”ì¼ ì£¼ì†Œì™€ ì¼ì¹˜í•˜ëŠ” ê³„ì •ì´ ì—†ìŠµë‹ˆë‹¤.');
            }
            
            const tempPassword = Math.random().toString(36).substring(2, 8);
            users[email].password = tempPassword;
            saveData('users', users);

            alert(`âœ… ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ê°€ ${email}ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. (${tempPassword})\n\në°˜ë“œì‹œ ë¡œê·¸ì¸ í›„ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•˜ì„¸ìš”.`);
            showLoginModal();
        }

        function handleChangePassword() {
            const currentPw = document.getElementById('currentPassword').value;
            const newPw = document.getElementById('newPassword').value;
            const confirmPw = document.getElementById('confirmNewPassword').value;

            if (users[currentUser.id].password !== currentPw) {
                return alert('í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
            if (newPw !== confirmPw) {
                return alert('ìƒˆë¡œìš´ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
            if (newPw.length < 4) {
                return alert('ë¹„ë°€ë²ˆí˜¸ëŠ” 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
            }

            users[currentUser.id].password = newPw;
            saveData('users', users);
            alert('âœ… ë¹„ë°€ë²ˆí˜¸ê°€ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
            closeModal();
        }

        // --- ê¸€ì“°ê¸°/ë¬´ë“œ ë“±ë¡ (ìš”ì²­ì‚¬í•­ 6) ---
        function submitPost() {
            const editId = document.getElementById('editPostId').value;
            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;
            const isMood = document.getElementById('moodSection').style.display !== 'none';
            
            if (!content) return alert('ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');

            if (editId) {
                const post = posts.find(p => p.id == editId);
                if (post) { post.title = title; post.content = content; saveData('posts', posts); alert('ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.'); viewPost(post.id); }
            } else {
                if (isMood && lastMoodDate === getTodayDate()) {
                    return alert('âš ï¸ ë¬´ë“œ ê¸°ë¡ì€ í•˜ë£¨ì— í•œ ë²ˆë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.\në‚´ì¼ ë‹¤ì‹œ ì°¾ì•„ì£¼ì„¸ìš”!');
                }

                const newId = Date.now();
                let newPost = {
                    id: newId, content: content, author: currentUser.name, authorId: currentUser.id,
                    date: getTodayDate()
                };

                if (isMood) {
                    const selected = document.querySelector('.emoji-option.selected');
                    if (!selected) return alert('ê¸°ë¶„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    newPost.type = 'mood';
                    newPost.emoji = selected.innerText;
                    newPost.bg = selected.style.backgroundColor;
                    newPost.title = 'ì˜¤ëŠ˜ì˜ ë¬´ë“œ';
                    
                    addStamp(1);
                    lastMoodDate = getTodayDate();
                    localStorage.setItem('lastMoodDate', lastMoodDate);
                    alert('âœ… ë¬´ë“œ ë“±ë¡ ì™„ë£Œ! ìŠ¤íƒ¬í”„ +1');

                } else {
                    const category = document.getElementById('postCategory').value;
                    if (category === 'ì—ë””í„°í†¡' && !currentUser.isAdmin) {
                         return alert('ì—ë””í„°í†¡ì€ ê´€ë¦¬ìë§Œ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                    }
                    newPost.type = (category === 'ì—ë””í„°í†¡' || category === 'ìíœ´ë ˆí„°' || category === 'ìíœ´ë©') ? 'talk' : 'letter';
                    newPost.category = category;
                    newPost.title = title;
                    
                    addStamp(1);
                    alert('âœ… ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤! ìŠ¤íƒ¬í”„ +1');
                }
                
                posts.unshift(newPost);
                saveData('posts', posts);
            }
            
            document.getElementById('postTitle').value = '';
            document.getElementById('postContent').value = '';
            closeModal();
            renderTab(isMood ? 'mood' : 'home');
        }


        // --- ëŒ“ê¸€ ë“±ë¡/ì‚­ì œ (ìš”ì²­ì‚¬í•­ 4) ---
        function submitComment() {
            const input = document.getElementById('commentInput');
            const text = input.value;
            if(!text) return;
            
            comments.push({
                id: Date.now(), postId: currentViewingPostId, content: text,
                author: currentUser.name, authorId: currentUser.id, date: getTodayDate()
            });
            saveData('comments', comments);
            addStamp(1); 
            
            input.value = '';
            renderComments();
            alert('âœ… ëŒ“ê¸€ ë“±ë¡ ì™„ë£Œ! ìŠ¤íƒ¬í”„ +1');
        }

        function renderComments() {
            const list = document.getElementById('commentList');
            const postComments = comments.filter(c => c.postId == currentViewingPostId).reverse();
            
            list.innerHTML = postComments.map(c => {
                const authorNickname = users[c.authorId] ? users[c.authorId].nickname : c.author;
                return `
                <div class="comment-item">
                    <div class="comment-meta">
                        <span>${authorNickname} (${c.date})</span>
                        ${(currentUser.isAdmin || currentUser.id === c.authorId) ? `<span class="comment-del" style="color:#EF4444; cursor:pointer;" onclick="deleteComment(${c.id})">ì‚­ì œ</span>` : ''}
                    </div>
                    <div>${c.content}</div>
                </div>
            `;}).join('');
        }
        
        function deleteComment(commentId) {
            if(confirm('ëŒ“ê¸€ì„ ì‚­ì œí• ê¹Œìš”?')) {
                comments = comments.filter(c => c.id != commentId);
                saveData('comments', comments);
                renderComments();
            }
        }
        
        function viewPost(id) {
            const post = posts.find(p => p.id == id);
            if (!post) return;

            currentViewingPostId = id;
            document.getElementById('detailCategory').innerText = post.category || 'Mood';
            document.getElementById('detailTitle').innerText = post.title;
            
            const authorNickname = users[post.authorId] ? users[post.authorId].nickname : post.author;
            document.getElementById('detailAuthor').innerText = authorNickname;
            document.getElementById('detailDate').innerText = post.date;
            
            let contentHtml = post.content;
            if (post.type === 'mood') {
                contentHtml = `<div style="font-size:40px; text-align:center; padding:20px; background:${post.bg || '#eee'}; border-radius:20px; margin-bottom:15px;">${post.emoji}</div>` + contentHtml;
            }
            document.getElementById('detailContent').innerHTML = contentHtml;
            
            const btnGroup = document.getElementById('manageButtons');
            if (currentUser.isAdmin || currentUser.id === post.authorId) {
                btnGroup.style.display = 'flex';
            } else {
                btnGroup.style.display = 'none';
            }

            updateInteractionButtons();
            renderComments();
            closeModal(); 
            setTimeout(() => document.getElementById('postDetailModal').classList.add('show'), 50);
        }

        function updateInteractionButtons() {
            // (ì¢‹ì•„ìš”/ë¶ë§ˆí¬ ë²„íŠ¼ ì—…ë°ì´íŠ¸ ë¡œì§ - ì´ì „ê³¼ ë™ì¼)
            const btnLike = document.getElementById('btnLike');
            const btnBookmark = document.getElementById('btnBookmark');
            const likeCount = document.getElementById('likeCount');

            if (myLikes.includes(currentViewingPostId)) {
                btnLike.classList.add('active-like');
                btnLike.style.color = '#EF4444';
                likeCount.innerText = '1';
            } else {
                btnLike.classList.remove('active-like');
                btnLike.style.color = '#6B7280';
                likeCount.innerText = '0';
            }

            if (myBookmarks.includes(currentViewingPostId)) {
                btnBookmark.classList.add('active-bookmark');
                btnBookmark.style.color = '#F59E0B';
                btnBookmark.innerHTML = '<i class="fas fa-bookmark"></i> ì €ì¥ë¨';
            } else {
                btnBookmark.classList.remove('active-bookmark');
                btnBookmark.style.color = '#6B7280';
                btnBookmark.innerHTML = '<i class="fas fa-bookmark"></i> ë¶ë§ˆí¬';
            }
        }
        
        function toggleLike() {
            if (myLikes.includes(currentViewingPostId)) {
                myLikes = myLikes.filter(id => id != currentViewingPostId);
            } else {
                myLikes.push(currentViewingPostId);
            }
            saveData('myLikes', myLikes);
            updateInteractionButtons();
        }

        function toggleBookmark() {
            if (myBookmarks.includes(currentViewingPostId)) {
                myBookmarks = myBookmarks.filter(id => id != currentViewingPostId);
            } else {
                myBookmarks.push(currentViewingPostId);
            }
            saveData('myBookmarks', myBookmarks);
            updateInteractionButtons();
        }

        // --- íƒ­ ë Œë”ë§ ---
        function renderTab(tab) {
            if (!currentUser) return showLoginModal();

            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById(`nav-${tab}`).classList.add('active');

            const writeIcon = document.getElementById('writeIcon');
            if (tab === 'editorTalk' || tab === 'letter') {
                 writeIcon.style.display = currentUser.isAdmin ? 'flex' : 'none';
            } else {
                 writeIcon.style.display = 'none';
            }

            const container = document.getElementById('appContainer');
            container.innerHTML = '';
            window.scrollTo(0,0);

            if (tab === 'home') {
                container.innerHTML = `
                    <div class="header-section">
                        <div class="header-title">${currentUser.name}ë‹˜ ë°˜ê°€ì›Œìš”!</div>
                        <div class="header-sub">ì˜¤ëŠ˜ì€ ë” í–‰ë³µí•˜ì„¸ìš”!</div>
                    </div>
                    <div class="content-card" style="text-align:center;">
                        <h3 style="margin-bottom: 15px;">ì˜¤ëŠ˜ì€ ì–´ë–¤ íœ´ì‹ì´ í•„ìš”í•˜ì„¸ìš”?</h3>
                        <div style="display:flex; justify-content:center; gap:10px;">
                            <button class="btn-primary" style="flex:1; margin:0;" onclick="renderTab('letter', 'ìíœ´ë ˆí„°')">ìíœ´ë ˆí„°</button>
                            <button class="btn-primary" style="flex:1; margin:0; background:var(--accent);" onclick="renderTab('letter', 'ìíœ´ë©')">ìíœ´ë©</button>
                        </div>
                        <p style="font-size:11px; color:#999; margin-top:10px;">ìíœ´ë ˆí„°ì™€ ìíœ´ë©ì„ ì£¼ì œë³„ë¡œ í•œ ëˆˆì—!</p>
                    </div>
                    <div style="padding:0 20px;">
                        <h4 style="margin:15px 0;">ìµœê·¼ ê²Œì‹œê¸€</h4>
                        ${getPostListHTML(posts.slice(0, 3))}
                    </div>
                `;
            } else if (tab === 'letter') {
                const categoryFilter = arguments[1] || 'all'; 
                const filteredPosts = posts.filter(p => p.category === 'ìíœ´ë ˆí„°' || p.category === 'ìíœ´ë©').filter(p => categoryFilter === 'all' || p.category === categoryFilter);

                container.innerHTML = `
                    <div class="header-section">
                        <div class="header-title">ì˜¤ëŠ˜ì˜ ë‚˜ë¥¼ ìœ„í•œ ìœ„ë¡œ!</div>
                        <div class="header-sub">ìíœ´ë ˆí„°ì™€ ìíœ´ë©ì„ ì£¼ì œë³„ë¡œ ë³¼ ìˆ˜ ìˆì–´ìš”</div>
                    </div>
                    
                    <div class="mypage-tabs">
                        <div class="mypage-tab ${categoryFilter === 'all' ? 'active' : ''}" onclick="renderTab('letter', 'all')">ì „ì²´</div>
                        <div class="mypage-tab ${categoryFilter === 'ìíœ´ë ˆí„°' ? 'active' : ''}" onclick="renderTab('letter', 'ìíœ´ë ˆí„°')">ìíœ´ë ˆí„°</div>
                        <div class="mypage-tab ${categoryFilter === 'ìíœ´ë©' ? 'active' : ''}" onclick="renderTab('letter', 'ìíœ´ë©')">ìíœ´ë©</div>
                    </div>

                    <div style="padding:0 20px;">${getPostListHTML(filteredPosts)}</div>
                `;
            } else if (tab === 'mood') {
                const moods = posts.filter(p => p.type === 'mood' && p.authorId === currentUser.id);
                const isTodayMood = lastMoodDate === getTodayDate();
                
                container.innerHTML = `
                    <div class="header-section">
                        <div class="header-title">ë¬´ë“œ íŠ¸ë˜ì»¤</div>
                        <div class="header-sub">ë¬´ë“œë¥¼ ê¸°ë¡í•˜ë©´ ìŠ¤íƒ¬í”„ê°€ ì ë¦½ë©ë‹ˆë‹¤! (1ì¼ 1íšŒ)</div>
                        <div class="header-sub">í–…ì‚ë‹˜ë§Œì˜ ê³µê°„ì— ê°ì •ì„ ê¸°ë¡í•´ ë³´ì„¸ìš”</div>
                    </div>
                    <div class="content-card" style="text-align:center;">
                        <button class="btn-primary" onclick="${isTodayMood ? `alert('âš ï¸ ì˜¤ëŠ˜ ì´ë¯¸ ë¬´ë“œë¥¼ ê¸°ë¡í•˜ì…¨ì–´ìš”.\\në‚´ì¼ ë‹¤ì‹œ ì°¾ì•„ì£¼ì„¸ìš”!')` : `openModal('mood')`}" 
                                style="margin:0; background:${isTodayMood ? '#9CA3AF' : 'var(--primary)'}">
                            ${isTodayMood ? 'ì˜¤ëŠ˜ì˜ ê¸°ë¡ ì™„ë£Œ' : 'ì˜¤ëŠ˜ì˜ ê¸°ë¶„ ê¸°ë¡í•˜ê¸°'}
                        </button>
                    </div>
                    <div style="padding:0 20px;">
                        <h4 style="margin:15px 0;">ë‚˜ì˜ ê¸°ë¡</h4>
                        ${getPostListHTML(moods)}
                    </div>
                `;
            } else if (tab === 'editorTalk') {
                const authorFilter = arguments[1] || 'all'; 
                const talks = posts.filter(p => p.category === 'ì—ë””í„°í†¡');
                const filteredTalks = authorFilter === 'all' 
                    ? talks
                    : talks.filter(p => p.author === authorFilter);

                container.innerHTML = `
                    <div class="header-section">
                        <div class="header-title">ì—ë””í„°í†¡</div>
                        <div class="header-sub">ì—ë””í„°ë“¤ê³¼ ë” ê°€ê¹Œì´ì—ì„œ ì†Œí†µí•´ìš”!</div>
                    </div>
                    
                    <div class="editor-filter-tabs">
                        <div class="editor-tab ${authorFilter === 'all' ? 'active' : ''}" onclick="renderTab('editorTalk', 'all')">ì „ì²´</div>
                        ${Object.values(EDITORS).map(name => `
                            <div class="editor-tab ${authorFilter === name ? 'active' : ''}" style="background:${authorFilter === name ? '#EC4899' : 'white'}; color:${authorFilter === name ? 'white' : '#6B7280'};" onclick="renderTab('editorTalk', '${name}')">${name}</div>
                        `).join('')}
                    </div>

                    <div style="padding:0 20px;">${getPostListHTML(filteredTalks)}</div>
                `;
            } else if (tab === 'mypage') {
                renderMyPage(container);
            }
        }
        
        // --- ë§ˆì´í˜ì´ì§€ (ìš”ì²­ì‚¬í•­ 8) ---
        function renderMyPage(container) {
            const user = users[currentUser.id];
            const currentStamps = user ? user.stamps : 0;
            
            container.innerHTML = `
                <div class="header-section">
                    <div class="header-title">ë§ˆì´í˜ì´ì§€</div>
                    <div class="header-sub">${currentUser.name}ë‹˜ (${currentUser.id})</div>
                    ${currentUser.isSuperAdmin ? '<span style="background:#4338CA; color:white; padding:2px 8px; border-radius:10px; font-size:10px; margin-top:5px;">ìŠˆí¼ ê´€ë¦¬ì</span>' : (currentUser.isAdmin ? '<span style="background:#E0E7FF; color:#4338CA; padding:2px 8px; border-radius:10px; font-size:10px; margin-top:5px;">ê´€ë¦¬ì</span>' : '')}
                </div>
                
                ${currentUser.isSuperAdmin ? `
                    <div class="content-card" onclick="renderAdminDashboard()">
                        <h3 style="color:var(--primary-dark);">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h3>
                        <p style="font-size:12px; color:#666; margin-top:5px;">ëª¨ë“  ì‚¬ìš©ì ê¸°ë¡ ë° í†µê³„ ë¶„ì„</p>
                    </div>
                ` : ''}

                <div class="content-card" style="cursor:default;">
                    <h3 style="font-size:16px; margin-bottom:10px;">ìíœ´ ìŠ¤íƒ¬í”„: ${currentStamps} / 30ê°œ</h3>
                    <div class="stamp-board">
                        ${Array(30).fill(0).map((_, i) => `
                            <div class="stamp-cell ${i < currentStamps ? 'stamped' : ''}">
                                <i class="fas fa-hand-peace"></i>
                            </div>
                        `).join('')}
                    </div>
                    <p style="font-size:12px; color:var(--text-dark); margin-top:15px; font-weight:bold;">
                        ìŠ¤íƒ¬í”„ë¥¼ 30ê°œ ëª¨ìœ¼ë©´ ì–´ëŠ ë‚  ìŠ¤í˜ì…œ ë ˆí„°ê°€ ë„ì°©!
                    </p>
                    <p style="font-size:11px; color:#666; margin-top:5px;">
                        ìíœ´ë ˆí„° ì¹´í†¡ ì±„ë„ë¡œ ì¸ì¦ì‚¬ì§„ì„ ë³´ë‚´ì£¼ì„¸ìš”!
                    </p>
                </div>
                
                <div class="mypage-tabs">
                    <div class="mypage-tab active" onclick="switchMyTab(this, 'posts')">ë‚´ê°€ ì“´ ê¸€</div>
                    <div class="mypage-tab" onclick="switchMyTab(this, 'comments')">ë‚´ê°€ ì“´ ëŒ“ê¸€</div>
                    <div class="mypage-tab" onclick="switchMyTab(this, 'likes')">ì¢‹ì•„ìš”</div>
                    <div class="mypage-tab" onclick="switchMyTab(this, 'bookmarks')">ë¶ë§ˆí¬</div>
                </div>

                <div id="mypageContent" style="padding: 0 20px;"></div>
                <div style="padding: 20px;">
                    <button onclick="showChangePasswordModal()" style="width:100%; padding:10px; border:1px solid #ddd; background:white; border-radius:10px; margin-bottom:10px;">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
                    <button onclick="localStorage.clear(); location.reload();" style="width:100%; padding:10px; border:1px solid #ddd; background:white; border-radius:10px; color:#EF4444;">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            `;
            loadMyContent('posts');
        }
        
        function loadMyContent(type) {
             // (ë§ˆì´í˜ì´ì§€ ì½˜í…ì¸  ë¡œë”© ë¡œì§ - ì´ì „ê³¼ ë™ì¼)
             const area = document.getElementById('mypageContent');
            let content = '';

            if (type === 'posts') {
                const myPosts = posts.filter(p => p.authorId === currentUser.id);
                content = myPosts.length ? getPostListHTML(myPosts) : '<p style="text-align:center; color:#999; margin-top:20px;">ì‘ì„±í•œ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            } else if (type === 'comments') {
                const myComments = comments.filter(c => c.authorId === currentUser.id).reverse();
                if (myComments.length) {
                    content = myComments.map(c => {
                        const originalPost = posts.find(p => p.id == c.postId);
                        const postTitle = originalPost ? originalPost.title : 'ì‚­ì œëœ ê²Œì‹œê¸€';
                        return `
                        <div class="content-card" onclick="${originalPost ? `viewPost(${originalPost.id})` : ''}">
                            <div style="font-size:11px; color:var(--primary); margin-bottom:5px;">${postTitle}</div>
                            <div style="font-size:13px;">${c.content}</div>
                            <div style="font-size:10px; color:#999; margin-top:5px;">${c.date}</div>
                        </div>`;
                    }).join('');
                } else {
                    content = '<p style="text-align:center; color:#999; margin-top:20px;">ì‘ì„±í•œ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
            } else if (type === 'likes') {
                const likedPosts = posts.filter(p => myLikes.includes(p.id));
                content = likedPosts.length ? getPostListHTML(likedPosts) : '<p style="text-align:center; color:#999; margin-top:20px;">ì¢‹ì•„ìš”í•œ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            } else if (type === 'bookmarks') {
                const bookmarkedPosts = posts.filter(p => myBookmarks.includes(p.id));
                content = bookmarkedPosts.length ? getPostListHTML(bookmarkedPosts) : '<p style="text-align:center; color:#999; margin-top:20px;">ë¶ë§ˆí¬í•œ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
            area.innerHTML = content;
        }

        // --- ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ (ìš”ì²­ì‚¬í•­ 8-A) ---
        function renderAdminDashboard() {
            // (ëŒ€ì‹œë³´ë“œ ë Œë”ë§ ë¡œì§ - ì´ì „ê³¼ ë™ì¼)
             if (!currentUser.isSuperAdmin) return;
            
            const container = document.getElementById('appContainer');
            container.innerHTML = `
                <div class="header-section">
                    <div class="header-title" style="color:#4338CA;">ìŠˆí¼ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</div>
                    <div class="header-sub">ì „ì²´ ì„œë¹„ìŠ¤ í†µê³„ ë° ì‚¬ìš©ì ê¸°ë¡ ì¡°íšŒ</div>
                </div>
                
                <div class="mypage-tabs" style="justify-content:center;">
                    <div id="dashTabUsers" class="mypage-tab active" onclick="switchDashTab('users')">ì‚¬ìš©ìë³„ ê¸°ë¡</div>
                    <div id="dashTabStats" class="mypage-tab" onclick="switchDashTab('stats')">í†µê³„ ë¶„ì„</div>
                </div>

                <div id="dashboardContent" style="padding: 0 20px;"></div>
                <div style="padding: 20px;">
                    <button onclick="renderTab('mypage')" style="width:100%; padding:10px; border:1px solid #ddd; background:white; border-radius:10px;">ë§ˆì´í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</button>
                </div>
            `;
            loadDashboardContent('users');
        }
        
        function switchDashTab(tab) {
             document.getElementById('dashTabUsers').classList.remove('active');
             document.getElementById('dashTabStats').classList.remove('active');
             document.getElementById(`dashTab${tab.charAt(0).toUpperCase() + tab.slice(1)}`).classList.add('active');
             loadDashboardContent(tab);
        }

        function loadDashboardContent(tab) {
             const contentArea = document.getElementById('dashboardContent');

             if (tab === 'users') {
                let userListHtml = '';
                
                Object.keys(users).forEach(email => {
                    const user = users[email];
                    const userPosts = posts.filter(p => p.authorId === email);
                    const userComments = comments.filter(c => c.authorId === email);
                    const userLikes = myLikes.filter(id => posts.find(p => p.id === id)?.authorId === email);
                    
                    userListHtml += `
                        <div class="content-card" style="cursor:default; margin-bottom:10px;">
                            <h4 style="font-size:14px; color:var(--primary);">${user.nickname} (${email})</h4>
                            <p style="font-size:12px; margin-top:5px;">
                                ğŸ“ ê¸€ ì‘ì„±: ${userPosts.length}ê°œ | ğŸ’¬ ëŒ“ê¸€ ì‘ì„±: ${userComments.length}ê°œ | â¤ï¸ ì¢‹ì•„ìš” ëˆ„ë¦„: ${userLikes.length}ê°œ
                            </p>
                            <p style="font-size:10px; color:#999;">ì ‘ì†: ${Math.floor(Math.random() * 50 + 1)}íšŒ | ì²´ë¥˜ì‹œê°„: ${Math.floor(Math.random() * 30 + 1)}ë¶„ ${Math.floor(Math.random() * 60)}ì´ˆ (ê°€ìƒ)</p>
                        </div>
                    `;
                });
                contentArea.innerHTML = userListHtml;

             } else if (tab === 'stats') {
                 const totalPosts = posts.length;
                 const totalComments = comments.length;
                 
                 contentArea.innerHTML = `
                    <div class="content-card" style="cursor:default;">
                        <h4 style="font-size:16px; margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:5px;">ì „ì²´ í†µê³„</h4>
                        <p>ì´ ê²Œì‹œë¬¼ ìˆ˜: ${totalPosts}ê°œ</p>
                        <p>ì´ ëŒ“ê¸€ ìˆ˜: ${totalComments}ê°œ</p>
                        <p>í‰ê·  ìŠ¤íƒ¬í”„: ${Math.round(Object.values(users).reduce((sum, u) => sum + u.stamps, 0) / Object.keys(users).length)}ê°œ</p>
                    </div>
                    
                    <div class="content-card" style="cursor:default;">
                        <h4 style="font-size:16px; margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:5px;">ì¸ê¸° ê¸€ ìˆœìœ„ (í´ë¦­/ì¡°íšŒìˆ˜ ê¸°ì¤€)</h4>
                        <ol style="font-size:13px; padding-left:20px; color:#444;">
                            <li>[32í˜¸] í‡´ì‚¬ í›„ ë²ˆì•„ì›ƒ (í‰ê·  ì²´ë¥˜ì‹œê°„: 2ë¶„ 15ì´ˆ)</li>
                            <li>ê¸€ì“°ê¸°ë¡œ ë§ˆìŒ ì±™ê¸°ê¸° (í‰ê·  ì²´ë¥˜ì‹œê°„: 1ë¶„ 40ì´ˆ)</li>
                            <li>ì˜¤ëŠ˜ ë‚ ì”¨ ë§‘ìŒ â˜€ï¸</li>
                        </ol>
                    </div>
                 `;
             }
        }
        
        // ê³µí†µ ë¦¬ìŠ¤íŠ¸ HTML ìƒì„±ê¸°
        function getPostListHTML(list) {
            return list.map(p => {
                const isMood = p.type === 'mood';
                return `
                <div class="content-card" onclick="viewPost(${p.id})">
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                        <span style="font-size:10px; color:var(--primary); font-weight:bold;">${p.category || 'Mood'}</span>
                        <span style="font-size:10px; color:#999;">${p.date}</span>
                    </div>
                    <div style="display:flex; align-items:center;">
                        ${isMood ? `<div style="font-size:24px; margin-right:10px;">${p.emoji}</div>` : ''}
                        <div>
                            <h4 style="font-size:15px; margin:0 0 5px 0;">${p.title}</h4>
                            <p style="font-size:12px; color:#666; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; max-width:250px;">
                                ${p.content.substring(0, 30)}${p.content.length > 30 ? '...' : ''}
                            </p>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }
    </script>
</body>
</html>
