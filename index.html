<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ììœ ì˜ì§€: íœ´ì‹ ê¸°ë¡</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* --- 1. ë³€ìˆ˜ ë° ê¸°ë³¸ ìŠ¤íƒ€ì¼ --- */
        :root {
            /* 1. 'ìíœ´ë ˆí„°', 'ìíœ´ë©' ì»¬ëŸ¬ ë³€ê²½ ìš”ì²­ ë°˜ì˜ */
            --primary: #8B5CF6; /* ë³´ë¼ìƒ‰ (ê¸°ì¡´ ìœ ì§€) */
            --primary-dark: #6D28D9;
            --accent: #F59E0B; /* ì£¼í™© */
            --background: #F3F4F6;
            --text-dark: #1F2937;
            --text-light: #6B7280;
            --border-color: #E5E7EB;
            
            /* 1. ìš”ì²­í•˜ì‹  'ìíœ´ë ˆí„°' ë³´ë¼ìƒ‰, 'ìíœ´ë©' í•‘í¬ìƒ‰ */
            --letter-color: var(--primary); /* ë³´ë¼ìƒ‰ */
            --lab-color: #F472B6; /* í•‘í¬ìƒ‰ */ 
        }
        body {
            /* 4. ê¸€ê¼´ í†µì¼: ë§‘ì€ ê³ ë”• */
            font-family: "Malgun Gothic", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background);
            color: var(--text-dark);
            overflow-x: hidden;
            touch-action: pan-y;
        }
        #appContainer {
            max-width: 500px;
            margin: 0 auto;
            min-height: 100vh;
            background-color: white;
            padding-bottom: 80px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
            display: none;
        }

        /* --- 2. ë¡œë”© ìŠ¤í¬ë¦° --- */
        #loadingScreen {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #F9FAFB, #EDE9FE);
            transition: opacity 0.5s ease-in-out;
            opacity: 1;
        }
        #loadingScreen i {
            font-size: 3rem;
            color: var(--primary);
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.7; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 0.7; }
        }

        /* --- 3. í—¤ë” ë° ë„¤ë¹„ê²Œì´ì…˜ --- */
        .header-section {
            padding: 20px;
            background-color: white;
            border-bottom: 1px solid var(--border-color);
        }
        .header-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-dark);
        }
        .header-sub {
            font-size: 14px;
            color: var(--text-light);
            margin-top: 4px;
        }

        .navbar {
            position: fixed;
            bottom: 0;
            width: 100%;
            max-width: 500px;
            height: 60px;
            background-color: white;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-around;
            align-items: center;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
            z-index: 100;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-light);
            transition: color 0.3s;
            flex-grow: 1;
            height: 100%;
        }
        .nav-item i {
            font-size: 18px;
        }
        .nav-item span {
            font-size: 10px;
            margin-top: 4px;
        }
        .nav-item.active {
            color: var(--primary);
        }
        
        #writeIcon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background-color: var(--accent);
            color: white;
            border-radius: 50%;
            display: none;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            box-shadow: 0 4px 8px rgba(245, 158, 11, 0.4);
            z-index: 110;
            cursor: pointer;
        }

        /* --- 4. ì½˜í…ì¸  ìŠ¤íƒ€ì¼ --- */
        .content-card {
            background-color: var(--background);
            padding: 15px;
            margin: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .content-card:hover {
            background-color: #E5E7EB;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        .btn-primary:hover {
            background-color: var(--primary-dark);
        }
        .input-box {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 14px;
        }
        
        /* ë§ˆì´í˜ì´ì§€/ëŒ€ì‹œë³´ë“œ íƒ­ */
        .mypage-tabs {
            display: flex;
            justify-content: space-around;
            padding: 0 20px;
            border-bottom: 1px solid var(--border-color);
            margin-top: 10px;
        }
        .mypage-tab {
            padding: 10px 0;
            cursor: pointer;
            color: var(--text-light);
            font-weight: 500;
            border-bottom: 3px solid transparent;
            transition: color 0.2s, border-bottom-color 0.2s;
        }
        .mypage-tab.active {
            color: var(--primary-dark);
            border-bottom-color: var(--primary);
        }

        /* ì—ë””í„° í•„í„° íƒ­ */
        .editor-filter-tabs {
            display: flex;
            padding: 0 20px 10px;
            overflow-x: auto;
            gap: 8px;
            white-space: nowrap;
        }
        .editor-tab {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        .editor-tab.active {
            background-color: var(--accent);
            color: white !important;
            border-color: var(--accent);
        }

        /* ìŠ¤íƒ¬í”„ ë³´ë“œ */
        .stamp-board {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            padding: 10px 0;
        }
        .stamp-cell {
            aspect-ratio: 1 / 1;
            background-color: #FEE2E2;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #FCA5A5;
            font-size: 1.2rem;
            border: 1px solid #FECACA;
        }
        .stamp-cell.stamped {
            background-color: #6D28D9;
            color: white;
            border: 1px solid var(--primary-dark);
        }
        
        /* ë¬´ë“œ íƒœê·¸ */
        #moodTagSelector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 10px 0;
            justify-content: center;
        }
        .mood-tag {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: opacity 0.2s;
        }
        .mood-tag.selected {
            border: 2px solid var(--accent);
            box-shadow: 0 0 5px rgba(245, 158, 11, 0.5);
        }


        /* --- 5. ëª¨ë‹¬ ìŠ¤íƒ€ì¼ --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 200;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            transform: translateY(-20px);
            transition: transform 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        .modal-overlay.show .modal-content {
            transform: translateY(0);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
        }
        
        /* ìƒì„¸ í˜ì´ì§€ */
        #postDetailModal .modal-content {
            height: 90vh;
            max-height: 700px;
            display: flex;
            flex-direction: column;
        }
        #postDetailBody {
            overflow-y: auto;
            padding-right: 5px;
        }
        .detail-meta {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 10px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }
        #detailImage {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-top: 15px;
            background: #eee;
        }
        #detailContent {
            margin: 15px 0;
            line-height: 1.6;
            font-size: 14px;
        }
        .interaction-bar {
            display: flex;
            justify-content: space-between;
            border-top: 1px solid var(--border-color);
            padding-top: 10px;
            margin-top: 10px;
        }
        .interaction-btn {
            background: none;
            border: 1px solid var(--border-color);
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            color: var(--text-light);
            transition: all 0.2s;
        }
        .interaction-btn i { margin-right: 5px; }

        /* ëŒ“ê¸€ */
        .comment-item {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
            font-size: 13px;
        }
        .comment-meta {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: var(--text-light);
            margin-bottom: 5px;
        }
        .reply-btn {
            color: var(--primary);
            cursor: pointer;
            font-weight: bold;
        }
        .reply-section {
            padding-left: 15px;
            border-left: 2px solid var(--border-color);
            margin-top: 10px;
        }
        .reply-item {
            padding: 5px 0;
            border-top: 1px dotted #eee;
            margin-top: 5px;
        }
        .reply-input-group {
            display: flex;
            gap: 5px;
            margin-top: 10px;
            align-items: center;
        }
        .comment-input-area {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        /* 2. ë¬´ë“œ ì„±ê³µ íŒì—… (ìˆ˜ì • ë°˜ì˜) */
        #moodSuccessModal .modal-content {
            background-color: #FBCFE8; /* ì˜ˆìœ í•‘í¬ìƒ‰ */
            text-align: center;
            padding: 30px 20px;
            border: 2px solid #EC4899;
        }
        #moodSuccessModal h2 {
            font-size: 22px; /* ë¬¸êµ¬ í¬ê¸° ì¡°ê¸ˆ í‚¤ì›Œì£¼ê³  */
            color: #831843;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        #moodSuccessModal .close-btn {
            background: #EC4899;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            margin-top: 15px;
            cursor: pointer;
            display: inline-block;
            font-weight: bold;
        }
        
        /* 9. ì•Œë¦¼ íŒì—… (ì‹ ê·œ & ë°˜ì‘í˜• í˜ì´ë“œì¸) */
        #notificationModal {
            position: fixed;
            top: 20px;
            left: 50%;
            /* ìƒ¤ë¼ë½ í˜ì´ë“œì¸/ì•„ì›ƒì„ ìœ„í•œ ì´ˆê¸° ìœ„ì¹˜ ì„¤ì • */
            transform: translateX(-50%) translateY(-100vh); 
            max-width: 90%;
            width: 350px;
            z-index: 300;
            opacity: 0;
            transition: transform 0.5s cubic-bezier(0.25, 0.8, 0.25, 1), opacity 0.5s ease-in-out;
        }
        #notificationModal.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        #notificationModal .modal-content {
            background-color: #FBCFE8; /* í•‘í¬ìƒ‰ */
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            /* ì•Œë¦¼ íŒì—…ì€ ì‘ê²Œ ë– ì•¼ í•˜ë¯€ë¡œ, ëª¨ë‹¬ ê¸°ë³¸ íŠ¸ëœì§€ì…˜ ì œì™¸ */
            transform: none;
            transition: none;
        }
        #notificationModal h4 {
            font-size: 15px;
            color: #831843;
            margin: 0 0 10px 0;
            font-weight: bold;
        }
        #notificationModal .notification-item {
             font-size: 13px;
             color: #A16207;
             margin-bottom: 8px;
             padding-bottom: 5px;
             border-bottom: 1px solid #FCD7D7;
        }
        #notificationModal .action-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }
        #notificationModal .action-btn {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            border: none;
            font-weight: bold;
        }
        #notificationModal .btn-view {
            background: #FBBF24;
            color: #831843;
        }
        /* 9. ì°½ ë‹«ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #notificationModal .btn-close-x {
             background: none;
             border: none;
             font-size: 18px;
             color: #831843;
             cursor: pointer;
             padding: 0;
        }

    </style>
</head>
<body>

    <div id="loadingScreen">
        <i class="fas fa-heart"></i>
    </div>

    <div id="appContainer">
        </div>

    <div class="navbar">
        <div id="nav-home" class="nav-item active" onclick="renderTab('home')">
            <i class="fas fa-home"></i>
            <span>í™ˆ</span>
        </div>
        <div id="nav-letter" class="nav-item" onclick="renderTab('letter', 'all')">
            <i class="fas fa-book-open"></i>
            <span>ë ˆí„°</span> </div>
        <div id="writeIcon" onclick="handleWriteIconClick()">
            <i class="fas fa-pen"></i>
        </div>
        <div id="nav-mood" class="nav-item" onclick="renderTab('mood')">
            <i class="fas fa-calendar-check"></i>
            <span>ë¬´ë“œ</span>
        </div>
        <div id="nav-editorTalk" class="nav-item" onclick="renderTab('editorTalk', 'all')">
            <i class="fas fa-comments"></i>
            <span>ì—ë””í„°í†¡</span>
        </div>
        <div id="nav-mypage" class="nav-item" onclick="renderTab('mypage')">
            <i class="fas fa-user"></i>
            <span>ë§ˆì´</span>
        </div>
    </div>

    <div id="loginModal" class="modal-overlay" onclick="if(event.target.id === 'loginModal') closeModal()">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ë¡œê·¸ì¸</h2>
                <button class="modal-close" onclick="showSignupModal()"><i class="fas fa-user-plus"></i></button>
            </div>
            <input type="email" id="loginEmail" class="input-box" placeholder="ì´ë©”ì¼ ì£¼ì†Œ">
            <input type="password" id="loginPassword" class="input-box" placeholder="ë¹„ë°€ë²ˆí˜¸">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <label style="font-size:12px;"><input type="checkbox" id="saveLoginInfo" style="margin-right:5px;">ë¡œê·¸ì¸ ì •ë³´ ì €ì¥</label>
                <a href="#" onclick="showFindPasswordModal()" style="font-size:12px; color:var(--text-light);">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
            </div>
            <button class="btn-primary" style="width:100%;" onclick="handleLogin()">ë¡œê·¸ì¸</button>
        </div>
    </div>

    <div id="signupModal" class="modal-overlay" onclick="if(event.target.id === 'signupModal') closeModal()">
        <div class="modal-content">
            <div class="modal-header">
                <h2>íšŒì›ê°€ì…</h2>
                <button class="modal-close" onclick="showLoginModal()"><i class="fas fa-times"></i></button>
            </div>
            <input type="text" id="signupNickname" class="input-box" placeholder="ë‹‰ë„¤ì„">
            <input type="email" id="signupEmail" class="input-box" placeholder="ì´ë©”ì¼ ì£¼ì†Œ">
            <input type="password" id="signupPassword" class="input-box" placeholder="ë¹„ë°€ë²ˆí˜¸ (4ì ì´ìƒ)">
            <button class="btn-primary" style="width:100%;" onclick="handleSignup()">ê°€ì…í•˜ê¸°</button>
        </div>
    </div>
    
    <div id="findPasswordModal" class="modal-overlay" onclick="if(event.target.id === 'findPasswordModal') closeModal()">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</h2>
                <button class="modal-close" onclick="showLoginModal()"><i class="fas fa-times"></i></button>
            </div>
            <p style="font-size:13px; color:var(--text-light); margin-bottom:15px;">ë“±ë¡ëœ ì´ë©”ì¼ë¡œ ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.</p>
            <input type="email" id="findPasswordEmail" class="input-box" placeholder="ê°€ì… ì‹œ ì‚¬ìš©í•œ ì´ë©”ì¼ ì£¼ì†Œ">
            <button class="btn-primary" style="width:100%;" onclick="handleFindPassword()">ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ ë°›ê¸°</button>
        </div>
    </div>
    <div id="changePasswordModal" class="modal-overlay" onclick="if(event.target.id === 'changePasswordModal') closeModal()">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h2>
                <button class="modal-close" onclick="closeModal()"><i class="fas fa-times"></i></button>
            </div>
            <input type="password" id="currentPassword" class="input-box" placeholder="í˜„ì¬ ë¹„ë°€ë²ˆí˜¸">
            <input type="password" id="newPassword" class="input-box" placeholder="ìƒˆë¡œìš´ ë¹„ë°€ë²ˆí˜¸ (4ì ì´ìƒ)">
            <input type="password" id="confirmNewPassword" class="input-box" placeholder="ìƒˆë¡œìš´ ë¹„ë°€ë²ˆí˜¸ í™•ì¸">
            <button class="btn-primary" style="width:100%;" onclick="handleChangePassword()">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì™„ë£Œ</button>
        </div>
    </div>


    <div id="writeModal" class="modal-overlay" onclick="if(event.target.id === 'writeModal') closeModal()">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="writeTitle">ê¸€ì“°ê¸°</h2>
                <button class="modal-close" onclick="closeModal()"><i class="fas fa-times"></i></button>
            </div>
            <input type="hidden" id="editPostId">

            <select id="postCategory" class="input-box" style="display:none;">
                <option value="ìíœ´ë ˆí„°">ìíœ´ë ˆí„°</option>
                <option value="ìíœ´ë©">ìíœ´ë©</option>
            </select>

            <input type="text" id="postTitle" class="input-box" placeholder="ì œëª©">

            <div id="moodSection" style="display:none;">
                <p style="font-size:12px; margin-top:5px; font-weight:bold;">ì˜¤ëŠ˜ì˜ ê¸°ë¶„ì€?</p>
                <div id="moodTagSelector">
                    </div>
            </div>

            <textarea id="postContent" class="input-box" placeholder="ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" rows="5" style="resize:none;"></textarea>
            
            <div id="photoAttachment" style="display:none; margin-bottom:15px;">
                 <label for="postImage" style="display:block; font-size:13px; font-weight:bold; margin-bottom:5px;">ğŸ–¼ï¸ ì‚¬ì§„ ì²¨ë¶€ (ì„ íƒ)</label>
                 <input type="file" id="postImage" accept="image/*" style="width:100%; border:1px solid #ddd; padding:8px; border-radius:8px;">
            </div>

            <button class="btn-primary" style="width:100%;" onclick="submitPost()">ë“±ë¡í•˜ê¸°</button>
        </div>
    </div>

    <div id="postDetailModal" class="modal-overlay" onclick="if(event.target.id === 'postDetailModal') closeModal()">
        <div class="modal-content">
            <div class="modal-header" style="flex-shrink:0;">
                <h2 id="detailCategory" style="color:var(--primary); font-size:16px;">Category</h2>
                <button class="modal-close" onclick="closeModal()"><i class="fas fa-times"></i></button>
            </div>
            <div id="postDetailBody">
                <h1 id="detailTitle" style="font-size:22px; margin-bottom:0;">ê²Œì‹œë¬¼ ì œëª©</h1>
                <div class="detail-meta">
                    <div>
                        <span>ì‘ì„±ì: <b id="detailAuthor"></b></span>
                        <span style="margin-left:15px;">ë‚ ì§œ: <b id="detailDate"></b></span>
                    </div>
                    <div id="manageButtons" style="display:none; gap:10px;">
                        <button class="btn-primary" style="padding:4px 8px; font-size:12px; background:#F59E0B;" onclick="editPost()">ìˆ˜ì •</button>
                        <button class="btn-primary" style="padding:4px 8px; font-size:12px; background:#EF4444;" onclick="deletePost()">ì‚­ì œ</button>
                    </div>
                </div>
                
                <img id="detailImage" alt="ì²¨ë¶€ ì´ë¯¸ì§€" style="display:none;">
                
                <div id="detailContent">
                    ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                </div>
                
                <div class="interaction-bar">
                    <div style="display:flex; gap:10px;">
                        <button id="btnLike" class="interaction-btn" onclick="toggleLike()">
                            <i class="fas fa-heart"></i> ì¢‹ì•„ìš” (<span id="likeCount">0</span>)
                        </button>
                        <button id="btnBookmark" class="interaction-btn" onclick="toggleBookmark()">
                            <i class="fas fa-bookmark"></i> ë¶ë§ˆí¬
                        </button>
                    </div>
                </div>

                <h3 style="font-size:16px; margin-top:20px;">ëŒ“ê¸€</h3>
                <div id="commentList">
                    </div>
                
                <div class="comment-input-area">
                    <input type="text" id="commentInput" class="input-box" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..." style="flex-grow:1; margin-bottom:0;">
                    <button class="btn-primary" style="width:60px; height:40px; margin-bottom:0;" onclick="submitComment(null)">ë“±ë¡</button>
                </div>
                
            </div>
        </div>
    </div>
    
    <div id="moodSuccessModal" class="modal-overlay" onclick="if(event.target.id === 'moodSuccessModal') closeMoodSuccessModal()">
        <div class="modal-content">
            <h2>ë¬´ë“œ ë“±ë¡ ì™„ë£Œ! ìŠ¤íƒ¬í”„ê°€ ì ë¦½ë˜ì—ˆìŠµë‹ˆë‹¤! â¤ï¸</h2>
            <div class="close-btn" onclick="closeMoodSuccessModal()">í™•ì¸</div>
        </div>
    </div>
    
    <div id="notificationModal" class="modal-overlay">
        <div class="modal-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                 <h4 id="notificationTitle">ìƒˆë¡œìš´ í™œë™ ì•Œë¦¼!</h4>
                 <button class="action-btn btn-close-x" onclick="closeNotificationModal()"><i class="fas fa-times"></i></button>
            </div>
            <div id="notificationList">
                 </div>
            <div class="action-group">
                <button class="action-btn btn-view" onclick="handleNotificationClick()">ëŒ“ê¸€ ë³´ê¸°</button> 
            </div>
        </div>
    </div>


    <script>
        // --- ë°ì´í„° ë° ìƒíƒœ ê´€ë¦¬ ---
        const SUPER_ADMIN = 'happxi@jahyu.com';
        const EDITORS = {
            'happxi@jahyu.com': 'í–…ì”¨', 'elly@jahyu.com': 'ì—˜ë¦¬', 'gokal@jahyu.com': 'ê³ ì¹¼', 
            'sunny@jahyu.com': 'ì¨ë‹ˆ', 'yudan@jahyu.com': 'ìœ ë‹¨'
        };
        const ADMINS = Object.keys(EDITORS);
        
        // 20ê°€ì§€ íŒŒìŠ¤í…”í†¤ ê·€ì—¬ìš´ íƒ€ì´í¬ê·¸ë˜í”¼ (ë¬´ë“œ íƒœê·¸)
        const MOOD_TAGS = [
            { text: '#í–‰ë³µí•´', color: '#BEE3F8' }, { text: '#ì‚¬ë‘ìŠ¤ëŸ¬ì›Œ', color: '#FEEBCF' }, { text: '#ë”°ëœ»í•´', color: '#D6BCFA' },
            { text: '#í‰í™”ë¡œì›Œ', color: '#A7F3D0' }, { text: '#ê¸°ëŒ€ë¼', color: '#FDD6D9' }, { text: '#ììœ ë¡œì›Œ', color: '#BEE3F8' },
            { text: '#ì§€ë£¨í•´', color: '#D1D5DB' }, { text: '#ë‹µë‹µí•´', color: '#FECACA' }, { text: '#í”¼ê³¤í•´', color: '#A7F3D0' },
            { text: '#ìš°ìš¸í•´', color: '#BFDBFE' }, { text: '#í™”ë‚˜', color: '#FCD7D7' }, { text: '#ì‹ ë‚˜', color: '#FEF08A' },
            { text: '#íë§', color: '#E9D5FF' }, { text: '#ë°˜ê°€ì›Œ', color: '#BFDBFE' }, { text: '#ì„¤ë ˜', color: '#FDD6D9' },
            { text: '#í¸ì•ˆí•´', color: '#D1FAE5' }, { text: '#ë³µì¡í•´', color: '#BFDBFE' }, { text: '#ì§œì¦ë‚˜', color: '#FEE2E2' },
            { text: '#ì¢‹ì•„', color: '#FDD6D9' }, { text: '#í‰ë²”í•´', color: '#D1D5DB' }
        ];

        let currentUser = null;
        let users = {};
        let posts = [];
        let comments = [];
        let myLikes = [];
        let myBookmarks = [];
        let lastLoginTime = 0; // ë§ˆì§€ë§‰ ë¡œê·¸ì¸ ì‹œê°„ (ì•Œë¦¼ ì²´í¬ìš©)
        let currentViewingPostId = null;
        let currentMoodTag = null;
        let lastMoodDate = localStorage.getItem('lastMoodDate') || null;
        let pendingNotifications = []; // 9. ì²˜ë¦¬ë˜ì§€ ì•Šì€ ì•Œë¦¼ ëª©ë¡

        function saveData(key, data) {
            localStorage.setItem(`jahyu_${key}`, JSON.stringify(data));
        }
        
        function getTodayDate() {
            return new Date().toISOString().split('T')[0];
        }
        
        // --- ì´ˆê¸° ë°ì´í„° ë¡œë”© ---
        function initData() {
            const initialUsers = {
                'happxi@jahyu.com': { nickname: 'í–…ì”¨', password: 'admin123', stamps: 5, lastActive: Date.now(), totalDuration: 1200, lastLogin: 0 },
                'elly@jahyu.com': { nickname: 'ì—˜ë¦¬', password: 'admin123', stamps: 3, lastActive: Date.now(), totalDuration: 900, lastLogin: 0 },
                'user@example.com': { nickname: 'í–…ì‚', password: 'test', stamps: 12, lastActive: Date.now(), totalDuration: 2000, lastLogin: 0 }
            };
            
            const initialPosts = [
                { id: 101, type: 'letter', category: 'ìíœ´ë ˆí„°', title: '[32í˜¸] í‡´ì‚¬ í›„ ë²ˆì•„ì›ƒ', content: 'ì‰¬ì–´ë„ ì‰¬ëŠ” ê²ƒ ê°™ì§€ ì•Šì€ ë‹¹ì‹ ì—ê²Œ...', author: 'í–…ì”¨', authorId: 'happxi@jahyu.com', date: '2025-12-08', views: 50, timestamp: new Date('2025-12-08T10:00:00').getTime() },
                { id: 102, type: 'letter', category: 'ìíœ´ë©', title: 'ê¸€ì“°ê¸°ë¡œ ë§ˆìŒ ì±™ê¸°ê¸°', content: 'ë‚˜ë¥¼ ëŒì•„ë³´ëŠ” ì‹œê°„', author: 'ì—˜ë¦¬', authorId: 'elly@jahyu.com', date: '2025-12-09', views: 30, timestamp: new Date('2025-12-09T10:00:00').getTime() },
                { id: 201, type: 'talk', category: 'ì—ë””í„°í†¡', title: 'ì˜¤ëŠ˜ ë‚ ì”¨ ë§‘ìŒ â˜€ï¸', content: 'ì‚°ì±…í•˜ê¸° ë”± ì¢‹ì€ ë‚ ì”¨ë„¤ìš”!', author: 'elly@jahyu.com', authorId: 'elly@jahyu.com', date: '2025-12-10', views: 20, timestamp: new Date('2025-12-10T10:00:00').getTime() },
                { id: 301, type: 'mood', title: 'ì˜¤ëŠ˜ì˜ ë¬´ë“œ', content: 'ê¸°ë¶„ì´ ë„ˆë¬´ ì¢‹ì•„ìš”!', author: 'í–…ì‚', authorId: 'user@example.com', date: '2025-12-11', moodTag: '#í–‰ë³µí•´', tagColor: '#BEE3F8', views: 5, timestamp: new Date('2025-12-11T09:00:00').getTime() }
            ];
            
            const initialComments = [
                // í–…ì‚(user@example.com)ê°€ ì—˜ë¦¬(201) í¬ìŠ¤íŠ¸ì— ëŒ“ê¸€ì„ ë‹¬ì•˜ìŒ
                { id: 1, postId: 201, content: 'ë§ì•„ìš” ë‚ ì”¨ ë„ˆë¬´ ì¢‹ì•„ìš”!', author: 'í–…ì‚', authorId: 'user@example.com', date: '2025-12-10', parentId: null, timestamp: new Date('2025-12-10T11:00:00').getTime() },
                // í–…ì”¨(happxi@jahyu.com)ê°€ ì—˜ë¦¬(201) í¬ìŠ¤íŠ¸ì— ëŒ“ê¸€ì„ ë‹¬ì•˜ìŒ
                { id: 2, postId: 201, content: 'ì €ë„ ì‚°ì±…ê°ˆë˜ìš”!', author: 'í–…ì”¨', authorId: 'happxi@jahyu.com', date: '2025-12-10', parentId: null, timestamp: new Date('2025-12-10T12:00:00').getTime() },
                // ì—˜ë¦¬(elly@jahyu.com)ê°€ í–…ì‚(1) ëŒ“ê¸€ì— ë‹µê¸€ì„ ë‹¬ì•˜ìŒ (í–…ì‚ì—ê²Œ ì•Œë¦¼ ê°€ì•¼í•¨)
                { id: 3, postId: 201, content: 'ëŒ“ê¸€ì— ëŒ€í•œ ë‹µê¸€ í…ŒìŠ¤íŠ¸!', author: 'ì—˜ë¦¬', authorId: 'elly@jahyu.com', date: '2025-12-11', parentId: 1, timestamp: new Date('2025-12-11T10:00:00').getTime() }
            ];
            
            users = JSON.parse(localStorage.getItem('jahyu_users')) || initialUsers;
            posts = JSON.parse(localStorage.getItem('jahyu_posts')) || initialPosts;
            comments = JSON.parse(localStorage.getItem('jahyu_comments')) || initialComments;
            myLikes = JSON.parse(localStorage.getItem('jahyu_myLikes')) || [];
            myBookmarks = JSON.parse(localStorage.getItem('jahyu_myBookmarks')) || [];
            
            Object.keys(users).forEach(email => {
                const u = users[email];
                if (!u.nickname) { u.nickname = email.split('@')[0]; }
                if (u.stamps === undefined) { u.stamps = 0; }
                if (u.lastActive === undefined) { u.lastActive = Date.now(); }
                if (u.totalDuration === undefined) { u.totalDuration = 0; }
                if (u.lastLogin === undefined) { u.lastLogin = 0; }
            });
            
            posts.forEach(p => {
                if (!p.timestamp) p.timestamp = new Date(`${p.date}T12:00:00`).getTime();
                // 3. ë¬´ë“œ ê¸°ë¡ì€ ìˆ˜ì •/ì‚­ì œ ì—†ì• ëŠ” ìš”ì²­ì„ ìœ„í•œ authorId ì²˜ë¦¬
                if (p.type === 'mood') p.canEdit = false;
            });

            comments.forEach(c => {
                 if (!c.timestamp) c.timestamp = new Date(`${c.date}T12:00:00`).getTime();
            });
            
            saveData('users', users);
            saveData('posts', posts);
            saveData('comments', comments);
        }

        // --- í™œë™ ì‹œê°„ ì—…ë°ì´íŠ¸ (ëŒ€ì‹œë³´ë“œ ì‹¤ì‹œê°„ ë°˜ì˜ ë¡œì§) ---
        let lastActivityTime = Date.now();
        function updateDuration() {
            if (currentUser && users[currentUser.id]) {
                const now = Date.now();
                const elapsedSeconds = Math.floor((now - lastActivityTime) / 1000);
                
                if (elapsedSeconds > 10) { 
                    users[currentUser.id].totalDuration = (users[currentUser.id].totalDuration || 0) + elapsedSeconds;
                    users[currentUser.id].lastActive = now;
                    saveData('users', users);
                }
                lastActivityTime = now;
            }
        }
        setInterval(updateDuration, 5000); 

        // --- ì´ˆê¸°í™” ë° ë¡œê·¸ì¸ ---
        window.addEventListener('load', () => {
            initData();
            
            const saved = localStorage.getItem('jahyu_currentUser');
            if (saved) {
                 currentUser = JSON.parse(saved);
                 checkLogin(true);
                 // ë¡œë”© í™”ë©´ ìˆ¨ê¸°ê¸°
                 document.getElementById('loadingScreen').style.opacity = '0';
                 setTimeout(() => {
                     document.getElementById('loadingScreen').style.display = 'none';
                 }, 500);
                 return;
            }

            setTimeout(() => {
                const loadingScreen = document.getElementById('loadingScreen');
                if (loadingScreen) {
                    loadingScreen.style.opacity = '0';
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                        checkLogin(); 
                    }, 500);
                } else {
                    checkLogin(); 
                }
            }, 800);
        });

        function checkLogin(isLoggedIn = false) {
            const saved = localStorage.getItem('jahyu_currentUser');
            if (isLoggedIn || saved) {
                if(!currentUser) currentUser = JSON.parse(saved);
                
                updateDuration();

                document.getElementById('appContainer').style.display = 'block';
                
                // 9. ì•Œë¦¼ ì²´í¬ë¥¼ ìœ„í•´ ë§ˆì§€ë§‰ ë¡œê·¸ì¸ ì‹œê°„ ì €ì¥ í›„ ì—…ë°ì´íŠ¸
                if (users[currentUser.id]) {
                     lastLoginTime = users[currentUser.id].lastLogin || 0;
                     users[currentUser.id].lastLogin = Date.now(); // í˜„ì¬ ì‹œê°„ìœ¼ë¡œ ì—…ë°ì´íŠ¸
                     saveData('users', users);
                }
                
                renderTab('home');
                checkNotifications(); // ì•Œë¦¼ í™•ì¸
            } else {
                showLoginModal();
            }
        }
        
        function addStamp(count = 1) {
            if (users[currentUser.id]) {
                users[currentUser.id].stamps += count;
                saveData('users', users);
                return true;
            }
            return false;
        }

        // --- ëª¨ë‹¬ ì œì–´ ---
        function closeModal() { document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('show')); }
        function showLoginModal() { closeModal(); document.getElementById('loginModal').classList.add('show'); document.getElementById('appContainer').style.display = 'none'; }
        
        function showMoodSuccessModal() {
             closeModal();
             document.getElementById('moodSuccessModal').classList.add('show');
        }
        function closeMoodSuccessModal() {
             document.getElementById('moodSuccessModal').classList.remove('show');
             // íŒì—… ë‹«ì€ í›„ ë¬´ë“œ íƒ­ìœ¼ë¡œ ì´ë™
             renderTab('mood');
        }
        
        function closeNotificationModal() {
             document.getElementById('notificationModal').classList.remove('show');
        }
        
        function handleWriteIconClick() {
            const isMoodTabActive = document.getElementById('nav-mood').classList.contains('active');
            const isEditorTalkActive = document.getElementById('nav-editorTalk').classList.contains('active');
            const isLetterActive = document.getElementById('nav-letter').classList.contains('active');

            if (isMoodTabActive) {
                openModal('mood');
            } else if (isEditorTalkActive && currentUser.isAdmin) {
                // 4. ì—ë””í„°í†¡ ê¸€ì“°ê¸°
                openModal('adminWrite', 'ì—ë””í„°í†¡');
            } else if (isLetterActive && currentUser.isAdmin) {
                // 6. ë ˆí„° íƒ­ ê¸€ì“°ê¸°
                openModal('adminWrite', 'letter');
            }
        }
        
        function openModal(type, adminCategory = null) {
            if ((type === 'adminWrite' || adminCategory) && !currentUser.isAdmin) { return; }
            
            currentMoodTag = null;
            document.getElementById('editPostId').value = '';
            document.getElementById('postTitle').value = '';
            document.getElementById('postContent').value = '';
            document.getElementById('postImage').value = null;
            
            const categorySelect = document.getElementById('postCategory');
            categorySelect.style.display = 'none';
            document.getElementById('moodSection').style.display = 'none';
            document.getElementById('postTitle').style.display = 'block';
            document.getElementById('photoAttachment').style.display = 'none';

            if (type === 'mood') {
                document.getElementById('writeTitle').innerText = 'ì˜¤ëŠ˜ì˜ ë¬´ë“œ ê¸°ë¡';
                document.getElementById('moodSection').style.display = 'block';
                document.getElementById('postTitle').placeholder = 'ì œëª© (ì„ íƒ)';
                document.getElementById('photoAttachment').style.display = 'block';
                renderMoodTags();
            } else if (type === 'adminWrite') {
                document.getElementById('postTitle').placeholder = 'ì œëª© (í•„ìˆ˜)';
                
                if (adminCategory === 'ì—ë””í„°í†¡') {
                    // 4. ì—ë””í„°í†¡ ê¸€ì“°ê¸° í—¤ë” ë¬¸êµ¬ ìˆ˜ì • ë° ì¹´í…Œê³ ë¦¬ ì‚­ì œ
                    document.getElementById('writeTitle').innerText = 'ì—ë””í„°í†¡ ì‘ì„±í•˜ê¸°';
                    categorySelect.style.display = 'none'; 
                    categorySelect.value = 'ì—ë””í„°í†¡';
                } else if (adminCategory === 'letter') {
                    // 6. ë ˆí„° íƒ­ ê¸€ì“°ê¸° í—¤ë” ë¬¸êµ¬ ìˆ˜ì • ë° ì¹´í…Œê³ ë¦¬ í•„í„°ë§
                    document.getElementById('writeTitle').innerText = 'ì½˜í…ì¸  ì•„ì¹´ì´ë¸Œ';
                    categorySelect.style.display = 'block';
                    
                    // 6. ì¹´í…Œê³ ë¦¬ ì˜µì…˜ ìˆ˜ì • (ì—ë””í„°í†¡ ì‚­ì œ)
                    categorySelect.innerHTML = `
                         <option value="ìíœ´ë ˆí„°">ìíœ´ë ˆí„°</option>
                         <option value="ìíœ´ë©">ìíœ´ë©</option>
                    `;
                    categorySelect.value = 'ìíœ´ë ˆí„°';
                }
            }
            
            closeModal();
            document.getElementById('writeModal').classList.add('show');
        }

        // --- ë¡œê·¸ì¸ ---
        function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!users[email] || users[email].password !== password) {
                return alert('ì´ë©”ì¼ ì£¼ì†Œ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
            
            const u = users[email];
            currentUser = { 
                id: email, 
                name: u.nickname, 
                isSuperAdmin: email === SUPER_ADMIN,
                isAdmin: ADMINS.includes(email)
            };

            localStorage.setItem('jahyu_currentUser', JSON.stringify(currentUser));
            
            // 9. ë¡œê·¸ì¸ ì‹œ lastLoginTime ì—…ë°ì´íŠ¸ ë° ì•Œë¦¼ ì²´í¬
            updateDuration();
            lastLoginTime = users[currentUser.id].lastLogin || 0;
            users[currentUser.id].lastLogin = Date.now();
            saveData('users', users);

            closeModal();
            document.getElementById('appContainer').style.display = 'block';
            renderTab('home');
            checkNotifications();
        }

        // --- ê¸€ì“°ê¸°/ë¬´ë“œ ë“±ë¡ ---
        function submitPost() {
            const editId = document.getElementById('editPostId').value;
            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;
            const isMood = document.getElementById('moodSection').style.display !== 'none';
            
            if (!content && !isMood) return alert('ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            if (isMood && !currentMoodTag) return alert('ê¸°ë¶„ íƒœê·¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
            
            const now = Date.now();

            if (editId) {
                // ìˆ˜ì • ë¡œì§ (ìƒëµ)
                // ...
            } else {
                if (isMood && lastMoodDate === getTodayDate()) {
                    return alert('âš ï¸ ë¬´ë“œ ê¸°ë¡ì€ í•˜ë£¨ì— í•œ ë²ˆë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.\në‚´ì¼ ë‹¤ì‹œ ì°¾ì•„ì£¼ì„¸ìš”!');
                }

                const newId = now;
                let newPost = {
                    id: newId, content: content, author: currentUser.name, authorId: currentUser.id,
                    date: getTodayDate(), views: 0, timestamp: now
                };

                if (isMood) {
                    newPost.type = 'mood';
                    newPost.moodTag = currentMoodTag.text;
                    newPost.tagColor = currentMoodTag.color;
                    newPost.title = title || `${currentMoodTag.text} ë¬´ë“œ`;
                    newPost.image = document.getElementById('postImage').files.length > 0 ? 'file_selected' : null;
                    
                    addStamp(1);
                    lastMoodDate = getTodayDate();
                    localStorage.setItem('lastMoodDate', lastMoodDate);
                    
                    closeModal();
                    showMoodSuccessModal(); // 2. ì˜ˆìœ íŒì—…ì°½
                } else {
                    const category = document.getElementById('postCategory').value;
                    
                    if (!currentUser.isAdmin) { return alert('âš ï¸ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.'); }
                    if (!title) return alert('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    
                    newPost.type = (category === 'ì—ë””í„°í†¡') ? 'talk' : 'letter';
                    newPost.category = category;
                    newPost.title = title;
                    
                    addStamp(1);
                    alert('âœ… ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤! ìŠ¤íƒ¬í”„ +1');
                    closeModal();
                }
                
                posts.unshift(newPost);
                saveData('posts', posts);
            }
            
            document.getElementById('postTitle').value = '';
            document.getElementById('postContent').value = '';
            document.getElementById('postImage').value = null;
            // renderTabì€ closeMoodSuccessModalì—ì„œ í˜¸ì¶œë˜ë¯€ë¡œ ì—¬ê¸°ì„œ ìƒëµ
        }


        // --- ëŒ“ê¸€ ë° ë‹µê¸€ ë“±ë¡ ---
        function submitComment(parentId) {
            const inputId = parentId ? `replyInput_${parentId}` : 'commentInput';
            const input = document.getElementById(inputId);
            const text = input.value;
            if(!text) return;
            
            const now = Date.now();
            
            comments.push({
                id: now, postId: currentViewingPostId, content: text,
                author: currentUser.name, authorId: currentUser.id, date: getTodayDate(), parentId: parentId, timestamp: now
            });
            saveData('comments', comments);
            
            if (!parentId) {
                addStamp(1); 
                alert('âœ… ëŒ“ê¸€ ë“±ë¡ ì™„ë£Œ! ìŠ¤íƒ¬í”„ +1');
            }
            
            input.value = '';
            renderComments();
        }

        // --- ê²Œì‹œë¬¼ ìƒì„¸ ë³´ê¸° (ë¬´ë“œ ì—´ëŒ ê¶Œí•œ ë°˜ì˜) ---
        function viewPost(id) {
            const post = posts.find(p => p.id == id);
            if (!post) return;

            const isMoodPost = post.type === 'mood';
            // ë¬´ë“œ ê²Œì‹œë¬¼ ì—´ëŒ ê¶Œí•œ ì²´í¬ (ë³¸ì¸ ë˜ëŠ” ìŠˆí¼ ê´€ë¦¬ì)
            if (isMoodPost && !(currentUser.id === post.authorId || currentUser.isSuperAdmin)) {
                return alert('âš ï¸ ì´ ë¬´ë“œ ê¸°ë¡ì€ ë³¸ì¸(ì‘ì„±ì) ë˜ëŠ” ìŠˆí¼ ê´€ë¦¬ì(í–…ì”¨)ë§Œ ì—´ëŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            }

            currentViewingPostId = id;
            document.getElementById('detailCategory').innerText = post.category || 'Mood';
            document.getElementById('detailTitle').innerText = post.title;
            
            const authorNickname = users[post.authorId] ? users[post.authorId].nickname : post.author;
            document.getElementById('detailAuthor').innerText = authorNickname;
            document.getElementById('detailDate').innerText = post.date;
            
            let contentHtml = post.content;
            document.getElementById('detailImage').style.display = 'none';

            // 3. ë¬´ë“œ ê¸°ë¡ì€ ìˆ˜ì •/ì‚­ì œ ê¸°ëŠ¥ ì—†ì• ê¸° ìš”ì²­ ë°˜ì˜
            const btnGroup = document.getElementById('manageButtons');
            if (isMoodPost) {
                btnGroup.style.display = 'none';
            } else if (currentUser.isAdmin || currentUser.id === post.authorId) {
                btnGroup.style.display = 'flex';
            } else {
                btnGroup.style.display = 'none';
            }
            
            // ë¬´ë“œ í¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ë§ (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
            if (isMoodPost) {
                contentHtml = `<div style="font-size:14px; text-align:center; padding:15px; border-radius:15px; background: ${post.tagColor || '#eee'}; color: var(--text-dark); margin-bottom: 15px; font-weight: bold;">${post.moodTag}</div>` + contentHtml;
                if (post.image) {
                     document.getElementById('detailImage').src = 'https://via.placeholder.com/400x200?text=Selected+Mood+Image'; 
                     document.getElementById('detailImage').style.display = 'block';
                }
            }
            document.getElementById('detailContent').innerHTML = contentHtml;
            
            // ì¡°íšŒìˆ˜ ì¦ê°€
            post.views = (post.views || 0) + 1;
            saveData('posts', posts);

            closeModal(); 
            setTimeout(() => document.getElementById('postDetailModal').classList.add('show'), 50);
            
            updateInteractionButtons();
            renderComments();
        }

        // --- íƒ­ ë Œë”ë§ ---
        function renderTab(tab) {
            if (!currentUser) return showLoginModal();

            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById(`nav-${tab}`).classList.add('active');

            const writeIcon = document.getElementById('writeIcon');
            if (tab === 'mood') {
                 writeIcon.style.display = 'flex';
            } else if (tab === 'editorTalk' && currentUser.isAdmin) {
                 writeIcon.style.display = 'flex';
            } else if (tab === 'letter' && currentUser.isAdmin) {
                 writeIcon.style.display = 'flex';
            } else {
                 writeIcon.style.display = 'none';
            }

            const container = document.getElementById('appContainer');
            container.innerHTML = '';
            window.scrollTo(0,0);
            
            updateDuration();

            if (tab === 'home') {
                const greeting = `${currentUser.name}ë‹˜ ë°˜ê°€ì›Œìš”!`;
                
                container.innerHTML = `
                    <div class="header-section">
                        <div class="header-title">${greeting}</div>
                        <div class="header-sub">ì˜¤ëŠ˜ì€ ë” í–‰ë³µí•˜ì„¸ìš”!</div>
                    </div>
                    <div class="content-card" style="text-align:center;">
                        <h3 style="margin-bottom: 15px;">ì˜¤ëŠ˜ì€ ì–´ë–¤ íœ´ì‹ì´ í•„ìš”í•˜ì„¸ìš”?</h3>
                        <div style="display:flex; justify-content:center; gap:10px;">
                            <button class="btn-primary" style="flex:1; margin:0; background:var(--letter-color); color:white;" onclick="renderTab('letter', 'ìíœ´ë ˆí„°')">ìíœ´ë ˆí„°</button>
                            <button class="btn-primary" style="flex:1; margin:0; background:var(--lab-color); color:white;" onclick="renderTab('letter', 'ìíœ´ë©')">ìíœ´ë©</button>
                        </div>
                        <p style="font-size:11px; color:#999; margin-top:10px;">ìíœ´ë ˆí„°ì™€ ìíœ´ë©ì„ ì£¼ì œë³„ë¡œ í•œ ëˆˆì—!</p>
                    </div>
                    <div style="padding:0 20px;">
                        <h4 style="margin:15px 0;">ìµœê·¼ ê²Œì‹œê¸€</h4>
                        ${getPostListHTML(posts.filter(p => p.type !== 'mood').slice(0, 3))}
                    </div>
                `;
            } else if (tab === 'letter') {
                const categoryFilter = arguments[1] || 'all'; 
                const filteredPosts = posts.filter(p => p.category === 'ìíœ´ë ˆí„°' || p.category === 'ìíœ´ë©').filter(p => categoryFilter === 'all' || p.category === categoryFilter);

                container.innerHTML = `
                    <div class="header-section">
                        <div class="header-title">ìíœ´ ì½˜í…ì¸  ì•„ì¹´ì´ë¸Œ</div> 
                        <div class="header-sub">ìíœ´ë ˆí„°ì™€ ìíœ´ë©ì„ ì£¼ì œë³„ë¡œ ë³¼ ìˆ˜ ìˆì–´ìš”</div>
                    </div>
                    
                    <div class="mypage-tabs">
                        <div class="mypage-tab ${categoryFilter === 'all' ? 'active' : ''}" onclick="renderTab('letter', 'all')">ì „ì²´</div>
                        <div class="mypage-tab ${categoryFilter === 'ìíœ´ë ˆí„°' ? 'active' : ''}" onclick="renderTab('letter', 'ìíœ´ë ˆí„°')">ìíœ´ë ˆí„°</div>
                        <div class="mypage-tab ${categoryFilter === 'ìíœ´ë©' ? 'active' : ''}" onclick="renderTab('letter', 'ìíœ´ë©')">ìíœ´ë©</div>
                    </div>

                    <div style="padding:0 20px;">${getPostListHTML(filteredPosts)}</div>
                `;
            } else if (tab === 'mypage') {
                renderMyPage(container);
            } else if (tab === 'editorTalk') {
                // ê¸°ì¡´ ì—ë””í„°í†¡ íƒ­ ë¡œì§ ìœ ì§€
                // ...
            }
        }
        
        // --- ë§ˆì´í˜ì´ì§€ ---
        function renderMyPage(container) {
            const user = users[currentUser.id];
            const currentStamps = user ? user.stamps : 0;
            
            container.innerHTML = `
                <div class="header-section">
                    <div class="header-title">ë§ˆì´í˜ì´ì§€</div>
                    <div class="header-sub">${currentUser.name}ë‹˜ (${currentUser.id})</div>
                    ${currentUser.isSuperAdmin ? '<span style="background:#4338CA; color:white; padding:2px 8px; border-radius:10px; font-size:10px; margin-top:5px;">ìŠˆí¼ ê´€ë¦¬ì</span>' : (currentUser.isAdmin ? '<span style="background:#E0E7FF; color:#4338CA; padding:2px 8px; border-radius:10px; font-size:10px; margin-top:5px;">ê´€ë¦¬ì</span>' : '')}
                </div>
                
                ${currentUser.isSuperAdmin ? `
                    <div class="content-card" onclick="renderAdminDashboard()">
                        <h3 style="color:var(--primary-dark);">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h3>
                        <p style="font-size:12px; color:#666; margin-top:5px;">ëª¨ë“  ì‚¬ìš©ì ê¸°ë¡ ë° í†µê³„ ë¶„ì„</p>
                    </div>
                ` : ''}
                
                <div class="mypage-tabs">
                </div>

                <div id="mypageContent" style="padding: 0 20px;"></div>
                <div style="padding: 20px;">
                </div>
            `;
            // loadMyContent('posts');
        }
        
        // --- 8. í–…ì”¨ ìŠˆí¼ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ---
        function renderAdminDashboard() {
            if (!currentUser.isSuperAdmin) { return alert('âš ï¸ ìŠˆí¼ ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.'); }
            
            const container = document.getElementById('appContainer');
            container.innerHTML = `
                <div class="header-section">
                    <div class="header-title">ìŠˆí¼ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</div>
                    <div class="header-sub">í–…ì”¨ë‹˜, ëª¨ë“  ë°ì´í„°ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.</div>
                </div>
                
                <div class="mypage-tabs" id="adminDashboardTabs">
                    <div class="mypage-tab active" onclick="switchAdminDashboard(this, 'users')">ì‚¬ìš©ìë³„ ê¸°ë¡</div>
                    <div class="mypage-tab" onclick="switchAdminDashboard(this, 'stats')">í†µê³„</div>
                    <div class="mypage-tab" onclick="switchAdminDashboard(this, 'mood')">ë¬´ë“œ í˜„í™©</div>
                </div>

                <div id="dashboardContent" style="padding: 0 20px;"></div>
            `;
            switchAdminDashboard(document.querySelector('#adminDashboardTabs .active'), 'users');
        }

        function switchAdminDashboard(element, type) {
            document.querySelectorAll('#adminDashboardTabs .mypage-tab').forEach(el => el.classList.remove('active'));
            element.classList.add('active');
            
            if (type === 'users') {
                renderUserDashboard();
            } else if (type === 'stats') {
                renderStatsDashboard();
            } else if (type === 'mood') {
                renderMoodDashboard(); // 8. ëª¨ë“  ì‚¬ìš©ìì˜ ë¬´ë“œ ê¸°ë¡ ì—´ëŒ
            }
        }
        
        function renderUserDashboard() {
            const content = document.getElementById('dashboardContent');
            content.innerHTML = `
                <h4 style="margin-top:15px;">ì „ì²´ ì‚¬ìš©ì ëª©ë¡</h4>
                `;
        }
        
        function renderStatsDashboard() {
            const content = document.getElementById('dashboardContent');
            content.innerHTML = `
                <h4 style="margin-top:15px;">ì£¼ìš” í†µê³„</h4>
                `;
        }

        // 8. ëª¨ë“  ì‚¬ìš©ìì˜ ë¬´ë“œ ê¸°ë¡ ì—´ëŒ ê¸°ëŠ¥
        function renderMoodDashboard() {
            const content = document.getElementById('dashboardContent');
            const allMoods = posts.filter(p => p.type === 'mood').sort((a, b) => b.timestamp - a.timestamp);

            content.innerHTML = `
                <h4 style="margin-top:15px;">ì „ì²´ ë¬´ë“œ ê¸°ë¡ í˜„í™© (ì´ ${allMoods.length}ê±´)</h4>
                <p style="font-size:12px; color:#EF4444;">â€» ì´ ëª©ë¡ì€ ìŠˆí¼ ê´€ë¦¬ì(í–…ì”¨)ë‹˜ë§Œ ì—´ëŒ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                <div style="margin-top:10px;">
                    ${allMoods.length > 0 ? allMoods.map(p => {
                        const authorNickname = users[p.authorId] ? users[p.authorId].nickname : p.author;
                        return `
                            <div class="content-card" style="cursor:pointer;" onclick="viewPost(${p.id})">
                                <div style="font-size:12px; color:#666;">${authorNickname} (${p.date})</div>
                                <h5 style="margin:5px 0;">${p.title} <span style="font-size:12px; color:gray;">${p.moodTag}</span></h5>
                                <p style="font-size:13px; color:#333; overflow:hidden; white-space:nowrap; text-overflow:ellipsis;">${p.content}</p>
                            </div>
                        `;
                    }).join('') : '<p style="text-align:center; color:#999;">ê¸°ë¡ëœ ë¬´ë“œ ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>'}
                </div>
            `;
        }
        
        // --- 9. ì•Œë¦¼ ì²´í¬ ë° íŒì—… êµ¬í˜„ ë¡œì§ ---
        function checkNotifications() {
            // ë§ˆì§€ë§‰ ë¡œê·¸ì¸ ì‹œê°„ì´ ì—†ê±°ë‚˜ (ì²« ë¡œê·¸ì¸) ë§ˆì§€ë§‰ ë¡œê·¸ì¸ ì´í›„ì— í™œë™ì´ ì—†ìœ¼ë©´ ì•Œë¦¼ íŒì—… ì•ˆ ë„ì›€
            if (lastLoginTime === 0) return;

            const newComments = comments.filter(c => c.timestamp > lastLoginTime);
            pendingNotifications = [];

            newComments.forEach(comment => {
                const post = posts.find(p => p.id === comment.postId);
                if (!post) return;

                const isCommentOnUserPost = (comment.parentId === null) && (post.authorId === currentUser.id);
                
                let isReplyToUserComment = false;
                if (comment.parentId) {
                    const parentComment = comments.find(c => c.id === comment.parentId);
                    if (parentComment && parentComment.authorId === currentUser.id) {
                        isReplyToUserComment = true;
                    }
                }

                if (isCommentOnUserPost) {
                    pendingNotifications.push({
                        postId: post.id,
                        title: `[${post.title}]ì— ìƒˆ ëŒ“ê¸€ì´ ë‹¬ë ¸ìŠµë‹ˆë‹¤.`,
                        type: 'comment'
                    });
                } else if (isReplyToUserComment) {
                    pendingNotifications.push({
                        postId: post.id,
                        title: `[${post.title}] ëŒ“ê¸€ì— ë‹µê¸€ì´ ë‹¬ë ¸ìŠµë‹ˆë‹¤.`,
                        type: 'reply'
                    });
                }
            });

            // ì¤‘ë³µëœ ê²Œì‹œë¬¼ IDëŠ” í•˜ë‚˜ë¡œ ë¬¶ê³  ìµœì‹  ì•Œë¦¼ë§Œ í‘œì‹œ
            const uniqueNotifications = [];
            const processedPostIds = new Set();
            
            pendingNotifications.forEach(notif => {
                if (!processedPostIds.has(notif.postId)) {
                    uniqueNotifications.push(notif);
                    processedPostIds.add(notif.postId);
                }
            });
            
            pendingNotifications = uniqueNotifications;

            if (pendingNotifications.length > 0) {
                renderNotificationModal(pendingNotifications);
            }
        }
        
        function renderNotificationModal(notifications) {
            const list = document.getElementById('notificationList');
            const title = document.getElementById('notificationTitle');
            const viewButton = document.querySelector('#notificationModal .btn-view');

            if (notifications.length > 1) {
                title.innerText = `ì´ ${notifications.length}ê°œì˜ ìƒˆë¡œìš´ í™œë™ ì•Œë¦¼!`;
            } else {
                 title.innerText = `ìƒˆë¡œìš´ í™œë™ ì•Œë¦¼!`;
            }

            list.innerHTML = notifications.slice(0, 3).map((notif, index) => `
                <div class="notification-item" data-post-id="${notif.postId}">
                    ${notif.title}
                </div>
            `).join('');

            // 'ëŒ“ê¸€ ë³´ê¸°' ë²„íŠ¼ í´ë¦­ ì‹œ ê°€ì¥ ìµœê·¼ ì•Œë¦¼ì˜ ê²Œì‹œë¬¼ë¡œ ì´ë™
            if (notifications.length > 0) {
                 viewButton.style.display = 'block';
                 viewButton.dataset.postId = notifications[0].postId;
            } else {
                 viewButton.style.display = 'none';
            }
            
            document.getElementById('notificationModal').classList.add('show');
        }
        
        function handleNotificationClick() {
            const postId = document.querySelector('#notificationModal .btn-view').dataset.postId;
            if (postId) {
                closeNotificationModal();
                viewPost(parseInt(postId)); // 9. í´ë¦­ì‹œ í•´ë‹¹ ê²Œì‹œë¬¼ urlë¡œ ì´ë™ ì—°ë™
            }
        }

    </script>
</body>
</html>
