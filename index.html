<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ììœ ë¡œìš´ íœ´ì‹ ë ˆí„° - ìíœ´ë ˆí„°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // ğŸš¨ UPDATED: Primary Color to Pastel Blue
                        'primary-blue': { 
                            DEFAULT: '#A2D2FF', // Main accent color (Soft Sky)
                            dark: '#73A3E0',    // Darker for hover
                            light: '#EAF4FF',   // Very light for background/badge
                        },
                        'soft-cream': '#F8F8F8', // Background color (like)
                        'text-dark': '#333333',
                        'text-light': '#666666',
                    }
                }
            }
        }
    </script>
    <style>
        /* ê¸°ë³¸ ë ˆì´ì•„ì›ƒ ë° í°íŠ¸ */
        body { 
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif; 
            background-color: #F8F8F8; /* Soft Cream Background */
        }
        .app-container {
            max-width: 500px; /* ëª¨ë°”ì¼ ë·° ìµœëŒ€ í­ */
            margin: 0 auto;
            background-color: #ffffff; 
            min-height: 100vh;
            padding-bottom: 60px; /* í•˜ë‹¨ íƒ­ë°” ë†’ì´ í™•ë³´ */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
        }
        .content-area {
            padding: 16px;
        }

        /* ëª¨ë‹¬ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease-out;
        }
        .modal.show { display: flex; opacity: 1; }
        .modal-content {
            background-color: #fff;
            padding: 24px;
            border-radius: 16px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(-20px);
            transition: transform 0.3s ease-out;
        }
        .modal.show .modal-content { transform: translateY(0); }

        /* í˜ì´ì§€ ì „í™˜ ì• ë‹ˆë©”ì´ì…˜ */
        .fade-in { animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ë²„íŠ¼ í˜¸ë²„ íš¨ê³¼ */
        .btn-scale { transition: transform 0.1s ease-out; }
        .btn-scale:hover { transform: scale(1.03); }

        /* ë§ˆì´í˜ì´ì§€ íƒ­ ìŠ¤íƒ€ì¼ */
        .tab-btn {
            padding: 10px 16px;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            color: #9ca3af;
            transition: border-color 0.2s, color 0.2s;
        }
        .tab-btn.active {
            color: #A2D2FF; /* Primary Blue */
            border-bottom-color: #A2D2FF;
            font-weight: 700;
        }
        
        /* ìŠ¤íƒ¬í”„ ìŠ¤ì¼€ì¹˜ ìŠ¤íƒ€ì¼ (ë¡±ë¸”ë™ ìŠ¤íƒ€ì¼) */
        .sketch-stamp { 
            fill: none; 
            stroke: #d1d5db; /* ì—°í•œ íšŒìƒ‰ ìŠ¤ì¼€ì¹˜ */
            stroke-width: 1.5;
            transition: all 0.3s;
        }
        .stamped-icon {
            fill: #73A3E0; /* íšë“ ìŠ¤íƒ¬í”„ ìƒ‰ìƒ (Dark Blue) */
            stroke: #73A3E0;
            transition: all 0.3s;
        }
        .stamp-container { position: relative; }
        
        /* í•˜ë‹¨ íƒ­ë°” ìŠ¤íƒ€ì¼ */
        .bottom-tab-bar {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 500px;
            height: 60px;
            background-color: #ffffff;
            box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.05);
            z-index: 50;
        }
        .tab-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex-grow: 1;
            font-size: 10px;
            color: #9ca3af;
            transition: color 0.2s;
        }
        .tab-item.active {
            color: #A2D2FF; /* Primary Blue */
        }
        .tab-item svg {
            width: 24px;
            height: 24px;
            margin-bottom: 2px;
        }
        
    </style>
</head>
<body class="min-h-screen">
    <div class="app-container">

        <header class="bg-white sticky top-0 z-40 border-b border-gray-100">
            <div class="content-area py-4 flex justify-between items-center">
                <h1 onclick="navigateTo('home')" class="text-2xl font-bold text-text-dark cursor-pointer hover:opacity-80 transition-opacity">
                    ìíœ´ë ˆí„°
                </h1>
                <div id="userAuth" class="flex items-center space-x-3">
                    <button id="authBtn" onclick="toggleAuthModal()" class="text-text-light hover:text-primary-blue btn-scale text-sm">
                        ë¡œê·¸ì¸
                    </button>
                    <button id="settingBtn" class="text-text-light hover:text-primary-blue btn-scale hide">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.82 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.82 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.82-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.82-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                    </button>
                </div>
            </div>
        </header>

        <main class="content-area pt-4">
            <section id="homePage" class="fade-in">
                <h2 id="homeGreeting" class="text-2xl font-bold text-text-dark mb-2">ììœ ë¡œìš´ ë‹¹ì‹ ì˜ íœ´ì‹ ê°€ì´ë“œ</h2>
                <p class="text-sm text-text-light mb-6">ì¼ê³¼ ì‚¶ì˜ ê· í˜•, ìíœ´ë ˆí„°ê°€ ë„ì™€ë“œë¦´ê²Œìš”.</p>
                
                <div class="bg-primary-blue-light p-4 rounded-xl shadow-inner mb-8 flex flex-col items-center text-center">
                    <p class="text-sm font-medium text-text-dark mb-2">ğŸŒ¿ ë‚˜ë§Œì˜ íë§ ìœ í˜•ì„ ì°¾ì•„ë³´ì„¸ìš”!</p>
                    <a href="https://index-html-zak5.vercel.app/" target="_blank" class="bg-primary-blue text-white px-6 py-2 rounded-full font-bold shadow-md hover:bg-primary-blue-dark btn-scale text-sm">
                        íë§ ìœ í˜• í…ŒìŠ¤íŠ¸ ë°”ë¡œê°€ê¸°
                    </a>
                </div>

                <h3 class="text-xl font-bold text-text-dark mb-4">ìµœì‹  ì½˜í…ì¸ </h3>
                <div id="latestPosts" class="space-y-4">
                    <p class="text-gray-400 text-center">ìµœì‹  ê¸€ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                </div>
            </section>

            <section id="newsletterPage" class="hide fade-in">
                <h2 class="text-2xl font-bold text-text-dark mb-2">ğŸ“– ë ˆí„° ì•„ì¹´ì´ë¸Œ</h2>
                <p class="text-sm text-text-light mb-6">ììœ ë¡œìš´ íœ´ì‹ì— ëŒ€í•œ ëª¨ë“  ì´ì•¼ê¸°</p>
                
                <div class="flex space-x-3 mb-6 border-b pb-3">
                    <button data-filter="all" onclick="filterNewsletters('all')" class="filter-btn text-sm font-medium px-4 py-2 rounded-full border border-primary-blue bg-primary-blue text-white transition-colors">
                        ì „ì²´
                    </button>
                    <button data-filter="letter" onclick="filterNewsletters('letter')" class="filter-btn text-sm font-medium px-4 py-2 rounded-full border border-gray-300 text-text-light hover:bg-gray-50 transition-colors">
                        ìíœ´ë ˆí„°
                    </button>
                    <button data-filter="lab" onclick="filterNewsletters('lab')" class="filter-btn text-sm font-medium px-4 py-2 rounded-full border border-gray-300 text-text-light hover:bg-gray-50 transition-colors">
                        ìíœ´ë©
                    </button>
                </div>
                
                <div id="newsletterList" class="space-y-4">
                    </div>
            </section>

            <section id="editorTalkPage" class="hide fade-in">
                <h2 class="text-2xl font-bold text-text-dark mb-2">ğŸ’¬ ì—ë””í„° í†¡</h2>
                <p class="text-sm text-text-light mb-6">ì—ë””í„°ë“¤ì˜ ì¼ìƒì„ ë§Œë‚˜ë³´ì„¸ìš”!</p>
                <div id="editorTalkList" class="space-y-4">
                    </div>
            </section>

            <section id="momentPage" class="hide fade-in">
                <h2 class="text-2xl font-bold text-text-dark mb-2">âœ¨ ëª¨ë¨¼íŠ¸</h2>
                <p class="text-sm text-text-light mb-6">ì§§ì€ ë‹¨ìƒê³¼ ì˜ê°ì„ ê¸°ë¡í•©ë‹ˆë‹¤.</p>
                <div id="momentList" class="space-y-4">
                    </div>
            </section>
            
            <section id="myPage" class="hide fade-in">
                </section>
        </main>

        <nav class="bottom-tab-bar flex justify-around items-center">
            <button class="tab-item active" data-page="home" onclick="navigateTo('home')">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
                <span class="mt-1">í™ˆ</span>
            </button>
            <button class="tab-item" data-page="newsletter" onclick="navigateTo('newsletter')">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.206 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.832 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.832 5 16.5 5s3.332.477 4.5 1.253v13C19.832 18.477 18.168 18 16.5 18s-3.332.477-4.5 1.253"/></svg>
                <span class="mt-1">ë ˆí„°</span>
            </button>
            <button class="tab-item" data-page="editorTalk" onclick="navigateTo('editorTalk')">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.682A9.956 9.956 0 013 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
                <span class="mt-1">ì—ë””í„° í†¡</span>
            </button>
            <button class="tab-item" data-page="moment" onclick="navigateTo('moment')">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4M17 19h4M16 3h4m-4 10h4m-8 8v4m-4-4h4M3 10h4m-4 4h4m4-14v4M10 3h4m-4 10v4m-4-4h4"/></svg>
                <span class="mt-1">ëª¨ë¨¼íŠ¸</span>
            </button>
            <button class="tab-item" data-page="myPage" onclick="navigateTo('myPage')">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14c4.418 0 8 3.582 8 8H4c0-4.418 3.582-8 8-8z"/></svg>
                <span class="mt-1">ë§ˆì´</span>
            </button>
        </nav>

        <div id="postDetailModal" class="modal" onclick="closeModal(event, 'postDetailModal')">
            <div class="modal-content max-w-lg">
                <div class="flex justify-between items-start border-b pb-3 mb-4 sticky top-0 bg-white z-10">
                    <div>
                        <h2 id="postDetailTitle" class="text-xl font-bold text-text-dark"></h2>
                        <div class="text-xs text-text-light mt-1 space-x-2">
                            <span id="postDetailAuthor"></span>
                            <span>|</span>
                            <span id="postDetailDate"></span>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button id="likeBtn-POSTID" onclick="toggleLike(currentPostId)" class="p-1 btn-scale" title="ì¢‹ì•„ìš”"></button>
                        <button id="bookmarkBtn-POSTID" onclick="toggleBookmark(currentPostId)" class="p-1 btn-scale" title="ìŠ¤í¬ë©"></button>
                        <button id="stampBtn-POSTID" onclick="toggleStamp(currentPostId)" class="p-1 btn-scale" title="ìŠ¤íƒ¬í”„ íšë“"></button>
                        <button onclick="closeModal(null, 'postDetailModal')" class="text-gray-400 hover:text-text-dark ml-2">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                        </button>
                    </div>
                </div>

                <div id="postDetailContent" class="prose max-w-none mb-6 text-text-dark">
                    </div>

                <div id="commentSection" class="border-t pt-4">
                    <h3 class="text-lg font-bold text-text-dark mb-4">ëŒ“ê¸€</h3>
                    <div id="postDetailComments" class="space-y-4">
                        </div>
                    <div id="commentFormContainer">
                        </div>
                </div>
            </div>
        </div>

        <div id="authModal" class="modal" onclick="closeModal(event, 'authModal')">
            <div class="modal-content max-w-xs">
                <div class="text-center mb-6">
                    <div class="w-12 h-12 bg-primary-blue-light rounded-full flex items-center justify-center mx-auto mb-3">
                        <svg class="w-6 h-6 text-primary-blue" fill="currentColor" viewBox="0 0 20 20"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/></svg>
                    </div>
                    <h3 class="text-xl font-bold text-primary-blue">ìíœ´ë ˆí„°ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤</h3>
                    <p class="text-xs text-text-light mt-1">íë§ì´ í•„ìš”í•œ ë‹¹ì‹ ì„ ìœ„í•œ ê³µê°„</p>
                </div>
                <div id="loginForm">
                    <input type="email" id="authEmail" placeholder="ì´ë©”ì¼ (ì˜ˆ: user@jahyu.com)" class="w-full px-4 py-3 mb-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-blue">
                    <input type="password" id="authPassword" placeholder="ë¹„ë°€ë²ˆí˜¸" class="w-full px-4 py-3 mb-4 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-blue">
                    
                    <label class="flex items-center mb-6">
                        <input type="checkbox" id="keepLoggedIn" class="form-checkbox text-primary-blue border-gray-300 rounded-sm focus:ring-primary-blue">
                        <span class="ml-2 text-sm text-text-light">ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€</span>
                    </label>

                    <button onclick="handleLogin()" class="w-full bg-primary-blue text-white px-4 py-3 rounded-full font-bold shadow-md hover:bg-primary-blue-dark btn-scale mb-4">ë¡œê·¸ì¸</button>
                    
                    <div class="flex justify-between text-sm text-text-light">
                        <button onclick="showSignupScreen()" class="hover:text-primary-blue">íšŒì›ê°€ì…</button>
                        <button class="hover:text-primary-blue">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="postWriteModal" class="modal" onclick="closeModal(event, 'postWriteModal')">
            <div class="modal-content max-w-md">
                <h3 id="writeModalTitle" class="text-xl font-bold text-primary-blue mb-6">ìƒˆ ê²Œì‹œê¸€ ì‘ì„±</h3>

                <div id="categorySelectContainer" class="mb-4 hide">
                    <label class="block text-sm font-medium text-text-dark mb-1">ì¹´í…Œê³ ë¦¬ ì„ íƒ</label>
                    <select id="postCategory" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-blue">
                        </select>
                </div>

                <input type="text" id="postTitle" placeholder="ì œëª©" class="w-full px-4 py-3 mb-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-blue">
                <textarea id="postContent" rows="8" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”." class="w-full px-4 py-3 mb-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-blue"></textarea>
                
                <div id="qnaOptions" class="flex items-center mb-6 hide">
                    <input type="checkbox" id="isPrivate" class="mr-2 form-checkbox text-primary-blue border-gray-300 rounded-sm focus:ring-primary-blue">
                    <label for="isPrivate" class="text-text-light text-sm">ë¹„ë°€ê¸€ë¡œ ì‘ì„±í•˜ê¸°</label>
                </div>

                <button onclick="submitPost()" class="w-full bg-primary-blue text-white px-4 py-3 rounded-full font-bold shadow-md hover:bg-primary-blue-dark btn-scale">ì‘ì„± ì™„ë£Œ</button>
            </div>
        </div>

        <div id="stampSuccessModal" class="modal">
            </div>

        <div id="notificationContainer" class="fixed top-4 right-4 space-y-2 z-50"></div>
    </div>


<script>
    // --- Global Variables and Constants ---
    let currentPage = 'home';
    let currentUser = null; 
    let currentPostId = null;
    let posts = [];
    let comments = [];
    
    // ğŸš¨ UPDATED: í–…ì”¨ë¥¼ í¬í•¨í•œ ê´€ë¦¬ì ì´ë©”ì¼ ëª©ë¡
    const ADMIN_EDITORS = ['admin@jahyu.com', 'hr@mail.com', 'happxi@jahyu.com', 'editor2@jahyu.com', 'editor3@jahyu.com']; 

    // --- Data Initialization & Utility Functions ---

    function loadData() {
        // ì„ì‹œ ì‚¬ìš©ì ë¡œê·¸ì¸ (í…ŒìŠ¤íŠ¸ìš©)
        currentUser = { id: 'user1', name: 'í˜œë€', email: 'hr@mail.com', isAdmin: true };
        
        let newsletters = [
            { id: 'nl1', title: '[32í˜¸] í‡´ì‚¬ í›„ ë²ˆì•„ì›ƒ, ì €ë§Œ ì´ëŸ°ê°€ìš”?', content: 'í‡´ì‚¬ í›„ì—ë„ ì‰¬ì§€ ëª»í•˜ëŠ” ë‹¹ì‹ ì—ê²Œ...', authorName: 'ì—˜ë¦¬', authorEmail: 'editor2@jahyu.com', type: 'letter', category: 'letter', timestamp: Date.now() - (2 * 24 * 60 * 60 * 1000) },
            { id: 'nl2', title: '[31í˜¸] ì´ì‚¬ë¥¼ ì•ë‘” ìì·¨ìƒì„ ìœ„í•œ í•„ìˆ˜í…œ 10ê°€ì§€', content: 'ì‹¤ìš©ì ì¸ ê°€ì´ë“œ...', authorName: 'í–…ì”¨', authorEmail: 'happxi@jahyu.com', type: 'letter', category: 'letter', timestamp: Date.now() - (15 * 24 * 60 * 60 * 1000) },
            { id: 'nl3', title: '[ìíœ´ë©] ê¸€ì“°ê¸° ë…¸í•˜ìš°: ë‚´ ë§ˆìŒì„ ë‹´ëŠ” ë²•', content: 'ê¸€ì“°ê¸° íŒ ê³µìœ ...', authorName: 'ê³ ì¹¼', authorEmail: 'editor3@jahyu.com', type: 'letter', category: 'lab', timestamp: Date.now() - (5 * 24 * 60 * 60 * 1000) },
            { id: 'nl4', title: '[30í˜¸] ì›”ìš”ë³‘ ì´ê¸°ëŠ” ë²•', content: 'ì›”ìš”ì¼ ì•„ì¹¨ì„ ìƒì¾Œí•˜ê²Œ ì‹œì‘í•˜ëŠ” íŒ', authorName: 'ì—˜ë¦¬', authorEmail: 'editor2@jahyu.com', type: 'letter', category: 'letter', timestamp: Date.now() - (30 * 24 * 60 * 60 * 1000) },
            { id: 'nl5', title: '[ìíœ´ë©] ì·¨ë¯¸ë¥¼ ì¼ë¡œ ë§Œë“œëŠ” ë°©ë²•', content: 'ì·¨ë¯¸ì™€ ìˆ˜ìµì„ ë™ì‹œì— ì¡ëŠ” ë²•', authorName: 'í–…ì”¨', authorEmail: 'happxi@jahyu.com', type: 'letter', category: 'lab', timestamp: Date.now() - (40 * 24 * 60 * 60 * 1000) },
        ];
        
        posts = [
            { id: 'p1', title: 'ë¹„ë°€ê¸€ ê¸°ëŠ¥ ë¬¸ì˜', content: 'ë¹„ë°€ê¸€ë¡œ ì‘ì„±í•˜ë©´ ì €ë‘ ê´€ë¦¬ìë§Œ ë³¼ ìˆ˜ ìˆë‚˜ìš”?', authorId: 'user1', authorName: 'í˜œë€', authorEmail: 'hr@mail.com', type: 'qna', timestamp: Date.now() - (1 * 60 * 60 * 1000), commentCount: 1, isPrivate: true, category: 'qna' },
            { id: 'p2', title: 'ì¼ì£¼ì¼ ì˜ ë²„í‹°ì…¨ë‚˜ìš”?', content: 'ì£¼ë§ì—ëŠ” ì•„ë¬´ ìƒê° ì—†ì´ ì‰¬ì–´ì•¼ í•´ìš”!', authorId: 'editor2', authorName: 'ì—˜ë¦¬', authorEmail: 'editor2@jahyu.com', type: 'editorTalk', timestamp: Date.now() - (2 * 24 * 60 * 60 * 1000), commentCount: 3, isPrivate: false, category: 'editorTalk' },
            { id: 'p3', title: 'ì¢‹ì•„í•˜ëŠ” ë…¸ë˜ë¥¼ ë“¤ìœ¼ë©°', content: 'ì´ ë…¸ë˜ë¥¼ ë“¤ì„ ë•Œë§ˆë‹¤ ë§ˆìŒì´ í¸í•´ì§‘ë‹ˆë‹¤.', authorId: 'editor3', authorName: 'ê³ ì¹¼', authorEmail: 'editor3@jahyu.com', type: 'moment', timestamp: Date.now() - (4 * 24 * 60 * 60 * 1000), commentCount: 0, isPrivate: false, category: 'moment' },
            { id: 'p4', title: 'ììœ ë¡œìš´ íœ´ì‹ íŒì„ ì£¼ì„¸ìš”!', content: 'ìê¾¸ ë¬´ì–¸ê°€ë¥¼ í•˜ë ¤ê³  í•´ìš”.', authorId: 'user2', authorName: 'ì§ì¥ì¸A', authorEmail: 'user2@mail.com', type: 'qna', timestamp: Date.now() - (6 * 24 * 60 * 60 * 1000), commentCount: 1, isPrivate: false, category: 'qna' },
            { id: 'p5', title: 'í‡´ê·¼ í›„ ë§¥ì£¼ í•œ ìº”ì˜ í–‰ë³µ', content: 'ì†Œì†Œí•œ í–‰ë³µì…ë‹ˆë‹¤.', authorId: 'user1', authorName: 'í˜œë€', authorEmail: 'hr@mail.com', type: 'moment', timestamp: Date.now() - (8 * 24 * 60 * 60 * 1000), commentCount: 0, isPrivate: false, category: 'moment' },
        ];
        
        posts = [...newsletters, ...posts];

        let likedItems = {
            'p2': { isLiked: true }, 
            'p5': { isLiked: true },
            'nl1': { isBookmarked: true, isStamped: true }, // ìŠ¤íƒ¬í”„ íšë“
            'nl3': { isStamped: true }, // ìŠ¤íƒ¬í”„ íšë“
            'nl5': { isStamped: true },
            'p3': { isBookmarked: true }, 
        };
        
        comments = [
            { id: 'c1', postId: 'p1', authorName: 'ê´€ë¦¬ì', authorEmail: 'happxi@jahyu.com', content: 'ë„¤, ë¹„ë°€ê¸€ë¡œ ì‘ì„±í•˜ì‹œë©´ ì‘ì„±ìë‹˜ê³¼ ê´€ë¦¬ìë§Œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.', timestamp: Date.now() - (30 * 60 * 1000) },
            { id: 'c2', postId: 'p2', authorName: 'í˜œë€', authorEmail: 'hr@mail.com', content: 'ë•ë¶„ì— ì˜ ë²„í…¼ìŠµë‹ˆë‹¤! ì£¼ë§ ê¿€íœ´ì‹!', timestamp: Date.now() - (1 * 24 * 60 * 60 * 1000) },
            { id: 'c3', postId: 'p4', authorName: 'ê´€ë¦¬ì', authorEmail: 'admin@jahyu.com', content: 'íœ´ì‹ë„ ì—°ìŠµì´ í•„ìš”í•´ìš”. ê°€ë³ê²Œ ì‚°ì±…ë¶€í„° ì‹œì‘í•´ë³´ì„¸ìš”.', timestamp: Date.now() - (3 * 24 * 60 * 60 * 1000) },
        ];
        
        // ì´ˆê¸° í™”ë©´ ë Œë”ë§
        updateAuthUI();
        navigateTo(currentPage);
    }

    function isNewPost(timestamp) {
        const oneWeek = 7 * 24 * 60 * 60 * 1000;
        return (Date.now() - timestamp) < oneWeek;
    }

    function getNewBadgeHtml(timestamp) {
        // ğŸš¨ UPDATED: New badge color to Light Blue
        return isNewPost(timestamp) ? '<span class="ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-primary-blue-light text-primary-blue">NEW</span>' : '';
    }
    
    function closeModal(event, modalId) {
        if (!event || event.target.id === modalId || event.target.closest('.modal-close')) {
            document.getElementById(modalId).classList.remove('show');
        }
    }
    
    function showNotification(title, message) {
        const container = document.getElementById('notificationContainer');
        const notification = document.createElement('div');
        // ğŸš¨ UPDATED: Notification icon color to Primary Blue
        notification.className = 'bg-white p-4 rounded-lg shadow-xl border border-gray-100 flex items-center space-x-3 transform translate-x-full transition-transform duration-300';
        notification.innerHTML = `
            <div class="flex-shrink-0 text-primary-blue">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            </div>
            <div>
                <p class="font-bold text-text-dark">${title}</p>
                <p class="text-sm text-text-light">${message}</p>
            </div>
        `;
        container.appendChild(notification);
        
        setTimeout(() => {
            notification.style.transform = 'translateX(0)';
        }, 10);

        setTimeout(() => {
            notification.style.transform = 'translateX(calc(100% + 16px))';
            notification.addEventListener('transitionend', () => notification.remove());
        }, 3000);
    }

    // --- Authentication Logic ---

    function updateAuthUI() {
        const authBtn = document.getElementById('authBtn');
        const settingBtn = document.getElementById('settingBtn');
        const homeGreeting = document.getElementById('homeGreeting');
        
        if (currentUser) {
            authBtn.textContent = 'ë¡œê·¸ì•„ì›ƒ';
            authBtn.onclick = handleLogout;
            settingBtn.classList.remove('hide');
            homeGreeting.textContent = `ì–´ë–¤ ìíœ´ê°€ í•„ìš”í•˜ì‹ ê°€ìš”, ${currentUser.name}ë‹˜?`;
        } else {
            authBtn.textContent = 'ë¡œê·¸ì¸';
            authBtn.onclick = toggleAuthModal;
            settingBtn.classList.add('hide');
            homeGreeting.textContent = 'ììœ ë¡œìš´ ë‹¹ì‹ ì˜ íœ´ì‹ ê°€ì´ë“œ';
        }
    }

    function toggleAuthModal() {
        document.getElementById('authModal').classList.toggle('show');
    }
    
    function showSignupScreen() {
        showNotification('ì•ˆë‚´', 'íšŒì›ê°€ì… ê¸°ëŠ¥ì€ í˜„ì¬ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
    }

    function handleLogin() {
        const email = document.getElementById('authEmail').value;
        const password = document.getElementById('authPassword').value;

        // ì„ì‹œ ë¡œê·¸ì¸ ë¡œì§
        if (email.includes('@') && password) {
            const name = email.split('@')[0];
            currentUser = { 
                id: 'user' + name, 
                name: name, 
                email: email, 
                isAdmin: ADMIN_EDITORS.includes(email) 
            };
            closeModal(null, 'authModal');
            updateAuthUI();
            showNotification('ë¡œê·¸ì¸ ì„±ê³µ', `${currentUser.name}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`);
            navigateTo(currentPage);
        } else {
            showNotification('ì˜¤ë¥˜', 'ìœ íš¨í•œ ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        }
    }

    function handleLogout() {
        currentUser = null;
        updateAuthUI();
        showNotification('ì•Œë¦¼', 'ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
        navigateTo('home');
    }
    
    // --- Navigation and Page Rendering ---

    function navigateTo(page) {
        document.querySelectorAll('section').forEach(section => section.classList.add('hide'));
        
        const targetSection = document.getElementById(page + 'Page');
        if (targetSection) {
            targetSection.classList.remove('hide');
            currentPage = page;
            
            // íƒ­ë°” í™œì„±í™”
            document.querySelectorAll('.bottom-tab-bar .tab-item').forEach(item => {
                item.classList.toggle('active', item.getAttribute('data-page') === page);
            });
            
            // í˜ì´ì§€ë³„ ë Œë”ë§ í˜¸ì¶œ
            if (page === 'home') renderLatestPosts();
            if (page === 'editorTalk') renderPostList('editorTalk');
            if (page === 'moment') renderPostList('moment');
            if (page === 'newsletter') renderNewsletterList();
            if (page === 'myPage') renderMyPage();
        }
    }

    function renderLatestPosts() {
        const latestList = document.getElementById('latestPosts');
        latestList.innerHTML = '';
        
        const latest = posts
            .filter(p => p.type === 'letter' || p.type === 'editorTalk')
            .sort((a, b) => b.timestamp - a.timestamp)
            .slice(0, 5);

        if (latest.length === 0) {
            latestList.innerHTML = '<p class="text-gray-400 text-center mt-8">ì•„ì§ ë“±ë¡ëœ ì½˜í…ì¸ ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }

        latest.forEach(post => {
            latestList.insertAdjacentHTML('beforeend', renderPostItem(post));
        });
    }

    function renderPostList(type) {
        const listElement = document.getElementById(type + 'List');
        listElement.innerHTML = '';
        
        const filteredPosts = posts
            .filter(p => p.type === type)
            .sort((a, b) => b.timestamp - a.timestamp);

        if (filteredPosts.length === 0) {
            listElement.innerHTML = '<p class="text-gray-400 text-center mt-8">ì•„ì§ ë“±ë¡ëœ ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }

        filteredPosts.forEach(post => {
            listElement.insertAdjacentHTML('beforeend', renderPostItem(post));
        });
    }

    // ëª©ë¡ ë·°ì—ì„œ ê²Œì‹œê¸€ ì•„ì´í…œ ë Œë”ë§ (ë””ìì¸ ì—…ë°ì´íŠ¸)
    function renderPostItem(post) {
        const commentCount = comments.filter(c => c.postId === post.id).length;
        const newBadge = getNewBadgeHtml(post.timestamp);
        let icon = '';
        if (post.type === 'letter') {
            icon = post.category === 'lab' ? 'ğŸ’¡' : 'ğŸ”–';
        } else if (post.type === 'editorTalk') {
            icon = 'ğŸ’¬';
        } else if (post.type === 'moment') {
            icon = 'âœ¨';
        }

        if (post.type === 'qna') {
            return ''; 
        }
        
        return `
            <div onclick="showPostDetail('${post.id}')" class="p-4 bg-white rounded-xl shadow-sm border border-gray-100 cursor-pointer hover:bg-soft-cream transition-colors">
                <div class="flex justify-between items-start">
                    <h3 class="text-base font-bold text-text-dark flex items-center">
                        ${icon} ${post.title} ${newBadge}
                    </h3>
                    <span class="text-xs text-gray-400">${new Date(post.timestamp).toLocaleDateString('ko-KR')}</span>
                </div>
                <p class="text-sm text-text-light mt-1 flex justify-between">
                    <span>${post.content.substring(0, 40)}...</span>
                    <span class="text-xs text-gray-500 ml-4">${post.authorName} | ëŒ“ê¸€ ${commentCount}</span>
                </p>
            </div>
        `;
    }
    
    // ë ˆí„° ëª©ë¡ í•„í„°ë§ (ìíœ´ë ˆí„°/ìíœ´ë©)
    function renderNewsletterList(filter = 'all') {
        const listElement = document.getElementById('newsletterList');
        listElement.innerHTML = '';
        
        const filteredList = posts.filter(p => p.type === 'letter' && (filter === 'all' || p.category === filter));
        
        // í•„í„° ë²„íŠ¼ UI ì—…ë°ì´íŠ¸ (Pastel Blue)
        document.querySelectorAll('#newsletterPage .filter-btn').forEach(btn => {
            const isActive = btn.getAttribute('data-filter') === filter;
            btn.classList.toggle('bg-primary-blue', isActive);
            btn.classList.toggle('text-white', isActive);
            btn.classList.toggle('border-primary-blue', isActive);
            btn.classList.toggle('bg-gray-50', !isActive);
            btn.classList.toggle('text-text-light', !isActive);
            btn.classList.toggle('border-gray-300', !isActive);
        });

        if (filteredList.length === 0) {
            listElement.innerHTML = `<p class="text-center text-gray-400 mt-8">ì„ íƒëœ ì¹´í…Œê³ ë¦¬ì˜ ë ˆí„°ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.</p>`;
            return;
        }
        
        filteredList.forEach(letter => {
            const newBadge = getNewBadgeHtml(letter.timestamp);
            const icon = letter.category === 'lab' ? 'ğŸ’¡' : 'ğŸ”–';

            const itemHtml = `
                <div onclick="showPostDetail('${letter.id}')" class="p-4 bg-white rounded-xl shadow-sm border border-gray-100 cursor-pointer hover:bg-soft-cream transition-colors">
                    <div class="flex justify-between items-start">
                        <h3 class="text-base font-bold text-text-dark flex items-center">
                            ${icon} ${letter.title} ${newBadge}
                        </h3>
                        <span class="text-xs text-gray-400">${letter.authorName}</span>
                    </div>
                    <p class="text-sm text-text-light mt-1">${letter.content.substring(0, 50) + '...'}</p>
                </div>
            `;
            listElement.insertAdjacentHTML('beforeend', itemHtml);
        });
    }

    function filterNewsletters(filter) {
        renderNewsletterList(filter);
    }
    
    // --- Post Detail and Interaction (Like, Bookmark, Stamp) ---
    
    function showPostDetail(postId) {
        currentPostId = postId;
        const post = posts.find(p => p.id === postId);
        
        if (!post) {
            showNotification('ì˜¤ë¥˜', 'ê²Œì‹œê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }
        
        const isAuthor = currentUser && currentUser.id === post.authorId;
        const isAdmin = currentUser && currentUser.isAdmin;

        // Q&A ë¹„ë°€ê¸€ ì²˜ë¦¬
        if (post.type === 'qna' && post.isPrivate && !(isAuthor || isAdmin)) {
             showNotification('ì ‘ê·¼ ë¶ˆê°€', 'ë¹„ë°€ê¸€ì€ ì‘ì„±ì ë˜ëŠ” ê´€ë¦¬ìë§Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
             return;
        }

        // ëª¨ë‹¬ í—¤ë”ì˜ ë²„íŠ¼ ID ì—…ë°ì´íŠ¸
        ['likeBtn', 'bookmarkBtn', 'stampBtn'].forEach(prefix => {
            const btn = document.getElementById(`${prefix}-POSTID`);
            if (btn) btn.id = `${prefix}-${postId}`;
        });
        
        updateLikeButton(postId); 
        updateBookmarkButton(postId, post.type);
        updateStampButton(postId, post.type); 

        // ë³¸ë¬¸ ë‚´ìš© ì—…ë°ì´íŠ¸
        document.getElementById('postDetailTitle').textContent = post.title;
        document.getElementById('postDetailAuthor').textContent = post.authorName;
        document.getElementById('postDetailDate').textContent = new Date(post.timestamp).toLocaleDateString('ko-KR');
        document.getElementById('postDetailContent').innerHTML = post.content.replace(/\n/g, '<br>');

        const postComments = comments.filter(c => c.postId === postId);
        document.getElementById('postDetailComments').innerHTML = postComments.map(c => renderComment(c, post.type)).join('');
        document.getElementById('commentFormContainer').innerHTML = renderCommentForm(post.type); 
        
        document.getElementById('postDetailModal').classList.add('show');
    }
    
    function toggleLike(postId) {
        if (!currentUser) return showNotification('ì•ˆë‚´', 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        
        const isLiked = likedItems[postId]?.isLiked || false;
        
        if (isLiked) {
            if (likedItems[postId]) delete likedItems[postId].isLiked;
            showNotification('ì•Œë¦¼', 'ì¢‹ì•„ìš”ê°€ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        } else {
            if (!likedItems[postId]) likedItems[postId] = {};
            likedItems[postId].isLiked = true;
            showNotification('ì•Œë¦¼', 'ê¸€ì— ì¢‹ì•„ìš”ë¥¼ ëˆŒë €ìŠµë‹ˆë‹¤!');
        }
        updateLikeButton(postId); 
        if (currentPage === 'myPage') loadMyPageContent(document.querySelector('#myPageTabs .tab-btn.active').getAttribute('data-tab'));
    }

    function toggleBookmark(postId) {
        if (!currentUser) return showNotification('ì•ˆë‚´', 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        
        const post = posts.find(p => p.id === postId);
        if (post.type === 'qna') return showNotification('ì•ˆë‚´', 'Q&AëŠ” ë¶ë§ˆí¬ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        
        const isBookmarked = likedItems[postId]?.isBookmarked || false;
        
        if (isBookmarked) {
            if (likedItems[postId]) delete likedItems[postId].isBookmarked;
            showNotification('ì•Œë¦¼', 'ìŠ¤í¬ë©ì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        } else {
            if (!likedItems[postId]) likedItems[postId] = {};
            likedItems[postId].isBookmarked = true;
            showNotification('ì•Œë¦¼', 'ê¸€ì´ ìŠ¤í¬ë©ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
        updateBookmarkButton(postId, post.type); 
        if (currentPage === 'myPage') loadMyPageContent(document.querySelector('#myPageTabs .tab-btn.active').getAttribute('data-tab'));
    }
    
    function toggleStamp(postId) {
        if (!currentUser) return showNotification('ì•ˆë‚´', 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        
        const post = posts.find(p => p.id === postId);
        if (!post || (post.type !== 'letter' && post.type !== 'moment')) {
            return showNotification('ì˜¤ë¥˜', 'ìŠ¤íƒ¬í”„ëŠ” ë ˆí„°ì™€ ëª¨ë¨¼íŠ¸ ê²Œì‹œë¬¼ì—ì„œë§Œ íšë“í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        }
        
        const isStamped = likedItems[postId]?.isStamped || false;
        
        if (isStamped) {
            return showNotification('ì•ˆë‚´', 'ì´ë¯¸ íšë“í•œ ìíœ´ ìŠ¤íƒ¬í”„ì…ë‹ˆë‹¤.');
        } else {
            if (!likedItems[postId]) likedItems[postId] = {};
            likedItems[postId].isStamped = true;
            showStampSuccessPopup(); 
        }
        updateStampButton(postId, post.type);
        if (currentPage === 'myPage') loadMyPageContent(document.querySelector('#myPageTabs .tab-btn.active').getAttribute('data-tab'));
    }

    function updateLikeButton(postId) {
        const likeBtn = document.getElementById(`likeBtn-${postId}`);
        if (!likeBtn) return;
        
        const isLiked = likedItems[postId]?.isLiked || false;
        // ë¹¨ê°„ í•˜íŠ¸ì™€ íŒŒë€ ìƒ‰ìƒ í…Œë‘ë¦¬ ì•„ì´ì½˜ (Pastel Blue)
        likeBtn.innerHTML = isLiked 
            ? `<svg class="w-6 h-6 text-red-500 fill-current" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>`
            : `<svg class="w-6 h-6 text-primary-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-.318-.318a4.5 4.5 0 00-6.364 0z"/></svg>`;
    }

    function updateBookmarkButton(postId, postType) {
        const bookmarkBtn = document.getElementById(`bookmarkBtn-${postId}`);
        if (!bookmarkBtn) return;
        
        if (postType === 'qna') {
            bookmarkBtn.classList.add('hidden');
            return;
        }
        
        bookmarkBtn.classList.remove('hidden');
        const isBookmarked = likedItems[postId]?.isBookmarked || false;

        // Pastel Blue ìƒ‰ìƒìœ¼ë¡œ í†µì¼
        bookmarkBtn.innerHTML = isBookmarked
            ? `<svg class="w-6 h-6 text-primary-blue fill-current" viewBox="0 0 24 24"><path d="M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2z"/></svg>`
            : `<svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5v14l7-3 7 3V5a2 2 0 00-2-2H7a2 2 0 00-2 2z"/></svg>`;
    }
    
    function updateStampButton(postId, postType) {
        const stampBtn = document.getElementById(`stampBtn-${postId}`);
        if (!stampBtn) return;
        
        if (postType !== 'letter' && postType !== 'moment') {
            stampBtn.classList.add('hidden');
            return;
        }
        
        stampBtn.classList.remove('hidden');
        const isStamped = likedItems[postId]?.isStamped || false;

        // ì±„ì›Œì§„ ìŠ¤íƒ¬í”„ (Dark Blue) vs ë¹„ì–´ìˆëŠ” ìŠ¤íƒ¬í”„ (íšŒìƒ‰ í…Œë‘ë¦¬)
        updateStampButton.innerHTML = isStamped
            ? `<svg class="w-7 h-7 stamped-icon fill-current" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>` 
            : `<svg class="w-7 h-7 sketch-stamp" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>`; 
    }
    
    function showStampSuccessPopup() {
        const modal = document.getElementById('stampSuccessModal');
        modal.innerHTML = `
            <div class="modal-content max-w-xs p-8">
                <div class="text-center">
                    <svg class="w-16 h-16 text-primary-blue fill-current mx-auto mb-4" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                    <h4 class="text-2xl font-bold text-primary-blue mb-2">ìŠ¤íƒ¬í”„ íšë“ ì™„ë£Œ!</h4>
                    <p class="text-text-light">ë§ˆì´í˜ì´ì§€ì—ì„œ ìƒˆë¡œìš´ ìŠ¤íƒ¬í”„ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.</p>
                    <button onclick="closeModal(null, 'stampSuccessModal')" class="mt-4 bg-primary-blue text-white px-6 py-2 rounded-full font-bold shadow-md hover:bg-primary-blue-dark btn-scale">í™•ì¸</button>
                </div>
            </div>
        `;
        modal.classList.add('show');
    }
    
    // --- Comment Logic ---
    
    function renderComment(comment, postType) {
        const isEditorReply = ADMIN_EDITORS.includes(comment.authorEmail);
        
        let avatarClass = 'bg-gray-200 text-gray-600';
        let nameClass = 'font-medium text-text-dark';
        let name = comment.authorName;

        if (postType === 'qna' && isEditorReply) { 
            // ğŸš¨ UPDATED: Q&A ë‹µë³€ ì•„ë°”íƒ€/ì´ë¦„ ìƒ‰ìƒ (Light/Primary Blue)
            avatarClass = 'bg-primary-blue-light text-primary-blue';
            nameClass = 'font-bold text-primary-blue';
            name = `ê´€ë¦¬ì`; 
        }

        const commentHtml = `
            <div class="flex space-x-3 mb-4 p-3 border-b border-soft-cream">
                <div class="w-8 h-8 rounded-full ${avatarClass} flex items-center justify-center text-sm font-bold flex-shrink-0">${name.charAt(0)}</div> 
                <div class="flex-1">
                    <div class="flex items-center justify-between mb-1">
                        <span class="${nameClass} text-sm">${name}</span>
                        <span class="text-xs text-gray-400">${new Date(comment.timestamp).toLocaleDateString('ko-KR')}</span>
                    </div>
                    <div class="text-text-dark text-sm">
                        ${comment.content}
                    </div>
                </div>
            </div>
        `;
        return commentHtml;
    }

    function renderCommentForm(postType) {
        if (!currentUser) {
            return `<p class="text-center text-gray-400 py-4 text-sm">ë¡œê·¸ì¸ í›„ ëŒ“ê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>`;
        }
        
        if (postType === 'qna' && !currentUser.isAdmin) {
            // ğŸš¨ UPDATED: Q&A ê²½ê³  ë¬¸êµ¬ ìƒ‰ìƒ
            return `<p class="text-center text-primary-blue py-4 font-medium text-sm">ê´€ë¦¬ì(ì—ë””í„°)ë§Œì´ Q&Aì— ë‹µë³€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>`;
        }
        
        return `
            <div class="flex space-x-3 p-4 border-t border-gray-100">
                <input type="text" id="commentContent" placeholder="${postType === 'qna' ? 'ê´€ë¦¬ì ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”.' : 'ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”.'}" 
                       class="flex-1 px-4 py-2 border border-gray-200 rounded-full focus:outline-none focus:ring-2 focus:ring-primary-blue text-sm">
                <button onclick="submitComment('${postType}')" class="bg-primary-blue text-white px-4 py-2 rounded-full font-medium btn-scale text-sm">ë“±ë¡</button>
            </div>
        `;
    }

    function submitComment(postType) {
        const content = document.getElementById('commentContent').value.trim();
        if (!content || !currentPostId || !currentUser) {
            showNotification('ì˜¤ë¥˜', 'ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•˜ê±°ë‚˜ ë¡œê·¸ì¸ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
            return;
        }

        const newComment = {
            id: 'c' + Date.now(),
            postId: currentPostId,
            authorName: postType === 'qna' && currentUser.isAdmin ? 'ê´€ë¦¬ì' : currentUser.name,
            authorEmail: currentUser.email,
            content: content,
            timestamp: Date.now()
        };
        
        comments.push(newComment);
        document.getElementById('commentContent').value = '';
        
        // ëŒ“ê¸€ ëª©ë¡ ê°±ì‹  ë° ëª¨ë‹¬ ì¬ë Œë”ë§
        const postComments = comments.filter(c => c.postId === currentPostId);
        document.getElementById('postDetailComments').innerHTML = postComments.map(c => renderComment(c, postType)).join('');

        showNotification('ì„±ê³µ', 'ëŒ“ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
        // Q&A ëª©ë¡ ê°±ì‹  (MyPage Q&A íƒ­ í™œì„±í™”ë¥¼ ìœ„í•´)
        if (postType === 'qna' && currentPage === 'myPage') loadMyPageContent('qna');
    }
    
    // --- Post Write Logic (Q&A, Letter) ---
    
    function showPostWriteModal(type) {
        if (!currentUser) {
            return showNotification('ì•ˆë‚´', 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        }
        
        document.getElementById('postWriteModal').setAttribute('data-post-type', type);
        document.getElementById('postTitle').value = '';
        document.getElementById('postContent').value = '';

        const qnaOptions = document.getElementById('qnaOptions');
        const categoryContainer = document.getElementById('categorySelectContainer');
        const postCategory = document.getElementById('postCategory');
        
        qnaOptions.classList.add('hide');
        categoryContainer.classList.add('hide');

        if (type === 'qna') {
            document.getElementById('writeModalTitle').textContent = 'â“ Q&A ì‘ì„±';
            qnaOptions.classList.remove('hide');
            document.getElementById('isPrivate').checked = false;
        } else if (type === 'letter') {
            document.getElementById('writeModalTitle').textContent = 'ğŸ“– ìƒˆ ë ˆí„° ì‘ì„±';
            categoryContainer.classList.remove('hide');
            
            // ì¹´í…Œê³ ë¦¬ ì˜µì…˜ ì„¤ì •
            postCategory.innerHTML = `
                <option value="" disabled selected>ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
                <option value="letter">ìíœ´ë ˆí„°</option>
                <option value="lab">ìíœ´ë©</option>
            `;
            
            if (!currentUser.isAdmin) {
                showNotification('ì˜¤ë¥˜', 'ë ˆí„° ì‘ì„±ì€ ê´€ë¦¬ì/ì—ë””í„°ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }
        } else {
            document.getElementById('writeModalTitle').textContent = 'ìƒˆ ê¸€ ì‘ì„±';
        }

        document.getElementById('postWriteModal').classList.add('show');
    }

    function submitPost() {
        const type = document.getElementById('postWriteModal').getAttribute('data-post-type');
        const title = document.getElementById('postTitle').value.trim();
        const content = document.getElementById('postContent').value.trim();
        let category = type;

        if (!title || !content) {
            showNotification('ì˜¤ë¥˜', 'ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }
        
        if (type === 'letter') {
            category = document.getElementById('postCategory').value;
            if (!category) {
                showNotification('ì˜¤ë¥˜', 'ë ˆí„° ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
        }
        
        const isPrivate = type === 'qna' ? document.getElementById('isPrivate').checked : false;

        const newPost = {
            id: type.charAt(0) + Date.now(),
            title: title,
            content: content,
            authorId: currentUser.id,
            authorName: currentUser.name,
            authorEmail: currentUser.email,
            type: type,
            category: category,
            timestamp: Date.now(),
            commentCount: 0,
            isPrivate: isPrivate
        };

        posts.unshift(newPost);
        closeModal(null, 'postWriteModal');
        showNotification('ì„±ê³µ', 'ê²Œì‹œê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
        
        // ì‘ì„± í›„ í•´ë‹¹ í˜ì´ì§€ë¡œ ì´ë™í•˜ê±°ë‚˜ ê°±ì‹ 
        if (type === 'qna') navigateTo('myPage'); // Q&AëŠ” ë§ˆì´í˜ì´ì§€ë¡œ ì´ë™
        else navigateTo(type);
    }

    // --- MyPage Logic ---

    // MyPage íƒ­ êµ¬ì¡° ë³€ê²½ (Q&A í¬í•¨)
    function renderMyPage() {
        if (!currentUser) {
            document.getElementById('myPage').innerHTML = '<p class="text-center text-gray-400 py-12">ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>';
            return;
        }
        
        const myPageHtml = `
            <h2 class="text-2xl font-bold text-text-dark mb-6">ë‚˜ì˜ ìíœ´ ê³µê°„</h2>
            <div class="bg-primary-blue-light p-4 rounded-xl shadow-inner mb-8 flex items-center space-x-4">
                <div class="w-10 h-10 rounded-full bg-primary-blue-dark text-white flex items-center justify-center text-lg font-bold">${currentUser.name.charAt(0)}</div>
                <div>
                    <p class="text-base font-bold text-text-dark">${currentUser.name}ë‹˜</p>
                    <p class="text-xs text-text-light">${currentUser.email}</p>
                </div>
            </div>
            
            <div class="mt-8 border-b border-gray-200 overflow-x-auto">
                <nav class="flex space-x-2" id="myPageTabs">
                    <button class="tab-btn active whitespace-nowrap" data-tab="likes" onclick="loadMyPageContent('likes')">â¤ï¸ ì¢‹ì•„ìš”</button>
                    <button class="tab-btn whitespace-nowrap" data-tab="bookmarks" onclick="loadMyPageContent('bookmarks')">ğŸ”– ë¶ë§ˆí¬</button> 
                    <button class="tab-btn whitespace-nowrap" data-tab="qna" onclick="loadMyPageContent('qna')">â“ Q&A</button> 
                    <button class="tab-btn whitespace-nowrap" data-tab="stamps" onclick="loadMyPageContent('stamps')">â­ï¸ ìíœ´ ìŠ¤íƒ¬í”„</button> 
                </nav>
            </div>
            <div id="myPageContent" class="py-6 space-y-4">
                </div>
            ${currentUser.isAdmin ? `
                <div class="mt-8 border-t pt-6">
                    <h3 class="text-xl font-bold text-primary-blue mb-4">ê´€ë¦¬ì ê¸°ëŠ¥</h3>
                    <div class="flex space-x-3">
                        <button onclick="showPostWriteModal('letter')" class="bg-primary-blue text-white px-4 py-2 rounded-full font-medium btn-scale text-sm hover:bg-primary-blue-dark">ë ˆí„° ì‘ì„±</button>
                        <button onclick="showPostWriteModal('editorTalk')" class="bg-primary-blue text-white px-4 py-2 rounded-full font-medium btn-scale text-sm hover:bg-primary-blue-dark">ì—ë””í„°í†¡ ì‘ì„±</button>
                        <button onclick="showPostWriteModal('moment')" class="bg-primary-blue text-white px-4 py-2 rounded-full font-medium btn-scale text-sm hover:bg-primary-blue-dark">ëª¨ë¨¼íŠ¸ ì‘ì„±</button>
                    </div>
                </div>
            ` : ''}
        `;
        
        document.getElementById('myPage').innerHTML = myPageHtml;
        loadMyPageContent('likes'); // ì´ˆê¸° íƒ­ ë¡œë“œ
    }

    function loadMyPageContent(tab) {
        if (!currentUser) return;
        
        document.querySelectorAll('#myPageTabs .tab-btn').forEach(btn => {
            btn.classList.toggle('active', btn.getAttribute('data-tab') === tab);
        });
        
        const contentElement = document.getElementById('myPageContent');
        contentElement.innerHTML = '';
        
        let filteredPosts = [];
        let title = '';

        if (tab === 'likes') {
            filteredPosts = posts.filter(p => likedItems[p.id]?.isLiked);
            title = 'ì¢‹ì•„ìš”í•œ ê¸€';
            renderMyPostListContent(contentElement, filteredPosts, title);
        } else if (tab === 'bookmarks') {
            filteredPosts = posts.filter(p => likedItems[p.id]?.isBookmarked);
            title = 'ë¶ë§ˆí¬í•œ ê¸€';
            renderMyPostListContent(contentElement, filteredPosts, title);
        } else if (tab === 'qna') { // Q&A TAB
            filteredPosts = posts.filter(p => p.type === 'qna' && p.authorId === currentUser.id);
            title = 'ë‚´ê°€ ì‘ì„±í•œ Q&A';
            renderMyQnaListContent(contentElement, filteredPosts, title);
        } else if (tab === 'stamps') {
            const allStampablePosts = posts.filter(p => p.type === 'letter' || p.type === 'moment');
            renderMyStampListContent(contentElement, allStampablePosts);
        }
    }

    // MyPage Q&A ë Œë”ë§ (Q&A ì „ìš© ëª©ë¡ ë·°)
    function renderMyQnaListContent(contentElement, list, title) {
        if (list.length === 0) {
            contentElement.innerHTML = `
                <p class="text-center text-gray-400 mt-8">ì•„ì§ ì‘ì„±í•œ Q&Aê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                <div class="text-center mt-4">
                    <button onclick="showPostWriteModal('qna')" class="bg-primary-blue text-white px-4 py-2 rounded-full font-medium btn-scale text-sm hover:bg-primary-blue-dark">ì§ˆë¬¸ ì‘ì„±í•˜ê¸°</button>
                </div>
            `;
            return;
        }

        const listHtml = list.map(post => {
            const isAnswered = comments.some(c => c.postId === post.id && ADMIN_EDITORS.includes(c.authorEmail));
            const statusClass = isAnswered ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700';
            const statusText = isAnswered ? 'ë‹µë³€ ì™„ë£Œ' : 'ë‹µë³€ ëŒ€ê¸°';
            const isPrivateIcon = post.isPrivate ? 'ğŸ”’ ' : '';

            return `
                <div onclick="showPostDetail('${post.id}')" class="p-4 bg-white rounded-xl shadow-sm border border-gray-100 cursor-pointer hover:bg-soft-cream transition-colors">
                    <div class="flex justify-between items-center mb-1">
                        <h4 class="text-base font-bold text-text-dark">${isPrivateIcon}${post.title}</h4>
                        <span class="text-xs ${statusClass} px-2 py-0.5 rounded-full">${statusText}</span>
                    </div>
                    <p class="text-xs text-text-light mt-1 flex justify-between">
                        <span>${new Date(post.timestamp).toLocaleDateString('ko-KR')}</span>
                        <span>ëŒ“ê¸€ ${comments.filter(c => c.postId === post.id).length}</span>
                    </p>
                </div>
            `;
        }).join('');

        contentElement.innerHTML = `
            <h3 class="text-xl font-bold text-text-dark mb-4">${title} (${list.length}ê°œ)</h3>
            ${listHtml}
        `;
    }


    function renderMyPostListContent(contentElement, list, title) {
        if (list.length === 0) {
            contentElement.innerHTML = `<p class="text-center text-gray-400 mt-8">ì•„ì§ ${title} ëª©ë¡ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</p>`;
            return;
        }

        const listHtml = list.map(post => `
            <div onclick="showPostDetail('${post.id}')" class="p-4 bg-white rounded-xl shadow-sm border border-gray-100 cursor-pointer hover:bg-soft-cream transition-colors">
                <h4 class="text-base font-bold text-text-dark">${post.title}</h4>
                <p class="text-sm text-text-light mt-1">${post.authorName} | ${new Date(post.timestamp).toLocaleDateString('ko-KR')}</p>
            </div>
        `).join('');

        contentElement.innerHTML = `
            <h3 class="text-xl font-bold text-text-dark mb-4">${title} (${list.length}ê°œ)</h3>
            ${listHtml}
        `;
    }

    // MyPage ìŠ¤íƒ¬í”„ ë Œë”ë§ (ë¡±ë¸”ë™ ìŠ¤íƒ€ì¼)
    function renderMyStampListContent(contentElement, allStampablePosts) {
        const acquiredCount = allStampablePosts.filter(p => likedItems[p.id]?.isStamped).length;
        
        if (allStampablePosts.length === 0) {
             contentElement.innerHTML = `<p class="text-center text-gray-400 mt-8">ìŠ¤íƒ¬í”„ë¥¼ íšë“í•  ìˆ˜ ìˆëŠ” ê²Œì‹œë¬¼ì´ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.</p>`;
            return;
        }

        const stampGridHtml = allStampablePosts.map(post => {
            const isStamped = likedItems[post.id]?.isStamped || false;
            // CSS: .stamped-icon (Dark Blue) vs .sketch-stamp (Gray)
            const iconClass = isStamped ? 'stamped-icon' : 'sketch-stamp'; 
            const clickAction = isStamped ? `showPostDetail('${post.id}')` : `toggleStamp('${post.id}')`; 
            const stampText = isStamped ? 'íšë“' : 'ë¯¸íšë“';
            const stampTitle = post.title.length > 15 ? post.title.substring(0, 15) + '...' : post.title;

            return `
                <div class="p-4 bg-white rounded-xl shadow-sm border border-gray-100 text-center flex flex-col items-center justify-center cursor-pointer hover:shadow-lg transition-shadow" onclick="${clickAction}">
                    <div class="w-12 h-12 mb-2 stamp-container">
                        <svg class="w-full h-full ${iconClass}" viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                        </svg>
                    </div>
                    <p class="text-xs font-medium ${isStamped ? 'text-text-dark font-bold' : 'text-gray-500'} mt-1">${stampTitle}</p>
                    <span class="text-xs ${isStamped ? 'text-primary-blue' : 'text-gray-400'}">${stampText}</span>
                </div>
            `;
        }).join('');
        
        contentElement.innerHTML = `
            <h3 class="text-xl font-bold text-text-dark mb-4">â­ï¸ ìíœ´ ìŠ¤íƒ¬í”„ (${acquiredCount} / ${allStampablePosts.length}ê°œ íšë“)</h3>
            <div class="grid grid-cols-3 gap-4">
                ${stampGridHtml}
            </div>
        `;
    }


    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', loadData);
</script>

</body>
</html>
