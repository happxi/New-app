<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ìíœ´ë ˆí„° - í–…ì‚ë‹˜ì„ ìœ„í•œ íŠ¹ë³„í•œ ê³µê°„!</title>
    
    <meta property="og:title" content="ìíœ´ë ˆí„°ë¥¼ ì•±ìœ¼ë¡œ ë§Œë‚˜ë³´ì„¸ìš”!">
    <meta property="og:description" content="ì—ë””í„°ì™€ í–…ì‚ë‹˜ë§Œì„ ìœ„í•œ ê³µê°„!">
    <meta property="og:image" content="https://i.imgur.com/WQgaT6m.png">
    <meta property="og:type" content="website">
    
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Round+Gothic:wght@400;700;800&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #8B5CF6;
            --primary-light: #A78BFA;
            --primary-dark: #7C3AED;
            --accent: #EC4899;
            --bg-gradient-start: #F0F4FF;
            --bg-gradient-end: #F5E6FF;
            --text-dark: #1F2937;
            --text-light: #6B7280;
            --white: #FFFFFF;
            --glass-bg: rgba(255, 255, 255, 0.9);
            --glass-border: rgba(255, 255, 255, 0.3);
            --like-color: #EF4444;
            --bookmark-color: #F59E0B;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Noto Sans KR', 'Nanum Round Gothic', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            color: var(--text-dark);
            min-height: 100vh;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        /* ë¡œë”© ìŠ¤í¬ë¦° */
        .loading-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            display: flex; justify-content: center; align-items: center; z-index: 10000; transition: opacity 0.5s ease;
        }
        .loading-icon { font-size: 48px; margin-bottom: 20px; animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }

        /* ì•± ì»¨í…Œì´ë„ˆ */
        .app-container {
            width: 100%; max-width: 480px; min-height: 100vh;
            background: var(--glass-bg); backdrop-filter: blur(10px); margin-top: 20px;
            border: 1px solid var(--glass-border); padding-bottom: 90px;
        }

        /* í—¤ë” & ì¹´ë“œ ê³µí†µ */
        .header-section { padding: 40px 25px 20px; text-align: center; background: linear-gradient(180deg, var(--white) 0%, var(--glass-bg) 100%); border-radius: 30px 30px 0 0; }
        .header-title { font-size: 24px; font-weight: 800; color: var(--primary-dark); margin-bottom: 8px; }
        .header-sub { font-size: 14px; color: var(--text-light); }

        .content-card {
            background: var(--glass-bg); border: 1px solid rgba(139, 92, 246, 0.1); border-radius: 25px;
            padding: 20px; margin: 0 20px 15px; position: relative; transition: all 0.2s ease;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.05); cursor: pointer;
        }
        .content-card:active { transform: scale(0.98); }

        /* ë¬´ë“œ ê¸°ë¡ ì´ëª¨ì§€ ìŠ¤íƒ€ì¼ (ìˆ˜ì •ë¨) */
        .emoji-selector {
            display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px;
            margin: 15px 0; padding: 15px; border-radius: 20px; background: rgba(139, 92, 246, 0.05);
            max-width: 100%; overflow: hidden;
        }
        .emoji-option {
            font-size: 18px; width: 40px; height: 40px; margin: 0 auto;
            border-radius: 50%; background: white; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.2s ease; border: 2px solid transparent;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .emoji-option:hover { transform: scale(1.1); }
        .emoji-option.selected {
            border-color: var(--primary); transform: scale(1.1);
            background: #FCE7F3; /* íŒŒìŠ¤í…” í•‘í¬ */
        }

        /* ìƒì„¸ ëª¨ë‹¬ ë²„íŠ¼ */
        .action-btn-group { display: flex; gap: 10px; margin-top: 15px; border-top: 1px solid rgba(0,0,0,0.05); padding-top: 15px; }
        .action-btn {
            flex: 1; padding: 10px; border-radius: 12px; border: 1px solid #eee; background: white;
            color: var(--text-light); font-size: 13px; display: flex; align-items: center; justify-content: center; gap: 5px;
            transition: all 0.2s;
        }
        .action-btn.active-like { color: var(--like-color); border-color: var(--like-color); background: #FEF2F2; }
        .action-btn.active-bookmark { color: var(--bookmark-color); border-color: var(--bookmark-color); background: #FFFBEB; }

        /* ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ */
        .manage-btn-group { position: absolute; top: 15px; right: 40px; display: flex; gap: 8px; }
        .manage-btn { font-size: 11px; padding: 4px 8px; border-radius: 6px; border: none; cursor: pointer; }
        .btn-edit { background: #E0E7FF; color: #4338CA; }
        .btn-delete { background: #FEE2E2; color: #B91C1C; }

        /* ë§ˆì´í˜ì´ì§€ íƒ­ */
        .mypage-tabs { display: flex; overflow-x: auto; padding: 0 20px; gap: 8px; margin-bottom: 20px; -webkit-overflow-scrolling: touch; }
        .mypage-tab {
            padding: 8px 16px; border-radius: 20px; background: white; border: 1px solid #eee;
            font-size: 12px; color: var(--text-light); white-space: nowrap; cursor: pointer;
        }
        .mypage-tab.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* ê³µí†µ UI ìš”ì†Œ */
        .btn-primary { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 12px; width: 100%; font-weight: bold; margin-top: 10px; }
        .input-box { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 10px; font-size: 14px; }
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5);
            display: none; align-items: center; justify-content: center; z-index: 2000;
        }
        .modal-overlay.show { display: flex; }
        .modal-card {
            background: white; width: 90%; max-width: 400px; border-radius: 20px; padding: 25px;
            max-height: 90vh; overflow-y: auto; position: relative;
        }
        
        .bottom-nav {
            position: fixed; bottom: 0; width: 100%; max-width: 480px; height: 70px; background: white;
            display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #eee; z-index: 1000;
        }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #999; font-size: 10px; cursor: pointer; }
        .nav-item i { font-size: 20px; margin-bottom: 4px; }
        .nav-item.active { color: var(--primary); }

        .write-icon {
            position: fixed; bottom: 90px; right: 20px; width: 55px; height: 55px;
            background: var(--primary); border-radius: 50%; color: white;
            display: flex; align-items: center; justify-content: center; font-size: 24px;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4); cursor: pointer; z-index: 900;
        }
        
        /* ëŒ“ê¸€ ì˜ì—­ */
        .comment-section { margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee; }
        .comment-item { font-size: 13px; margin-bottom: 12px; padding: 10px; background: #f9fafb; border-radius: 10px; position: relative; }
        .comment-meta { font-size: 11px; color: #888; margin-bottom: 4px; display: flex; justify-content: space-between; }
        .comment-del { color: #EF4444; cursor: pointer; font-size: 10px; }
    </style>
</head>
<body>

    <div class="loading-screen" id="loadingScreen">
        <div class="loading-icon">ğŸ’œ</div>
    </div>

    <div id="loginModal" class="modal-overlay">
        <div class="modal-card" style="text-align: center;">
            <h2 style="color: var(--primary); margin-bottom: 20px;">ìíœ´ë ˆí„°</h2>
            <input type="email" id="loginEmail" class="input-box" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" required>
            <input type="password" id="loginPassword" class="input-box" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
            <button onclick="handleLogin()" class="btn-primary">ë¡œê·¸ì¸</button>
            <p style="margin-top: 15px; font-size: 12px; color: #666;">
                ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? <span onclick="showSignupModal()" style="color: var(--primary); font-weight: bold; cursor: pointer;">íšŒì›ê°€ì…</span>
            </p>
        </div>
    </div>

    <div id="signupModal" class="modal-overlay">
        <div class="modal-card">
            <h3 style="text-align: center; margin-bottom: 15px;">íšŒì›ê°€ì…</h3>
            <input type="text" id="signupNickname" class="input-box" placeholder="ë‹‰ë„¤ì„">
            <input type="email" id="signupEmail" class="input-box" placeholder="ì´ë©”ì¼">
            <input type="password" id="signupPassword" class="input-box" placeholder="ë¹„ë°€ë²ˆí˜¸">
            <button onclick="handleSignup()" class="btn-primary">ê°€ì…í•˜ê¸°</button>
            <button onclick="showLoginModal()" style="width:100%; padding:10px; background:none; border:none; color:#888; margin-top:10px;">ì·¨ì†Œ</button>
        </div>
    </div>

    <div id="writeModal" class="modal-overlay">
        <div class="modal-card">
            <h3 id="writeTitle" style="margin-bottom: 15px; color: var(--primary);">ê¸€ì“°ê¸°</h3>
            
            <input type="hidden" id="editPostId" value="">
            
            <select id="postCategory" class="input-box" style="display: none;">
                <option value="ìíœ´ë ˆí„°">ìíœ´ë ˆí„°</option>
                <option value="ìíœ´ë©">ìíœ´ë©</option>
                <option value="ì—ë””í„°í†¡">ì—ë””í„°í†¡</option>
            </select>
            
            <div id="moodSection" style="display: none;">
                <p style="font-size: 12px; color: #666;">ì˜¤ëŠ˜ì˜ ê¸°ë¶„ì€ ì–´ë–¤ê°€ìš”?</p>
                <div id="moodSelector" class="emoji-selector"></div>
            </div>
            
            <div id="fileSection">
                <input type="file" id="fileInput" accept="image/*" class="input-box" style="padding: 5px;">
            </div>
            
            <input type="text" id="postTitle" class="input-box" placeholder="ì œëª©">
            <textarea id="postContent" class="input-box" style="height: 100px; resize: none;" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            
            <button onclick="submitPost()" class="btn-primary">ë“±ë¡í•˜ê¸°</button>
            <button onclick="closeModal()" style="width:100%; padding:10px; background:none; border:none; color:#888; margin-top:5px;">ì·¨ì†Œ</button>
        </div>
    </div>

    <div id="postDetailModal" class="modal-overlay">
        <div class="modal-card" style="max-height: 85vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: start; position: relative;">
                <span id="detailCategory" style="background: var(--primary-light); color: white; padding: 4px 8px; border-radius: 8px; font-size: 10px; font-weight: 700;">ì¹´í…Œê³ ë¦¬</span>
                
                <div id="manageButtons" class="manage-btn-group" style="display:none;">
                    <button class="manage-btn btn-edit" onclick="openEditModal()">ìˆ˜ì •</button>
                    <button class="manage-btn btn-delete" onclick="deleteCurrentPost()">ì‚­ì œ</button>
                </div>
                
                <button onclick="closeModal()" style="background:none; border:none; font-size: 20px; color: #999;"><i class="fas fa-times"></i></button>
            </div>
            
            <h3 id="detailTitle" style="margin: 15px 0; font-size: 18px;">ì œëª©</h3>
            <div style="font-size: 12px; color: #888; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
                <span id="detailAuthor" style="font-weight: bold; color: var(--text-dark);">ì‘ì„±ì</span> Â· <span id="detailDate">ë‚ ì§œ</span>
            </div>

            <img id="detailImage" src="" style="width: 100%; border-radius: 10px; margin-bottom: 15px; display: none;">
            <div id="detailContent" style="font-size: 14px; line-height: 1.6; white-space: pre-line; margin-bottom: 20px;">ë‚´ìš©</div>

            <div class="action-btn-group">
                <button id="btnLike" class="action-btn" onclick="toggleLike()">
                    <i class="fas fa-heart"></i> <span id="likeCount">0</span>
                </button>
                <button id="btnBookmark" class="action-btn" onclick="toggleBookmark()">
                    <i class="fas fa-bookmark"></i> ë¶ë§ˆí¬
                </button>
            </div>

            <div class="comment-section">
                <div style="display:flex; gap:5px; margin-bottom:15px;">
                    <input type="text" id="commentInput" class="input-box" style="margin:0; font-size:12px;" placeholder="ëŒ“ê¸€ ë‹¬ê¸°...">
                    <button onclick="submitComment()" style="background:var(--primary); color:white; border:none; border-radius:10px; width:50px; font-size:12px;">ë“±ë¡</button>
                </div>
                <div id="commentList"></div>
            </div>
        </div>
    </div>
    
    <div id="appContainer" class="app-container"></div>

    <div id="writeIcon" class="write-icon" onclick="openModal('adminWrite')">
        <i class="fas fa-plus"></i>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="renderTab('home')" id="nav-home"><i class="fas fa-home"></i><span>í™ˆ</span></div>
        <div class="nav-item" onclick="renderTab('letter')" id="nav-letter"><i class="fas fa-envelope"></i><span>ë ˆí„°</span></div>
        <div class="nav-item" onclick="renderTab('mood')" id="nav-mood"><i class="fas fa-smile"></i><span>ë¬´ë“œ</span></div>
        <div class="nav-item" onclick="renderTab('editorTalk')" id="nav-editorTalk"><i class="fas fa-comments"></i><span>ì—ë””í„°í†¡</span></div>
        <div class="nav-item" onclick="renderTab('mypage')" id="nav-mypage"><i class="fas fa-user"></i><span>ë§ˆì´</span></div>
    </nav>

    <script>
        // --- ë°ì´í„° ë° ìƒíƒœ ê´€ë¦¬ ---
        const ADMINS = ['happxi@jahyu.com', 'elly@jahyu.com', 'gokal@jahyu.com', 'sunny@jahyu.com', 'yudan@jahyu.com'];
        // ìš”ì²­ì‚¬í•­ 2: ì´ëª¨ì§€ íŒŒìŠ¤í…”í†¤ ë°°ê²½ìš© ì»¬ëŸ¬ ë§¤í•‘
        const MOOD_EMOJIS = [
            { emoji: 'ğŸ˜Š', bg: '#E0F2FE' }, { emoji: 'ğŸ¥°', bg: '#FCE7F3' }, { emoji: 'ğŸ˜Œ', bg: '#E9D5FF' },
            { emoji: 'ğŸ˜¢', bg: '#DBEAFE' }, { emoji: 'ğŸ˜ ', bg: '#FEE2E2' }, { emoji: 'ğŸ˜´', bg: '#D1FAE5' },
            { emoji: 'ğŸ’¡', bg: '#FEF3C7' }, { emoji: 'â˜€ï¸', bg: '#FDE68A' }, { emoji: 'ğŸ˜°', bg: '#FED7AA' }, { emoji: 'ğŸ˜', bg: '#F3F4F6' }
        ];

        let currentUser = null;
        let posts = []; // ëª¨ë“  ê¸€ í†µí•© ê´€ë¦¬ (idë¡œ êµ¬ë¶„)
        let comments = []; // ëŒ“ê¸€ ë°ì´í„°
        let myLikes = []; // ì¢‹ì•„ìš”í•œ ê¸€ ID ëª©ë¡
        let myBookmarks = []; // ë¶ë§ˆí¬í•œ ê¸€ ID ëª©ë¡
        let userStamps = 0;
        let currentViewingPostId = null;

        // ì´ˆê¸° ë°ì´í„° ì„¸íŒ…
        function initData() {
            // ë”ë¯¸ ë°ì´í„°
            posts = [
                { id: 101, type: 'letter', category: 'ìíœ´ë ˆí„°', title: '[32í˜¸] í‡´ì‚¬ í›„ ë²ˆì•„ì›ƒ, ì €ë§Œ ì´ëŸ°ê°€ìš”?', content: 'ì‰¬ì–´ë„ ì‰¬ëŠ” ê²ƒ ê°™ì§€ ì•Šì€ ë‹¹ì‹ ì—ê²Œ...', author: 'í–…ì”¨', authorId: 'happxi@jahyu.com', date: '2025-12-08', image: null },
                { id: 102, type: 'letter', category: 'ìíœ´ë©', title: 'ê¸€ì“°ê¸°ë¡œ ë§ˆìŒ ì±™ê¸°ê¸°', content: 'ë‚˜ë¥¼ ëŒì•„ë³´ëŠ” ì‹œê°„', author: 'ì—˜ë¦¬', authorId: 'elly@jahyu.com', date: '2025-12-09', image: null },
                { id: 201, type: 'talk', category: 'ì—ë””í„°í†¡', title: 'ì˜¤ëŠ˜ ë‚ ì”¨ ë§‘ìŒ â˜€ï¸', content: 'ì‚°ì±…í•˜ê¸° ë”± ì¢‹ì€ ë‚ ì”¨ë„¤ìš”!', author: 'ê³ ì¹¼', authorId: 'gokal@jahyu.com', date: '2025-12-10', image: null }
            ];
            comments = [
                { id: 1, postId: 201, content: 'ë§ì•„ìš” ë‚ ì”¨ ë„ˆë¬´ ì¢‹ì•„ìš”!', author: 'í–…ì‚', authorId: 'user@example.com', date: '2025-12-10' }
            ];
        }

        // --- ì´ˆê¸°í™” ---
        window.addEventListener('load', () => {
            initData();
            setTimeout(() => {
                document.getElementById('loadingScreen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                    checkLogin();
                }, 500);
            }, 800);
        });

        function checkLogin() {
            const saved = localStorage.getItem('jahyu_user');
            if (saved) {
                currentUser = JSON.parse(saved);
                renderTab('home');
            } else {
                showLoginModal();
            }
        }

        // --- ëª¨ë‹¬ ì œì–´ ---
        function closeModal() { document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('show')); }
        function showLoginModal() { closeModal(); document.getElementById('loginModal').classList.add('show'); }
        function showSignupModal() { closeModal(); document.getElementById('signupModal').classList.add('show'); }

        function openModal(type) {
            closeModal();
            document.getElementById('editPostId').value = ""; // ì´ˆê¸°í™”
            
            if (type === 'adminWrite') {
                document.getElementById('writeTitle').innerText = 'ê¸€ì“°ê¸°';
                document.getElementById('postCategory').style.display = 'block';
                document.getElementById('moodSection').style.display = 'none';
                document.getElementById('fileSection').style.display = 'block';
                document.getElementById('postTitle').style.display = 'block';
                document.getElementById('writeModal').classList.add('show');
            } else if (type === 'mood') {
                document.getElementById('writeTitle').innerText = 'ì˜¤ëŠ˜ì˜ ë¬´ë“œ';
                document.getElementById('postCategory').style.display = 'none';
                document.getElementById('moodSection').style.display = 'block';
                document.getElementById('fileSection').style.display = 'none';
                document.getElementById('postTitle').style.display = 'none'; // ë¬´ë“œëŠ” ì œëª© ì—†ì´ ë‚´ìš©ë§Œ
                
                // ì´ëª¨ì§€ ë Œë”ë§ (ìš”ì²­ì‚¬í•­ 2 ë°˜ì˜)
                const selector = document.getElementById('moodSelector');
                selector.innerHTML = MOOD_EMOJIS.map(e => 
                    `<div class="emoji-option" style="background:${e.bg}" onclick="selectEmoji(this)">${e.emoji}</div>`
                ).join('');
                
                document.getElementById('writeModal').classList.add('show');
            }
        }

        // --- ë¡œê·¸ì¸/íšŒì›ê°€ì… ---
        function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            if(!email) return alert('ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.');
            currentUser = { 
                id: email, 
                name: email.split('@')[0], 
                isAdmin: ADMINS.includes(email) 
            };
            localStorage.setItem('jahyu_user', JSON.stringify(currentUser));
            closeModal();
            renderTab('home');
        }

        function handleSignup() {
            alert('íšŒì›ê°€ì… ì™„ë£Œ! ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
            showLoginModal();
        }

        // --- ê¸€ì“°ê¸° / ìˆ˜ì • / ì‚­ì œ ---
        function selectEmoji(el) {
            document.querySelectorAll('.emoji-option').forEach(o => o.classList.remove('selected'));
            el.classList.add('selected');
        }

        function submitPost() {
            const editId = document.getElementById('editPostId').value;
            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;
            const isMood = document.getElementById('moodSection').style.display !== 'none';
            
            if (!content) return alert('ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');

            if (editId) {
                // ìˆ˜ì • ë¡œì§
                const post = posts.find(p => p.id == editId);
                if (post) {
                    post.title = title;
                    post.content = content;
                    // ì´ë¯¸ì§€ë‚˜ ì¹´í…Œê³ ë¦¬ ë“± ì¶”ê°€ ì—…ë°ì´íŠ¸ ê°€ëŠ¥
                    alert('ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    viewPost(post.id); // ìƒì„¸ í™”ë©´ ê°±ì‹ 
                }
            } else {
                // ì‹ ê·œ ë“±ë¡ ë¡œì§
                const newId = Date.now();
                let newPost = {
                    id: newId,
                    content: content,
                    author: currentUser.name,
                    authorId: currentUser.id,
                    date: new Date().toISOString().split('T')[0],
                    image: null // íŒŒì¼ ì²˜ë¦¬ ìƒëµ (êµ¬ì¡°ë§Œ ì¡ìŒ)
                };

                if (isMood) {
                    const selected = document.querySelector('.emoji-option.selected');
                    if (!selected) return alert('ê¸°ë¶„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    newPost.type = 'mood';
                    newPost.emoji = selected.innerText;
                    newPost.bg = selected.style.backgroundColor; // ë°°ê²½ìƒ‰ ì €ì¥
                    newPost.title = 'ì˜¤ëŠ˜ì˜ ë¬´ë“œ';
                    userStamps++;
                } else {
                    newPost.type = document.getElementById('postCategory').value === 'ì—ë””í„°í†¡' ? 'talk' : 'letter';
                    newPost.category = document.getElementById('postCategory').value;
                    newPost.title = title;
                }
                
                posts.unshift(newPost);
                alert('ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }
            
            // ì´ˆê¸°í™”
            document.getElementById('postTitle').value = '';
            document.getElementById('postContent').value = '';
            closeModal();
            renderTab('home');
        }

        function openEditModal() {
            const post = posts.find(p => p.id == currentViewingPostId);
            if (!post) return;
            
            // ê¸€ì“°ê¸° ëª¨ë‹¬ ì¬ì‚¬ìš©
            closeModal();
            setTimeout(() => {
                document.getElementById('writeTitle').innerText = 'ê¸€ ìˆ˜ì •';
                document.getElementById('editPostId').value = post.id;
                document.getElementById('postTitle').value = post.title || '';
                document.getElementById('postContent').value = post.content;
                
                // UI ì„¸íŒ…
                if (post.type === 'mood') {
                    document.getElementById('postCategory').style.display = 'none';
                    document.getElementById('moodSection').style.display = 'none'; // ë¬´ë“œ ìˆ˜ì • ì‹œ ì´ëª¨ì§€ëŠ” ë³€ê²½ ë¶ˆê°€ ì •ì±…(ê°„ì†Œí™”)
                    document.getElementById('fileSection').style.display = 'none';
                    document.getElementById('postTitle').style.display = 'none';
                } else {
                    document.getElementById('postCategory').style.display = 'block';
                    document.getElementById('postCategory').value = post.category;
                    document.getElementById('moodSection').style.display = 'none';
                    document.getElementById('fileSection').style.display = 'block';
                    document.getElementById('postTitle').style.display = 'block';
                }
                
                document.getElementById('writeModal').classList.add('show');
            }, 100);
        }

        function deleteCurrentPost() {
            if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                posts = posts.filter(p => p.id != currentViewingPostId);
                // ì—°ê´€ ëŒ“ê¸€, ì¢‹ì•„ìš” ì‚­ì œ
                comments = comments.filter(c => c.postId != currentViewingPostId);
                myLikes = myLikes.filter(id => id != currentViewingPostId);
                myBookmarks = myBookmarks.filter(id => id != currentViewingPostId);
                
                alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                closeModal();
                renderTab(document.querySelector('.nav-item.active').id.replace('nav-', '')); // í˜„ì¬ íƒ­ ìƒˆë¡œê³ ì¹¨
            }
        }

        // --- ìƒì„¸ ë³´ê¸° & ì¸í„°ë™ì…˜ (ì¢‹ì•„ìš”/ë¶ë§ˆí¬/ëŒ“ê¸€) ---
        function viewPost(id) {
            const post = posts.find(p => p.id == id);
            if (!post) return;

            currentViewingPostId = id;

            // ë‚´ìš© ì±„ìš°ê¸°
            document.getElementById('detailCategory').innerText = post.category || 'Mood';
            document.getElementById('detailTitle').innerText = post.title;
            document.getElementById('detailAuthor').innerText = post.author;
            document.getElementById('detailDate').innerText = post.date;
            
            // ë³¸ë¬¸ ì²˜ë¦¬ (ë¬´ë“œì¸ ê²½ìš° ì´ëª¨ì§€ í‘œì‹œ)
            let contentHtml = post.content;
            if (post.type === 'mood') {
                contentHtml = `<div style="font-size:40px; text-align:center; padding:20px; background:${post.bg || '#eee'}; border-radius:20px; margin-bottom:15px;">${post.emoji}</div>` + contentHtml;
            }
            document.getElementById('detailContent').innerHTML = contentHtml;
            document.getElementById('detailImage').style.display = 'none'; // ì´ë¯¸ì§€ ìƒëµ

            // ìš”ì²­ì‚¬í•­ 5: ê´€ë¦¬ ë²„íŠ¼ í‘œì‹œ ì—¬ë¶€ (ê´€ë¦¬ì or ì‘ì„±ì ë³¸ì¸)
            const btnGroup = document.getElementById('manageButtons');
            if (currentUser.isAdmin || currentUser.id === post.authorId) {
                btnGroup.style.display = 'flex';
            } else {
                btnGroup.style.display = 'none';
            }

            // ìš”ì²­ì‚¬í•­ 4: ì¢‹ì•„ìš”/ë¶ë§ˆí¬ ìƒíƒœ ë°˜ì˜
            updateInteractionButtons();
            
            // ëŒ“ê¸€ ë Œë”ë§
            renderComments();

            // ëª¨ë‹¬ ì—´ê¸°
            closeModal(); // ê¸°ì¡´ ëª¨ë‹¬ ë‹«ê¸°
            setTimeout(() => document.getElementById('postDetailModal').classList.add('show'), 50);
        }

        function updateInteractionButtons() {
            const btnLike = document.getElementById('btnLike');
            const btnBookmark = document.getElementById('btnBookmark');
            const likeCount = document.getElementById('likeCount');

            // ì¢‹ì•„ìš” ìƒíƒœ
            if (myLikes.includes(currentViewingPostId)) {
                btnLike.classList.add('active-like');
                likeCount.innerText = '1'; // ë‹¨ìˆœ ì¹´ìš´íŠ¸ ì˜ˆì‹œ
            } else {
                btnLike.classList.remove('active-like');
                likeCount.innerText = '0';
            }

            // ë¶ë§ˆí¬ ìƒíƒœ
            if (myBookmarks.includes(currentViewingPostId)) {
                btnBookmark.classList.add('active-bookmark');
                btnBookmark.innerHTML = '<i class="fas fa-bookmark"></i> ì €ì¥ë¨';
            } else {
                btnBookmark.classList.remove('active-bookmark');
                btnBookmark.innerHTML = '<i class="fas fa-bookmark"></i> ë¶ë§ˆí¬';
            }
        }

        function toggleLike() {
            if (myLikes.includes(currentViewingPostId)) {
                myLikes = myLikes.filter(id => id != currentViewingPostId);
            } else {
                myLikes.push(currentViewingPostId);
            }
            updateInteractionButtons();
            // ë§ˆì´í˜ì´ì§€ ê°±ì‹ ì„ ìœ„í•´ ë°ì´í„°ëŠ” ë°°ì—´ì— ì €ì¥ë¨
        }

        function toggleBookmark() {
            if (myBookmarks.includes(currentViewingPostId)) {
                myBookmarks = myBookmarks.filter(id => id != currentViewingPostId);
            } else {
                myBookmarks.push(currentViewingPostId);
            }
            updateInteractionButtons();
        }

        function submitComment() {
            const input = document.getElementById('commentInput');
            const text = input.value;
            if(!text) return;
            
            comments.push({
                id: Date.now(),
                postId: currentViewingPostId,
                content: text,
                author: currentUser.name,
                authorId: currentUser.id,
                date: new Date().toISOString().split('T')[0]
            });
            input.value = '';
            renderComments();
        }

        function deleteComment(commentId) {
            if(confirm('ëŒ“ê¸€ì„ ì‚­ì œí• ê¹Œìš”?')) {
                comments = comments.filter(c => c.id != commentId);
                renderComments();
            }
        }

        function renderComments() {
            const list = document.getElementById('commentList');
            const postComments = comments.filter(c => c.postId == currentViewingPostId);
            
            list.innerHTML = postComments.map(c => `
                <div class="comment-item">
                    <div class="comment-meta">
                        <span>${c.author} Â· ${c.date}</span>
                        ${(currentUser.isAdmin || currentUser.id === c.authorId) ? `<span class="comment-del" onclick="deleteComment(${c.id})">ì‚­ì œ</span>` : ''}
                    </div>
                    <div>${c.content}</div>
                </div>
            `).join('');
        }

        // --- íƒ­ ë Œë”ë§ ---
        function renderTab(tab) {
            if (!currentUser) return showLoginModal();

            // ë„¤ë¹„ê²Œì´ì…˜ í™œì„±í™”
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById(`nav-${tab}`).classList.add('active');

            // ê¸€ì“°ê¸° ë²„íŠ¼ (ê´€ë¦¬ìë§Œ ê¸€ì“°ê¸°, ì‚¬ìš©ìë„ ë¬´ë“œëŠ” ê°€ëŠ¥í•˜ì§€ë§Œ íƒ­ì— ë”°ë¼ ë‹¤ë¦„)
            const writeIcon = document.getElementById('writeIcon');
            if (tab === 'mood') {
                 // ë¬´ë“œ íƒ­ì—ì„œëŠ” ëˆ„êµ¬ë‚˜ ê¸°ë¡ ê°€ëŠ¥í•˜ê²Œ í•  ìˆ˜ë„ ìˆìœ¼ë‚˜, ìš”ì²­ ë¡œì§ìƒ ê´€ë¦¬ì ê¸€ì“°ê¸° ì•„ì´ì½˜ ìœ ì§€
                 // ì—¬ê¸°ì„œëŠ” 'ë¬´ë“œ ê¸°ë¡' ë²„íŠ¼ì´ ì»¨í…ì¸  ì•ˆì— ìˆìœ¼ë¯€ë¡œ, í”Œë¡œíŒ… ë²„íŠ¼ì€ ì—ë””í„°ìš©ìœ¼ë¡œë§Œ ì‚¬ìš©
                 writeIcon.style.display = currentUser.isAdmin ? 'flex' : 'none';
            } else if (tab === 'letter' || tab === 'editorTalk') {
                 writeIcon.style.display = currentUser.isAdmin ? 'flex' : 'none';
            } else {
                 writeIcon.style.display = 'none';
            }

            const container = document.getElementById('appContainer');
            container.innerHTML = '';
            window.scrollTo(0,0);

            if (tab === 'home') {
                container.innerHTML = `
                    <div class="header-section">
                        <div class="header-title">ì•ˆë…•í•˜ì„¸ìš”, ${currentUser.name}ë‹˜!</div>
                        <div class="header-sub">ì˜¤ëŠ˜ í•˜ë£¨ëŠ” ì–´ë– ì…¨ë‚˜ìš”?</div>
                    </div>
                    <div class="content-card" style="text-align:center;">
                        <h3>ì˜¤ëŠ˜ì˜ íë§ ì¹´ë“œ</h3>
                        <p style="color:#666; margin:10px 0;">ì ì‹œ ëˆˆì„ ê°ê³  ì‹¬í˜¸í¡ì„ í•´ë³´ì„¸ìš” ğŸŒ¿</p>
                    </div>
                    <div style="padding:0 20px;">
                        <h4 style="margin:15px 0;">ìµœê·¼ ê²Œì‹œê¸€</h4>
                        ${getPostListHTML(posts.slice(0, 3))}
                    </div>
                `;
            } else if (tab === 'letter') {
                const letters = posts.filter(p => p.type === 'letter');
                container.innerHTML = `
                    <div class="header-section">
                        <div class="header-title">ìíœ´ë ˆí„°</div>
                        <div class="header-sub">ë§ˆìŒì˜ íœ´ì‹ì„ ìœ„í•œ í¸ì§€</div>
                    </div>
                    <div style="padding:0 20px;">${getPostListHTML(letters)}</div>
                `;
            } else if (tab === 'mood') {
                const moods = posts.filter(p => p.type === 'mood' && p.authorId === currentUser.id);
                container.innerHTML = `
                    <div class="header-section">
                        <div class="header-title">ë¬´ë“œ íŠ¸ë˜ì»¤</div>
                        <div class="header-sub">ë‚˜ì˜ ê°ì • ê¸°ë¡ì¥</div>
                    </div>
                    <div class="content-card" style="text-align:center;">
                        <button class="btn-primary" onclick="openModal('mood')" style="margin:0;">ì˜¤ëŠ˜ì˜ ê¸°ë¶„ ê¸°ë¡í•˜ê¸°</button>
                    </div>
                    <div style="padding:0 20px;">
                        <h4 style="margin:15px 0;">ë‚˜ì˜ ê¸°ë¡</h4>
                        ${getPostListHTML(moods)}
                    </div>
                `;
            } else if (tab === 'editorTalk') {
                const talks = posts.filter(p => p.type === 'talk');
                container.innerHTML = `
                    <div class="header-section">
                        <div class="header-title">ì—ë””í„°í†¡</div>
                        <div class="header-sub">ì—ë””í„°ë“¤ì˜ ì†Œì†Œí•œ ì¼ìƒ</div>
                    </div>
                    <div style="padding:0 20px;">${getPostListHTML(talks)}</div>
                `;
            } else if (tab === 'mypage') {
                renderMyPage(container);
            }
        }

        // --- ë§ˆì´í˜ì´ì§€ êµ¬í˜„ (ìš”ì²­ì‚¬í•­ 3) ---
        function renderMyPage(container) {
            container.innerHTML = `
                <div class="header-section">
                    <div class="header-title">ë§ˆì´í˜ì´ì§€</div>
                    <div class="header-sub">${currentUser.name}ë‹˜ (${currentUser.id})</div>
                    <p style="font-size:12px; margin-top:5px;">ë³´ìœ  ìŠ¤íƒ¬í”„: ${userStamps}ê°œ</p>
                    ${currentUser.isAdmin ? '<span style="background:#E0E7FF; color:#4338CA; padding:2px 8px; border-radius:10px; font-size:10px;">ê´€ë¦¬ì</span>' : ''}
                </div>
                
                <div class="mypage-tabs">
                    <div class="mypage-tab active" onclick="switchMyTab(this, 'posts')">ë‚´ê°€ ì“´ ê¸€</div>
                    <div class="mypage-tab" onclick="switchMyTab(this, 'comments')">ë‚´ê°€ ì“´ ëŒ“ê¸€</div>
                    <div class="mypage-tab" onclick="switchMyTab(this, 'likes')">ì¢‹ì•„ìš”</div>
                    <div class="mypage-tab" onclick="switchMyTab(this, 'bookmarks')">ë¶ë§ˆí¬</div>
                </div>

                <div id="mypageContent" style="padding: 0 20px;"></div>
                <div style="padding: 20px;">
                    <button onclick="localStorage.removeItem('jahyu_user'); location.reload();" style="width:100%; padding:10px; border:1px solid #ddd; background:white; border-radius:10px;">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            `;
            // ê¸°ë³¸ ë¡œë“œ
            loadMyContent('posts');
        }

        function switchMyTab(el, type) {
            document.querySelectorAll('.mypage-tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            loadMyContent(type);
        }

        function loadMyContent(type) {
            const area = document.getElementById('mypageContent');
            let content = '';

            if (type === 'posts') {
                const myPosts = posts.filter(p => p.authorId === currentUser.id);
                content = myPosts.length ? getPostListHTML(myPosts) : '<p style="text-align:center; color:#999; margin-top:20px;">ì‘ì„±í•œ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            } else if (type === 'comments') {
                const myComments = comments.filter(c => c.authorId === currentUser.id).reverse();
                if (myComments.length) {
                    content = myComments.map(c => {
                        const originalPost = posts.find(p => p.id == c.postId);
                        const postTitle = originalPost ? originalPost.title : 'ì‚­ì œëœ ê²Œì‹œê¸€';
                        return `
                        <div class="content-card" onclick="${originalPost ? `viewPost(${originalPost.id})` : ''}">
                            <div style="font-size:11px; color:var(--primary); margin-bottom:5px;">${postTitle}</div>
                            <div style="font-size:13px;">${c.content}</div>
                            <div style="font-size:10px; color:#999; margin-top:5px;">${c.date}</div>
                        </div>`;
                    }).join('');
                } else {
                    content = '<p style="text-align:center; color:#999; margin-top:20px;">ì‘ì„±í•œ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
            } else if (type === 'likes') {
                const likedPosts = posts.filter(p => myLikes.includes(p.id));
                content = likedPosts.length ? getPostListHTML(likedPosts) : '<p style="text-align:center; color:#999; margin-top:20px;">ì¢‹ì•„ìš”í•œ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            } else if (type === 'bookmarks') {
                const bookmarkedPosts = posts.filter(p => myBookmarks.includes(p.id));
                content = bookmarkedPosts.length ? getPostListHTML(bookmarkedPosts) : '<p style="text-align:center; color:#999; margin-top:20px;">ë¶ë§ˆí¬í•œ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
            area.innerHTML = content;
        }

        // ê³µí†µ ë¦¬ìŠ¤íŠ¸ HTML ìƒì„±ê¸°
        function getPostListHTML(list) {
            return list.map(p => {
                const isMood = p.type === 'mood';
                return `
                <div class="content-card" onclick="viewPost(${p.id})">
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                        <span style="font-size:10px; color:var(--primary); font-weight:bold;">${p.category || 'Mood'}</span>
                        <span style="font-size:10px; color:#999;">${p.date}</span>
                    </div>
                    <div style="display:flex; align-items:center;">
                        ${isMood ? `<div style="font-size:24px; margin-right:10px;">${p.emoji}</div>` : ''}
                        <div>
                            <h4 style="font-size:15px; margin:0 0 5px 0;">${p.title}</h4>
                            <p style="font-size:12px; color:#666; overflow:hidden; white-space:nowrap; text-overflow:ellipsis; max-width:250px;">
                                ${p.content.substring(0, 30)}${p.content.length > 30 ? '...' : ''}
                            </p>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }
    </script>
</body>
</html>
