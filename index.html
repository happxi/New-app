<!DOCTYPE html>  
<html lang="ko">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">  
    <title>ìíœ´ë ˆí„° - í–…ì‚ë‹˜ì„ ìœ„í•œ íŠ¹ë³„í•œ ê³µê°„!</title>  
      
    <meta property="og:title" content="ìíœ´ë ˆí„°ë¥¼ ì•±ìœ¼ë¡œ ë§Œë‚˜ë³´ì„¸ìš”!">  
    <meta property="og:description" content=" ë¬´ë“œíŠ¸ë˜ì»¤ë„ ê¸°ë¡í•´ë³´ì„¸ìš”!">  
    <meta property="og:image" content="https://i.imgur.com/exampleImage.png">   
    <meta property="og:url" content="https://assets.carat-api.im/files/2907633/97cb17f3-d538-4c40-9705-3f9e517a4d5a/jahyu_letter_app_fixed.html">  
    <meta property="og:type" content="website">  
      
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Round+Gothic:wght@400;700;800&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">  
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">  
      
    <!-- Firebase SDK -->  
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>  
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>  
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>  
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-analytics-compat.js"></script>  
      
    <style>  
        /* ê¸°ì¡´ CSS ì½”ë“œëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ - ìƒëµë¨ */  
        :root {  
            /* ğŸ¨ íŠ¸ë Œë””í•œ 2030 ì—¬ì„± ëŒ€ìƒ ì»¬ëŸ¬ íŒ”ë ˆíŠ¸ */  
            --primary: #6B46C1;       /* ë³´ë¼ìƒ‰ - ë©”ì¸ */  
            --primary-soft: #F3E8FF;  /* ì—°í•œ ë³´ë¼ */  
            --accent: #FF6B9D;        /* í•‘í¬ - í¬ì¸íŠ¸ */  
            --accent-soft: #FFE4EC;   /* ì—°í•œ í•‘í¬ */  
            --secondary: #4ECDC4;     /* ë¯¼íŠ¸ - ì„œë¸Œ */  
            --secondary-soft: #E6FFF9; /* ì—°í•œ ë¯¼íŠ¸ */  
            --text-main: #2D3748;     /* ì§„í•œ íšŒìƒ‰ í…ìŠ¤íŠ¸ */  
            --text-sub: #718096;      /* íšŒìƒ‰ ì„œë¸Œ í…ìŠ¤íŠ¸ */  
            --bg-body: #F8F9FA;       /* ì „ì²´ ë°°ê²½ */  
            --white: #FFFFFF;  
            --glass-bg: rgba(255, 255, 255, 0.85);  
            --glass-border: rgba(255, 255, 255, 0.2);  
            --shadow-card: 0 8px 32px rgba(107, 70, 193, 0.12);  
            --shadow-glass: 0 8px 32px rgba(31, 38, 135, 0.15);  
        }  
  
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Nanum Round Gothic', 'Noto Sans KR', sans-serif; -webkit-tap-highlight-color: transparent; }  
          
        body {  
            background: linear-gradient(135deg, #F8F9FA 0%, #E6FFF9 100%);  
            color: var(--text-main);  
            min-height: 100vh;  
            overflow-x: hidden;  
            display: flex; flex-direction: column; align-items: center;  
            position: relative;  
        }  
  
        .app-container {  
            width: 100%; max-width: 480px; min-height: 100vh;  
            background: var(--glass-bg);  
            backdrop-filter: blur(10px);  
            border-radius: 30px 30px 0 0;  
            margin-top: 20px;  
            box-shadow: var(--shadow-glass);  
            border: 1px solid var(--glass-border);  
            padding-bottom: 90px;  
            position: relative;  
        }  
  
        /* ê¸°íƒ€ ëª¨ë“  CSS ìŠ¤íƒ€ì¼ë“¤ - í•œê³„ë¡œ ìƒëµë¨ (ì‚¬ìš©ì ê¸°ì¡´ CSSì™€ ë™ì¼) */  
  
    </style>  
</head>  
<body>  
  
    <!-- ê¸°ì¡´ HTML êµ¬ì¡°ëŠ” ë™ì¼ - ìƒëµ -->  
      
    <script>  
    // --- Firebase ì´ˆê¸°í™” ---  
    const firebaseConfig = {  
        apiKey: "AIzaSyDq2eT8H6tNcsrT8dhZWsEyyMZbpCZIZZQ",  
        authDomain: "jahyu-e24cd.firebaseapp.com",  
        databaseURL: "https://jahyu-e24cd-default-rtdb.firebaseio.com",  
        projectId: "jahyu-e24cd",  
        storageBucket: "jahyu-e24cd.firebasestorage.app",  
        messagingSenderId: "955637836464",  
        appId: "1:955637836464:web:096ed0c28e0070f4fca975",  
        measurementId: "G-CTDZFNYJV7"  
    };  
  
    // Firebase ì´ˆê¸°í™”  
    firebase.initializeApp(firebaseConfig);  
    const db = firebase.firestore();  
    const auth = firebase.auth();  
    const analytics = firebase.analytics();  
  
    // --- Firebase ì—°ë™ í•¨ìˆ˜ ---  
  
    // ë°ì´í„° ì´ˆê¸° ë¶ˆëŸ¬ì˜¤ê¸°  
    async function loadInitialData() {  
        try {  
            // ì‚¬ìš©ì ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°  
            const usersSnapshot = await db.collection('users').get();  
            users = usersSnapshot.docs.map(doc => doc.data());  
              
            // ê²Œì‹œê¸€ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°  
            const postsSnapshot = await db.collection('posts').get();  
            posts = postsSnapshot.docs.map(doc => ({ ...doc.data(), id: doc.id }));  
              
            // ì—ë””í„°í†¡ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°  
            const talksSnapshot = await db.collection('editorTalks').get();  
            editorTalks = talksSnapshot.docs.map(doc => ({ ...doc.data(), id: doc.id }));  
              
            // ë¬´ë“œ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°  
            const moodsSnapshot = await db.collection('moodRecords').get();  
            myMoodRecords = moodsSnapshot.docs.map(doc => ({ ...doc.data(), id: doc.id }));  
              
            // ëŒ“ê¸€ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°  
            const commentsSnapshot = await db.collectionGroup('replies').get();  
            comments = {};  
            commentsSnapshot.forEach(doc => {  
                const comment = { ...doc.data(), id: doc.id };  
                const postId = comment.postId;  
                if (!comments[postId]) comments[postId] = [];  
                comments[postId].push(comment);  
            });  
              
            // í™œë™ ë¡œê·¸ ë¶ˆëŸ¬ì˜¤ê¸°  
            const activitySnapshot = await db.collection('activityLogs').get();  
            activityLogs = activitySnapshot.docs.map(doc => doc.data());  
              
            // í†µí•© ê²Œì‹œê¸€ ëª©ë¡ ì—…ë°ì´íŠ¸  
            allPosts = [...posts, ...editorTalks];  
              
            console.log('Firebase ë°ì´í„° ë¡œë“œ ì™„ë£Œ');  
        } catch (error) {  
            console.error('Firebase ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);  
        }  
    }  
  
    // ì‚¬ìš©ì ë°ì´í„° ì €ì¥  
    async function saveUser(userData) {  
        try {  
            await db.collection('users').doc(userData.id).set(userData);  
            console.log('ì‚¬ìš©ì Firebase ì €ì¥ ì™„ë£Œ:', userData.id);  
        } catch (error) {  
            console.error('ì‚¬ìš©ì Firebase ì €ì¥ ì˜¤ë¥˜:', error);  
        }  
    }  
  
    // ê²Œì‹œê¸€ ì €ì¥  
    async function savePost(postData) {  
        try {  
            const docRef = await db.collection('posts').add(postData);  
            console.log('ê²Œì‹œê¸€ Firebase ì €ì¥ ì™„ë£Œ:', docRef.id);  
            return docRef.id;  
        } catch (error) {  
            console.error('ê²Œì‹œê¸€ Firebase ì €ì¥ ì˜¤ë¥˜:', error);  
            throw error;  
        }  
    }  
  
    // ì—ë””í„°í†¡ ì €ì¥  
    async function saveEditorTalk(talkData) {  
        try {  
            const docRef = await db.collection('editorTalks').add(talkData);  
            console.log('ì—ë””í„°í†¡ Firebase ì €ì¥ ì™„ë£Œ:', docRef.id);  
            return docRef.id;  
        } catch (error) {  
            console.error('ì—ë””í„°í†¡ Firebase ì €ì¥ ì˜¤ë¥˜:', error);  
            throw error;  
        }  
    }  
  
    // ë¬´ë“œ ê¸°ë¡ ì €ì¥  
    async function saveMoodRecord(moodData) {  
        try {  
            const docRef = await db.collection('moodRecords').add(moodData);  
            console.log('ë¬´ë“œ ê¸°ë¡ Firebase ì €ì¥ ì™„ë£Œ:', docRef.id);  
            return docRef.id;  
        } catch (error) {  
            console.error('ë¬´ë“œ ê¸°ë¡ Firebase ì €ì¥ ì˜¤ë¥˜:', error);  
            throw error;  
        }  
    }  
  
    // í™œë™ ë¡œê·¸ ì €ì¥  
    async function saveActivityLog(logData) {  
        try {  
            await db.collection('activityLogs').add(logData);  
            console.log('í™œë™ ë¡œê·¸ Firebase ì €ì¥ ì™„ë£Œ');  
        } catch (error) {  
            console.error('í™œë™ ë¡œê·¸ Firebase ì €ì¥ ì˜¤ë¥˜:', error);  
        }  
    }  
  
    // ëŒ“ê¸€ ì €ì¥  
    async function saveComment(postId, commentData) {  
        try {  
            await db.collection('comments').doc(postId).collection('replies').add(commentData);  
            console.log('ëŒ“ê¸€ Firebase ì €ì¥ ì™„ë£Œ');  
        } catch (error) {  
            console.error('ëŒ“ê¸€ Firebase ì €ì¥ ì˜¤ë¥˜:', error);  
        }  
    }  
  
    // ì‚¬ìš©ì ì„ í˜¸ë„ ì €ì¥  
    async function saveUserPreferences(userId, preferences) {  
        try {  
            await db.collection('userPreferences').doc(userId).set(preferences);  
            console.log('ì‚¬ìš©ì ì„ í˜¸ë„ Firebase ì €ì¥ ì™„ë£Œ');  
        } catch (error) {  
            console.error('ì‚¬ìš©ì ì„ í˜¸ë„ Firebase ì €ì¥ ì˜¤ë¥˜:', error);  
        }  
    }  
  
    // --- ê¸°ì¡´ ë°ì´í„° ë³€ìˆ˜ë“¤ ---  
    const ADMINS = ['happxi@jahyu.com', 'elly@jahyu.com', 'gokal@jahyu.com', 'sunny@jahyu.com', 'yudan@jahyu.com'];  
    const SUPER_ADMIN = 'happxi@jahyu.com';  
      
    let currentUser = null;  
    let currentTab = 'home';  
    let userStamps = 0; Firebaseì—ì„œ ë¡œë“œ  
    let selectedMoodEmoji = null;  
    let todayMoodSubmitted = false;  
    let attachedFile = null;  
  
    let users = [];  
    let posts = [];  
    let editorTalks = [];  
    let allPosts = [];  
    let myMoodRecords = [];  
    let comments = {};  
    let bookmarks = [];  
    let myLikes = [];  
    let activityLogs = [];  
  
    // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---  
    function findUserById(id) { return users.find(u => u.id === id); }  
    function findUserByName(name) { return users.find(u => u.name === name); }  
    function findPostById(postId) { return allPosts.find(p => p.id === postId); }  
    function showToast(msg) {  
        const div = document.createElement('div'); div.className = 'toast'; div.innerText = msg;  
        document.body.appendChild(div);  
        setTimeout(() => div.remove(), 3000);  
    }  
  
    function getTimeAgo(dateString) {  
        const now = new Date(); const past = new Date(dateString);  
        const diffMs = now.getTime() - past.getTime();  
        const diffMin = Math.floor(diffMs / (1000 * 60));  
        if (diffMin < 60) return `${diffMin}ë¶„ ì „`;  
        const diffHour = Math.floor(diffMin / 60);  
        if (diffHour < 24) return `${diffHour}ì‹œê°„ ì „`;  
        const diffDay = Math.floor(diffHour / 24);  
        if (diffDay < 7) return `${diffDay}ì¼ ì „`;  
        return new Date(dateString).toLocaleDateString('ko-KR').replace(/\. /g, '.').replace(/\.$/, '');  
    }  
      
    // --- í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ì´ˆê¸°í™” ---  
    document.addEventListener('DOMContentLoaded', async () => {  
        await loadInitialData(); // Firebase ë°ì´í„° ë¨¼ì € ë¡œë“œ  
        checkAutoLogin(); // ê·¸ í›„ ë¡œê·¸ì¸ ì²´í¬  
    });  
  
    // --- ë¡œê·¸ì¸ ì²˜ë¦¬ (Firebase ì—°ë™) ---  
    async function handleLogin() {  
        const email = document.getElementById('loginEmail').value.trim();  
        const password = document.getElementById('loginPassword').value;  
          
        if (!email || !password) return showToast('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');  
        if (!email.includes('@')) return showToast('ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');  
          
        const user = users.find(u => u.id === email);  
        if (!user) return showToast('ë“±ë¡ë˜ì§€ ì•Šì€ ì´ë©”ì¼ì…ë‹ˆë‹¤. íšŒì›ê°€ì…ì„ í•´ì£¼ì„¸ìš”.');  
        if (user.password !== password) return showToast('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');  
  
        currentUser = {  
            id: user.id, name: user.name, isAdmin: ADMINS.includes(user.id),  
            isSuperAdmin: user.id === SUPER_ADMIN, password: user.password  
        };  
  
        if (document.getElementById('keepLogin').checked) {  
            localStorage.setItem('jahyu_user', JSON.stringify(currentUser));  
        }  
  
        // í™œë™ ë¡œê·¸ ì¶”ê°€ (Firebase ì €ì¥)  
        const logData = {   
            type: 'login',   
            user: currentUser.name,   
            date: new Date().toISOString(),   
            userId: currentUser.id   
        };  
        activityLogs.push(logData);  
        await saveActivityLog(logData);  
  
        document.getElementById('loginModal').style.display = 'none';  
        renderTab('home');  
        showToast(`${currentUser.name}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`);  
    }  
  
    // --- íšŒì›ê°€ì… ì²˜ë¦¬ (Firebase ì—°ë™) ---  
    async function handleSignup() {  
        const nickname = document.getElementById('signupNickname').value.trim();  
        const email = document.getElementById('signupEmail').value.trim();  
        const password = document.getElementById('signupPassword').value;  
        const passwordConfirm = document.getElementById('signupPasswordConfirm').value;  
        const agreeTerms = document.getElementById('agreeTerms').checked;  
  
        if (!email || !nickname || !password || !passwordConfirm) return showToast('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');  
        if (!email.includes('@')) return showToast('ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');  
        if (password !== passwordConfirm) return showToast('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');  
        if (password.length < 6) return showToast('ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');  
        if (!agreeTerms) return showToast('ì´ìš©ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”.');  
        if (users.some(u => u.id === email)) return showToast('ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤. ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');  
          
        const newUser = { id: email, name: nickname, password: password };  
        users.push(newUser);  
        await saveUser(newUser); // Firebaseì— ì €ì¥  
  
        currentUser = {  
            id: email, name: nickname, isAdmin: ADMINS.includes(email),  
            isSuperAdmin: email === SUPER_ADMIN, password: password  
        };  
  
        localStorage.setItem('jahyu_user', JSON.stringify(currentUser));  
  
        // í™œë™ ë¡œê·¸ ì¶”ê°€ (Firebase ì €ì¥)  
        const logData = {   
            type: 'signup',   
            user: currentUser.name,   
            date: new Date().toISOString(),   
            userId: currentUser.id   
        };  
        activityLogs.push(logData);  
        await saveActivityLog(logData);  
  
        document.getElementById('signupModal').style.display = 'none';  
        renderTab('home');  
        showToast(`${nickname}ë‹˜, íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!`);  
    }  
  
    // --- ê²Œì‹œê¸€ ë“±ë¡ (Firebase ì—°ë™) ---  
    async function submitPost() {  
        const title = document.getElementById('postTitle').value.trim();  
        const content = document.getElementById('postContent').value.trim();  
        const postCategorySelect = document.getElementById('postCategory');  
        const isMoodRecord = document.getElementById('moodSelector').style.display === 'grid';  
          
        if (!title || !content) return showToast('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');  
          
        if (isMoodRecord) {  
            // ë¬´ë“œ ê¸°ë¡ ì²˜ë¦¬  
            const today = new Date().toDateString();  
            if (myMoodRecords.some(record => new Date(record.date).toDateString() === today && record.authorId === currentUser.id)) {  
                showToast('ì˜¤ëŠ˜ì€ ì´ë¯¸ ë¬´ë“œë¥¼ ê¸°ë¡í•˜ì…¨ì–´ìš”!');  
                closeModal();  
                return;  
            }  
              
            if (!selectedMoodEmoji) return showToast('ê°ì • ì´ëª¨ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');  
  
            const moodRecord = {  
                id: 'M' + (myMoodRecords.length + 1),  
                emoji: selectedMoodEmoji,  
                title: title,  
                content: content,  
                date: new Date().toISOString(),  
                author: currentUser.name,  
                authorId: currentUser.id  
            };  
  
            // Firebaseì— ë¬´ë“œ ê¸°ë¡ ì €ì¥  
            moodRecord.id = await saveMoodRecord(moodRecord);  
            myMoodRecords.push(moodRecord);  
            todayMoodSubmitted = true;  
              
            if (userStamps < 30) userStamps++;  
  
            // í™œë™ ë¡œê·¸ Firebase ì €ì¥  
            const logData = {   
                type: 'mood',   
                user: currentUser.name,   
                date: new Date().toISOString(),   
                targetId: moodRecord.id,   
                userId: currentUser.id   
            };  
            activityLogs.push(logData);  
            await saveActivityLog(logData);  
              
            showToast("ë¬´ë“œ ê¸°ë¡ ì™„ë£Œ! ìíœ´ìŠ¤íƒ¬í”„ê°€ ì ë¦½ë˜ì—ˆìŠµë‹ˆë‹¤ âœ¨");  
            renderTab('mood');  
        } else if (currentUser.isAdmin) {  
            // ê´€ë¦¬ì ê¸€ì“°ê¸° (ë ˆí„° / ì—ë””í„°í†¡) ì²˜ë¦¬  
            const selectedCategory = postCategorySelect.value;  
            const isLetterOrLab = selectedCategory === 'ìíœ´ë ˆí„°' || selectedCategory === 'ìíœ´ë©';  
              
            const newId = Math.max(...allPosts.map(p => p.id), 0) + 1;  
            const imageUrl = attachedFile ? document.getElementById('imagePreview').src : null;  
              
            const newPost = {  
                id: newId,  
                title: isLetterOrLab ? title : title,  
                category: selectedCategory,  
                content: content,  
                author: currentUser.name,  
                authorId: currentUser.id,  
                date: new Date().toISOString(),  
                likes: 0,  
                comments: 0,  
                image: imageUrl  
            };  
  
            if (isLetterOrLab) {  
                newPost.id = await savePost(newPost);  
                posts.unshift(newPost);  
                allPosts.unshift(newPost);  
                showToast(`${selectedCategory}ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!`);  
                renderTab('letter');  
            } else if (selectedCategory === 'ì—ë””í„°í†¡') {  
                newPost.id = await saveEditorTalk(newPost);  
                editorTalks.unshift(newPost);  
                allPosts.unshift(newPost);  
                showToast("ì—ë””í„°í†¡ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!");  
                renderTab('editorTalk');  
            }  
  
            // í™œë™ ë¡œê·¸ Firebase ì €ì¥  
            const logData = {   
                type: 'post',   
                user: currentUser.name,   
                date: new Date().toISOString(),   
                targetId: newPost.id,   
                userId: currentUser.id   
            };  
            activityLogs.push(logData);  
            await saveActivityLog(logData);  
        } else {  
            showToast("ê²Œì‹œê¸€ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (ìœ íš¨í•˜ì§€ ì•Šì€ ì ‘ê·¼)");  
        }  
  
        closeModal();  
    }  
  
    // --- ëŒ“ê¸€ ë“±ë¡ (Firebase ì—°ë™) ---  
    async function submitComment(postId) {  
        const commentInput = document.getElementById('commentInput');  
        const content = commentInput.value.trim();  
  
        if (!content) return showToast('ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');  
          
        const nowIso = new Date().toISOString();  
  
        const newComment = {  
            id: Date.now(),  
            author: currentUser.name,  
            content: content,  
            date: nowIso,  
            authorId: currentUser.id,  
            postId: postId  
        };  
  
        if (!comments[postId]) comments[postId] = [];  
        comments[postId].push(newComment);  
          
        // Firebaseì— ëŒ“ê¸€ ì €ì¥  
        await saveComment(postId, newComment);  
          
        const post = findPostById(postId);  
        post.comments = comments[postId].length;  
          
        // í™œë™ ë¡œê·¸ Firebase ì €ì¥  
        const logData = {   
            type: 'comment',   
            user: currentUser.name,   
            date: nowIso,   
            targetId: postId,   
            userId: currentUser.id,  
            commentId: newComment.id  
        };  
        activityLogs.push(logData);  
        await saveActivityLog(logData);  
          
        const commentSectionContainer = document.getElementById('commentSection');  
        commentSectionContainer.innerHTML = generateCommentSection(postId);  
        commentInput.value = '';   
        showToast('ëŒ“ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');  
    }  
  
    // --- ì¢‹ì•„ìš” ì²˜ë¦¬ (Firebase ì—°ë™) ---  
    async function toggleLike(postId) {  
        if (!currentUser) return showToast('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');  
          
        const index = myLikes.indexOf(postId);  
        const post = findPostById(postId);  
  
        if (index > -1) {  
            myLikes.splice(index, 1);  
            showToast('ì¢‹ì•„ìš”ë¥¼ ì·¨ì†Œí–ˆì–´ìš”.');  
            post.likes--;  
        } else {  
            myLikes.push(postId);  
            showToast('ì¢‹ì•„ìš”! ğŸ’œ');  
            post.likes++;  
              
            // í™œë™ ë¡œê·¸ Firebase ì €ì¥  
            const logData = {   
                type: 'like',   
                user: currentUser.name,   
                date: new Date().toISOString(),   
                targetId: postId,   
                userId: currentUser.id   
            };  
            activityLogs.push(logData);  
            await saveActivityLog(logData);  
        }  
  
        // ì‚¬ìš©ì ì„ í˜¸ë„ ì €ì¥ (ì¢‹ì•„ìš”, ë¶ë§ˆí¬)  
        await saveUserPreferences(currentUser.id, {  
            likes: myLikes,  
            bookmarks: bookmarks,  
            stamps: userStamps  
        });  
  
        if (currentTab === 'postDetail' || currentTab === 'editorTalkDetail') {  
             document.querySelector(`.action-btn i.fa-heart`).parentElement.classList.toggle('active', myLikes.includes(postId));  
             document.getElementById(`likes-count-${postId}`).textContent = post.likes;  
        } else {  
            renderTab(currentTab);  
        }  
    }  
  
    // --- ë¶ë§ˆí¬ ì²˜ë¦¬ (Firebase ì—°ë™) ---  
    async function toggleBookmark(postId) {  
        if (!currentUser) return showToast('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');  
  
        const index = bookmarks.indexOf(postId);  
          
        if (index > -1) {  
            bookmarks.splice(index, 1);  
            showToast('ë¶ë§ˆí¬ë¥¼ í•´ì œí–ˆì–´ìš”.');  
        } else {  
            bookmarks.push(postId);  
            showToast('ë¶ë§ˆí¬ ì €ì¥! ğŸ”–');  
        }  
          
        // ì‚¬ìš©ì ì„ í˜¸ë„ ì €ì¥ (ì¢‹ì•„ìš”, ë¶ë§ˆí¬)  
        await saveUserPreferences(currentUser.id, {  
            likes: myLikes,  
            bookmarks: bookmarks,  
            stamps: userStamps  
        });  
          
        if (currentTab === 'postDetail' || currentTab === 'editorTalkDetail') {  
            document.querySelector(`.action-btn i.fa-bookmark`).parentElement.classList.toggle('active', bookmarks.includes(postId));  
        }  
    }  
  
    // --- ê¸°ì¡´ ëª¨ë“  í•¨ìˆ˜ë“¤ì€ ê·¸ëŒ€ë¡œ ìœ ì§€ ---  
    // checkAutoLogin, renderTab, generateLetterPosts, generateEditorTalks ë“±ì€  
    // Firebase ë°ì´í„° ë¡œë“œ í›„ ìë™ìœ¼ë¡œ ìµœì‹  ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ìˆ˜ì • ë¶ˆí•„ìš”  
  
    // --- ì´í•˜ ê¸°ì¡´ ëª¨ë“  í•¨ìˆ˜ë“¤ ë™ì¼ ---  
    // (showSignupModal, showLoginModal, showChangePassword, closePasswordChangeModal ë“±)  
    // (generateCommentSection, deleteComment, editComment, deletePost ë“±)  
    // (viewPost, viewEditorTalk, renderPostList, viewMyPosts ë“±)  
    // (ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ê´€ë ¨ í•¨ìˆ˜ë“¤ ë“±)  
  
    </script>  
</body>  
</html>  
