<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ììœ ì˜ì§€: ë¬´ë“œ ê¸°ë¡ & ë ˆí„°</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* --- 1. ë³€ìˆ˜ ë° ê¸°ë³¸ ìŠ¤íƒ€ì¼ --- */
        :root {
            --primary: #8B5CF6; /* ë³´ë¼ìƒ‰ (ê¸°ì¡´ ìœ ì§€) */
            --primary-dark: #6D28D9;
            --accent: #F59E0B; /* ì£¼í™© */
            --background: #F3F4F6;
            --text-dark: #1F2937;
            --text-light: #6B7280;
            --border-color: #E5E7EB;
            
            --letter-color: var(--primary); /* ë³´ë¼ìƒ‰ */
            --lab-color: #F472B6; /* í•‘í¬ìƒ‰ */ 
        }
        body {
            font-family: "Malgun Gothic", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background);
            color: var(--text-dark);
            overflow-x: hidden;
            touch-action: pan-y;
        }
        #appContainer {
            max-width: 500px;
            margin: 0 auto;
            min-height: 100vh;
            background-color: white;
            padding-bottom: 80px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
            display: none;
        }

        /* --- 2. ë¡œë”© ìŠ¤í¬ë¦° --- */
        #loadingScreen {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #F9FAFB, #EDE9FE);
            transition: opacity 0.5s ease-in-out;
            opacity: 1;
        }
        #loadingScreen i {
            font-size: 3rem;
            color: var(--primary);
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.7; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 0.7; }
        }

        /* --- 3. í—¤ë” ë° ë„¤ë¹„ê²Œì´ì…˜ --- */
        .header-section {
            padding: 20px;
            background-color: white;
            border-bottom: 1px solid var(--border-color);
        }
        .header-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-dark);
        }
        .header-sub {
            font-size: 14px;
            color: var(--text-light);
            margin-top: 4px;
        }

        .navbar {
            position: fixed;
            bottom: 0;
            width: 100%;
            max-width: 500px;
            height: 60px;
            background-color: white;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-around;
            align-items: center;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
            z-index: 100;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-light);
            transition: color 0.3s;
            flex-grow: 1;
            height: 100%;
        }
        .nav-item i {
            font-size: 18px;
        }
        .nav-item span {
            font-size: 10px;
            margin-top: 4px;
        }
        .nav-item.active {
            color: var(--primary);
        }
        
        #writeIcon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background-color: var(--accent);
            color: white;
            border-radius: 50%;
            display: none;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            z-index: 110;
            cursor: pointer;
        }

        /* --- 4. ì½˜í…ì¸  ìŠ¤íƒ€ì¼ --- */
        .content-card {
            background-color: var(--background);
            padding: 15px;
            margin: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .content-card:hover {
            background-color: #E5E7EB;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        .btn-primary:hover {
            background-color: var(--primary-dark);
        }
        .input-box {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 14px;
        }
        
        /* ë§ˆì´í˜ì´ì§€/ëŒ€ì‹œë³´ë“œ íƒ­ */
        .mypage-tabs {
            display: flex;
            justify-content: space-around;
            padding: 0 20px;
            border-bottom: 1px solid var(--border-color);
            margin-top: 10px;
        }
        .mypage-tab {
            padding: 10px 0;
            cursor: pointer;
            color: var(--text-light);
            font-weight: 500;
            border-bottom: 3px solid transparent;
            transition: color 0.2s, border-bottom-color 0.2s;
            flex-grow: 1; /* íƒ­ ê· ë“± ë¶„ë°° */
            text-align: center;
        }
        .mypage-tab.active {
            color: var(--primary-dark);
            border-bottom-color: var(--primary);
        }

        /* ì—ë””í„° í•„í„° íƒ­ */
        .editor-filter-tabs {
            display: flex;
            padding: 0 20px 10px;
            overflow-x: auto;
            gap: 8px;
            white-space: nowrap;
        }
        .editor-tab {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        .editor-tab.active {
            background-color: var(--accent);
            color: white !important;
            border-color: var(--accent);
        }

        /* ë¬´ë“œ íƒœê·¸ - ì´ëª¨í‹°ì½˜ë§Œ ë³´ì´ë„ë¡ ìµœì¢… ìˆ˜ì • */
        #moodTagSelector {
            display: grid; 
            grid-template-columns: repeat(5, 1fr); 
            gap: 8px;
            padding: 10px 0;
            justify-content: center;
        }
        .mood-tag {
            padding: 10px;
            border-radius: 15px; 
            cursor: pointer;
            transition: transform 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            aspect-ratio: 1 / 1; 
        }
        .mood-tag:hover {
            transform: scale(1.05);
        }
        /* ì´ëª¨í‹°ì½˜ ìŠ¤íƒ€ì¼ */
        .mood-tag-icon {
            font-size: 24px; 
            line-height: 1; 
        }
        /* í•œê¸€ í…ìŠ¤íŠ¸ ìˆ¨ê¹€ ì²˜ë¦¬ (ìš”ì²­ ë°˜ì˜) */
        .mood-tag-text {
            display: none; 
        }

        .mood-tag.selected {
            border: 3px solid var(--accent); 
            box-shadow: 0 0 5px rgba(245, 158, 11, 0.5);
        }
        
        /* ë§ˆì´í˜ì´ì§€ ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        .comment-item-in-mypage {
            background-color: #f9f9f9;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 3px solid var(--primary);
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .comment-item-in-mypage:hover {
            background-color: #f0f0f0;
        }
        .comment-item-in-mypage p {
            margin: 0;
            font-size: 14px;
            color: var(--text-dark);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .comment-item-in-mypage small {
            display: block;
            margin-top: 5px;
            font-size: 11px;
            color: var(--text-light);
        }

        /* --- 5. ëª¨ë‹¬ ìŠ¤íƒ€ì¼ --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 200;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            transform: translateY(-20px);
            transition: transform 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        .modal-overlay.show .modal-content {
            transform: translateY(0);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
        }
        
        /* ìƒì„¸ í˜ì´ì§€ */
        #postDetailModal .modal-content {
            height: 90vh;
            max-height: 700px;
            display: flex;
            flex-direction: column;
        }
        #postDetailBody {
            overflow-y: auto;
            padding-right: 5px;
        }
        .detail-meta {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 10px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }
        #detailImage {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-top: 15px;
            background: #eee;
        }
        #detailContent {
            margin: 15px 0;
            line-height: 1.6;
            font-size: 14px;
        }
        .interaction-bar {
            display: flex;
            justify-content: space-between;
            border-top: 1px solid var(--border-color);
            padding-top: 10px;
            margin-top: 10px;
        }
        .interaction-btn {
            background: none;
            border: 1px solid var(--border-color);
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            color: var(--text-light);
            transition: all 0.2s;
        }
        .interaction-btn i { margin-right: 5px; }

        /* ëŒ“ê¸€ */
        .comment-item {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
            font-size: 13px;
        }
        .comment-meta {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: var(--text-light);
            margin-bottom: 5px;
        }
        .reply-btn {
            color: var(--primary);
            cursor: pointer;
            font-weight: bold;
        }
        .reply-section {
            padding-left: 15px;
            border-left: 2px solid var(--border-color);
            margin-top: 10px;
        }
        .reply-item {
            padding: 5px 0;
            border-top: 1px dotted #eee;
            margin-top: 5px;
        }
        .reply-input-group {
            display: flex;
            gap: 5px;
            margin-top: 10px;
            align-items: center;
        }
        .comment-input-area {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        /* ë¬´ë“œ ì„±ê³µ íŒì—… */
        #moodSuccessModal .modal-content {
            background-color: #FBCFE8; /* ì˜ˆìœ í•‘í¬ìƒ‰ */
            text-align: center;
            padding: 30px 20px;
            border: 2px solid #EC4899;
        }
        #moodSuccessModal h2 {
            font-size: 22px; 
            color: #831843;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        #moodSuccessModal .close-btn {
            background: #EC4899;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            margin-top: 15px;
            cursor: pointer;
            display: inline-block;
            font-weight: bold;
        }
        
        /* ì•Œë¦¼ íŒì—… (ì‹ ê·œ & ë°˜ì‘í˜• í˜ì´ë“œì¸) */
        #notificationModal {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100vh); 
            max-width: 90%;
            width: 350px;
            z-index: 300;
            opacity: 0;
            transition: transform 0.5s cubic-bezier(0.25, 0.8, 0.25, 1), opacity 0.5s ease-in-out;
        }
        #notificationModal.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        /* F. ìƒˆ ëŒ“ê¸€ ì•Œë¦¼ íŒì—… ìŠ¤íƒ€ì¼ (ì—°í•‘í¬ìƒ‰) */
        #newCommentNotificationModal .modal-content {
            background-color: #F0F9FF; /* ì•„ì£¼ ì—°í•œ í•˜ëŠ˜ìƒ‰ */
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: none;
            transition: none;
            cursor: pointer;
            border: 2px solid #3B82F6;
            text-align: center;
        }
        #newCommentNotificationModal h4 {
            font-size: 15px;
            color: #1E40AF;
            margin: 0;
            font-weight: bold;
        }
        
        /* ê¸°ë³¸ ì•Œë¦¼ íŒì—… ìŠ¤íƒ€ì¼ (ì´ì „ì— ì‚¬ìš©ëœ í•‘í¬) */
        #notificationModal .modal-content {
            background-color: #FBCFE8; 
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: none;
            transition: none;
        }
        #notificationModal h4 {
            font-size: 15px;
            color: #831843;
            margin: 0 0 10px 0;
            font-weight: bold;
        }
        #notificationModal .notification-item {
             font-size: 13px;
             color: #A16207;
             margin-bottom: 8px;
             padding-bottom: 5px;
             border-bottom: 1px solid #FCD7D7;
        }
        #notificationModal .action-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }
        #notificationModal .action-btn {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            border: none;
            font-weight: bold;
        }
        #notificationModal .btn-view {
            background: #FBBF24;
            color: #831843;
        }
        #notificationModal .btn-close-x {
             background: none;
             border: none;
             font-size: 18px;
             color: #831843;
             cursor: pointer;
             padding: 0;
        }

    </style>
</head>
<body>

    <div id="loadingScreen">
        <i class="fas fa-heart"></i>
    </div>

    <div id="appContainer">
        </div>

    <div class="navbar">
        <div id="nav-home" class="nav-item active" onclick="renderTab('home')">
            <i class="fas fa-home"></i>
            <span>í™ˆ</span>
        </div>
        <div id="nav-letter" class="nav-item" onclick="renderTab('letter', 'all')">
            <i class="fas fa-book-open"></i>
            <span>ë ˆí„°</span>
        </div>
        <div id="writeIcon" onclick="handleWriteIconClick()">
            <i class="fas fa-pen"></i>
        </div>
        <div id="nav-mood" class="nav-item" onclick="renderTab('mood')">
            <i class="fas fa-calendar-check"></i>
            <span>ë¬´ë“œ</span>
        </div>
        <div id="nav-editorTalk" class="nav-item" onclick="renderTab('editorTalk', 'all')">
            <i class="fas fa-comments"></i>
            <span>ì—ë””í„°í†¡</span>
        </div>
        <div id="nav-mypage" class="nav-item" onclick="renderTab('mypage')">
            <i class="fas fa-user"></i>
            <span>ë§ˆì´</span>
        </div>
    </div>

    <div id="loginModal" class="modal-overlay" onclick="if(event.target.id === 'loginModal') closeModal()">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ë¡œê·¸ì¸</h2>
                <button class="modal-close" onclick="showSignupModal()"><i class="fas fa-user-plus"></i></button>
            </div>
            <input type="email" id="loginEmail" class="input-box" placeholder="ì´ë©”ì¼ ì£¼ì†Œ">
            <input type="password" id="loginPassword" class="input-box" placeholder="ë¹„ë°€ë²ˆí˜¸">
            <div style="display:flex; justify-content:flex-start; align-items:center; margin-bottom:15px;">
                <label style="font-size:12px;"><input type="checkbox" id="saveLoginInfo" style="margin-right:5px;">ë¡œê·¸ì¸ ì •ë³´ ì €ì¥</label>
                </div>
            <button class="btn-primary" style="width:100%;" onclick="handleLogin()">ë¡œê·¸ì¸</button>
        </div>
    </div>

    <div id="signupModal" class="modal-overlay" onclick="if(event.target.id === 'signupModal') closeModal()">
        <div class="modal-content">
            <div class="modal-header">
                <h2>íšŒì›ê°€ì…</h2>
                <button class="modal-close" onclick="showLoginModal()"><i class="fas fa-times"></i></button>
            </div>
            <input type="text" id="signupNickname" class="input-box" placeholder="ë‹‰ë„¤ì„">
            <input type="email" id="signupEmail" class="input-box" placeholder="ì´ë©”ì¼ ì£¼ì†Œ">
            <input type="password" id="signupPassword" class="input-box" placeholder="ë¹„ë°€ë²ˆí˜¸ (4ì ì´ìƒ)">
            <button class="btn-primary" style="width:100%;" onclick="handleSignup()">ê°€ì…í•˜ê¸°</button>
        </div>
    </div>
    
    <div id="changePasswordModal" class="modal-overlay" onclick="if(event.target.id === 'changePasswordModal') closeModal()">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h2>
                <button class="modal-close" onclick="closeModal()"><i class="fas fa-times"></i></button>
            </div>
            <input type="password" id="currentPassword" class="input-box" placeholder="í˜„ì¬ ë¹„ë°€ë²ˆí˜¸">
            <input type="password" id="newPassword" class="input-box" placeholder="ìƒˆë¡œìš´ ë¹„ë°€ë²ˆí˜¸ (4ì ì´ìƒ)">
            <input type="password" id="confirmNewPassword" class="input-box" placeholder="ìƒˆë¡œìš´ ë¹„ë°€ë²ˆí˜¸ í™•ì¸">
            <button class="btn-primary" style="width:100%;" onclick="handleChangePassword()">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì™„ë£Œ</button>
        </div>
    </div>


    <div id="writeModal" class="modal-overlay" onclick="if(event.target.id === 'writeModal') closeModal()">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="writeTitle">ê¸€ì“°ê¸°</h2>
                <button class="modal-close" onclick="closeModal()"><i class="fas fa-times"></i></button>
            </div>
            <input type="hidden" id="editPostId">

            <select id="postCategory" class="input-box" style="display:none;">
                <option value="ìíœ´ë ˆí„°">ìíœ´ë ˆí„°</option>
                <option value="ìíœ´ë©">ìíœ´ë©</option>
            </select>

            <input type="text" id="postTitle" class="input-box" placeholder="ì œëª©">

            <div id="moodSection" style="display:none;">
                <p style="font-size:12px; margin-top:5px; font-weight:bold;">ì˜¤ëŠ˜ì˜ ê¸°ë¶„ì€?</p>
                <div id="moodTagSelector"></div>
            </div>

            <textarea id="postContent" class="input-box" placeholder="ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" rows="5" style="resize:none;"></textarea>
            
            <div id="photoAttachment" style="display:none; margin-bottom:15px;">
                 <label for="postImage" style="display:block; font-size:13px; font-weight:bold; margin-bottom:5px;">ğŸ–¼ï¸ ì‚¬ì§„ ì²¨ë¶€ (ì„ íƒ)</label>
                 <input type="file" id="postImage" accept="image/*" style="width:100%; border:1px solid #ddd; padding:8px; border-radius:8px;">
            </div>

            <button class="btn-primary" style="width:100%;" onclick="submitPost()">ë“±ë¡í•˜ê¸°</button>
        </div>
    </div>

    <div id="postDetailModal" class="modal-overlay" onclick="if(event.target.id === 'postDetailModal') closeModal()">
        <div class="modal-content">
            <div class="modal-header" style="flex-shrink:0;">
                <h2 id="detailCategory" style="color:var(--primary); font-size:16px;">Category</h2>
                <button class="modal-close" onclick="closeModal()"><i class="fas fa-times"></i></button>
            </div>
            <div id="postDetailBody">
                <h1 id="detailTitle" style="font-size:22px; margin-bottom:0;">ê²Œì‹œë¬¼ ì œëª©</h1>
                <div class="detail-meta">
                    <div>
                        <span>ì‘ì„±ì: <b id="detailAuthor"></b></span>
                        <span style="margin-left:15px;">ë‚ ì§œ: <b id="detailDate"></b></span>
                    </div>
                    <div id="manageButtons" style="display:none; gap:10px;">
                        <button class="btn-primary" style="padding:4px 8px; font-size:12px; background:#F59E0B;" onclick="editPost()">ìˆ˜ì •</button>
                        <button class="btn-primary" style="padding:4px 8px; font-size:12px; background:#EF4444;" onclick="deletePost()">ì‚­ì œ</button>
                    </div>
                </div>
                
                <img id="detailImage" alt="ì²¨ë¶€ ì´ë¯¸ì§€" style="display:none;">
                
                <div id="detailContent">
                    ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                </div>
                
                <div class="interaction-bar">
                    <div style="display:flex; gap:10px;">
                        <button id="btnLike" class="interaction-btn" onclick="toggleLike()">
                            <i class="fas fa-heart"></i> ì¢‹ì•„ìš” (<span id="likeCount">0</span>)
                        </button>
                        <button id="btnBookmark" class="interaction-btn" onclick="toggleBookmark()">
                            <i class="fas fa-bookmark"></i> ë¶ë§ˆí¬
                        </button>
                    </div>
                </div>

                <h3 style="font-size:16px; margin-top:20px;">ëŒ“ê¸€</h3>
                <div id="commentList">
                    </div>
                
                <div class="comment-input-area">
                    <input type="text" id="commentInput" class="input-box" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..." style="flex-grow:1; margin-bottom:0;">
                    <button class="btn-primary" style="width:60px; height:40px; margin-bottom:0;" onclick="submitComment(null)">ë“±ë¡</button>
                </div>
                
            </div>
        </div>
    </div>
    
    <div id="moodSuccessModal" class="modal-overlay" onclick="if(event.target.id === 'moodSuccessModal') closeMoodSuccessModal()">
        <div class="modal-content">
            <h2>ì˜¤ëŠ˜ì˜ ë¬´ë“œ ê¸°ë¡ ì™„ë£Œ! ìŠ¤íƒ¬í”„ê°€ ì ë¦½ë˜ì—ˆì–´ìš”! â¤ï¸</h2>
            <div class="close-btn" onclick="closeMoodSuccessModal()">í™•ì¸</div>
        </div>
    </div>
    
    <div id="notificationModal" class="modal-overlay">
        <div class="modal-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                 <h4 id="notificationTitle">ìƒˆë¡œìš´ í™œë™ ì•Œë¦¼!</h4>
                 <button class="action-btn btn-close-x" onclick="closeNotificationModal()"><i class="fas fa-times"></i></button>
            </div>
            <div id="notificationList">
                 </div>
            <div class="action-group">
                <button class="action-btn btn-view" onclick="handleNotificationClick()">ëŒ“ê¸€ ë³´ê¸°</button> 
            </div>
        </div>
    </div>
    
    <div id="newCommentNotificationModal" class="modal-overlay" onclick="handleNewCommentNotificationClick(event)">
        <div class="modal-content">
             <h4 id="newCommentNotificationText">ë‚´ê°€ ì“´ ê¸€ì— ìƒˆë¡œìš´ ëŒ“ê¸€ì´ ë‹¬ë ¸ì–´ìš”! ğŸ‰</h4>
        </div>
    </div>


    <script>
        // --- ë°ì´í„° ë° ìƒíƒœ ê´€ë¦¬ ---
        const SUPER_ADMIN = 'happxi@jahyu.com';
        const EDITORS = {
            'happxi@jahyu.com': 'í–…ì”¨', 'elly@jahyu.com': 'ì—˜ë¦¬', 'gokal@jahyu.com': 'ê³ ì¹¼', 
            'sunny@jahyu.com': 'ì¨ë‹ˆ', 'yudan@jahyu.com': 'ìœ ë‹¨'
        };
        const ADMINS = Object.keys(EDITORS);
        
        // 20ê°€ì§€ íŒŒìŠ¤í…”í†¤ ê·€ì—¬ìš´ ì´ëª¨í‹°ì½˜ íƒœê·¸
        const MOOD_TAGS = [
            { icon: 'ğŸ˜Š', text: '#í–‰ë³µí•´', color: '#BEE3F8' }, // ë¼ì´íŠ¸ ë¸”ë£¨
            { icon: 'ğŸ¥°', text: '#ì‚¬ë‘ìŠ¤ëŸ¬ì›Œ', color: '#FEEBCF' }, // ë¼ì´íŠ¸ ì˜¤ë Œì§€
            { icon: 'ğŸ˜Œ', text: '#ë”°ëœ»í•´', color: '#D6BCFA' }, // ì—°í•œ ë³´ë¼
            { icon: 'ğŸŒ¿', text: '#í‰í™”ë¡œì›Œ', color: '#A7F3D0' }, // ë¯¼íŠ¸
            { icon: 'ğŸ¤©', text: '#ê¸°ëŒ€ë¼', color: '#FDD6D9' }, // ì—°í•œ í•‘í¬
            { icon: 'ğŸ•Šï¸', text: '#ììœ ë¡œì›Œ', color: '#BEE3F8' },
            { icon: 'ğŸ¥±', text: '#ì§€ë£¨í•´', color: '#D1D5DB' }, // íšŒìƒ‰
            { icon: 'ğŸ¤¯', text: '#ë‹µë‹µí•´', color: '#FECACA' }, // ì‚´êµ¬
            { icon: 'ğŸ˜´', text: '#í”¼ê³¤í•´', color: '#A7F3D0' },
            { icon: 'ğŸŒ§ï¸', text: '#ìš°ìš¸í•´', color: '#BFDBFE' }, // í•˜ëŠ˜ìƒ‰
            { icon: 'ğŸ˜¡', text: '#í™”ë‚˜', color: '#FCD7D7' }, // ë°ì€ ë ˆë“œ
            { icon: 'ğŸ¥³', text: '#ì‹ ë‚˜', color: '#FEF08A' }, // ë°ì€ ë…¸ë‘
            { icon: 'ğŸ§˜', text: '#íë§', color: '#E9D5FF' }, // ì—°í•œ ë¼ë²¤ë”
            { icon: 'ğŸ¤', text: '#ë°˜ê°€ì›Œ', color: '#BFDBFE' },
            { icon: 'ğŸ’–', text: '#ì„¤ë ˜', color: '#FDD6D9' },
            { icon: 'â˜•', text: '#í¸ì•ˆí•´', color: '#D1FAE5' }, // ì—°í•œ ê·¸ë¦°
            { icon: 'ğŸ’­', text: '#ë³µì¡í•´', color: '#BFDBFE' },
            { icon: 'ğŸ˜’', text: '#ì§œì¦ë‚˜', color: '#FEE2E2' }, // ì—°í•œ ë ˆë“œ
            { icon: 'ğŸ‘', text: '#ì¢‹ì•„', color: '#FDD6D9' },
            { icon: 'ğŸ˜', text: '#í‰ë²”í•´', color: '#D1D5DB' }
        ];

        let currentUser = null;
        let users = {};
        let posts = [];
        let comments = [];
        let myLikes = [];
        let myBookmarks = [];
        let lastLoginTime = 0; // ë§ˆì§€ë§‰ ë¡œê·¸ì¸ ì‹œê°„ (ì•Œë¦¼ ì²´í¬ìš©)
        let currentViewingPostId = null;
        let currentMoodTag = null;
        let lastMoodDate = localStorage.getItem('lastMoodDate') || null;
        let pendingNotifications = []; 
        let newCommentAlertPostId = null; // F. ì‹ ê·œ ëŒ“ê¸€ ì•Œë¦¼ ê²Œì‹œë¬¼ ID ì €ì¥

        function saveData(key, data) {
            localStorage.setItem(`jahyu_${key}`, JSON.stringify(data));
        }
        
        function getTodayDate() {
            return new Date().toISOString().split('T')[0];
        }
        
        // --- ì´ˆê¸° ë°ì´í„° ë¡œë”© ---
        function initData() {
            const initialUsers = {
                'happxi@jahyu.com': { nickname: 'í–…ì”¨', password: 'admin123', stamps: 5, lastActive: Date.now(), totalDuration: 1200, lastLogin: 0 },
                'elly@jahyu.com': { nickname: 'ì—˜ë¦¬', password: 'admin123', stamps: 3, lastActive: Date.now(), totalDuration: 900, lastLogin: 0 },
                'user@example.com': { nickname: 'í–…ì‚', password: 'test', stamps: 12, lastActive: Date.now(), totalDuration: 2000, lastLogin: 0 }
            };
            
            const initialPosts = [
                { id: 101, type: 'letter', category: 'ìíœ´ë ˆí„°', title: '[32í˜¸] í‡´ì‚¬ í›„ ë²ˆì•„ì›ƒ', content: 'ì‰¬ì–´ë„ ì‰¬ëŠ” ê²ƒ ê°™ì§€ ì•Šì€ ë‹¹ì‹ ì—ê²Œ...', author: 'í–…ì”¨', authorId: 'happxi@jahyu.com', date: '2025-12-08', views: 50, timestamp: new Date('2025-12-08T10:00:00').getTime() },
                { id: 102, type: 'letter', category: 'ìíœ´ë©', title: 'ê¸€ì“°ê¸°ë¡œ ë§ˆìŒ ì±™ê¸°ê¸°', content: 'ë‚˜ë¥¼ ëŒì•„ë³´ëŠ” ì‹œê°„', author: 'ì—˜ë¦¬', authorId: 'elly@jahyu.com', date: '2025-12-09', views: 30, timestamp: new Date('2025-12-09T10:00:00').getTime() },
                { id: 201, type: 'talk', category: 'ì—ë””í„°í†¡', title: 'ì˜¤ëŠ˜ ë‚ ì”¨ ë§‘ìŒ â˜€ï¸', content: 'ì‚°ì±…í•˜ê¸° ë”± ì¢‹ì€ ë‚ ì”¨ë„¤ìš”!', author: 'elly@jahyu.com', authorId: 'elly@jahyu.com', date: '2025-12-10', views: 20, timestamp: new Date('2025-12-10T10:00:00').getTime() },
                { id: 301, type: 'mood', title: 'ì˜¤ëŠ˜ì˜ ë¬´ë“œ', content: 'ê¸°ë¶„ì´ ë„ˆë¬´ ì¢‹ì•„ìš”!', author: 'í–…ì‚', authorId: 'user@example.com', date: '2025-12-11', moodTag: '#í–‰ë³µí•´', tagColor: '#BEE3F8', views: 5, timestamp: new Date('2025-12-11T09:00:00').getTime() }
            ];
            
            const initialComments = [
                { id: 1, postId: 201, content: 'ë§ì•„ìš” ë‚ ì”¨ ë„ˆë¬´ ì¢‹ì•„ìš”!', author: 'í–…ì‚', authorId: 'user@example.com', date: '2025-12-10', parentId: null, timestamp: new Date('2025-12-10T11:00:00').getTime() },
                { id: 2, postId: 201, content: 'ì‚°ì±… ê°€ì¦ˆì•„!', author: 'í–…ì”¨', authorId: 'happxi@jahyu.com', date: '2025-12-10', parentId: null, timestamp: new Date('2025-12-10T12:00:00').getTime() },
            ];

            users = JSON.parse(localStorage.getItem('jahyu_users')) || initialUsers;
            posts = JSON.parse(localStorage.getItem('jahyu_posts')) || initialPosts;
            comments = JSON.parse(localStorage.getItem('jahyu_comments')) || initialComments;
            myLikes = JSON.parse(localStorage.getItem('jahyu_myLikes')) || [];
            myBookmarks = JSON.parse(localStorage.getItem('jahyu_myBookmarks')) || [];
            
            const savedUserEmail = localStorage.getItem('jahyu_current_user_email');
            if (savedUserEmail && users[savedUserEmail]) {
                currentUser = savedUserEmail;
                lastLoginTime = users[currentUser].lastLogin || 0; // ê¸°ì¡´ ë¡œê·¸ì¸ ì‹œê°„ ë¡œë“œ
            }
            
            const savedNotifications = JSON.parse(localStorage.getItem('jahyu_pendingNotifications'));
            if (savedNotifications && savedNotifications.length > 0) {
                 pendingNotifications = savedNotifications;
            }

            // ë¡œë”© ìŠ¤í¬ë¦° ìˆ¨ê¸°ê¸°
            setTimeout(() => {
                document.getElementById('loadingScreen').style.opacity = '0';
                document.getElementById('appContainer').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                    renderTab('home');
                    if (!currentUser) {
                         showLoginModal();
                    } else {
                         // F. ìƒˆ ëŒ“ê¸€ ì•Œë¦¼ ì²´í¬ (ë¡œê·¸ì¸ ì‹œ)
                         checkForNewComments();
                    }
                }, 500);
            }, 1000); 
        }

        // F. ìƒˆ ëŒ“ê¸€ ì•Œë¦¼ ë¡œì§
        function checkForNewComments() {
            if (!currentUser || lastLoginTime === 0) return;

            // ë‚´ê°€ ì“´ ê¸€ (typeì´ moodì¸ ê¸€ì€ ì œì™¸)
            const userPosts = posts.filter(p => p.authorId === currentUser && p.type !== 'mood');
            let hasNewComment = false;
            
            for (const post of userPosts) {
                // ì´ ê¸€ì— ë‹¬ë¦° ëŒ“ê¸€ ì¤‘, ë‚´ ë§ˆì§€ë§‰ ë¡œê·¸ì¸ ì‹œê°„ ì´í›„ì— ì‘ì„±ëœ ëŒ“ê¸€ì´ ìˆëŠ”ì§€ í™•ì¸
                const recentComment = comments.find(c => 
                    c.postId === post.id && 
                    c.timestamp > lastLoginTime && 
                    c.authorId !== currentUser // ë‚´ê°€ ë‹¨ ëŒ“ê¸€ì€ ì œì™¸
                );
                
                if (recentComment) {
                    newCommentAlertPostId = post.id;
                    hasNewComment = true;
                    break; 
                }
            }

            if (hasNewComment) {
                showNewCommentNotificationModal();
            }
        }
        
        // F. ì‹ ê·œ ëŒ“ê¸€ ì•Œë¦¼ íŒì—… ì œì–´
        function showNewCommentNotificationModal() {
            if (newCommentAlertPostId) {
                const modal = document.getElementById('newCommentNotificationModal');
                const post = posts.find(p => p.id === newCommentAlertPostId);
                const text = document.getElementById('newCommentNotificationText');
                
                text.innerHTML = `ë‚´ê°€ ì“´ ê¸€ **'${post.title}'**ì— ìƒˆë¡œìš´ ëŒ“ê¸€ì´ ë‹¬ë ¸ì–´ìš”! ğŸ‰`;
                showModal('newCommentNotificationModal');
            }
        }

        function handleNewCommentNotificationClick(event) {
            if (newCommentAlertPostId && event.target.id === 'newCommentNotificationModal') {
                viewPostDetail(newCommentAlertPostId);
                newCommentAlertPostId = null; // ì•Œë¦¼ ì²˜ë¦¬
                closeModal();
            }
        }


        // --- ëª¨ë‹¬ ì œì–´ í•¨ìˆ˜ ---
        function showModal(id) {
            document.getElementById(id).classList.add('show');
        }
        function closeModal() {
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.classList.remove('show');
            });
        }

        function showLoginModal() {
            closeModal();
            showModal('loginModal');
        }
        function showSignupModal() {
            closeModal();
            showModal('signupModal');
        }
        
        function showChangePasswordModal() {
            closeModal();
            showModal('changePasswordModal');
        }

        
        // --- ì‚¬ìš©ì ì¸ì¦ ë° ê´€ë¦¬ ---
        function handleLogin() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (users[email] && users[email].password === password) {
                currentUser = email;
                localStorage.setItem('jahyu_current_user_email', currentUser);
                
                // ë¡œê·¸ì¸ ì‹œì ì˜ íƒ€ì„ìŠ¤íƒ¬í”„ë¥¼ lastLoginTimeìœ¼ë¡œ ì €ì¥
                lastLoginTime = users[currentUser].lastLogin || 0;
                users[currentUser].lastLogin = Date.now();
                saveData('users', users);
                
                closeModal();
                alert(`${users[currentUser].nickname}ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!`);
                
                // F. ìƒˆ ëŒ“ê¸€ ì•Œë¦¼ ì²´í¬ (ë¡œê·¸ì¸ ì‹œ)
                checkForNewComments();
                
                renderTab('home');
            } else {
                alert('ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
        }
        
        function handleLogout() {
            currentUser = null;
            localStorage.removeItem('jahyu_current_user_email');
            alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');
            renderTab('home');
            showLoginModal();
        }

        function handleSignup() {
            const nickname = document.getElementById('signupNickname').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value;

            if (!nickname || !email || !password) {
                alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            if (users[email]) {
                alert('ì´ë¯¸ ë“±ë¡ëœ ì´ë©”ì¼ ì£¼ì†Œì…ë‹ˆë‹¤.');
                return;
            }
            if (password.length < 4) {
                 alert('ë¹„ë°€ë²ˆí˜¸ëŠ” 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                 return;
            }

            users[email] = { nickname, password, stamps: 0, lastActive: Date.now(), totalDuration: 0, lastLogin: 0 };
            saveData('users', users);
            
            alert('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
            showLoginModal();
        }
        
        // ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° ê¸°ëŠ¥ì€ ìš”ì²­ì— ë”°ë¼ ì™„ì „íˆ ì‚­ì œë¨


        function handleChangePassword() {
            const currentPass = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirmNewPass = document.getElementById('confirmNewPassword').value;
            
            if (!currentUser) return;

            if (users[currentUser].password !== currentPass) {
                alert('í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }
            if (newPass.length < 4 || newPass !== confirmNewPass) {
                alert('ìƒˆ ë¹„ë°€ë²ˆí˜¸ê°€ 4ì ë¯¸ë§Œì´ê±°ë‚˜ í™•ì¸ë€ê³¼ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }

            users[currentUser].password = newPass;
            saveData('users', users);
            alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì„±ê³µì ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
            closeModal();
        }


        // --- íƒ­ ë Œë”ë§ í•¨ìˆ˜ ---
        function renderTab(tabName, filter = 'all') {
            const container = document.getElementById('appContainer');
            const navItems = document.querySelectorAll('.nav-item');
            const writeIcon = document.getElementById('writeIcon');
            const navbar = document.querySelector('.navbar');
            
            // **[í•µì‹¬] 1. ë„¤ë¹„ê²Œì´ì…˜ êµ¬ì¡° ë™ì  ì¡°ì • (ëŒ€ì‹œë³´ë“œ íƒ­ ì²˜ë¦¬)**
            const existingDashboard = document.getElementById('nav-dashboard');
            if (currentUser === SUPER_ADMIN && !existingDashboard) {
                // ìŠˆí¼ê´€ë¦¬ìë©´ ëŒ€ì‹œë³´ë“œ íƒ­ ìƒì„± ë° ì‚½ì… (Mood íƒ­ ì•ì— ì‚½ì…)
                const dashboardNavItem = document.createElement('div');
                dashboardNavItem.id = 'nav-dashboard';
                dashboardNavItem.className = 'nav-item';
                dashboardNavItem.innerHTML = '<i class="fas fa-chart-line"></i><span>ëŒ€ì‹œë³´ë“œ</span>';
                dashboardNavItem.onclick = () => renderTab('dashboard');
                const moodNav = document.getElementById('nav-mood');
                navbar.insertBefore(dashboardNavItem, moodNav);
            } else if (currentUser !== SUPER_ADMIN && existingDashboard) {
                // ì¼ë°˜ ì‚¬ìš©ì/ë¡œê·¸ì•„ì›ƒ ì‹œ ëŒ€ì‹œë³´ë“œ íƒ­ ì œê±°
                navbar.removeChild(existingDashboard);
            }

            // **[í•µì‹¬] 2. ì¼ë°˜ ì‚¬ìš©ì ë¡œê·¸ì¸ ì²´í¬ (ëŒ€ì‹œë³´ë“œ íƒ­ì€ ë”°ë¡œ ì²´í¬)**
            if (!currentUser && tabName !== 'home' && tabName !== 'letter' && tabName !== 'editorTalk') {
                 container.innerHTML = `<div style="padding: 40px; text-align: center;">ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</div>`;
                 setTimeout(showLoginModal, 300);
                 return;
            }
            
            // **[í•µì‹¬] 3. ëŒ€ì‹œë³´ë“œ íƒ­ ì ‘ê·¼ ê¶Œí•œ ì²´í¬**
            if (tabName === 'dashboard' && currentUser !== SUPER_ADMIN) {
                container.innerHTML = `<div style="padding: 40px; text-align: center; color:#EF4444; font-weight:bold;">ê´€ë¦¬ì ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
                return;
            }

            navItems.forEach(item => item.classList.remove('active'));
            const activeNav = document.getElementById(`nav-${tabName}`);
            if (activeNav) activeNav.classList.add('active');


            writeIcon.style.display = (tabName === 'editorTalk' || tabName === 'mood') ? 'flex' : 'none';

            container.innerHTML = ''; 

            switch(tabName) {
                case 'home':
                    renderHome(container);
                    break;
                case 'letter':
                    renderLetter(container, filter);
                    break;
                case 'editorTalk':
                    renderEditorTalk(container, filter);
                    break;
                case 'mood':
                    renderMood(container);
                    break;
                case 'mypage':
                    renderMyPage(container);
                    break;
                case 'dashboard':
                    renderDashboard(container);
                    break;
            }
        }
        
        // --- ê°œë³„ íƒ­ ë Œë”ë§ ---

        function renderHome(container) {
            const userNickname = currentUser ? users[currentUser].nickname : '';
            // a. í—¤ë” íƒ€ì´í‹€, ì„œë¸Œ ë¬¸êµ¬ ìˆ˜ì • ë°˜ì˜
            container.innerHTML = `
                <div class="header-section">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <h1 class="header-title">${currentUser ? userNickname + 'ë‹˜' : 'ììœ ì˜ì§€'}</h1> 
                        <div style="display:flex; gap:10px;">
                            <i id="notificationBell" class="fas fa-bell" style="font-size: 20px; color: ${pendingNotifications.length > 0 ? 'var(--accent)' : 'var(--text-light)'}; cursor:pointer;" onclick="showNotificationModal()"></i>
                            <i class="fas fa-user-circle" style="font-size: 20px; color: var(--text-light); cursor:pointer;" onclick="renderTab('mypage')"></i>
                        </div>
                    </div>
                    <p class="header-sub">${currentUser ? 'ì˜¤ëŠ˜ë„ í–‰ë³µí•˜ì„¸ìš”! ğŸ˜Š' : 'ì˜¤ëŠ˜ì€ ì–´ë–¤ ì‘ì›ì´ í•„ìš”í•˜ì„¸ìš”?'}</p>
                </div>
                <h2 style="padding: 0 20px; margin-top: 20px; font-size: 18px;">âœ¨ í–…ì”¨ & ì—˜ë¦¬ì˜ ë ˆí„°</h2>
                <div id="latestLetters" style="padding: 0 20px;"></div>
                
                <h2 style="padding: 0 20px; margin-top: 20px; font-size: 18px;">ğŸ’¬ ìµœì‹  ì—ë””í„°í†¡</h2>
                <div id="latestTalks" style="padding: 0 20px;"></div>
                
                <h2 style="padding: 0 20px; margin-top: 20px; font-size: 18px;">ğŸ’¡ ë‚˜ì˜ ë¬´ë“œ í˜„í™©</h2>
                <div id="moodSummary" class="content-card" style="cursor:default;"></div>
            `;
            
            renderPostList('latestLetters', posts.filter(p => p.type === 'letter').slice(0, 3));
            renderPostList('latestTalks', posts.filter(p => p.type === 'talk').slice(0, 3));
            renderMoodSummary(document.getElementById('moodSummary'));
        }

        function renderLetter(container, filter) {
             // c. ë¬¸êµ¬ ìˆ˜ì • ë°˜ì˜
            container.innerHTML = `
                <div class="header-section">
                    <h1 class="header-title" style="color:var(--letter-color);">ìíœ´ë ˆí„°ì™€ ìíœ´ë©ì„ í•œ ëˆˆì—!</h1>
                    <p class="header-sub">ì˜¤ëŠ˜ë„ ê¼­ íë§ ë°›ì•„ê°€ì„¸ìš”!</p>
                </div>
                <div class="editor-filter-tabs">
                    <div class="editor-tab ${filter === 'all' ? 'active' : ''}" onclick="renderTab('letter', 'all')" style="color:var(--letter-color);">ì „ì²´</div>
                    <div class="editor-tab ${filter === 'ìíœ´ë ˆí„°' ? 'active' : ''}" onclick="renderTab('letter', 'ìíœ´ë ˆí„°')" style="color:var(--letter-color);">ìíœ´ë ˆí„°</div>
                    <div class="editor-tab ${filter === 'ìíœ´ë©' ? 'active' : ''}" onclick="renderTab('letter', 'ìíœ´ë©')" style="color:var(--letter-color);">ìíœ´ë©</div>
                </div>
                <div id="letterList" style="padding: 0 20px;"></div>
            `;
            
            const filteredPosts = posts.filter(p => p.type === 'letter' && (filter === 'all' || p.category === filter));
            renderPostList('letterList', filteredPosts);
        }

        function renderEditorTalk(container, filter) {
             // c. ë¬¸êµ¬ ìˆ˜ì • ë°˜ì˜
            container.innerHTML = `
                <div class="header-section">
                    <h1 class="header-title" style="color:var(--accent);">ì—ë””í„°í†¡</h1>
                    <p class="header-sub">ì—ë””í„°ì˜ ì¼ìƒ ê³µê°œ! ìš°ë¦¬ ë” ì¹œí•´ì ¸ìš” :)</p>
                </div>
                <div class="editor-filter-tabs">
                    <div class="editor-tab ${filter === 'all' ? 'active' : ''}" onclick="renderTab('editorTalk', 'all')" style="color:var(--accent);">ì „ì²´</div>
                    ${ADMINS.map(id => {
                        const nickname = EDITORS[id];
                        return `<div class="editor-tab ${filter === id ? 'active' : ''}" onclick="renderTab('editorTalk', '${id}')" style="color:var(--accent);">${nickname}</div>`;
                    }).join('')}
                </div>
                <div id="editorTalkList" style="padding: 0 20px;"></div>
            `;
            
            const filteredPosts = posts.filter(p => p.type === 'talk' && (filter === 'all' || p.authorId === filter));
            renderPostList('editorTalkList', filteredPosts.sort((a, b) => b.timestamp - a.timestamp));
        }
        
        // --- ë¬´ë“œ íŠ¸ë˜ì»¤ ë Œë”ë§ ---
        function renderMood(container) {
             // d. ë¬¸êµ¬ ë° ì¤„ë°”ê¿ˆ ë°˜ì˜
             const moodSubText = `ì˜¤ì§ ë‚˜ë§Œì„ ìœ„í•œ ê³µê°„!<br>ì˜¤ëŠ˜ì˜ ê°ì •ì„ ì†”ì§í•˜ê²Œ ê¸°ë¡í•´ìš”<br>ë¬´ë“œ ì‘ì„±ì‹œ ìŠ¤íƒ¬í”„ê°€ ì ë¦½ë©ë‹ˆë‹¤ (1ì¼ 1íšŒ)`;

            container.innerHTML = `
                <div class="header-section">
                    <h1 class="header-title" style="color:var(--primary-dark);">ì˜¤ëŠ˜ì˜ ë¬´ë“œ</h1>
                    <p class="header-sub">${moodSubText}</p>
                </div>
                
                <h2 style="padding: 0 20px; margin-top: 20px; font-size: 18px;">ğŸ—“ï¸ ë‚˜ì˜ ìŠ¤íƒ¬í”„ ë³´ë“œ</h2>
                <div id="stampBoardContainer" style="padding: 0 20px;">
                    ${renderStampBoard()}
                </div>

                <h2 style="padding: 0 20px; margin-top: 20px; font-size: 18px;">ğŸ“ ì˜¤ëŠ˜ ë¬´ë“œ ê¸°ë¡</h2>
                <div id="moodWriteArea" class="content-card" onclick="handleWriteIconClick()">
                    ${lastMoodDate === getTodayDate() 
                        ? `<p style="text-align:center; color:var(--text-light);">ì˜¤ëŠ˜ì˜ ë¬´ë“œ ê¸°ë¡ì„ ì™„ë£Œí–ˆì–´ìš”!</p>`
                        : `<p style="text-align:center; font-weight:bold;">í´ë¦­í•˜ì—¬ ì˜¤ëŠ˜ì˜ ë¬´ë“œ ê¸°ë¡í•˜ê¸°</p>`}
                </div>
                
                <h2 style="padding: 0 20px; margin-top: 20px; font-size: 18px;">ğŸ“ˆ ë¬´ë“œ ê¸°ë¡ í†µê³„</h2>
                <div id="moodStats" class="content-card" style="cursor:default;">
                    ${renderMoodStats()}
                </div>

            `;
        }

        function renderStampBoard() {
             if (!currentUser) return `<p style="text-align:center; color:var(--text-light);">ë¡œê·¸ì¸ í›„ ìŠ¤íƒ¬í”„ ë³´ë“œë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>`;
             
             const stampCount = users[currentUser].stamps || 0;
             let html = '<div class="stamp-board">';
             for (let i = 1; i <= 30; i++) {
                 const isStamped = i <= stampCount;
                 html += `<div class="stamp-cell ${isStamped ? 'stamped' : ''}">
                             ${isStamped ? `<i class="fas fa-star"></i>` : i}
                          </div>`;
             }
             html += '</div>';
             return html;
        }

        function renderMoodStats() {
            if (!currentUser) return `<p style="text-align:center; color:var(--text-light);">ë¡œê·¸ì¸ í›„ í™•ì¸í•˜ì„¸ìš”.</p>`;

            const userMoods = posts.filter(p => p.authorId === currentUser && p.type === 'mood');
            if (userMoods.length === 0) return `<p style="text-align:center; color:var(--text-light);">ì•„ì§ ê¸°ë¡ëœ ë¬´ë“œê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;

            const moodCounts = {};
            userMoods.forEach(mood => {
                const tag = mood.moodTag;
                moodCounts[tag] = (moodCounts[tag] || 0) + 1;
            });

            const topMood = Object.entries(moodCounts).sort(([, a], [, b]) => b - a)[0];
            const topMoodInfo = MOOD_TAGS.find(m => m.text === topMood[0]);

            return `
                <p style="font-weight:bold; margin-bottom:10px;">ê°€ì¥ ë§ì´ ê¸°ë¡í•œ ë¬´ë“œ:</p>
                <div style="font-size:16px; font-weight:bold; color:var(--accent);">
                    ${topMoodInfo.icon} ${topMood[0]} (${topMood[1]}íšŒ)
                </div>
            `;
        }


        // --- ìŠˆí¼ê´€ë¦¬ì ì „ìš© ëŒ€ì‹œë³´ë“œ ë Œë”ë§ í•¨ìˆ˜ ---
        function renderDashboard(container) {
            if (currentUser !== SUPER_ADMIN) return; // 2ì°¨ ë³´ì•ˆ ì²´í¬

            // ëª¨ë“  ë¬´ë“œ ê¸°ë¡ ì¡°íšŒ (ìµœì‹ ìˆœ)
            const allMoods = posts.filter(p => p.type === 'mood').sort((a, b) => b.timestamp - a.timestamp);
            
            // ë¬´ë“œ íƒœê·¸ë³„ í†µê³„ ê³„ì‚° (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
            const moodCounts = {};
            allMoods.forEach(mood => {
                const tag = mood.moodTag || '#ë¬´ë“œ_ì—†ìŒ';
                moodCounts[tag] = (moodCounts[tag] || 0) + 1;
            });
            
            const topMoods = Object.entries(moodCounts)
                .sort(([, a], [, b]) => b - a)
                .slice(0, 5);

            container.innerHTML = `
                <div class="header-section">
                    <h1 class="header-title" style="color:#059669;">ğŸ“Š ìŠˆí¼ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
                    <p class="header-sub">ì „ì²´ ì‚¬ìš©ìì˜ ë¬´ë“œ ê¸°ë¡ í˜„í™© ë° ë‚´ì—­ì„ ì‹œê°„ìˆœìœ¼ë¡œ í™•ì¸í•©ë‹ˆë‹¤.</p>
                </div>
                
                <h2 style="padding: 0 20px; margin-top: 20px; font-size: 18px;">ğŸ“ˆ ì „ì²´ ë¬´ë“œ í†µê³„ ìš”ì•½ (${allMoods.length}ê±´)</h2>
                <div class="content-card" style="cursor:default;">
                    <p style="font-weight:bold; margin-bottom:10px;">ê°€ì¥ ë§ì´ ê¸°ë¡ëœ ë¬´ë“œ TOP 5:</p>
                    <ul>
                        ${topMoods.map(([tag, count]) => {
                            const moodInfo = MOOD_TAGS.find(m => m.text === tag) || { icon: 'â“', color: '#ccc' };
                            return `<li style="font-size:14px; margin-bottom:5px; display:flex; justify-content:space-between;">
                                        <span>${moodInfo.icon} ${tag.replace('#', '')}</span>
                                        <span style="font-weight:bold; color:var(--primary);">${count}íšŒ</span>
                                    </li>`;
                        }).join('')}
                    </ul>
                </div>
                
                <h2 style="padding: 0 20px; margin-top: 20px; font-size: 18px;">ğŸ“ ì‹œê°„ìˆœ ì „ì²´ ë¬´ë“œ ê¸°ë¡</h2>
                <div id="allMoodList" style="padding: 0 20px;">
                    ${renderAdminMoodList(allMoods)} </div>
            `;
        }

        // ê´€ë¦¬ììš© ë¬´ë“œ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ ë„ìš°ë¯¸ í•¨ìˆ˜ (Admin Dashboard ì „ìš©)
        function renderAdminMoodList(moods) {
            if (moods.length === 0) return '<p style="color:var(--text-light);">ì•„ì§ ê¸°ë¡ëœ ë¬´ë“œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            
            let html = '';
            moods.forEach(mood => {
                const moodInfo = MOOD_TAGS.find(m => m.text === mood.moodTag) || { icon: 'â“' };
                html += `
                    <div class="content-card" onclick="viewPostDetail(${mood.id})">
                        <div style="font-size: 11px; margin-bottom: 5px; color: var(--text-light); display:flex; justify-content:space-between;">
                            <span>ì‘ì„±ì: **${users[mood.authorId]?.nickname || mood.author}** (${mood.authorId})</span>
                            <span>${mood.date}</span>
                        </div>
                        <h4 style="margin: 0 0 5px 0; font-size: 15px; color: var(--text-dark); overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">
                            ${moodInfo.icon} ${mood.title}
                        </h4>
                    </div>
                `;
            });
            return html;
        }


        // --- ë§ˆì´í˜ì´ì§€ ë Œë”ë§ ë° ê¸°ëŠ¥ ì¶”ê°€ ---
        function renderMyPage(container) {
            if (!currentUser) return;
            const user = users[currentUser];

            container.innerHTML = `
                <div class="header-section" style="text-align:center;">
                    <i class="fas fa-user-circle" style="font-size: 40px; color: var(--primary);"></i>
                    <h1 class="header-title" style="margin-top:10px;">${user.nickname}ë‹˜</h1>
                    <p class="header-sub">${currentUser} | ìŠ¤íƒ¬í”„: ${user.stamps}ê°œ</p>
                    <button class="btn-primary" style="margin-top:10px; background-color:#EF4444;" onclick="handleLogout()">ë¡œê·¸ì•„ì›ƒ</button>
                </div>

                <div class="mypage-tabs">
                    <div class="mypage-tab active" id="tab-myactivity" onclick="renderMyPageContent('myactivity')">ë‚´ í™œë™</div>
                    <div class="mypage-tab" id="tab-mycomments" onclick="renderMyPageContent('mycomments')">ë‚´ê°€ ì“´ ëŒ“ê¸€</div>
                    <div class="mypage-tab" id="tab-settings" onclick="renderMyPageContent('settings')">ì„¤ì •</div>
                </div>

                <div id="mypageContent" style="padding: 20px;">
                    </div>
            `;
            
            renderMyPageContent('myactivity');
        }
        
        function renderMyPageContent(type) {
            const contentDiv = document.getElementById('mypageContent');
            const tabs = document.querySelectorAll('.mypage-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            document.getElementById(`tab-${type}`).classList.add('active');

            if (type === 'myactivity') {
                const myPosts = posts.filter(p => p.authorId === currentUser).sort((a, b) => b.timestamp - a.timestamp);
                const bookmarkedPosts = posts.filter(p => myBookmarks.includes(p.id)).sort((a, b) => b.timestamp - a.timestamp);
                
                contentDiv.innerHTML = `
                    <h3 style="margin-top:0;">ğŸ“š ë‚´ê°€ ì“´ ê¸€ (${myPosts.length}ê°œ)</h3>
                    ${myPosts.length > 0 ? renderPostListHtml(myPosts) : '<p>ì‘ì„±í•œ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>'}
                    
                    <h3 style="margin-top:20px;">â­ ë¶ë§ˆí¬ (${bookmarkedPosts.length}ê°œ)</h3>
                    ${bookmarkedPosts.length > 0 ? renderPostListHtml(bookmarkedPosts) : '<p>ë¶ë§ˆí¬í•œ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>'}
                `;
            } else if (type === 'mycomments') { // 'ë‚´ê°€ ì“´ ëŒ“ê¸€' ë©”ë‰´
                 const myComments = comments
                     .filter(c => c.authorId === currentUser)
                     .sort((a, b) => b.timestamp - a.timestamp); // ìµœì‹ ìˆœ ì •ë ¬

                 let html = `<h3 style="margin-top:0;">ğŸ’¬ ë‚´ê°€ ì“´ ëŒ“ê¸€ (${myComments.length}ê°œ)</h3>`;

                 if (myComments.length === 0) {
                     html += '<p>ì‘ì„±í•œ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                 } else {
                     myComments.forEach(comment => {
                         const post = posts.find(p => p.id === comment.postId);
                         const postTitle = post ? post.title : 'ì›ë³¸ ê²Œì‹œë¬¼ ì‚­ì œë¨';
                         
                         html += `
                             <div class="comment-item-in-mypage" onclick="viewPostDetail(${comment.postId})">
                                 <p>${comment.content}</p>
                                 <small>ê²Œì‹œë¬¼: ${postTitle} | ì‘ì„±ì¼: ${new Date(comment.timestamp).toLocaleDateString()}</small>
                             </div>
                         `;
                     });
                 }
                 contentDiv.innerHTML = html;

            } else if (type === 'settings') {
                contentDiv.innerHTML = `
                    <h3 style="margin-top:0;">âš™ï¸ ê³„ì • ì„¤ì •</h3>
                    <div class="content-card" onclick="showChangePasswordModal()">
                        <i class="fas fa-lock" style="margin-right:10px;"></i> ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
                    </div>
                    <div class="content-card" onclick="alert('ê³„ì •ì„ íƒˆí‡´í•©ë‹ˆë‹¤. (ê¸°ëŠ¥ ë¯¸êµ¬í˜„)')" style="color:#EF4444;">
                        <i class="fas fa-trash-alt" style="margin-right:10px;"></i> ê³„ì • íƒˆí‡´
                    </div>
                `;
            }
        }

        // --- ê²Œì‹œë¬¼ ë Œë”ë§ ë° ë¡œì§ (ì¼ë¶€ ìƒëµ) ---

        function renderPostList(id, postArray) {
             const listDiv = document.getElementById(id);
             listDiv.innerHTML = renderPostListHtml(postArray);
        }

        function renderPostListHtml(postArray) {
             let html = '';
             if (postArray.length === 0) return '<p style="color:var(--text-light);">ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
             postArray.forEach(post => {
                 // ì´ëª¨í‹°ì½˜ ê¸°ë°˜ ë¬´ë“œ íƒœê·¸ í‘œì‹œ (ë¬´ë“œ íƒ€ì…ë§Œ)
                 const moodEmoji = post.type === 'mood' ? MOOD_TAGS.find(m => m.text === post.moodTag)?.icon || 'â­' : '';
                 const categoryDisplay = post.type === 'letter' ? `<span style="color:var(--letter-color);">${post.category}</span>` : 
                                       post.type === 'talk' ? `<span style="color:var(--accent);">Talk</span>` : '';
                 
                 html += `
                     <div class="content-card" onclick="viewPostDetail(${post.id})">
                         <div style="font-size: 11px; margin-bottom: 5px; color: var(--text-light); display:flex; justify-content:space-between;">
                            <span>${categoryDisplay}</span>
                            <span>ì¡°íšŒìˆ˜ ${post.views}</span>
                         </div>
                         <h4 style="margin: 0 0 5px 0; font-size: 15px; color: var(--text-dark); overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">
                             ${moodEmoji} ${post.title}
                         </h4>
                         <p style="margin: 0; font-size: 13px; color: var(--text-light); overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">
                             ${post.content}
                         </p>
                     </div>
                 `;
             });
             return html;
        }


        function viewPostDetail(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post) {
                alert('ê²Œì‹œë¬¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            currentViewingPostId = postId;

            // ì¡°íšŒìˆ˜ ì¦ê°€
            post.views = (post.views || 0) + 1;
            saveData('posts', posts);
            
            document.getElementById('detailCategory').textContent = post.category || (post.type === 'talk' ? 'ì—ë””í„°í†¡' : 'ë¬´ë“œê¸°ë¡');
            document.getElementById('detailTitle').textContent = post.title;
            document.getElementById('detailAuthor').textContent = users[post.authorId]?.nickname || post.author;
            document.getElementById('detailDate').textContent = post.date;
            document.getElementById('detailContent').textContent = post.content;
            
            const manageButtons = document.getElementById('manageButtons');
            const isMyPost = currentUser && post.authorId === currentUser;
            
            // ë¬´ë“œ ê¸°ë¡ì€ ìˆ˜ì •/ì‚­ì œ ë¶ˆê°€ (d. ìš”ì²­ ë°˜ì˜)
            const canEditOrDelete = isMyPost && post.type !== 'mood'; 
            manageButtons.style.display = canEditOrDelete ? 'flex' : 'none';

            // ì´ë¯¸ì§€ ì²˜ë¦¬ ìƒëµ (ê¸°ëŠ¥ êµ¬í˜„ì— í¬í•¨ë˜ì§€ ì•ŠìŒ)

            // ì¢‹ì•„ìš” ë° ë¶ë§ˆí¬ ìƒíƒœ ì—…ë°ì´íŠ¸
            updateInteractionButtons(postId);
            
            // ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
            renderComments(postId);
            
            showModal('postDetailModal');
        }

        // --- ê¸€ì“°ê¸° ë¡œì§ (ìˆ˜ì •) ---

        function handleWriteIconClick() {
            if (!currentUser) {
                alert('ë¡œê·¸ì¸ í›„ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                showLoginModal();
                return;
            }
            
            const currentTab = document.querySelector('.nav-item.active').id.replace('nav-', '');
            
            document.getElementById('postCategory').style.display = 'none';
            document.getElementById('moodSection').style.display = 'none';
            document.getElementById('postTitle').value = '';
            document.getElementById('postContent').value = '';
            document.getElementById('editPostId').value = '';
            document.getElementById('photoAttachment').style.display = 'none'; 
            currentMoodTag = null; // ë¬´ë“œ íƒœê·¸ ì´ˆê¸°í™”

            if (currentTab === 'mood') {
                 // d. ë¬´ë“œ ê¸°ë¡ì€ 1ì¼ 1íšŒë§Œ ê°€ëŠ¥, ìˆ˜ì • ë¶ˆê°€ (ìš”ì²­ ë°˜ì˜)
                 if (lastMoodDate === getTodayDate()) {
                     alert('ì˜¤ëŠ˜ì˜ ë¬´ë“œëŠ” ì´ë¯¸ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤. (ìˆ˜ì •/ì‚­ì œ ê¸°ëŠ¥ì€ ì œê³µë˜ì§€ ì•ŠìŠµë‹ˆë‹¤)');
                     return; 
                 }
                 document.getElementById('writeTitle').textContent = 'ì˜¤ëŠ˜ì˜ ë¬´ë“œ ê¸°ë¡';
                 document.getElementById('moodSection').style.display = 'block';
                 document.getElementById('postTitle').placeholder = 'ì˜¤ëŠ˜ì˜ ë¬´ë“œ ìš”ì•½ (ì„ íƒ)';
                 document.getElementById('postContent').placeholder = 'ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ê°„ëµíˆ ê¸°ë¡í•´ë³´ì„¸ìš”.';
                 document.getElementById('submitPost').textContent = 'ë“±ë¡í•˜ê¸°';
                 
                 // ë¬´ë“œ íƒœê·¸ ëª©ë¡ ë Œë”ë§
                 renderMoodTags();
                 
            } else if (currentTab === 'editorTalk') {
                 document.getElementById('writeTitle').textContent = 'ì—ë””í„°í†¡ ì‘ì„±';
                 document.getElementById('postTitle').placeholder = 'ì œëª©';
                 document.getElementById('postContent').placeholder = 'ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”';
                 document.getElementById('photoAttachment').style.display = 'block'; 
                 document.getElementById('submitPost').textContent = 'ë“±ë¡í•˜ê¸°';
            }
            
            showModal('writeModal');
        }
        
        function renderMoodTags() {
            const selector = document.getElementById('moodTagSelector');
            selector.innerHTML = '';
            
            MOOD_TAGS.forEach(mood => {
                const tag = document.createElement('div');
                tag.className = 'mood-tag';
                tag.style.backgroundColor = mood.color;
                tag.innerHTML = `
                    <span class="mood-tag-icon">${mood.icon}</span>
                    <span class="mood-tag-text">${mood.text}</span>
                `;
                tag.onclick = () => selectMoodTag(tag, mood.text);
                selector.appendChild(tag);
            });
        }
        
        function selectMoodTag(selectedElement, tagText) {
            document.querySelectorAll('.mood-tag').forEach(tag => tag.classList.remove('selected'));
            selectedElement.classList.add('selected');
            currentMoodTag = tagText;
        }

        function submitPost() {
            const editId = document.getElementById('editPostId').value;
            const title = document.getElementById('postTitle').value.trim();
            const content = document.getElementById('postContent').value.trim();
            const currentTab = document.querySelector('.nav-item.active').id.replace('nav-', '');
            
            if (currentTab === 'mood' && !currentMoodTag) {
                alert('ì˜¤ëŠ˜ì˜ ë¬´ë“œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!title && !content && currentTab !== 'mood') {
                alert('ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // Mood Record (d. ë¬´ë“œ ë“±ë¡ ì‹œ ìŠ¤íƒ¬í”„ ì ë¦½ ë¡œì§ í¬í•¨)
            if (currentTab === 'mood') {
                // ì´ì „ì— 1ì¼ 1íšŒ ì²´í¬ëŠ” handleWriteIconClickì—ì„œ í–ˆìœ¼ë¯€ë¡œ, ì—¬ê¸°ì„œëŠ” ê¸°ë¡ë§Œ
                const moodInfo = MOOD_TAGS.find(m => m.text === currentMoodTag);
                const newMood = {
                    id: Date.now(),
                    type: 'mood',
                    category: 'ë¬´ë“œ',
                    title: title || `${moodInfo.icon} ì˜¤ëŠ˜ì˜ ë¬´ë“œ ê¸°ë¡`,
                    content: content,
                    author: users[currentUser].nickname,
                    authorId: currentUser,
                    date: getTodayDate(),
                    moodTag: currentMoodTag,
                    tagColor: moodInfo.color,
                    views: 0,
                    timestamp: Date.now()
                };
                
                posts.push(newMood);
                saveData('posts', posts);
                
                // ìŠ¤íƒ¬í”„ ì ë¦½ ë° lastMoodDate ì—…ë°ì´íŠ¸
                users[currentUser].stamps = (users[currentUser].stamps || 0) + 1;
                lastMoodDate = getTodayDate();
                localStorage.setItem('lastMoodDate', lastMoodDate);
                saveData('users', users);

                closeModal();
                // íŒì—… ë¬¸êµ¬ ìˆ˜ì • ë°˜ì˜
                document.querySelector('#moodSuccessModal h2').textContent = 'ì˜¤ëŠ˜ì˜ ë¬´ë“œ ê¸°ë¡ ì™„ë£Œ! ìŠ¤íƒ¬í”„ê°€ ì ë¦½ë˜ì—ˆì–´ìš”! â¤ï¸';
                showModal('moodSuccessModal');
                renderTab('mood'); // ë¬´ë“œ íƒ­ ìƒˆë¡œê³ ì¹¨
                return;
            }
            
            // ... (EditorTalk, Letter ìˆ˜ì •/ë“±ë¡ ë¡œì§ ìƒëµ) ...
            
            closeModal();
            renderTab(currentTab);
        }

        // --- ê¸°íƒ€ ìƒí˜¸ì‘ìš© í•¨ìˆ˜ (ìƒëµ) ---

        function updateInteractionButtons(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post) return;

            const likeCountSpan = document.getElementById('likeCount');
            if (likeCountSpan) likeCountSpan.textContent = (post.likes || []).length;
            
            const btnLike = document.getElementById('btnLike');
            const btnBookmark = document.getElementById('btnBookmark');

            if (btnLike && currentUser) {
                btnLike.classList.toggle('active', myLikes.includes(postId));
                btnLike.style.color = myLikes.includes(postId) ? '#EF4444' : 'var(--text-light)';
            }
             if (btnBookmark && currentUser) {
                btnBookmark.classList.toggle('active', myBookmarks.includes(postId));
                btnBookmark.style.color = myBookmarks.includes(postId) ? '#F59E0B' : 'var(--text-light)';
            }
        }
        
        function renderComments(postId) {
            const commentListDiv = document.getElementById('commentList');
            const postComments = comments.filter(c => c.postId === postId && !c.parentId)
                                          .sort((a, b) => a.timestamp - b.timestamp);
            
            let html = '';
            
            postComments.forEach(comment => {
                const replies = comments.filter(c => c.parentId === comment.id)
                                        .sort((a, b) => a.timestamp - b.timestamp);
                                        
                const commentAuthorName = users[comment.authorId]?.nickname || comment.author;
                
                html += `
                    <div class="comment-item">
                        <div class="comment-meta">
                            <span><b>${commentAuthorName}</b> (${comment.date})</span>
                            <span class="reply-btn" onclick="showReplyInput(${comment.id})">ë‹µê¸€ ë‹¬ê¸°</span>
                        </div>
                        <p>${comment.content}</p>
                        
                        <div id="replyInput-${comment.id}" class="reply-input-group" style="display:none;">
                            <input type="text" id="replyText-${comment.id}" class="input-box" placeholder="${commentAuthorName}ë‹˜ì—ê²Œ ë‹µê¸€" style="flex-grow:1; margin-bottom:0;">
                            <button class="btn-primary" style="width:50px; height:35px; margin-bottom:0; padding:0;" onclick="submitComment(${comment.id})">ë“±ë¡</button>
                        </div>

                        ${replies.length > 0 ? `
                            <div class="reply-section">
                                ${replies.map(reply => `
                                    <div class="reply-item">
                                        <div class="comment-meta">
                                            <span><b>${users[reply.authorId]?.nickname || reply.author}</b> (${reply.date})</span>
                                        </div>
                                        <p>${reply.content}</p>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            commentListDiv.innerHTML = html || '<p style="color:var(--text-light); text-align:center;">ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
        }

        // --- ê¸°íƒ€ í•¨ìˆ˜ í˜¸ì¶œ ---
        initData();
    </script>
</body>
</html>
