<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ììœ ë¡œìš´ íœ´ì‹ ë ˆí„° - ìíœ´ë ˆí„°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'pastel-blue': {
                            100: '#DDEFFF',
                            300: '#9AC6F6',
                            500: '#5A9BD6', // Primary Blue
                            600: '#3A7CBB',
                            700: '#1A5A9F',
                        },
                        'luxury-gold': {
                            300: '#FFD700',
                            500: '#C5B358', // Accent Gold
                            700: '#A99433',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* ê¸°ë³¸ ë ˆì´ì•„ì›ƒ ë° í°íŠ¸ */
        body { font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif; background-color: #f7f9fc; }
        .container { max-width: 1000px; }

        /* ëª¨ë‹¬ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease-out;
        }
        .modal.show { display: flex; opacity: 1; }
        .modal-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 12px;
            width: 90%;
            max-width: 700px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(-20px);
            transition: transform 0.3s ease-out;
        }
        .modal.show .modal-content { transform: translateY(0); }

        /* í˜ì´ì§€ ì „í™˜ ì• ë‹ˆë©”ì´ì…˜ */
        .fade-in { animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ë²„íŠ¼ í˜¸ë²„ íš¨ê³¼ */
        .btn-scale { transition: transform 0.1s ease-out; }
        .btn-scale:hover { transform: scale(1.05); }

        /* ë§ˆì´í˜ì´ì§€ íƒ­ ìŠ¤íƒ€ì¼ */
        .tab-btn {
            padding: 8px 16px;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            color: #6b7280;
            transition: border-color 0.2s, color 0.2s;
        }
        .tab-btn.active {
            color: #5A9BD6; /* Pastel Blue */
            border-bottom-color: #5A9BD6;
            font-weight: 700;
        }
        
        /* ìŠ¤íƒ¬í”„ ìŠ¤ì¼€ì¹˜ ìŠ¤íƒ€ì¼ */
        .sketch-stamp { 
            fill: none; 
            stroke: #d1d5db; /* ì—°í•œ íšŒìƒ‰ */
            stroke-width: 1.5;
            transition: stroke-width 0.3s;
        }
        .stamped-icon {
            fill: #5A9BD6; /* ì˜ˆìœ íŒŒë€ìƒ‰ */
            stroke: #5A9BD6;
        }
        .stamp-container { position: relative; }
        
    </style>
</head>
<body class="min-h-screen">

    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <h1 onclick="navigateTo('home')" class="text-3xl font-extrabold text-pastel-blue-600 cursor-pointer hover:opacity-80 transition-opacity">
                ìíœ´ë ˆí„°
            </h1>
            <nav class="flex space-x-6">
                <button onclick="navigateTo('home')" class="text-gray-600 hover:text-pastel-blue-500 font-medium btn-scale">ğŸ  í™ˆ</button>
                <button onclick="navigateTo('newsletter')" class="text-gray-600 hover:text-pastel-blue-500 font-medium btn-scale">ğŸ“– ë ˆí„°</button>
                <button onclick="navigateTo('editorTalk')" class="text-gray-600 hover:text-pastel-blue-500 font-medium btn-scale">ğŸ’¬ ì—ë””í„° í†¡</button>
                <button onclick="navigateTo('moment')" class="text-gray-600 hover:text-pastel-blue-500 font-medium btn-scale">âœ¨ ëª¨ë¨¼íŠ¸</button>
                <button onclick="navigateTo('qna')" class="text-gray-600 hover:text-pastel-blue-500 font-medium btn-scale">â“ Q&A</button>
                <a href="https://index-html-zak5.vercel.app/" target="_blank" class="text-luxury-gold-500 hover:text-luxury-gold-700 font-bold btn-scale transition-transform">ğŸŒ¿ íë§ ìœ í˜• í…ŒìŠ¤íŠ¸</a>
            </nav>
            <div id="userAuth" class="flex items-center space-x-3">
                <button id="myPageBtn" onclick="navigateTo('myPage')" class="text-gray-600 hover:text-pastel-blue-500 font-medium btn-scale hide">ë§ˆì´í˜ì´ì§€</button>
                <button id="loginBtn" onclick="toggleAuthModal()" class="bg-pastel-blue-500 text-white px-4 py-2 rounded-full font-medium shadow-md hover:bg-pastel-blue-600 btn-scale">ë¡œê·¸ì¸</button>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <section id="homePage" class="fade-in">
            <h2 class="text-4xl font-extrabold text-gray-800 mb-4">ììœ ë¡œìš´ ë‹¹ì‹ ì˜ íœ´ì‹ ê°€ì´ë“œ</h2>
            <p class="text-lg text-gray-600 mb-8">ì¼ê³¼ ì‚¶ì˜ ê· í˜•, ìíœ´ë ˆí„°ê°€ ë„ì™€ë“œë¦´ê²Œìš”.</p>
            <div id="latestPosts" class="space-y-6">
                <p class="text-gray-500 text-center">ìµœì‹  ê¸€ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
            </div>
        </section>

        <section id="newsletterPage" class="p-4 hide fade-in">
            <h2 class="text-2xl font-extrabold text-pastel-blue-600 mb-6 border-b-4 border-pastel-blue-500 pb-2">ë‹¹ì‹ ì„ ìœ„í•œ ìíœ´ë ˆí„° ì•„ì¹´ì´ë¸Œ</h2>
            
            <div class="mb-4 flex space-x-2">
                <input type="search" id="newsletterSearch" placeholder="ì œëª©/í‚¤ì›Œë“œ ê²€ìƒ‰" onkeyup="filterNewsletters()" 
                       class="flex-1 px-4 py-2 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-luxury-gold-300">
                <select id="newsletterFilter" onchange="filterNewsletters()" 
                        class="px-3 py-2 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-luxury-gold-300">
                    <option value="all">ì „ì²´ ì—ë””í„°</option>
                </select>
            </div>
            
            <div id="newsletterList" class="space-y-6">
                <p class="text-gray-500 text-center mt-8">ìíœ´ë ˆí„° ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
            </div>
        </section>

        <section id="editorTalkPage" class="hide fade-in">
            <h2 class="text-2xl font-extrabold text-pastel-blue-600 mb-6 border-b-4 border-pastel-blue-500 pb-2">ğŸ’¬ ì—ë””í„° í†¡</h2>
            <div id="editorTalkList" class="space-y-4">
                <p class="text-gray-500 text-center">ì—ë””í„°ë“¤ì˜ ì´ì•¼ê¸°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
            </div>
        </section>

        <section id="momentPage" class="hide fade-in">
            <h2 class="text-2xl font-extrabold text-pastel-blue-600 mb-6 border-b-4 border-pastel-blue-500 pb-2">âœ¨ ëª¨ë¨¼íŠ¸ (ì§§ì€ ë‹¨ìƒ)</h2>
            <div id="momentList" class="space-y-4">
                <p class="text-gray-500 text-center">ì—ë””í„°ë“¤ì˜ ì§§ì€ ë‹¨ìƒì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
            </div>
        </section>
        
        <section id="qnaPage" class="hide fade-in">
            <h2 class="text-2xl font-extrabold text-pastel-blue-600 mb-6 border-b-4 border-pastel-blue-500 pb-2">â“ Q&A</h2>
            <div class="flex justify-end mb-4">
                <button onclick="showPostWriteModal('qna')" class="bg-pastel-blue-500 text-white px-4 py-2 rounded-xl font-medium shadow-md hover:bg-pastel-blue-600 btn-scale">ì§ˆë¬¸í•˜ê¸°</button>
            </div>
            <div id="qnaList" class="space-y-4">
                <p class="text-gray-500 text-center">Q&A ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
            </div>
        </section>

        <section id="myPage" class="p-4 hide fade-in">
            </section>
    </main>

    <div id="postDetailModal" class="modal" onclick="closeModal(event, 'postDetailModal')">
        <div class="modal-content">
            <div class="flex justify-between items-start border-b pb-3 mb-4 sticky top-0 bg-white z-10">
                <div>
                    <h2 id="postDetailTitle" class="text-2xl font-bold text-gray-800"></h2>
                    <div class="text-sm text-gray-500 mt-1 space-x-2">
                        <span id="postDetailAuthor"></span>
                        <span>|</span>
                        <span id="postDetailDate"></span>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="likeBtn-POSTID" onclick="toggleLike(currentPostId)" class="p-2 btn-scale" title="ì¢‹ì•„ìš”">
                        </button>
                    <button id="bookmarkBtn-POSTID" onclick="toggleBookmark(currentPostId)" class="p-2 btn-scale" title="ìŠ¤í¬ë©">
                        </button>
                    <button id="stampBtn-POSTID" onclick="toggleStamp(currentPostId)" class="p-2 btn-scale" title="ìŠ¤íƒ¬í”„ íšë“">
                        </button>
                    <button onclick="closeModal(null, 'postDetailModal')" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>
            </div>

            <div id="postDetailContent" class="prose max-w-none mb-6">
                </div>

            <div id="commentSection" class="border-t pt-4">
                <h3 class="text-lg font-bold text-gray-700 mb-4">ëŒ“ê¸€</h3>
                <div id="postDetailComments" class="space-y-4">
                    </div>
                <div id="commentFormContainer">
                    </div>
            </div>
        </div>
    </div>

    <div id="authModal" class="modal" onclick="closeModal(event, 'authModal')">
        <div class="modal-content max-w-sm">
            <h3 class="text-xl font-bold text-pastel-blue-600 mb-4">ë¡œê·¸ì¸ / íšŒì›ê°€ì…</h3>
            <div id="loginForm">
                <input type="email" id="authEmail" placeholder="ì´ë©”ì¼" class="w-full px-4 py-2 mb-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pastel-blue-500">
                <input type="password" id="authPassword" placeholder="ë¹„ë°€ë²ˆí˜¸" class="w-full px-4 py-2 mb-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pastel-blue-500">
                <button onclick="handleLogin()" class="w-full bg-pastel-blue-500 text-white px-4 py-2 rounded-lg font-medium shadow-md hover:bg-pastel-blue-600 btn-scale mb-3">ë¡œê·¸ì¸</button>
                <button onclick="handleSignup()" class="w-full bg-gray-400 text-white px-4 py-2 rounded-lg font-medium hover:bg-gray-500 btn-scale">íšŒì›ê°€ì…</button>
            </div>
        </div>
    </div>

    <div id="postWriteModal" class="modal" onclick="closeModal(event, 'postWriteModal')">
        <div class="modal-content">
            <h3 id="writeModalTitle" class="text-xl font-bold text-pastel-blue-600 mb-4">ìƒˆ ê²Œì‹œê¸€ ì‘ì„±</h3>
            <input type="text" id="postTitle" placeholder="ì œëª©" class="w-full px-4 py-2 mb-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pastel-blue-500">
            <textarea id="postContent" rows="8" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”." class="w-full px-4 py-2 mb-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pastel-blue-500"></textarea>
            <div id="qnaOptions" class="flex items-center mb-4 hide">
                <input type="checkbox" id="isPrivate" class="mr-2">
                <label for="isPrivate" class="text-gray-700">ë¹„ë°€ê¸€ë¡œ ì‘ì„±í•˜ê¸° (ì‘ì„±ìì™€ ê´€ë¦¬ìë§Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤)</label>
            </div>
            <button onclick="submitPost()" class="w-full bg-pastel-blue-500 text-white px-4 py-2 rounded-lg font-medium shadow-md hover:bg-pastel-blue-600 btn-scale">ì‘ì„± ì™„ë£Œ</button>
        </div>
    </div>

    <div id="notificationContainer" class="fixed bottom-4 right-4 space-y-2 z-50"></div>


<script>
    // --- Global Variables and Constants ---
    let currentPage = 'home';
    let currentUser = null; // { id: 'user1', name: 'í˜œë€', email: 'hr@mail.com', isAdmin: true }
    let currentPostId = null;
    let posts = [];
    let comments = [];
    let newsletters = []; // ë ˆí„° ì „ìš© ë°ì´í„°
    let likedItems = {}; // { postId: { isLiked: true, isBookmarked: false, isStamped: true } }
    
    // ê´€ë¦¬ì ì´ë©”ì¼ ëª©ë¡ (ëŒ“ê¸€/Q&A ê¶Œí•œ í™•ì¸ìš©)
    const ADMIN_EDITORS = ['admin@jahyu.com', 'hr@mail.com']; // í˜œë€ë‹˜ ì´ë©”ì¼ì„ ê´€ë¦¬ìë¡œ ì„ì‹œ ì§€ì •
    
    // --- Data Initialization & Utility Functions ---

    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ë¡œë“œ (ì„ì‹œ)
    function loadData() {
        // ì„ì‹œ ì‚¬ìš©ì ë¡œê·¸ì¸ (í…ŒìŠ¤íŠ¸ìš©)
        currentUser = { id: 'user1', name: 'í˜œë€', email: 'hr@mail.com', isAdmin: true };
        
        // ì„ì‹œ posts ë°ì´í„° (íƒ€ì… í¬í•¨)
        posts = [
            { id: 'p1', title: 'Q&A: ë¹„ë°€ê¸€ ê¸°ëŠ¥ ë¬¸ì˜', content: 'ë¹„ë°€ê¸€ë¡œ ì‘ì„±í•˜ë©´ ì €ë‘ ê´€ë¦¬ìë§Œ ë³¼ ìˆ˜ ìˆë‚˜ìš”?', authorId: 'user1', authorName: 'í˜œë€', authorEmail: 'hr@mail.com', type: 'qna', timestamp: Date.now() - (1 * 60 * 60 * 1000), commentCount: 1, isPrivate: true },
            { id: 'p2', title: 'ì—ë””í„°í†¡: ì¼ì£¼ì¼ ì˜ ë²„í‹°ì…¨ë‚˜ìš”?', content: 'ì£¼ë§ì—ëŠ” ì•„ë¬´ ìƒê° ì—†ì´ ì‰¬ì–´ì•¼ í•´ìš”!', authorId: 'editor2', authorName: 'ì—˜ë¦¬', authorEmail: 'editor2@jahyu.com', type: 'editorTalk', timestamp: Date.now() - (2 * 24 * 60 * 60 * 1000), commentCount: 3, isPrivate: false },
            { id: 'p3', title: 'ëª¨ë¨¼íŠ¸: ì¢‹ì•„í•˜ëŠ” ë…¸ë˜ë¥¼ ë“¤ìœ¼ë©°', content: 'ì´ ë…¸ë˜ë¥¼ ë“¤ì„ ë•Œë§ˆë‹¤ ë§ˆìŒì´ í¸í•´ì§‘ë‹ˆë‹¤.', authorId: 'editor3', authorName: 'ê³ ì¹¼', authorEmail: 'editor3@jahyu.com', type: 'moment', timestamp: Date.now() - (4 * 24 * 60 * 60 * 1000), commentCount: 0, isPrivate: false },
            { id: 'p4', title: 'Q&A: ììœ ë¡œìš´ íœ´ì‹ íŒì„ ì£¼ì„¸ìš”!', content: 'ìê¾¸ ë¬´ì–¸ê°€ë¥¼ í•˜ë ¤ê³  í•´ìš”.', authorId: 'user2', authorName: 'ì§ì¥ì¸A', authorEmail: 'user2@mail.com', type: 'qna', timestamp: Date.now() - (6 * 24 * 60 * 60 * 1000), commentCount: 1, isPrivate: false },
        ];
        
        // ì„ì‹œ newsletters ë°ì´í„° (ìŠ¤íƒ¬í”„ í…ŒìŠ¤íŠ¸ìš©)
        newsletters = [
            { id: 'nl1', title: '[32í˜¸] í‡´ì‚¬ í›„ ë²ˆì•„ì›ƒ, ì €ë§Œ ì´ëŸ°ê°€ìš”?', content: 'í‡´ì‚¬ í›„ì—ë„ ì‰¬ì§€ ëª»í•˜ëŠ” ë‹¹ì‹ ì—ê²Œ...', authorName: 'ì—˜ë¦¬', type: 'letter', timestamp: Date.now() - (2 * 24 * 60 * 60 * 1000) },
            { id: 'nl2', title: '[31í˜¸] ì´ì‚¬ë¥¼ ì•ë‘” ìì·¨ìƒì„ ìœ„í•œ í•„ìˆ˜í…œ 10ê°€ì§€', content: 'ì‹¤ìš©ì ì¸ ê°€ì´ë“œ...', authorName: 'í–…ì”¨', type: 'letter', timestamp: Date.now() - (15 * 24 * 60 * 60 * 1000) },
            { id: 'nl3', title: '[ìíœ´ë©] ê¸€ì“°ê¸° ë…¸í•˜ìš°: ë‚´ ë§ˆìŒì„ ë‹´ëŠ” ë²•', content: 'ê¸€ì“°ê¸° íŒ ê³µìœ ...', authorName: 'ê³ ì¹¼', type: 'letter', timestamp: Date.now() - (5 * 24 * 60 * 60 * 1000) },
            { id: 'nl4', title: '[30í˜¸] ì›”ìš”ë³‘ ì´ê¸°ëŠ” ë²•', content: 'ì›”ìš”ì¼ ì•„ì¹¨ì„ ìƒì¾Œí•˜ê²Œ ì‹œì‘í•˜ëŠ” íŒ', authorName: 'ì—˜ë¦¬', type: 'letter', timestamp: Date.now() - (30 * 24 * 60 * 60 * 1000) },
            { id: 'nl5', title: '[ìíœ´ë©] ì·¨ë¯¸ë¥¼ ì¼ë¡œ ë§Œë“œëŠ” ë°©ë²•', content: 'ì·¨ë¯¸ì™€ ìˆ˜ìµì„ ë™ì‹œì— ì¡ëŠ” ë²•', authorName: 'í–…ì”¨', type: 'letter', timestamp: Date.now() - (40 * 24 * 60 * 60 * 1000) },
        ];

        // postsì— newsletters ë°ì´í„° í†µí•© (ìƒì„¸ë³´ê¸° ë° ì¢‹ì•„ìš”/ë¶ë§ˆí¬ ì²˜ë¦¬ë¥¼ ìœ„í•´)
        posts = [...newsletters, ...posts];

        // ì„ì‹œ comments ë°ì´í„°
        comments = [
            { id: 'c1', postId: 'p1', authorName: 'ê´€ë¦¬ì', authorEmail: 'admin@jahyu.com', content: 'ë„¤, ë¹„ë°€ê¸€ë¡œ ì‘ì„±í•˜ì‹œë©´ ì‘ì„±ìë‹˜ê³¼ ê´€ë¦¬ìë§Œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.', timestamp: Date.now() - (30 * 60 * 1000) },
            { id: 'c2', postId: 'p2', authorName: 'í˜œë€', authorEmail: 'hr@mail.com', content: 'ë•ë¶„ì— ì˜ ë²„í…¼ìŠµë‹ˆë‹¤! ì£¼ë§ ê¿€íœ´ì‹!', timestamp: Date.now() - (1 * 24 * 60 * 60 * 1000) },
            { id: 'c3', postId: 'p4', authorName: 'ê´€ë¦¬ì', authorEmail: 'admin@jahyu.com', content: 'íœ´ì‹ë„ ì—°ìŠµì´ í•„ìš”í•´ìš”. ê°€ë³ê²Œ ì‚°ì±…ë¶€í„° ì‹œì‘í•´ë³´ì„¸ìš”.', timestamp: Date.now() - (3 * 24 * 60 * 60 * 1000) },
        ];
        
        // ì„ì‹œ likedItems ë°ì´í„° (í˜œë€ user1 ê¸°ì¤€)
        likedItems = {
            'p2': { isLiked: true }, // ì—ë””í„°í†¡ ì¢‹ì•„ìš”
            'nl1': { isBookmarked: true, isStamped: true }, // ë ˆí„° ë¶ë§ˆí¬ ë° ìŠ¤íƒ¬í”„ íšë“
            'nl3': { isStamped: true }, // ë ˆí„° ìŠ¤íƒ¬í”„ íšë“
            'p3': { isBookmarked: true }, // ëª¨ë¨¼íŠ¸ ë¶ë§ˆí¬
        };

        // ì´ˆê¸° í™”ë©´ ë Œë”ë§
        updateAuthUI();
        navigateTo(currentPage);
        initializeNewsletterFilters(); // ë ˆí„° í•„í„° ì´ˆê¸°í™”
    }

    // ìƒˆ ê¸€ ë±ƒì§€ í‘œì‹œ ë¡œì§
    function isNewPost(timestamp) {
        const oneWeek = 7 * 24 * 60 * 60 * 1000;
        return (Date.now() - timestamp) < oneWeek;
    }

    function getNewBadgeHtml(timestamp) {
        return isNewPost(timestamp) ? '<span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">NEW</span>' : '';
    }
    
    // ëª¨ë‹¬ ë‹«ê¸°
    function closeModal(event, modalId) {
        if (!event || event.target.id === modalId || event.target.closest('.modal-close')) {
            document.getElementById(modalId).classList.remove('show');
        }
    }
    
    // ì•Œë¦¼ í‘œì‹œ
    function showNotification(title, message) {
        const container = document.getElementById('notificationContainer');
        const notification = document.createElement('div');
        notification.className = 'bg-white p-4 rounded-lg shadow-xl border border-gray-100 flex items-center space-x-3 transform translate-x-full transition-transform duration-300';
        notification.innerHTML = `
            <div class="flex-shrink-0 text-pastel-blue-500">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            </div>
            <div>
                <p class="font-bold text-gray-800">${title}</p>
                <p class="text-sm text-gray-600">${message}</p>
            </div>
        `;
        container.appendChild(notification);
        
        // ì• ë‹ˆë©”ì´ì…˜: ë‚˜íƒ€ë‚˜ê¸°
        setTimeout(() => {
            notification.style.transform = 'translateX(0)';
        }, 10);

        // ì• ë‹ˆë©”ì´ì…˜: ì‚¬ë¼ì§€ê¸°
        setTimeout(() => {
            notification.style.transform = 'translateX(calc(100% + 16px))';
            notification.addEventListener('transitionend', () => notification.remove());
        }, 3000);
    }

    // --- Authentication Logic ---

    function updateAuthUI() {
        const loginBtn = document.getElementById('loginBtn');
        const myPageBtn = document.getElementById('myPageBtn');
        
        if (currentUser) {
            loginBtn.textContent = 'ë¡œê·¸ì•„ì›ƒ';
            loginBtn.onclick = handleLogout;
            myPageBtn.classList.remove('hide');
        } else {
            loginBtn.textContent = 'ë¡œê·¸ì¸';
            loginBtn.onclick = toggleAuthModal;
            myPageBtn.classList.add('hide');
        }
    }

    function toggleAuthModal() {
        document.getElementById('authModal').classList.toggle('show');
    }

    function handleLogin() {
        // ì„ì‹œ ë¡œê·¸ì¸ ë¡œì§
        const email = document.getElementById('authEmail').value;
        if (email) {
            currentUser = { 
                id: 'user1', 
                name: email.split('@')[0], 
                email: email, 
                isAdmin: ADMIN_EDITORS.includes(email) 
            };
            closeModal(null, 'authModal');
            updateAuthUI();
            showNotification('ì„±ê³µ', `${currentUser.name}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`);
            // ë¡œê·¸ì¸ í›„ ë§ˆì´í˜ì´ì§€ë¡œ ì´ë™í•˜ê±°ë‚˜ í˜„ì¬ í˜ì´ì§€ ê°±ì‹ 
            navigateTo(currentPage);
        } else {
            showNotification('ì˜¤ë¥˜', 'ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        }
    }

    function handleSignup() {
        // ì„ì‹œ íšŒì›ê°€ì… ë¡œì§
        showNotification('ì•ˆë‚´', 'íšŒì›ê°€ì… ê¸°ëŠ¥ì€ í˜„ì¬ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
    }

    function handleLogout() {
        currentUser = null;
        updateAuthUI();
        showNotification('ì•Œë¦¼', 'ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
        navigateTo('home');
    }
    
    // --- Navigation and Page Rendering ---

    function navigateTo(page) {
        document.querySelectorAll('section').forEach(section => section.classList.add('hide'));
        
        const targetSection = document.getElementById(page + 'Page');
        if (targetSection) {
            targetSection.classList.remove('hide');
            currentPage = page;
            
            if (page === 'home') renderLatestPosts();
            if (page === 'qna') renderQnaList();
            if (page === 'editorTalk') renderPostList('editorTalk');
            if (page === 'moment') renderPostList('moment');
            if (page === 'newsletter') renderNewsletterList();
            if (page === 'myPage') renderMyPage();
        }
    }

    function renderLatestPosts() {
        const latestList = document.getElementById('latestPosts');
        latestList.innerHTML = '';
        
        // ìµœì‹  4ê°œ ê¸€ (Q&A ì œì™¸)
        const latest = posts
            .filter(p => p.type !== 'qna')
            .sort((a, b) => b.timestamp - a.timestamp)
            .slice(0, 4);

        if (latest.length === 0) {
            latestList.innerHTML = '<p class="text-gray-500 text-center mt-8">ì•„ì§ ë“±ë¡ëœ ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }

        latest.forEach(post => {
            latestList.insertAdjacentHTML('beforeend', renderPostItem(post));
        });
    }

    // ê²Œì‹œê¸€ ëª©ë¡ ë Œë”ë§ í•¨ìˆ˜ (EditorTalk, Momentìš©)
    function renderPostList(type) {
        const listElement = document.getElementById(type + 'List');
        listElement.innerHTML = '';
        
        const filteredPosts = posts
            .filter(p => p.type === type)
            .sort((a, b) => b.timestamp - a.timestamp);

        if (filteredPosts.length === 0) {
            listElement.innerHTML = '<p class="text-gray-500 text-center mt-8">ì•„ì§ ë“±ë¡ëœ ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }

        filteredPosts.forEach(post => {
            listElement.insertAdjacentHTML('beforeend', renderPostItem(post));
        });
    }

    // ğŸš¨ UPDATED FUNCTION: Q&A ê²Œì‹œê¸€ ëª©ë¡ ë Œë”ë§ (ì‘ì„±ì/ê¸€ì œëª© í¬ë§· ì ìš©)
    function renderQnaList() {
        const qnaListElement = document.getElementById('qnaList');
        qnaListElement.innerHTML = '';
        
        const qnaPosts = posts
            .filter(p => p.type === 'qna')
            .sort((a, b) => b.timestamp - a.timestamp);
        
        if (qnaPosts.length === 0) {
            qnaListElement.innerHTML = '<p class="text-gray-500 text-center mt-8">ì•„ì§ ë“±ë¡ëœ Q&Aê°€ ì—†ìŠµë‹ˆë‹¤. ì²« ì§ˆë¬¸ì„ ë‚¨ê²¨ë³´ì„¸ìš”!</p>';
            return;
        }

        qnaPosts.forEach(post => {
            const isAuthor = currentUser && currentUser.id === post.authorId;
            const isAdmin = currentUser && currentUser.isAdmin;
            let iconHtml = '';
            let titleHtml; 
            let clickAction = '';
            
            const newBadge = getNewBadgeHtml(post.timestamp); 

            if (post.isPrivate) {
                iconHtml = '<span class="text-sm mr-2 text-pastel-blue-500">ğŸ”’</span>';
                
                if (isAuthor || isAdmin) {
                    // ì‘ì„±ì ë˜ëŠ” ê´€ë¦¬ìëŠ” 'ì‘ì„±ì / ê¸€ì œëª©' í‘œì‹œ, í´ë¦­ ê°€ëŠ¥
                    const titleText = `${post.authorName} / ${post.title}`; 
                    titleHtml = `<span class="font-medium text-gray-800 hover:text-pastel-blue-500 cursor-pointer">${titleText}</span>${newBadge}`;
                    clickAction = `onclick="showPostDetail('${post.id}')"`;
                } else {
                    // ì¼ë°˜ ì‚¬ìš©ìëŠ” "ğŸ”’ ë¹„ë°€ê¸€ì…ë‹ˆë‹¤" í‘œì‹œ
                    titleHtml = `<span class="font-medium text-gray-500">ğŸ”’ ë¹„ë°€ê¸€ì…ë‹ˆë‹¤</span>`;
                    clickAction = ``; 
                }
            } else {
                // ì¼ë°˜ê¸€ì€ 'ì‘ì„±ì / ê¸€ì œëª©' í‘œì‹œ, ëª¨ë‘ì—ê²Œ ê³µê°œ
                const titleText = `${post.authorName} / ${post.title}`; 
                titleHtml = `<span class="font-medium text-gray-800 hover:text-pastel-blue-500 cursor-pointer">${titleText}</span>${newBadge}`;
                clickAction = `onclick="showPostDetail('${post.id}')"`;
            }

            const itemHtml = `
                <div class="p-4 bg-white rounded-xl shadow-sm border border-gray-100 ${clickAction}">
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center">
                            ${iconHtml}
                            ${titleHtml}
                        </div>
                        <span class="text-xs text-gray-400">${new Date(post.timestamp).toLocaleDateString('ko-KR')}</span>
                    </div>
                    <div class="text-sm text-gray-500 flex justify-end">
                        <span>ëŒ“ê¸€ ${comments.filter(c => c.postId === post.id).length || 0}</span>
                    </div>
                </div>
            `;
            qnaListElement.insertAdjacentHTML('beforeend', itemHtml);
        });
    }

    // ëª©ë¡ ë·°ì—ì„œ ê²Œì‹œê¸€ ì•„ì´í…œ ë Œë”ë§
    function renderPostItem(post) {
        const commentCount = comments.filter(c => c.postId === post.id).length;
        const newBadge = getNewBadgeHtml(post.timestamp);
        const icon = post.type === 'letter' ? 'ğŸ“–' : post.type === 'editorTalk' ? 'ğŸ’¬' : 'âœ¨';
        
        return `
            <div onclick="showPostDetail('${post.id}')" class="p-4 bg-white rounded-xl shadow-sm border border-gray-100 cursor-pointer hover:bg-gray-50">
                <div class="flex justify-between items-center">
                    <h3 class="text-lg font-bold text-gray-800 flex items-center">
                        ${icon} ${post.title} ${newBadge}
                    </h3>
                    <span class="text-xs text-gray-400">${post.authorName} | ${new Date(post.timestamp).toLocaleDateString('ko-KR')}</span>
                </div>
                <p class="text-sm text-gray-600 mt-1 flex justify-between">
                    <span>${post.content.substring(0, 50)}...</span>
                    <span class="text-xs text-gray-500 ml-4">ëŒ“ê¸€ ${commentCount}</span>
                </p>
            </div>
        `;
    }
    
    // ğŸš¨ NEW FUNCTION: ë ˆí„° ëª©ë¡ ë Œë”ë§
    function renderNewsletterList(list = newsletters) {
        const listElement = document.getElementById('newsletterList');
        listElement.innerHTML = '';
        
        if (list.length === 0) {
            listElement.innerHTML = `<p class="text-center text-gray-500 mt-8">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
            return;
        }
        
        list.forEach(letter => {
            const newBadge = getNewBadgeHtml(letter.timestamp);
            
            const itemHtml = `
                <div onclick="showPostDetail('${letter.id}')" class="p-4 bg-white rounded-xl shadow-sm border border-gray-100 cursor-pointer hover:bg-gray-50">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-bold text-gray-800 flex items-center">
                            ${letter.title} ${newBadge}
                        </h3>
                        <span class="text-xs text-gray-500">${letter.authorName}</span>
                    </div>
                    <p class="text-sm text-gray-600 mt-1">${letter.content.substring(0, 50) + '...'}</p>
                </div>
            `;
            listElement.insertAdjacentHTML('beforeend', itemHtml);
        });
    }

    // ğŸš¨ NEW FUNCTION: ë ˆí„° ëª©ë¡ í•„í„°ë§/ê²€ìƒ‰
    function filterNewsletters() {
        const searchTerm = document.getElementById('newsletterSearch').value.toLowerCase();
        const filterEditor = document.getElementById('newsletterFilter').value;
        
        let filteredList = newsletters.filter(letter => {
            const titleMatch = letter.title.toLowerCase().includes(searchTerm);
            const contentMatch = letter.content.toLowerCase().includes(searchTerm); 
            const editorMatch = filterEditor === 'all' || letter.authorName === filterEditor;
            
            return (titleMatch || contentMatch) && editorMatch;
        });
        
        renderNewsletterList(filteredList);
    }

    // ğŸš¨ NEW FUNCTION: ë ˆí„° í•„í„° ì˜µì…˜ ì´ˆê¸°í™”
    function initializeNewsletterFilters() {
        const filterSelect = document.getElementById('newsletterFilter');
        const editors = [...new Set(newsletters.map(n => n.authorName))];
        
        filterSelect.innerHTML = '<option value="all">ì „ì²´ ì—ë””í„°</option>';
        editors.forEach(editor => {
            filterSelect.innerHTML += `<option value="${editor}">${editor}</option>`;
        });
    }

    // --- Post Detail and Interaction (Like, Bookmark, Stamp) ---
    
    // ğŸš¨ UPDATED FUNCTION: showPostDetail (ì„¸ ê°œì˜ ë²„íŠ¼ ë Œë”ë§ í¬í•¨)
    function showPostDetail(postId) {
        currentPostId = postId;
        const post = posts.find(p => p.id === postId);
        
        if (!post) {
            showNotification('ì˜¤ë¥˜', 'ê²Œì‹œê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }
        
        const isAuthor = currentUser && currentUser.id === post.authorId;
        const isAdmin = currentUser && currentUser.isAdmin;

        if (post.isPrivate && !(isAuthor || isAdmin)) {
             showNotification('ì ‘ê·¼ ë¶ˆê°€', 'ë¹„ë°€ê¸€ì€ ì‘ì„±ì ë˜ëŠ” ê´€ë¦¬ìë§Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
             return;
        }

        // ëª¨ë‹¬ í—¤ë”ì˜ ë²„íŠ¼ IDë¥¼ í˜„ì¬ postIdë¡œ ì—…ë°ì´íŠ¸
        ['likeBtn', 'bookmarkBtn', 'stampBtn'].forEach(prefix => {
            const btn = document.getElementById(`${prefix}-POSTID`);
            if (btn) btn.id = `${prefix}-${postId}`;
        });
        
        // ë²„íŠ¼ UI ì—…ë°ì´íŠ¸ í˜¸ì¶œ
        updateLikeButton(postId); 
        updateBookmarkButton(postId, post.type);
        updateStampButton(postId, post.type); 

        // ë³¸ë¬¸ ë‚´ìš© ì—…ë°ì´íŠ¸
        document.getElementById('postDetailTitle').textContent = post.title;
        document.getElementById('postDetailAuthor').textContent = post.authorName;
        document.getElementById('postDetailDate').textContent = new Date(post.timestamp).toLocaleDateString('ko-KR');
        document.getElementById('postDetailContent').innerHTML = post.content.replace(/\n/g, '<br>');


        // ëŒ“ê¸€ í¼ ë Œë”ë§
        const commentFormContainer = document.getElementById('commentFormContainer');
        if (commentFormContainer) {
            commentFormContainer.innerHTML = renderCommentForm(post.type); 
        }
        
        // ëŒ“ê¸€ ëª©ë¡ ë Œë”ë§
        const postComments = comments.filter(c => c.postId === postId);
        const commentsContainer = document.getElementById('postDetailComments');
        if (commentsContainer) {
            commentsContainer.innerHTML = postComments.map(c => renderComment(c, post.type)).join('');
        }
        
        document.getElementById('postDetailModal').classList.add('show');
    }
    
    // ğŸš¨ UPDATED FUNCTION: ì¢‹ì•„ìš” í† ê¸€
    function toggleLike(postId) {
        if (!currentUser) return showNotification('ì•ˆë‚´', 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        
        const isLiked = likedItems[postId]?.isLiked || false;
        
        if (isLiked) {
            if (likedItems[postId]) delete likedItems[postId].isLiked;
            showNotification('ì•Œë¦¼', 'ì¢‹ì•„ìš”ê°€ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        } else {
            if (!likedItems[postId]) likedItems[postId] = {};
            likedItems[postId].isLiked = true;
            showNotification('ì•Œë¦¼', 'ê¸€ì— ì¢‹ì•„ìš”ë¥¼ ëˆŒë €ìŠµë‹ˆë‹¤!');
        }
        updateLikeButton(postId); 
    }

    // ğŸš¨ NEW FUNCTION: ë¶ë§ˆí¬ í† ê¸€
    function toggleBookmark(postId) {
        if (!currentUser) return showNotification('ì•ˆë‚´', 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        
        const isBookmarked = likedItems[postId]?.isBookmarked || false;
        
        if (isBookmarked) {
            if (likedItems[postId]) delete likedItems[postId].isBookmarked;
            showNotification('ì•Œë¦¼', 'ìŠ¤í¬ë©ì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        } else {
            if (!likedItems[postId]) likedItems[postId] = {};
            likedItems[postId].isBookmarked = true;
            showNotification('ì•Œë¦¼', 'ê¸€ì´ ìŠ¤í¬ë©ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
        updateBookmarkButton(postId, posts.find(p => p.id === postId)?.type); 
    }
    
    // ğŸš¨ NEW FUNCTION: ìíœ´ ìŠ¤íƒ¬í”„ í† ê¸€
    function toggleStamp(postId) {
        if (!currentUser) return showNotification('ì•ˆë‚´', 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        
        const post = posts.find(p => p.id === postId);
        if (!post || (post.type !== 'letter' && post.type !== 'moment')) {
            return showNotification('ì˜¤ë¥˜', 'ìŠ¤íƒ¬í”„ëŠ” ë ˆí„°ì™€ ëª¨ë¨¼íŠ¸ ê²Œì‹œë¬¼ì—ì„œë§Œ íšë“í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        }
        
        const isStamped = likedItems[postId]?.isStamped || false;
        
        if (isStamped) {
            return showNotification('ì•ˆë‚´', 'ì´ë¯¸ íšë“í•œ ì˜¤ëŠ˜ì˜ ìíœ´ ìŠ¤íƒ¬í”„ì…ë‹ˆë‹¤.');
        } else {
            // ìŠ¤íƒ¬í”„ íšë“ ë¡œì§
            if (!likedItems[postId]) likedItems[postId] = {};
            likedItems[postId].isStamped = true;
            
            // íŒì—… ë„ìš°ê¸°
            showStampSuccessPopup(); 
        }
        updateStampButton(postId, post.type);
        // ë§ˆì´í˜ì´ì§€ ìŠ¤íƒ¬í”„ ëª©ë¡ ê°±ì‹ ì„ ìœ„í•´ navigateTo('myPage') í˜¸ì¶œ ê°€ëŠ¥
    }

    // ğŸš¨ NEW FUNCTION: ì¢‹ì•„ìš” ë²„íŠ¼ UI ì—…ë°ì´íŠ¸ (ë¹¨ê°„ í•˜íŠ¸ ì ìš©)
    function updateLikeButton(postId) {
        const likeBtn = document.getElementById(`likeBtn-${postId}`);
        if (!likeBtn) return;
        
        const isLiked = likedItems[postId]?.isLiked || false;

        if (isLiked) {
            // ì±„ì›Œì§„ ë¹¨ê°„ í•˜íŠ¸
            likeBtn.innerHTML = `<svg class="w-6 h-6 text-red-500 fill-current" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>`;
        } else {
            // ë¹„ì–´ìˆëŠ” í•˜íŠ¸
            likeBtn.innerHTML = `<svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-.318-.318a4.5 4.5 0 00-6.364 0z"/></svg>`;
        }
    }

    // ğŸš¨ NEW FUNCTION: ë¶ë§ˆí¬ ë²„íŠ¼ UI ì—…ë°ì´íŠ¸
    function updateBookmarkButton(postId, postType) {
        const bookmarkBtn = document.getElementById(`bookmarkBtn-${postId}`);
        if (!bookmarkBtn) return;
        
        // Q&AëŠ” ë¶ë§ˆí¬ ë²„íŠ¼ì„ ìˆ¨ê¹€
        if (postType === 'qna') {
            bookmarkBtn.classList.add('hide');
            return;
        }
        
        const isBookmarked = likedItems[postId]?.isBookmarked || false;

        if (isBookmarked) {
            // Luxury Gold ìƒ‰ìƒ
            bookmarkBtn.innerHTML = `<svg class="w-6 h-6 text-luxury-gold-500 fill-current" viewBox="0 0 24 24"><path d="M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2z"/></svg>`;
            bookmarkBtn.setAttribute('title', 'ìŠ¤í¬ë© í•´ì œ');
        } else {
            // ë¹„ì–´ìˆëŠ” ë¶ë§ˆí¬
            bookmarkBtn.innerHTML = `<svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5v14l7-3 7 3V5a2 2 0 00-2-2H7a2 2 0 00-2 2z"/></svg>`;
            bookmarkBtn.setAttribute('title', 'ìŠ¤í¬ë©');
        }
        bookmarkBtn.classList.remove('hide');
    }
    
    // ğŸš¨ NEW FUNCTION: ìíœ´ ìŠ¤íƒ¬í”„ ë²„íŠ¼ UI ì—…ë°ì´íŠ¸ (ë ˆí„°/ëª¨ë¨¼íŠ¸ì—ë§Œ ë³´ì„)
    function updateStampButton(postId, postType) {
        const stampBtn = document.getElementById(`stampBtn-${postId}`);
        if (!stampBtn) return;
        
        // Q&A, ì—ë””í„°í†¡ì€ ë²„íŠ¼ ìˆ¨ê¹€
        if (postType !== 'letter' && postType !== 'moment') {
            stampBtn.classList.add('hide');
            return;
        }
        
        stampBtn.classList.remove('hide');
        const isStamped = likedItems[postId]?.isStamped || false;

        if (isStamped) {
            // ì±„ì›Œì§„ ìŠ¤íƒ¬í”„ (Luxury Gold ìƒ‰ìƒ)
            stampBtn.innerHTML = `<svg class="w-7 h-7 text-luxury-gold-500 fill-current" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>`; 
            stampBtn.setAttribute('title', 'ìŠ¤íƒ¬í”„ íšë“ ì™„ë£Œ');
        } else {
            // ë¹„ì–´ìˆëŠ” ìŠ¤íƒ¬í”„ (í…Œë‘ë¦¬ë§Œ ìˆëŠ” ì˜ˆìœ ë””ìì¸)
            stampBtn.innerHTML = `<svg class="w-7 h-7 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 22s-8-4-8-10c0-4.42 3.58-8 8-8s8 3.58 8 8c0 6-8 10-8 10zM12 16l-3 1 3-3 3 3-3-1zM12 6v10"/></svg>`;
            stampBtn.setAttribute('title', 'ìŠ¤íƒ¬í”„ íšë“í•˜ê¸°');
        }
    }
    
    // ğŸš¨ NEW FUNCTION: ìíœ´ ìŠ¤íƒ¬í”„ íšë“ íŒì—…
    function showStampSuccessPopup() {
        const popupHtml = `
            <div id="stampSuccessModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                <div class="bg-white p-8 rounded-2xl shadow-2xl max-w-sm w-full transform transition-all scale-100 ease-out border-4 border-pastel-blue-300 relative">
                    <button onclick="document.getElementById('stampSuccessModal').remove()" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                    <div class="text-center">
                        <svg class="w-20 h-20 text-pastel-blue-500 fill-current mx-auto mb-4" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                        <h4 class="text-2xl font-bold text-pastel-blue-700 mb-2">ì˜¤ëŠ˜ì˜ ìíœ´ ì„±ê³µ!</h4>
                        <p class="text-gray-600">ìƒˆë¡œìš´ ìŠ¤íƒ¬í”„ë¥¼ ë§ˆì´í˜ì´ì§€ì—ì„œ í™•ì¸í•´ë³´ì„¸ìš”.</p>
                    </div>
                </div>
            </div>
        `;
        document.body.insertAdjacentHTML('beforeend', popupHtml);
    }
    
    // --- Comment Logic ---
    
    // ğŸš¨ UPDATED FUNCTION: ëŒ“ê¸€ ë Œë”ë§ ë¡œì§ (ê´€ë¦¬ì ì´ë¦„ 'ê´€ë¦¬ì'ë¡œ í†µì¼)
    function renderComment(comment, postType) {
        const isEditorReply = ADMIN_EDITORS.includes(comment.authorEmail);
        
        let avatarClass = 'bg-gray-200 text-gray-600';
        let nameClass = 'font-medium text-gray-700';
        let contentClass = 'text-gray-700';
        let name = comment.authorName;
        let containerClass = '';

        // Q&Aì´ê³  ê´€ë¦¬ì ë‹µë³€ì¼ ê²½ìš°
        if (postType === 'qna' && isEditorReply) { 
            avatarClass = 'bg-pastel-blue-200 text-pastel-blue-700';
            nameClass = 'font-bold text-pastel-blue-700';
            name = `ê´€ë¦¬ì`; // ğŸš¨ ì´ë¦„ 'ê´€ë¦¬ì'ë¡œ ê³ ì •
            contentClass = 'text-gray-800';
            containerClass = 'admin-reply'; 
        }

        const commentHtml = `
            <div class="flex space-x-3 mb-4">
                <div class="w-8 h-8 rounded-full ${avatarClass} flex items-center justify-center text-xs flex-shrink-0">${name.charAt(0)}</div> 
                <div class="flex-1 ${containerClass}">
                    <div class="flex items-center justify-between mb-1">
                        <span class="${nameClass} text-sm">${name}</span>
                        <span class="text-xs text-gray-400">${new Date(comment.timestamp).toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' })}</span>
                    </div>
                    <div class="${contentClass}">
                        ${comment.content}
                    </div>
                </div>
            </div>
        `;
        return commentHtml;
    }

    // ğŸš¨ UPDATED FUNCTION: Q&A ëŒ“ê¸€ ì…ë ¥ í¼ ë Œë”ë§ (ê¶Œí•œ ì œì–´)
    function renderCommentForm(postType) {
        if (!currentUser) {
            return `<p class="text-center text-gray-500 py-4">ë¡œê·¸ì¸ í›„ ëŒ“ê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>`;
        }
        
        // Q&AëŠ” ê´€ë¦¬ì(ì—ë””í„°)ë§Œ ë‹µë³€ ê°€ëŠ¥
        if (postType === 'qna' && !currentUser.isAdmin) {
            return `<p class="text-center text-pastel-blue-500 py-4 font-medium">ê´€ë¦¬ì(ì—ë””í„°)ë§Œì´ Q&Aì— ë‹µë³€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>`;
        }
        
        return `
            <div class="flex space-x-3 p-4 border-t border-gray-100">
                <input type="text" id="commentContent" placeholder="${postType === 'qna' ? 'ê´€ë¦¬ì ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”.' : 'ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”.'}" 
                       class="flex-1 px-4 py-2 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pastel-blue-400">
                <button onclick="submitComment('${postType}')" class="bg-pastel-blue-500 text-white px-4 py-2 rounded-xl font-medium btn-scale transition-transform">ë“±ë¡</button>
            </div>
        `;
    }

    function submitComment(postType) {
        const content = document.getElementById('commentContent').value.trim();
        if (!content || !currentPostId || !currentUser) {
            showNotification('ì˜¤ë¥˜', 'ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•˜ê±°ë‚˜ ë¡œê·¸ì¸ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
            return;
        }

        const newComment = {
            id: 'c' + Date.now(),
            postId: currentPostId,
            authorName: postType === 'qna' && currentUser.isAdmin ? 'ê´€ë¦¬ì' : currentUser.name,
            authorEmail: currentUser.email,
            content: content,
            timestamp: Date.now()
        };
        
        comments.push(newComment);
        document.getElementById('commentContent').value = '';
        
        // ëŒ“ê¸€ ëª©ë¡ ê°±ì‹ 
        const postComments = comments.filter(c => c.postId === currentPostId);
        document.getElementById('postDetailComments').innerHTML = postComments.map(c => renderComment(c, postType)).join('');

        showNotification('ì„±ê³µ', 'ëŒ“ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
        // Q&A ëª©ë¡ ê°±ì‹  (ëŒ“ê¸€ ìˆ˜ ë°˜ì˜ì„ ìœ„í•´)
        if (postType === 'qna') renderQnaList();
    }
    
    // --- Post Write Logic (Q&A) ---
    
    function showPostWriteModal(type) {
        if (!currentUser) {
            return showNotification('ì•ˆë‚´', 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        }
        
        document.getElementById('writeModalTitle').textContent = type === 'qna' ? 'â“ Q&A ì‘ì„±' : 'ìƒˆ ê¸€ ì‘ì„±';
        document.getElementById('postTitle').value = '';
        document.getElementById('postContent').value = '';
        
        const qnaOptions = document.getElementById('qnaOptions');
        qnaOptions.classList.toggle('hide', type !== 'qna');
        document.getElementById('isPrivate').checked = false;
        
        document.getElementById('postWriteModal').setAttribute('data-post-type', type);
        document.getElementById('postWriteModal').classList.add('show');
    }

    function submitPost() {
        const type = document.getElementById('postWriteModal').getAttribute('data-post-type');
        const title = document.getElementById('postTitle').value.trim();
        const content = document.getElementById('postContent').value.trim();
        const isPrivate = type === 'qna' ? document.getElementById('isPrivate').checked : false;

        if (!title || !content) {
            showNotification('ì˜¤ë¥˜', 'ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        const newPost = {
            id: type.charAt(0) + Date.now(),
            title: title,
            content: content,
            authorId: currentUser.id,
            authorName: currentUser.name,
            authorEmail: currentUser.email,
            type: type,
            timestamp: Date.now(),
            commentCount: 0,
            isPrivate: isPrivate
        };

        posts.unshift(newPost);
        closeModal(null, 'postWriteModal');
        showNotification('ì„±ê³µ', 'ê²Œì‹œê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
        
        if (type === 'qna') renderQnaList();
    }

    // --- MyPage Logic ---

    function renderMyPage() {
        if (!currentUser) {
            document.getElementById('myPage').innerHTML = '<p class="text-center text-gray-500 py-12">ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>';
            return;
        }
        
        const myPageHtml = `
            <h2 class="text-3xl font-extrabold text-pastel-blue-600 mb-6 border-b-4 border-pastel-blue-500 pb-2">ë‚˜ì˜ ìíœ´ ê³µê°„</h2>
            <div class="bg-white p-6 rounded-xl shadow-md mb-8 flex items-center space-x-4">
                <div class="w-12 h-12 rounded-full bg-pastel-blue-100 text-pastel-blue-600 flex items-center justify-center text-xl font-bold">${currentUser.name.charAt(0)}</div>
                <div>
                    <p class="text-lg font-bold text-gray-800">${currentUser.name}ë‹˜</p>
                    <p class="text-sm text-gray-500">${currentUser.email}</p>
                </div>
            </div>
            
            <div class="mt-8 border-b border-gray-200">
                <nav class="flex space-x-4" id="myPageTabs">
                    <button class="tab-btn active" data-tab="likes" onclick="loadMyPageContent('likes')">â¤ï¸ ì¢‹ì•„ìš”í•œ ê¸€</button>
                    <button class="tab-btn" data-tab="bookmarks" onclick="loadMyPageContent('bookmarks')">ğŸ”– ë¶ë§ˆí¬í•œ ê¸€</button> 
                    <button class="tab-btn" data-tab="stamps" onclick="loadMyPageContent('stamps')">â­ï¸ ìíœ´ ìŠ¤íƒ¬í”„</button> 
                </nav>
            </div>
            <div id="myPageContent" class="py-6 space-y-4">
                </div>
        `;
        
        document.getElementById('myPage').innerHTML = myPageHtml;
        loadMyPageContent('likes'); // ì´ˆê¸° íƒ­ ë¡œë“œ
    }

    function loadMyPageContent(tab) {
        // íƒ­ ë²„íŠ¼ í™œì„±í™”
        document.querySelectorAll('#myPageTabs .tab-btn').forEach(btn => {
            btn.classList.toggle('active', btn.getAttribute('data-tab') === tab);
        });
        
        const contentElement = document.getElementById('myPageContent');
        contentElement.innerHTML = '';
        
        let filteredPosts = [];
        let title = '';

        if (tab === 'likes') {
            filteredPosts = posts.filter(p => likedItems[p.id]?.isLiked);
            title = 'ì¢‹ì•„ìš”í•œ ê¸€';
            renderPostListContent(contentElement, filteredPosts, title);
        } else if (tab === 'bookmarks') {
            filteredPosts = posts.filter(p => likedItems[p.id]?.isBookmarked);
            title = 'ë¶ë§ˆí¬í•œ ê¸€';
            renderPostListContent(contentElement, filteredPosts, title);
        } else if (tab === 'stamps') {
            // ğŸš¨ UPDATED: ìíœ´ ìŠ¤íƒ¬í”„ ëª©ë¡ ë¡±ë¸”ë™ ìŠ¤íƒ€ì¼ ë Œë”ë§
            
            // ìŠ¤íƒ¬í”„ íšë“ ê°€ëŠ¥í•œ ëª¨ë“  ê¸€ (ë ˆí„° + ëª¨ë¨¼íŠ¸)
            const allStampablePosts = posts.filter(p => p.type === 'letter' || p.type === 'moment');
            
            if (allStampablePosts.length === 0) {
                 contentElement.innerHTML = `<p class="text-center text-gray-500 mt-8">ìŠ¤íƒ¬í”„ë¥¼ íšë“í•  ìˆ˜ ìˆëŠ” ê²Œì‹œë¬¼ì´ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.</p>`;
                return;
            }

            // ëª¨ë“  ìŠ¤íƒ¬í”„ í•­ëª©ì„ ë Œë”ë§
            const stampGridHtml = allStampablePosts.map(post => {
                const isStamped = likedItems[post.id]?.isStamped || false;
                const iconClass = isStamped ? 'stamped-icon' : 'sketch-stamp';
                const clickAction = isStamped ? `showPostDetail('${post.id}')` : `toggleStamp('${post.id}')`;
                const stampText = isStamped ? 'íšë“ ì™„ë£Œ' : 'ë¯¸íšë“';

                return `
                    <div class="p-4 bg-white rounded-xl shadow-sm border border-gray-100 text-center flex flex-col items-center justify-center cursor-pointer hover:shadow-lg transition-shadow" onclick="${clickAction}">
                        <div class="w-16 h-16 mb-2 stamp-container">
                            <svg class="w-full h-full ${iconClass}" viewBox="0 0 24 24">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                            </svg>
                        </div>
                        <p class="text-sm font-medium ${isStamped ? 'text-pastel-blue-600 font-bold' : 'text-gray-500'} mt-1">${post.title.substring(0, 15)}...</p>
                        <span class="text-xs ${isStamped ? 'text-pastel-blue-400' : 'text-gray-400'}">${stampText}</span>
                    </div>
                `;
            }).join('');
            
            const acquiredCount = allStampablePosts.filter(p => likedItems[p.id]?.isStamped).length;

            contentElement.innerHTML = `
                <h3 class="text-xl font-bold text-pastel-blue-600 mb-4">â­ï¸ ìíœ´ ìŠ¤íƒ¬í”„ (${acquiredCount} / ${allStampablePosts.length}ê°œ íšë“)</h3>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                    ${stampGridHtml}
                </div>
            `;
        }
    }

    function renderPostListContent(contentElement, list, title) {
        if (list.length === 0) {
            contentElement.innerHTML = `<p class="text-center text-gray-500 mt-8">ì•„ì§ ${title} ëª©ë¡ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</p>`;
            return;
        }

        const listHtml = list.map(post => `
            <div onclick="showPostDetail('${post.id}')" class="p-4 bg-white rounded-xl shadow-sm border border-gray-100 cursor-pointer hover:bg-gray-50">
                <h4 class="text-lg font-bold text-gray-800">${post.title}</h4>
                <p class="text-sm text-gray-500 mt-1">${post.authorName} | ${new Date(post.timestamp).toLocaleDateString('ko-KR')}</p>
            </div>
        `).join('');

        contentElement.innerHTML = `
            <h3 class="text-xl font-bold text-pastel-blue-600 mb-4">${title} (${list.length}ê°œ)</h3>
            ${listHtml}
        `;
    }


    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', loadData);
</script>

</body>
</html>
