<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jahyu Letter</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;600;700&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <style>
        :root {
            /* ğŸ¨ ê°€ì‹œì„± ë†’ì€ ì»¬ëŸ¬ íŒ”ë ˆíŠ¸ */
            --primary: #8E70B3; 
            --primary-dark: #6A4C93;
            --primary-light: #F3E5F5;
            --bg-body: #FFFEF5;
            --white: #ffffff;
            --text-main: #333333;
            --text-sub: #666666;
            --border: #DDDDDD; 
            --shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Pretendard', sans-serif; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { background: var(--bg-body); color: var(--text-main); min-height: 100vh; display: flex; flex-direction: column; align-items: center; overflow-x: hidden; }
        
        .app-container { width: 100%; max-width: 480px; min-height: 100vh; background: var(--bg-body); padding-bottom: 90px; padding-top: 70px; position: relative; }
        .clickable { cursor: pointer; transition: transform 0.1s, opacity 0.1s; }
        .clickable:active { transform: scale(0.97); opacity: 0.8; }

        /* í—¤ë” */
        .header { position: fixed; top: 0; width: 100%; max-width: 480px; height: 60px; background: rgba(255,255,255,0.95); backdrop-filter: blur(5px); display: flex; align-items: center; justify-content: center; z-index: 100; border-bottom: 1px solid var(--border); }
        .logo { font-family: 'Dancing Script', cursive; font-size: 26px; color: var(--primary); font-weight: 700; }

        /* ë²¤í†  ê·¸ë¦¬ë“œ */
        .bento-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 20px; }
        .bento-item { background: var(--white); border-radius: 16px; padding: 20px; box-shadow: var(--shadow); border: 1px solid #EAEAEA; display: flex; flex-direction: column; justify-content: space-between; min-height: 110px; }
        .bento-full { grid-column: span 2; background: linear-gradient(135deg, #B39CD0 0%, #9FA8DA 100%); color: white; border: none; }
        .bento-title { font-size: 16px; font-weight: 700; margin-bottom: 5px; color: var(--text-main); }
        .bento-full .bento-title { color: white; }
        .bento-desc { font-size: 12px; color: var(--text-sub); line-height: 1.4; }
        .bento-full .bento-desc { color: rgba(255,255,255,0.9); }
        .bento-icon { font-size: 28px; align-self: flex-end; margin-top: 10px; }

        /* ì¹´ë“œ & ë¦¬ìŠ¤íŠ¸ */
        .card { background: var(--white); border-radius: 16px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid #EAEAEA; margin-bottom: 15px; }
        .section-header { font-size: 18px; font-weight: 700; margin-bottom: 15px; padding: 0 20px; color: #444; }

        /* ë¬´ë“œ ìº˜ë¦°ë” */
        .cal-container { background: var(--white); border-radius: 20px; padding: 20px; border: 1px solid var(--border); box-shadow: var(--shadow); }
        .cal-header { display: flex; justify-content: space-between; font-weight: 700; margin-bottom: 15px; color: #555; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; }
        .day-cell { aspect-ratio: 1/1; border-radius: 8px; background: #f5f5f5; display: flex; align-items: center; justify-content: center; font-size: 11px; color: #ccc; position: relative; }
        .day-cell.today { border: 2px solid var(--primary); background: #fff; color: var(--primary); font-weight: 700; }
        .day-emoji { font-size: 20px; position: absolute; }

        /* ì—ë””í„° ì•„ì´ì½˜ */
        .editor-circle { width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 28px; border: 2px solid #fff; box-shadow: 0 3px 6px rgba(0,0,0,0.1); margin: 0 auto 5px; }
        .editor-name { font-size: 12px; font-weight: 600; text-align: center; color: #555; }
        .editor-scroll { display: flex; gap: 15px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; }

        /* ë²„íŠ¼ */
        .btn-main { width: 100%; padding: 14px; border-radius: 12px; border: none; font-weight: 700; font-size: 15px; margin-top: 10px; cursor: pointer; background: var(--primary); color: white; box-shadow: 0 4px 10px rgba(142, 112, 179, 0.3); }
        .btn-sub { background: #F5F5F5; color: #666; width: 100%; padding: 12px; border-radius: 12px; border: none; font-weight: 600; margin-top: 5px; }
        .rate-group { display: flex; gap: 5px; margin: 15px 0; }
        .rate-btn { flex: 1; padding: 10px; border: 1px solid var(--border); border-radius: 10px; background: white; font-size: 12px; color: #666; }
        .empathy-bar { display: flex; gap: 10px; margin-top: 15px; padding-top: 15px; border-top: 1px solid #f5f5f5; }
        .empathy-btn { flex: 1; padding: 8px; border-radius: 20px; background: #f9f9f9; border: none; font-size: 12px; color: #666; display: flex; align-items: center; justify-content: center; gap: 5px; }

        /* íŒì—… */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; display: none; justify-content: center; align-items: center; backdrop-filter: blur(3px); }
        .popup-box { background: white; width: 85%; max-width: 360px; padding: 30px; border-radius: 20px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2); position: relative; }

        /* ìŠ¤íƒ¬í”„ ë³´ë“œ */
        .stamp-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin: 20px 0; }
        .stamp-slot { aspect-ratio: 1/1; background: #F0F0F0; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #bbb; position: relative; }
        .stamp-slot.active { background: var(--primary); color: white; box-shadow: 0 2px 5px rgba(142, 112, 179, 0.4); font-weight: 700; }
        .gift-box { position: absolute; right: -2px; bottom: -2px; background: white; border-radius: 50%; padding: 3px; font-size: 14px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

        /* VIP ì¹´ë“œ ìƒì„±ìš© (ìˆ¨ê¹€ ì²˜ë¦¬) */
        #vipCardArea { 
            width: 300px; height: 450px; background: linear-gradient(135deg, #FFF0F5, #E6E6FA); 
            position: fixed; top: -9999px; left: -9999px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border-radius: 20px; padding: 20px; text-align: center; box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .vip-title { font-family:'Dancing Script'; font-size: 30px; color: var(--primary); margin-bottom: 20px; }
        .vip-name { font-size: 24px; font-weight: 800; color: #333; margin-bottom: 10px; }
        .vip-desc { font-size: 14px; color: #666; line-height: 1.6; }

        .shredder-box { transition: 1s; }
        .shredder-act { transform: translateY(100px) scale(0, 0); opacity: 0; }

        .hidden { display: none !important; }
        .fab { position: fixed; bottom: 100px; right: 20px; width: 55px; height: 55px; background: #333; border-radius: 50%; color: white; display: none; align-items: center; justify-content: center; font-size: 22px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 900; }
        .fab.show { display: flex; }
    </style>
</head>
<body>

    <!-- ì•Œë¦¼ íŒì—… -->
    <div id="customAlert" class="modal-overlay" style="z-index: 3000;">
        <div class="popup-box">
            <div style="font-size:40px; margin-bottom:15px;">ğŸŒ¿</div>
            <div id="alertMsg" style="margin-bottom:20px; font-weight:600; color:#333; line-height:1.5; word-break:keep-all;">ì•Œë¦¼ ë‚´ìš©</div>
            <button onclick="window.closeAlert()" class="btn-main">í™•ì¸</button>
        </div>
    </div>

    <!-- VIP ì¹´ë“œ ìƒì„± ì˜ì—­ (ìˆ¨ê¹€) -->
    <div id="vipCardArea">
        <div class="vip-title">Jahyu VIP</div>
        <div style="font-size:50px; margin-bottom:20px;">ğŸ‘‘</div>
        <div class="vip-name" id="vipNameTarget">User Name</div>
        <div class="vip-desc">ìœ„ ì‚¬ëŒì€ ì˜¨ì „í•œ íœ´ì‹ì„ ì¦ê¸¸ ì¤„ ì•„ëŠ”<br>ìíœ´ë ˆí„°ì˜ ì†Œì¤‘í•œ VIPì„ì„ ì¸ì¦í•©ë‹ˆë‹¤.</div>
        <div style="margin-top:30px; font-size:12px; color:#aaa;">Jahyu Letter Official</div>
    </div>

    <!-- í—¤ë” -->
    <header class="header">
        <div class="logo">Jahyu Letter</div>
    </header>

    <div id="appContainer" class="app-container"></div>

    <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="bottom-nav">
        <div class="nav-item clickable" onclick="window.renderTab('home')"><i class="fas fa-home"></i>í™ˆ</div>
        <div class="nav-item clickable" onclick="window.renderTab('letter')"><i class="fas fa-envelope-open-text"></i>ë ˆí„°</div>
        <div class="nav-item clickable" onclick="window.renderTab('mood')"><i class="fas fa-calendar-check"></i>ë¬´ë“œ</div>
        <div class="nav-item clickable" onclick="window.renderTab('editor')"><i class="fas fa-comment-dots"></i>ì—ë””í„°</div>
        <div class="nav-item clickable" onclick="window.renderTab('mypage')"><i class="fas fa-user"></i>ë§ˆì´</div>
    </nav>

    <div id="fab" class="fab clickable" onclick="window.openWriteModal()"><i class="fas fa-pen"></i></div>

    <!-- ğŸ”‘ ë¡œê·¸ì¸ ëª¨ë‹¬ (ìˆ˜ì •ë¨) -->
    <div id="authModal" class="modal-overlay" style="display:flex;">
        <div class="popup-box">
            <h2 style="font-family:'Dancing Script'; color:var(--primary); margin-bottom:10px; font-size:32px;">Jahyu</h2>
            <p style="color:#666; margin-bottom:25px; font-size:14px;">ë©”ë§ˆë¥¸ ì¼ìƒ ì† íœ´ì‹ í•œ ë°©ìš¸ ğŸ’§</p>
            <input type="email" id="authEmail" style="width:100%; padding:15px; border:1px solid #ddd; border-radius:10px; margin-bottom:10px;" placeholder="ì´ë©”ì¼">
            <input type="password" id="authPw" style="width:100%; padding:15px; border:1px solid #ddd; border-radius:10px; margin-bottom:10px;" placeholder="ë¹„ë°€ë²ˆí˜¸ (6ìë¦¬ ì´ìƒ)">
            <div id="signupFields" class="hidden">
                <input type="text" id="authNick" style="width:100%; padding:15px; border:1px solid #ddd; border-radius:10px; margin-bottom:10px;" placeholder="ë‹‰ë„¤ì„">
            </div>
            
            <!-- ë²„íŠ¼ ì—°ê²°ì„ window í•¨ìˆ˜ë¡œ í™•ì‹¤í•˜ê²Œ ì²˜ë¦¬ -->
            <button onclick="window.doLogin()" class="btn-main" id="loginBtn">ë¡œê·¸ì¸</button>
            <button onclick="window.toggleSignup()" class="btn-sub" id="signupBtn">íšŒì›ê°€ì…</button>
            
            <!-- ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° ì¶”ê°€ -->
            <p onclick="window.resetPw()" style="font-size:12px; color:#999; margin-top:15px; cursor:pointer; text-decoration:underline;">ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠìœ¼ì…¨ë‚˜ìš”?</p>
        </div>
    </div>

    <!-- ê¸€ì“°ê¸°/ê´€ë¦¬ ëª¨ë‹¬ -->
    <div id="writeModal" class="modal-overlay">
        <div class="popup-box" style="text-align:left; max-width:400px; width:90%;">
            <h3 id="modalTitle" style="text-align:center; color:#333; margin-bottom:20px;">ê¸°ë¡í•˜ê¸°</h3>
            
            <div id="moodForm" class="hidden">
                <div id="emojiList" style="display:grid; grid-t